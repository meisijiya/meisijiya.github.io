<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="老江湖">


    <meta name="subtitle" content="记录进入房间门后的美好">


    <meta name="description" content="一年前，孤苦伶仃的老江湖，偶然间发现一处房间门，推门而入，从此进入了充满幸福的世界。">


    <meta name="keywords" content="老江湖,博客,房间门">


<title>Mybatis快速上手 | 欢迎来到老江湖的博客</title>



    <link rel="icon" href="/images/%E9%87%91%E6%AF%9B.png?_t=1758006391547">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    
    <link rel="stylesheet" href="/css/search.css">
    

<!-- highlight.js 样式（默认亮色） -->
<link id="hljs-theme" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/github.css">
<!-- highlight.js 自动上色功能 -->
<script src="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/lib/highlight.min.js"></script>
<script>hljs.highlightAll();</script>

<link rel="stylesheet" href="/css/custom.css">



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 7.3.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const pagebody = document.getElementsByTagName('body')[0]

            function setTheme(status) {

                if (status === 'dark') {
                    window.sessionStorage.theme = 'dark'
                    pagebody.classList.add('dark-theme');

                } else if (status === 'light') {
                    window.sessionStorage.theme = 'light'
                    pagebody.classList.remove('dark-theme');
                }
            };

            setTheme(window.sessionStorage.theme)
        })();
    </script>

    <div class="wrapper">
        <header>
  <nav class="navbar">
    <div class="container">
      <div class="navbar-header header-logo">
        <a href="/">老江湖的博客</a>
      </div>
      <div class="menu navbar-right">
        <!-- 在电脑端的导航链接区域添加搜索功能 -->
        <div class="search-container">
          <a href="javascript:;" onclick="toggleSearchInput()">🔍</a>
          <input
            type="text"
            id="nav-search-input-desktop"
            class="nav-search-input"
            placeholder="想知道我什么秘密呢，搜搜看吧"
            oninput="navSearch(this)"
          />
          <div id="nav-search-result-desktop" class="nav-search-result"></div>
        </div>

        
        <a class="menu-item" href="/archives">归档</a>
        
        <a class="menu-item" href="/category">分类</a>
        
        <a class="menu-item" href="/tag">标签</a>
        
        <a class="menu-item" href="/Timer">任务计时器</a>
        
        <a class="menu-item" href="/timeLine">时间线</a>
        
        <a class="menu-item" href="/tongji">网站统计</a>
        
        <a class="menu-item" href="/about">关于</a>
        

        <input id="switch_default" type="checkbox" class="switch_default" />
        <label for="switch_default" class="toggleBtn"></label>
      </div>
    </div>
  </nav>

  
  <nav class="navbar-mobile" id="nav-mobile">
    <div class="container">
      <div class="navbar-header">
        <div>
          <a href="/">老江湖的博客</a
          ><a id="mobile-toggle-theme">·&nbsp;Light</a>
        </div>

        <div class="menu-toggle" onclick="mobileBtn()">
          <svg
            class="menu-icon"
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
          >
            <path
              fill="currentColor"
              d="M4.5 17.27q-.213 0-.356-.145T4 16.768t.144-.356t.356-.143h15q.213 0 .356.144q.144.144.144.357t-.144.356t-.356.143zm0-4.77q-.213 0-.356-.144T4 11.999t.144-.356t.356-.143h15q.213 0 .356.144t.144.357t-.144.356t-.356.143zm0-4.77q-.213 0-.356-.143Q4 7.443 4 7.23t.144-.356t.356-.143h15q.213 0 .356.144T20 7.23t-.144.356t-.356.144z"
            />
          </svg>
          <svg
            class="close-icon"
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
          >
            <!-- Icon from Material Symbols Light by Google - https://github.com/google/material-design-icons/blob/master/LICENSE -->
            <path
              fill="currentColor"
              d="m12 12.708l-5.246 5.246q-.14.14-.344.15t-.364-.15t-.16-.354t.16-.354L11.292 12L6.046 6.754q-.14-.14-.15-.344t.15-.364t.354-.16t.354.16L12 11.292l5.246-5.246q.14-.14.345-.15q.203-.01.363.15t.16.354t-.16.354L12.708 12l5.246 5.246q.14.14.15.345q.01.203-.15.363t-.354.16t-.354-.16z"
            />
          </svg>
        </div>
      </div>

      <div class="menu" id="mobile-menu">
        
        <a class="menu-item" href="/archives">归档</a>
        
        <a class="menu-item" href="/category">分类</a>
        
        <a class="menu-item" href="/tag">标签</a>
        
        <a class="menu-item" href="/Timer">任务计时器</a>
        
        <a class="menu-item" href="/timeLine">时间线</a>
        
        <a class="menu-item" href="/tongji">网站统计</a>
        
        <a class="menu-item" href="/about">关于</a>
        
        <!-- 手机模式搜索框 -->
        <div class="search-container mobile-container">
          <a class="menu-item" href="javascript:;" onclick="toggleSearchInput()"
            >🔍</a
          >
          <input
            type="text"
            id="nav-search-input-mobile"
            class="nav-search-input"
            placeholder="想知道我什么秘密呢，搜搜看吧"
            oninput="navSearch(this)"
          />
          <div id="nav-search-result-mobile" class="nav-search-result"></div>
        </div>
      </div>
    </div>
  </nav>
</header>
<script>
  var mobileBtn = function f() {
    var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
    var mobileMenu = document.getElementById("mobile-menu");
    if (toggleMenu.classList.contains("active")) {
      toggleMenu.classList.remove("active");
      mobileMenu.classList.remove("active");
    } else {
      toggleMenu.classList.add("active");
      mobileMenu.classList.add("active");
    }
  };

  function toggleSearchInput() {
    const inputs = document.querySelectorAll(".nav-search-input");
    const results = document.querySelectorAll(".nav-search-result");
    inputs.forEach((input) => {
      input.classList.toggle("active");
      if (input.classList.contains("active")) input.focus();
    });
    results.forEach((r) => (r.style.display = "none"));
  }

  // 点击外部区域隐藏搜索框和结果容器的函数
  function handleClickOutsideSearch(event) {
    const searchContainers = document.querySelectorAll(".search-container");
    searchContainers.forEach((container) => {
      const searchInput = container.querySelector(".nav-search-input");
      const searchIcon = container.querySelector("a");

      // 如果点击的元素不是搜索输入框或搜索图标，则隐藏搜索框和结果容器
      if (
        !searchInput.contains(event.target) &&
        !searchIcon.contains(event.target)
      ) {
        searchInput.classList.remove("active");
        searchInput.value = ""
        // 根据输入框ID确定对应的结果容器
        let resultContainer;
        if (searchInput.id === "nav-search-input-mobile") {
          // 移动端结果容器
          resultContainer = document.querySelector(
            ".navbar-mobile .nav-search-result"
          );
        } else {
          // 桌面端结果容器
          resultContainer = document.getElementById(
            "nav-search-result-desktop"
          );
        }

        if (resultContainer) {
          resultContainer.style.display = "none";
          resultContainer.innerHTML = ""; // 清空结果容器内容
        }
      }
    });
  }

  // 添加全局点击事件监听器
  document.addEventListener("click", function (event) {
    handleClickOutsideSearch(event);
  });

  // 新增：搜索功能实现
  let searchData = []; // 全局变量存储搜索数据

  // 页面加载完成后获取搜索数据
  document.addEventListener("DOMContentLoaded", function () {
    fetch("/search.xml")
      .then((res) => res.text())
      .then((xmlText) => {
        const parser = new DOMParser();
        const xml = parser.parseFromString(xmlText, "text/xml");
        const entries = xml.getElementsByTagName("entry");
        for (let entry of entries) {
          searchData.push({
            title: entry.getElementsByTagName("title")[0]?.textContent || "",
            content:
              entry.getElementsByTagName("content")[0]?.textContent || "",
            url: entry.getElementsByTagName("url")[0]?.textContent || "",
          });
        }
      })
      .catch((err) => {
        console.error("Failed to load search data:", err);
      });
  });

  // 新增：导航搜索方法
  function navSearch(inputElement) {
    const keyword = inputElement.value.trim().toLowerCase();
    // 查找对应的搜索结果容器
    let resultContainer;

    if (inputElement.id === "nav-search-input-desktop") {
      // 桌面端
      resultContainer = document.getElementById("nav-search-result-desktop");
    } else if (inputElement.id === "nav-search-input-mobile") {
      // 移动端
      resultContainer =
        inputElement.parentNode.querySelector(".nav-search-result");
    }

    if (!resultContainer) return;

    resultContainer.innerHTML = "";

    if (!keyword) {
      resultContainer.style.display = "none";
      return;
    }

    // 显示结果容器
    resultContainer.style.display = "block";

    // 过滤搜索数据
    const results = searchData.filter(
      (data) =>
        (data.title && data.title.toLowerCase().includes(keyword)) ||
        (data.content && data.content.toLowerCase().includes(keyword))
    );

    if (results.length === 0) {
      resultContainer.innerHTML =
        '<p class="no-result">没有结果哟，换个关键词试试吧</p>';
      return;
    }

    // 限制显示结果数量
    const maxResults = 10;
    const limitedResults = results.slice(0, maxResults);

    // 构建结果HTML
    const html = limitedResults
      .map((item) => {
        // 提取包含关键字的内容片段
        let contentSnippet = "";
        if (item.content) {
          // 找到包含关键字的内容片段
          const contentLower = item.content.toLowerCase();
          const keywordIndex = contentLower.indexOf(keyword);

          // 提取关键字前后的内容
          const start = Math.max(0, keywordIndex - 3 * keyword.length);
          const end = Math.min(
            item.content.length,
            keywordIndex + 3 * keyword.length
          );
          contentSnippet = item.content.substring(start, end);
        // 高亮关键字
      const keywordRegex = new RegExp(`(${keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
      contentSnippet = contentSnippet.replace(
        keywordRegex,
        "<mark>$1</mark>"
      );
        }

        return `<div class="search-result-item">
  <a href="${item.url}">
    <div>标题：${item.title}</div>
    <div>内容：${contentSnippet}</div>
  </a>
</div>`;
      })
      .join("");
    resultContainer.innerHTML = html;
  }
</script>
<style>
  /* 手机端使用flexbox布局搜索容器 */
  .mobile-container {
    display: flex;
    align-items: center;
    flex-direction: row;
    margin-bottom: 10px;
    margin-left: 10px;
    flex-grow: 1;
    max-width: calc(100% - 40px);
  }


  .search-result-item {
  border: 1px solid #ddd; /* 边框 */
  margin: 4px 0; /* 外层间距 */
  padding: 0; /* 无内边距 */
  background: #fff; /* 背景色 */
}

.search-result-item a {
  display: block;
  text-decoration: none;
  color: inherit;
}

.search-result-item div {
  padding: 3px 8px; /* 紧凑的内边距 */
  margin: 0; /* 无外边距 */
  line-height: 1.3; /* 紧凑的行高 */
  word-wrap: break-word; /* 允许长单词换行 */
  white-space: normal; /* 允许正常换行 */
}

.search-result-item div:first-child {
  border-bottom: 1px solid #eee; /* 标题和内容之间的分隔线 */
}


</style>

            <div class="main">
                <div class="container">
    <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">展开所有</a>
        <a onclick="go_top()">返回顶部</a>
        <a onclick="go_bottom()">返回底部</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // 为 6 时展开所有
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // 这个值是由 tocbot 源码里定义的 scrollSmoothDuration 得来的
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? '展开所有' : '折叠所有';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>  
  <article class="post-wrap">
    <header class="post-header">
      <h1 class="post-title">Mybatis快速上手</h1>
      
      <div class="post-meta">
         作者:
        <a itemprop="author" rel="author" href="/">老江湖</a>
         
        <span class="post-time">
          <br />日期:
          <a href="#"
            >十月 15, 2025&nbsp;&nbsp;1:03:19</a
          >
        </span>
         
        <span class="post-category"
          ><br />
          分类: 
          <a href="/categories/java/">java</a>
          
        </span>
        
      </div>
      
    </header>

    <div class="post-content"><hr>
<h2 id="一、Mybatis-简介与快速上手"><a href="#一、Mybatis-简介与快速上手" class="headerlink" title="一、Mybatis 简介与快速上手"></a>一、Mybatis 简介与快速上手</h2><h3 id="1-1-什么是-Mybatis"><a href="#1-1-什么是-Mybatis" class="headerlink" title="1.1 什么是 Mybatis"></a>1.1 什么是 Mybatis</h3><ul>
<li><strong>核心定位</strong>：Mybatis 是一款<strong>持久层框架</strong>，专注于解决 Java 应用与数据库交互的问题，属于 ORM（对象关系映射）技术的一种实现。</li>
<li><strong>历史背景</strong>：前身是 Apache 的 iBatis 框架，2010 年迁移到 Google Code 并更名为 Mybatis，后托管于 GitHub，目前最新稳定版为 3.5.x（2025.10）。</li>
<li>解决的问题：<ul>
<li>消除 JDBC 冗余代码（手动加载驱动、创建连接、处理结果集等）</li>
<li>实现 SQL 与 Java 代码分离，便于维护</li>
<li>提供灵活的 SQL 定制能力（无需像 Hibernate 那样受限于 ORM 自动生成的 SQL）</li>
</ul>
</li>
<li><strong>核心思想</strong>：通过配置文件或注解定义 SQL 语句与 Java 对象的映射关系，框架自动完成数据的查询、封装与持久化操作。</li>
</ul>
<h3 id="1-2-环境搭建"><a href="#1-2-环境搭建" class="headerlink" title="1.2 环境搭建"></a>1.2 环境搭建</h3><h4 id="基础依赖配置"><a href="#基础依赖配置" class="headerlink" title="基础依赖配置"></a>基础依赖配置</h4><ul>
<li><strong>Maven 依赖</strong>（核心 + 数据库驱动）：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Mybatis核心依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.16<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- MySQL驱动（根据数据库类型选择） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.33<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- 适配MySQL 8.x --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Gradle 依赖</strong>：</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation <span class="string">&#x27;org.mybatis:mybatis:3.5.16&#x27;</span></span><br><span class="line">implementation <span class="string">&#x27;mysql:mysql-connector-java:8.0.33&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-配置文件结构（mybatis-config-xml）"><a href="#1-3-配置文件结构（mybatis-config-xml）" class="headerlink" title="1.3 配置文件结构（mybatis-config.xml）"></a>1.3 配置文件结构（mybatis-config.xml）</h3><p>Mybatis 核心配置文件包含框架全局设置，标签顺序有严格要求（properties → settings → typeAliases → … → environments → mappers）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1. 引入外部配置文件（如数据库连接信息） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;db.properties&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 2. 全局设置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 开启驼峰命名自动映射（数据库user_name → 实体userName） --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 开启日志（可选LOG4J、SLF4J等） --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;logImpl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;LOG4J&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 二级缓存开关 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 3. 类型别名（简化类名书写） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 单个类别名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">type</span>=<span class="string">&quot;com.example.pojo.User&quot;</span> <span class="attr">alias</span>=<span class="string">&quot;User&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 包扫描（默认别名为类名首字母小写，如User→user） --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.example.pojo&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 4. 环境配置（可配置多环境，default指定默认环境） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 事务管理器：JDBC（依赖数据库事务）/MANAGED（交给容器管理） --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 数据源：POOLED（连接池）/UNPOOLED（无连接池）/JNDI（容器数据源） --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;db.driver&#125;&quot;</span>/&gt;</span> <span class="comment">&lt;!-- 从properties文件获取 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;db.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;db.username&#125;&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;db.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 5. 映射器（注册SQL映射文件或接口） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 方式1：资源路径（XML文件） --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mappers/UserMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 方式2：接口全类名（需XML与接口同包同名） --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.example.mapper.UserMapper&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 方式3：包扫描（批量注册接口） --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.example.mapper&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>补充</strong>：<code>db.properties</code>文件示例：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">db.driver</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">db.url</span>=<span class="string">jdbc:mysql://localhost:3306/test?useSSL=false&amp;serverTimezone=UTC</span></span><br><span class="line"><span class="attr">db.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">db.password</span>=<span class="string">123456</span></span><br></pre></td></tr></table></figure>

<h3 id="1-4-基础使用示例（工具类-核心-API）"><a href="#1-4-基础使用示例（工具类-核心-API）" class="headerlink" title="1.4 基础使用示例（工具类 + 核心 API）"></a>1.4 基础使用示例（工具类 + 核心 API）</h3><h4 id="工具类封装（MybatisUtil）"><a href="#工具类封装（MybatisUtil）" class="headerlink" title="工具类封装（MybatisUtil）"></a>工具类封装（MybatisUtil）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisUtil</span> &#123;</span><br><span class="line">    <span class="comment">// SqlSessionFactory是线程安全的，全局只需要一个实例</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. 加载配置文件（InputStream/Reader均可）</span></span><br><span class="line">            <span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line">            <span class="comment">// 2. 创建SqlSessionFactory（建造者模式）</span></span><br><span class="line">            sqlSessionFactory = <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(is);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;初始化SqlSessionFactory失败&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取SqlSession实例</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> autoCommit 是否自动提交事务（DML操作建议关闭自动提交）</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> SqlSession（线程不安全，需单独获取）</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title function_">openSession</span><span class="params">(<span class="type">boolean</span> autoCommit)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sqlSessionFactory.openSession(autoCommit);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 简化调用：默认不自动提交</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SqlSession <span class="title function_">openSession</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> openSession(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="核心-API-说明"><a href="#核心-API-说明" class="headerlink" title="核心 API 说明"></a>核心 API 说明</h4><ul>
<li><strong>SqlSessionFactory</strong>：工厂类，负责创建 SqlSession，全局唯一，线程安全。</li>
<li><strong>SqlSession</strong>：会话对象，封装了数据库连接，提供 CRUD 方法，线程不安全，需每次使用时创建，用完关闭。</li>
<li>使用流程：<ol>
<li>通过工具类获取 SqlSession</li>
<li>执行 SQL 操作（直接调用 API 或通过 Mapper 接口）</li>
<li>提交 &#x2F; 回滚事务（DML 操作）</li>
<li>关闭 SqlSession（try-with-resources 自动关闭）</li>
</ol>
</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?content_id=175142038&content_type=Article&match_order=1&q=%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80&zhida_source=entity">数据定义语言</a>(DDL)、<a target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?content_id=175142038&content_type=Article&match_order=1&q=%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80&zhida_source=entity">数据查询语言</a>（DQL）、<a target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?content_id=175142038&content_type=Article&match_order=1&q=%E6%95%B0%E6%8D%AE%E6%93%8D%E7%BA%B5%E8%AF%AD%E8%A8%80&zhida_source=entity">数据操纵语言</a>（DML）、<a target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?content_id=175142038&content_type=Article&match_order=1&q=%E6%95%B0%E6%8D%AE%E6%8E%A7%E5%88%B6%E8%AF%AD%E8%A8%80&zhida_source=entity">数据控制语言</a>（DCL）</p>
</blockquote>
<h3 id="1-5-MyBatis-与-JDBC-的对比（解决-JDBC-的核心痛点）"><a href="#1-5-MyBatis-与-JDBC-的对比（解决-JDBC-的核心痛点）" class="headerlink" title="1.5 MyBatis 与 JDBC 的对比（解决 JDBC 的核心痛点）"></a>1.5 MyBatis 与 JDBC 的对比（解决 JDBC 的核心痛点）</h3><p>JDBC 操作数据库的典型流程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JDBC原生代码（冗余且繁琐）</span></span><br><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="type">PreparedStatement</span> <span class="variable">ps</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 加载驱动（硬编码）</span></span><br><span class="line">    Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">    <span class="comment">// 2. 创建连接（URL/账号/密码硬编码）</span></span><br><span class="line">    conn = DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">    <span class="comment">// 3. 编写SQL（字符串拼接易引发注入）</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user where id = &quot;</span> + id; <span class="comment">// 存在SQL注入风险</span></span><br><span class="line">    ps = conn.prepareStatement(sql);</span><br><span class="line">    <span class="comment">// 4. 执行查询</span></span><br><span class="line">    rs = ps.executeQuery();</span><br><span class="line">    <span class="comment">// 5. 手动封装结果集（重复劳动）</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">        user.setId(rs.getInt(<span class="string">&quot;id&quot;</span>));</span><br><span class="line">        user.setName(rs.getString(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">        <span class="comment">// ... 更多字段映射</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">// 6. 手动关闭资源（繁琐且易遗漏）</span></span><br><span class="line">    <span class="keyword">if</span> (rs != <span class="literal">null</span>) <span class="keyword">try</span> &#123; rs.close(); &#125; <span class="keyword">catch</span> (SQLException e) &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> (ps != <span class="literal">null</span>) <span class="keyword">try</span> &#123; ps.close(); &#125; <span class="keyword">catch</span> (SQLException e) &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> (conn != <span class="literal">null</span>) <span class="keyword">try</span> &#123; conn.close(); &#125; <span class="keyword">catch</span> (SQLException e) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MyBatis 的优化点：</p>
<ul>
<li>消除硬编码：通过配置文件管理数据库连接信息和 SQL</li>
<li>防注入：使用<code>#&#123;&#125;</code>预编译参数（替代 JDBC 的字符串拼接）</li>
<li>自动映射：结果集自动封装为 Java 对象（无需手动<code>rs.getXXX()</code>）</li>
<li>资源管理：自动处理连接、Statement、ResultSet 的创建与关闭</li>
<li>事务简化：通过<code>SqlSession</code>的<code>commit()</code>&#x2F;<code>rollback()</code>统一管理</li>
</ul>
<h3 id="1-6-初次使用的细节补充"><a href="#1-6-初次使用的细节补充" class="headerlink" title="1.6 初次使用的细节补充"></a>1.6 初次使用的细节补充</h3><ul>
<li><p>Mapper 配置文件的 DTD 引入：在 XML 映射文件头部添加 DTD 约束，确保标签格式正确（IDE 会自动提示）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>环境配置细节</strong>：<code>environments</code>标签的<code>default</code>属性需与某个<code>environment</code>的<code>id</code>一致；<code>transactionManager</code>的<code>MANAGED</code>类型会将事务交给容器（如 Spring）管理，此时 MyBatis 不做任何事务处理。</p>
</li>
</ul>
<h3 id="1-7-XML-格式规范与特殊字符处理"><a href="#1-7-XML-格式规范与特殊字符处理" class="headerlink" title="1.7 XML 格式规范与特殊字符处理"></a>1.7 XML 格式规范与特殊字符处理</h3><h5 id="（1）基本格式规则"><a href="#（1）基本格式规则" class="headerlink" title="（1）基本格式规则"></a>（1）基本格式规则</h5><ul>
<li>根节点唯一：核心配置文件根节点为<code>&lt;configuration&gt;</code>，映射文件为<code>&lt;mapper&gt;</code></li>
<li>标签嵌套严格：子标签必须符合 MyBatis 规定的顺序（如<code>configuration</code>的子标签顺序不可乱）</li>
<li>属性值引号：单引号或双引号均可，建议统一使用双引号</li>
</ul>
<h5 id="（2）特殊字符处理（转义字符与-CDATA）"><a href="#（2）特殊字符处理（转义字符与-CDATA）" class="headerlink" title="（2）特殊字符处理（转义字符与 CDATA）"></a>（2）特殊字符处理（转义字符与 CDATA）</h5><p>当 SQL 中包含<code>&lt;</code>、<code>&gt;</code>、<code>&amp;</code>等特殊字符时，有两种处理方式：</p>
<ul>
<li><p>转义字符：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 原SQL：select * from user where age &lt; 18 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectYoungUser&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    select * from user where age <span class="symbol">&amp;lt;</span> 18 <span class="comment">&lt;!-- &amp;lt; 对应 &lt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>XML 中常用的转义字符归纳如下：</p>
<table>
<thead>
<tr>
<th>转义序列</th>
<th>对应字符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>&amp;amp</code> 或 <code>&amp;</code></td>
<td><code>&amp;</code></td>
<td>和</td>
</tr>
<tr>
<td><code>&amp;lt</code>或 <code>&lt;</code></td>
<td><code>&lt;</code></td>
<td>小于号</td>
</tr>
<tr>
<td><code>&amp;gt</code> 或<code> &gt;</code></td>
<td><code>&gt;</code></td>
<td>大于号</td>
</tr>
<tr>
<td><code>&amp;quot</code></td>
<td><code>&quot;</code></td>
<td>双引号</td>
</tr>
<tr>
<td><code>&amp;nbsp</code></td>
<td>（空格）</td>
<td>空格</td>
</tr>
<tr>
<td><code>&amp;copy</code></td>
<td><code>©</code></td>
<td>版权符</td>
</tr>
<tr>
<td><code>&amp;reg</code></td>
<td><code>®</code></td>
<td>注册符</td>
</tr>
</tbody></table>
</li>
<li><p>CDATA 区域</p>
<p>（无需转义，适合复杂 SQL）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectYoungUser&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    &lt;![CDATA[</span><br><span class="line">        select * from user where age &lt; 18 and status &amp; 1 = 1</span><br><span class="line">    ]]&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="（3）Java-解析-XML-示例（了解-MyBatis-底层原理）"><a href="#（3）Java-解析-XML-示例（了解-MyBatis-底层原理）" class="headerlink" title="（3）Java 解析 XML 示例（了解 MyBatis 底层原理）"></a>（3）Java 解析 XML 示例（了解 MyBatis 底层原理）</h5><p>MyBatis 通过 DOM 解析 XML 配置文件，简化示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 解析MyBatis映射文件中的SQL</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XmlParser</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">DocumentBuilderFactory</span> <span class="variable">factory</span> <span class="operator">=</span> DocumentBuilderFactory.newInstance();</span><br><span class="line">        <span class="type">DocumentBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> factory.newDocumentBuilder();</span><br><span class="line">        <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> builder.parse(Resources.getResourceAsStream(<span class="string">&quot;mappers/UserMapper.xml&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 获取select标签的SQL内容</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> doc.getElementsByTagName(<span class="string">&quot;select&quot;</span>).item(<span class="number">0</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> node.getTextContent().trim();</span><br><span class="line">        System.out.println(<span class="string">&quot;解析到的SQL：&quot;</span> + sql);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="二、核心查询操作详解"><a href="#二、核心查询操作详解" class="headerlink" title="二、核心查询操作详解"></a>二、核心查询操作详解</h2><h3 id="2-1-基础查询配置（XML-映射文件）"><a href="#2-1-基础查询配置（XML-映射文件）" class="headerlink" title="2.1 基础查询配置（XML 映射文件）"></a>2.1 基础查询配置（XML 映射文件）</h3><p><code>UserMapper.xml</code>核心标签说明：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;userMapper&quot;</span>&gt;</span> <span class="comment">&lt;!-- 命名空间：区分不同映射文件的SQL --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 1. 简单查询 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">id</span>=<span class="string">&quot;selectAllUser&quot;</span>  &lt;!<span class="attr">--</span> <span class="attr">SQL唯一标识</span>（<span class="attr">与namespace组合为全限定名</span>）<span class="attr">--</span>&gt;</span></span><br><span class="line">        resultType=&quot;User&quot;   <span class="comment">&lt;!-- 结果类型（单个对象/集合元素类型） --&gt;</span></span><br><span class="line">        timeout=&quot;30&quot;&gt;       <span class="comment">&lt;!-- 超时时间（秒） --&gt;</span></span><br><span class="line">        select * from user</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 2. 条件查询（单个参数） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">id</span>=<span class="string">&quot;selectUserById&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>  &lt;!<span class="attr">--</span> <span class="attr">参数类型</span>（<span class="attr">可省略</span>，<span class="attr">Mybatis自动推断</span>） <span class="attr">--</span>&gt;</span></span><br><span class="line">        resultType=&quot;User&quot;&gt;</span><br><span class="line">        select * from user where id = #&#123;id&#125;  <span class="comment">&lt;!-- #&#123;id&#125;：参数占位符（预编译，防SQL注入） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 3. 多条件查询（注意参数传递方式） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByIdAndAge&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">        select * from user where id = #&#123;id&#125; and age = #&#123;age&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-Java-调用方式（3-种常用方式）"><a href="#2-2-Java-调用方式（3-种常用方式）" class="headerlink" title="2.2 Java 调用方式（3 种常用方式）"></a>2.2 Java 调用方式（3 种常用方式）</h3><h4 id="方式-1：直接通过-SqlSession-调用（指定全限定名）"><a href="#方式-1：直接通过-SqlSession-调用（指定全限定名）" class="headerlink" title="方式 1：直接通过 SqlSession 调用（指定全限定名）"></a>方式 1：直接通过 SqlSession 调用（指定全限定名）</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> MybatisUtil.openSession()) &#123;</span><br><span class="line">    <span class="comment">// 全限定名 = namespace + id</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> session.selectOne(<span class="string">&quot;userMapper.selectUserById&quot;</span>, <span class="number">1</span>); </span><br><span class="line">    List&lt;User&gt; users = session.selectList(<span class="string">&quot;userMapper.selectAllUser&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="方式-2：多参数传递（-Param-注解-Map）"><a href="#方式-2：多参数传递（-Param-注解-Map）" class="headerlink" title="方式 2：多参数传递（@Param 注解 &#x2F; Map）"></a>方式 2：多参数传递（@Param 注解 &#x2F; Map）</h4><ul>
<li><strong>@Param 注解</strong>（推荐，清晰直观）：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Mapper接口方法</span></span><br><span class="line">User <span class="title function_">selectUserByIdAndAge</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> <span class="type">int</span> id, <span class="meta">@Param(&quot;age&quot;)</span> <span class="type">int</span> age)</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// XML中直接使用#&#123;id&#125;和#&#123;age&#125;（无需额外配置）</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Map 传递</strong>（适合参数较多的场景）：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; params = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">params.put(<span class="string">&quot;id&quot;</span>, <span class="number">1</span>);</span><br><span class="line">params.put(<span class="string">&quot;age&quot;</span>, <span class="number">18</span>);</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> session.selectOne(<span class="string">&quot;selectUserByIdAndAge&quot;</span>, params);</span><br></pre></td></tr></table></figure>

<h4 id="方式-3：通过实体类传递参数"><a href="#方式-3：通过实体类传递参数" class="headerlink" title="方式 3：通过实体类传递参数"></a>方式 3：通过实体类传递参数</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实体类</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserQuery</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// XML中使用#&#123;属性名&#125;</span></span><br><span class="line">&lt;select id=<span class="string">&quot;selectByQuery&quot;</span> resultType=<span class="string">&quot;User&quot;</span>&gt;</span><br><span class="line">    select * from user <span class="type">where</span> <span class="variable">id</span> <span class="operator">=</span> #&#123;id&#125; <span class="type">and</span> <span class="variable">age</span> <span class="operator">=</span> #&#123;age&#125;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line"><span class="type">UserQuery</span> <span class="variable">query</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserQuery</span>();</span><br><span class="line">query.setId(<span class="number">1</span>);</span><br><span class="line">query.setAge(<span class="number">18</span>);</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> session.selectOne(<span class="string">&quot;selectByQuery&quot;</span>, query);</span><br></pre></td></tr></table></figure>

<h3 id="2-3-字段映射问题解决（3-种方案）"><a href="#2-3-字段映射问题解决（3-种方案）" class="headerlink" title="2.3 字段映射问题解决（3 种方案）"></a>2.3 字段映射问题解决（3 种方案）</h3><p>当实体类字段与数据库列名不一致时（如实体<code>uid</code> vs 数据库<code>id</code>），需手动映射：</p>
<h4 id="方案-1：resultMap（最常用，XML-配置）"><a href="#方案-1：resultMap（最常用，XML-配置）" class="headerlink" title="方案 1：resultMap（最常用，XML 配置）"></a>方案 1：resultMap（最常用，XML 配置）</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 定义映射规则 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;uid&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span> <span class="comment">&lt;!-- 主键映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span>/&gt;</span> <span class="comment">&lt;!-- 普通字段映射 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;userAge&quot;</span> <span class="attr">column</span>=<span class="string">&quot;age&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 使用映射规则 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userMap&quot;</span>&gt;</span></span><br><span class="line">    select * from user where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="方案-2：SQL-别名（简单场景）"><a href="#方案-2：SQL-别名（简单场景）" class="headerlink" title="方案 2：SQL 别名（简单场景）"></a>方案 2：SQL 别名（简单场景）</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    select id as uid, name as username, age as userAge from user where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="方案-3：全局驼峰映射（针对下划线命名）"><a href="#方案-3：全局驼峰映射（针对下划线命名）" class="headerlink" title="方案 3：全局驼峰映射（针对下划线命名）"></a>方案 3：全局驼峰映射（针对下划线命名）</h4><p>在<code>mybatis-config.xml</code>中开启：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;mapUnderscoreToCamelCase&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>效果：数据库<code>user_name</code> → 实体<code>userName</code>，<code>user_age</code> → <code>userAge</code></li>
</ul>
<h2 id="三、接口绑定与注解开发"><a href="#三、接口绑定与注解开发" class="headerlink" title="三、接口绑定与注解开发"></a>三、接口绑定与注解开发</h2><h3 id="3-1-接口绑定（推荐方式）"><a href="#3-1-接口绑定（推荐方式）" class="headerlink" title="3.1 接口绑定（推荐方式）"></a>3.1 接口绑定（推荐方式）</h3><p><strong>核心原理</strong>：通过动态代理，将 Mapper 接口与 XML 映射文件绑定，无需编写实现类。</p>
<h4 id="步骤-1：定义-Mapper-接口"><a href="#步骤-1：定义-Mapper-接口" class="headerlink" title="步骤 1：定义 Mapper 接口"></a>步骤 1：定义 Mapper 接口</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="comment">// 方法名 = XML中select的id</span></span><br><span class="line">    <span class="comment">// 参数类型 = parameterType</span></span><br><span class="line">    <span class="comment">// 返回值类型 = resultType/resultMap</span></span><br><span class="line">    User <span class="title function_">selectUserById</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">    List&lt;User&gt; <span class="title function_">selectAllUser</span><span class="params">()</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(User user)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">updateUserAge</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> <span class="type">int</span> id, <span class="meta">@Param(&quot;age&quot;)</span> <span class="type">int</span> age)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">deleteUserById</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="步骤-2：配置-XML-映射文件（namespace-必须为接口全类名）"><a href="#步骤-2：配置-XML-映射文件（namespace-必须为接口全类名）" class="headerlink" title="步骤 2：配置 XML 映射文件（namespace 必须为接口全类名）"></a>步骤 2：配置 XML 映射文件（namespace 必须为接口全类名）</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.example.mapper.UserMapper&quot;</span>&gt;</span> <span class="comment">&lt;!-- 接口全类名 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span> <span class="comment">&lt;!-- id = 方法名 --&gt;</span></span><br><span class="line">        select * from user where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="步骤-3：通过接口调用"><a href="#步骤-3：通过接口调用" class="headerlink" title="步骤 3：通过接口调用"></a>步骤 3：通过接口调用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> MybatisUtil.openSession()) &#123;</span><br><span class="line">    <span class="comment">// 获取接口代理对象</span></span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> session.getMapper(UserMapper.class);</span><br><span class="line">    <span class="comment">// 调用方法（自动执行对应SQL）</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> mapper.selectUserById(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-注解开发（简化配置）"><a href="#3-2-注解开发（简化配置）" class="headerlink" title="3.2 注解开发（简化配置）"></a>3.2 注解开发（简化配置）</h3><p>适合简单 SQL，复杂 SQL 建议用 XML。</p>
<h4 id="常用注解说明"><a href="#常用注解说明" class="headerlink" title="常用注解说明"></a>常用注解说明</h4><table>
<thead>
<tr>
<th>注解</th>
<th>作用</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>@Select</td>
<td>查询操作</td>
<td>@Select(“SELECT * FROM user WHERE id &#x3D; #{id}”)</td>
</tr>
<tr>
<td>@Insert</td>
<td>插入操作</td>
<td>@Insert(“INSERT INTO user(name) VALUES(#{name})”)</td>
</tr>
<tr>
<td>@Update</td>
<td>更新操作</td>
<td>@Update(“UPDATE user SET name &#x3D; #{name} WHERE id &#x3D; #{id}”)</td>
</tr>
<tr>
<td>@Delete</td>
<td>删除操作</td>
<td>@Delete(“DELETE FROM user WHERE id &#x3D; #{id}”)</td>
</tr>
<tr>
<td>@Results</td>
<td>定义结果映射</td>
<td>@Results({@Result(property&#x3D;”uid”, column&#x3D;”id”)})</td>
</tr>
<tr>
<td>@Param</td>
<td>声明参数名</td>
<td>方法参数前加 @Param (“id”)</td>
</tr>
<tr>
<td>@Options</td>
<td>额外配置（如自增主键）</td>
<td>@Options(useGeneratedKeys &#x3D; true, keyProperty &#x3D; “id”)</td>
</tr>
</tbody></table>
<h4 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="comment">// 基础查询</span></span><br><span class="line">    <span class="meta">@Select(&quot;SELECT * FROM user WHERE id = #&#123;id&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">selectUserById</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 插入并返回自增主键</span></span><br><span class="line">    <span class="meta">@Options(useGeneratedKeys = true, keyProperty = &quot;id&quot;)</span> <span class="comment">// 主键回写至实体id属性</span></span><br><span class="line">    <span class="meta">@Insert(&quot;INSERT INTO user(name, age) VALUES(#&#123;name&#125;, #&#123;age&#125;)&quot;)</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">insertUser</span><span class="params">(User user)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 结果映射（解决字段不一致）</span></span><br><span class="line">    <span class="meta">@Results(&#123;</span></span><br><span class="line"><span class="meta">        @Result(property = &quot;uid&quot;, column = &quot;id&quot;),       // 主键映射</span></span><br><span class="line"><span class="meta">        @Result(property = &quot;username&quot;, column = &quot;name&quot;) // 普通字段映射</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="meta">@Select(&quot;SELECT * FROM user&quot;)</span></span><br><span class="line">    List&lt;User&gt; <span class="title function_">selectAllUser</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 动态SQL（注解中用&lt;script&gt;包裹）</span></span><br><span class="line">    <span class="meta">@Select(&quot;&lt;script&gt;&quot; +</span></span><br><span class="line"><span class="meta">            &quot;SELECT * FROM user WHERE 1=1&quot; +</span></span><br><span class="line"><span class="meta">            &quot;&lt;if test=&#x27;name != null&#x27;&gt; AND name = #&#123;name&#125;&lt;/if&gt;&quot; +</span></span><br><span class="line"><span class="meta">            &quot;&lt;if test=&#x27;age != null&#x27;&gt; AND age = #&#123;age&#125;&lt;/if&gt;&quot; +</span></span><br><span class="line"><span class="meta">            &quot;&lt;/script&gt;&quot;)</span></span><br><span class="line">    List&lt;User&gt; <span class="title function_">selectByCondition</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="四、复杂关系查询（关联映射）"><a href="#四、复杂关系查询（关联映射）" class="headerlink" title="四、复杂关系查询（关联映射）"></a>四、复杂关系查询（关联映射）</h2><h3 id="4-1-一对一查询（如-User-与-UserDetail）"><a href="#4-1-一对一查询（如-User-与-UserDetail）" class="headerlink" title="4.1 一对一查询（如 User 与 UserDetail）"></a>4.1 一对一查询（如 User 与 UserDetail）</h3><h4 id="实体类设计"><a href="#实体类设计" class="headerlink" title="实体类设计"></a>实体类设计</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> UserDetail detail; <span class="comment">// 一对一关联（一个用户对应一个详情）</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDetail</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">    <span class="keyword">private</span> Date registerTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="关联查询实现（2-种方式）"><a href="#关联查询实现（2-种方式）" class="headerlink" title="关联查询实现（2 种方式）"></a>关联查询实现（2 种方式）</h4><h5 id="方式-1：关联查询（JOIN-语句，一次查询）"><a href="#方式-1：关联查询（JOIN-语句，一次查询）" class="headerlink" title="方式 1：关联查询（JOIN 语句，一次查询）"></a>方式 1：关联查询（JOIN 语句，一次查询）</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userWithDetail&quot;</span> <span class="attr">type</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- association：一对一关联 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">property</span>=<span class="string">&quot;detail&quot;</span>      &lt;!<span class="attr">--</span> <span class="attr">实体中关联属性名</span> <span class="attr">--</span>&gt;</span></span><br><span class="line">        javaType=&quot;UserDetail&quot;&gt; <span class="comment">&lt;!-- 关联属性类型 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;detail_id&quot;</span>/&gt;</span> <span class="comment">&lt;!-- 注意column与查询结果别名对应 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span> <span class="attr">column</span>=<span class="string">&quot;address&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;registerTime&quot;</span> <span class="attr">column</span>=<span class="string">&quot;register_time&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserWithDetail&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userWithDetail&quot;</span>&gt;</span></span><br><span class="line">    SELECT </span><br><span class="line">        u.id, u.name, </span><br><span class="line">        ud.id as detail_id, ud.address, ud.register_time </span><br><span class="line">    FROM user u </span><br><span class="line">    LEFT JOIN user_detail ud ON u.id = ud.user_id </span><br><span class="line">    WHERE u.id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="方式-2：嵌套查询（子查询，多次查询）"><a href="#方式-2：嵌套查询（子查询，多次查询）" class="headerlink" title="方式 2：嵌套查询（子查询，多次查询）"></a>方式 2：嵌套查询（子查询，多次查询）</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userWithDetail&quot;</span> <span class="attr">type</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">property</span>=<span class="string">&quot;detail&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">javaType</span>=<span class="string">&quot;UserDetail&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>                   &lt;!<span class="attr">--</span> <span class="attr">传递给子查询的参数</span>（<span class="attr">user的id</span>） <span class="attr">--</span>&gt;</span></span><br><span class="line">        select=&quot;selectUserDetail&quot;/&gt;   <span class="comment">&lt;!-- 子查询的id --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 主查询 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserWithDetail&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userWithDetail&quot;</span>&gt;</span></span><br><span class="line">    select * from user where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 子查询（根据user_id查详情） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserDetail&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;UserDetail&quot;</span>&gt;</span></span><br><span class="line">    select * from user_detail where user_id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：嵌套查询可能导致 N+1 问题（查询 1 个用户引发 1 次主查询 + N 次子查询），建议优先用关联查询。</p>
<h4 id="多参数传递"><a href="#多参数传递" class="headerlink" title="多参数传递"></a>多参数传递</h4><p><code>association</code>标签的<code>column</code>属性支持多列传递（用于子查询需要多个参数的场景）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userWithDetail&quot;</span> <span class="attr">type</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">property</span>=<span class="string">&quot;detail&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">javaType</span>=<span class="string">&quot;UserDetail&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">column</span>=<span class="string">&quot;&#123;userId=id, status=status&#125;&quot;</span> &lt;!<span class="attr">--</span> <span class="attr">多列参数</span>（<span class="attr">key为子查询参数名</span>，<span class="attr">value为当前查询列名</span>） <span class="attr">--</span>&gt;</span></span><br><span class="line">        select=&quot;selectUserDetailByMultiParams&quot;/&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 子查询接收多参数 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserDetailByMultiParams&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;UserDetail&quot;</span>&gt;</span></span><br><span class="line">    select * from user_detail where user_id = #&#123;userId&#125; and status = #&#123;status&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-一对多查询（如-User-与-Book）"><a href="#4-2-一对多查询（如-User-与-Book）" class="headerlink" title="4.2 一对多查询（如 User 与 Book）"></a>4.2 一对多查询（如 User 与 Book）</h3><h4 id="实体类设计-1"><a href="#实体类设计-1" class="headerlink" title="实体类设计"></a>实体类设计</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Book&gt; books; <span class="comment">// 一对多关联（一个用户有多本书）</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Book</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> userId; <span class="comment">// 关联用户id</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="实现方式（关联查询）"><a href="#实现方式（关联查询）" class="headerlink" title="实现方式（关联查询）"></a>实现方式（关联查询）</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userWithBooks&quot;</span> <span class="attr">type</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- collection：一对多关联 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">property</span>=<span class="string">&quot;books&quot;</span>    &lt;!<span class="attr">--</span> <span class="attr">集合属性名</span> <span class="attr">--</span>&gt;</span></span><br><span class="line">        ofType=&quot;Book&quot;&gt;      <span class="comment">&lt;!-- 集合元素类型（区别于javaType） --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;book_id&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;title&quot;</span> <span class="attr">column</span>=<span class="string">&quot;title&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;userId&quot;</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserWithBooks&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userWithBooks&quot;</span>&gt;</span></span><br><span class="line">    SELECT </span><br><span class="line">        u.id, u.name, </span><br><span class="line">        b.id as book_id, b.title, b.user_id </span><br><span class="line">    FROM user u </span><br><span class="line">    LEFT JOIN book b ON u.id = b.user_id </span><br><span class="line">    WHERE u.id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="加载方式"><a href="#加载方式" class="headerlink" title="加载方式"></a>加载方式</h4><p><code>collection</code>标签的<code>fetchType</code>属性控制加载方式（<code>eager</code>立即加载 &#x2F; <code>lazy</code>延迟加载）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userWithBooks&quot;</span> <span class="attr">type</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">property</span>=<span class="string">&quot;books&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">ofType</span>=<span class="string">&quot;Book&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">column</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">select</span>=<span class="string">&quot;selectBooksByUserId&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">fetchType</span>=<span class="string">&quot;lazy&quot;</span>/&gt;</span> <span class="comment">&lt;!-- 延迟加载：只有调用user.getBooks()时才执行子查询 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBooksByUserId&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Book&quot;</span>&gt;</span></span><br><span class="line">    select * from book where user_id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>延迟加载配置</strong>（需在全局设置中开启）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span> <span class="comment">&lt;!-- 全局延迟加载开关 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;aggressiveLazyLoading&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span> <span class="comment">&lt;!-- 按需加载（不触发关联对象全加载） --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="五、DML-操作与事务"><a href="#五、DML-操作与事务" class="headerlink" title="五、DML 操作与事务"></a>五、DML 操作与事务</h2><h3 id="5-1-增删改操作（XML-配置）"><a href="#5-1-增删改操作（XML-配置）" class="headerlink" title="5.1 增删改操作（XML 配置）"></a>5.1 增删改操作（XML 配置）</h3><h4 id="插入操作（含自增主键）"><a href="#插入操作（含自增主键）" class="headerlink" title="插入操作（含自增主键）"></a>插入操作（含自增主键）</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span>  &lt;!<span class="attr">--</span> <span class="attr">开启自增主键获取</span> <span class="attr">--</span>&gt;</span></span><br><span class="line">    keyProperty=&quot;id&quot;&gt;        <span class="comment">&lt;!-- 主键值回写至实体的id属性 --&gt;</span></span><br><span class="line">    INSERT INTO user(name, age) VALUES(#&#123;name&#125;, #&#123;age&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>调用后可通过<code>user.getId()</code>获取自动生成的主键</li>
</ul>
<p><strong>非自增主键（如 UUID）的获取方式：</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUserWithUUID&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 插入前生成UUID --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">selectKey</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>    &lt;!<span class="attr">--</span> <span class="attr">主键回写至实体的id属性</span> <span class="attr">--</span>&gt;</span></span><br><span class="line">        resultType=&quot;String&quot; <span class="comment">&lt;!-- 主键类型 --&gt;</span></span><br><span class="line">        order=&quot;BEFORE&quot;&gt;     <span class="comment">&lt;!-- 执行时机：BEFORE（插入前）/AFTER（插入后） --&gt;</span></span><br><span class="line">        SELECT REPLACE(UUID(), &#x27;-&#x27;, &#x27;&#x27;) AS id</span><br><span class="line">    <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">    INSERT INTO user(id, name) VALUES(#&#123;id&#125;, #&#123;name&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>联合主键场景（<code>keyColumn</code>指定数据库列名）：</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertOrderItem&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">keyProperty</span>=<span class="string">&quot;itemId&quot;</span> <span class="attr">keyColumn</span>=<span class="string">&quot;item_id&quot;</span>&gt;</span> <span class="comment">&lt;!-- 多主键用逗号分隔：keyColumn=&quot;col1,col2&quot; --&gt;</span></span><br><span class="line">    INSERT INTO order_item(order_id, product_id, quantity) </span><br><span class="line">    VALUES(#&#123;orderId&#125;, #&#123;productId&#125;, #&#123;quantity&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>此配置避免了插入后需手动查询主键的额外操作，简化了关联数据的插入逻辑。</li>
</ul>
<h4 id="更新操作"><a href="#更新操作" class="headerlink" title="更新操作"></a>更新操作</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    UPDATE user </span><br><span class="line">    SET name = #&#123;name&#125;, age = #&#123;age&#125; </span><br><span class="line">    WHERE id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="删除操作"><a href="#删除操作" class="headerlink" title="删除操作"></a>删除操作</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteUserById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">    DELETE FROM user WHERE id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="5-2-事务管理"><a href="#5-2-事务管理" class="headerlink" title="5.2 事务管理"></a>5.2 事务管理</h3><p>Mybatis 事务默认依赖 JDBC 事务管理器，需手动控制提交 &#x2F; 回滚。</p>
<h4 id="事务操作流程"><a href="#事务操作流程" class="headerlink" title="事务操作流程"></a>事务操作流程</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> MybatisUtil.openSession()) &#123; <span class="comment">// 关闭自动提交（默认）</span></span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> session.getMapper(UserMapper.class);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 执行多个DML操作</span></span><br><span class="line">        mapper.insertUser(user1);</span><br><span class="line">        mapper.updateUser(user2);</span><br><span class="line">        </span><br><span class="line">        session.commit(); <span class="comment">// 全部成功则提交</span></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        session.rollback(); <span class="comment">// 失败则回滚</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;事务执行失败&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="事务特性"><a href="#事务特性" class="headerlink" title="事务特性"></a>事务特性</h4><ul>
<li><strong>原子性</strong>：多个操作要么全成功，要么全失败</li>
<li><strong>一致性</strong>：事务前后数据状态一致</li>
<li><strong>隔离性</strong>：不同事务互不干扰（依赖数据库隔离级别）</li>
<li><strong>持久性</strong>：提交后数据永久保存</li>
</ul>
<h2 id="六、动态-SQL-与缓存"><a href="#六、动态-SQL-与缓存" class="headerlink" title="六、动态 SQL 与缓存"></a>六、动态 SQL 与缓存</h2><h3 id="6-1-动态-SQL（XML-标签详解）"><a href="#6-1-动态-SQL（XML-标签详解）" class="headerlink" title="6.1 动态 SQL（XML 标签详解）"></a>6.1 动态 SQL（XML 标签详解）</h3><p>动态 SQL 用于根据条件动态生成 SQL 语句，避免字符串拼接的繁琐与风险。</p>
<h4 id="（1）if-标签（条件判断）"><a href="#（1）if-标签（条件判断）" class="headerlink" title="（1）if 标签（条件判断）"></a>（1）if 标签（条件判断）</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM user WHERE 1=1</span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span> <span class="comment">&lt;!-- test中用OGNL表达式 --&gt;</span></span><br><span class="line">        AND name = #&#123;name&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age != null&quot;</span>&gt;</span></span><br><span class="line">        AND age = #&#123;age&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>动态 SQL 中<code>if</code>标签的复杂场景</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 多条件模糊查询 + 范围查询 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserByAdvancedCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM user</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null and name != &#x27;&#x27;&quot;</span>&gt;</span></span><br><span class="line">            AND name LIKE CONCAT(&#x27;%&#x27;, #&#123;name&#125;, &#x27;%&#x27;) <span class="comment">&lt;!-- 模糊查询拼接 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;ageRange != null&quot;</span>&gt;</span> <span class="comment">&lt;!-- 传入Map&lt;String, Integer&gt; ageRange，包含min和max --&gt;</span></span><br><span class="line">            AND age BETWEEN #&#123;ageRange.min&#125; AND #&#123;ageRange.max&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;statusList != null and statusList.size() &gt; 0&quot;</span>&gt;</span> <span class="comment">&lt;!-- 传入List&lt;Integer&gt; --&gt;</span></span><br><span class="line">            AND status IN</span><br><span class="line">            <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;statusList&quot;</span> <span class="attr">item</span>=<span class="string">&quot;s&quot;</span> <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">                #&#123;s&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="（2）where-标签（自动处理-AND-OR）"><a href="#（2）where-标签（自动处理-AND-OR）" class="headerlink" title="（2）where 标签（自动处理 AND&#x2F;OR）"></a>（2）where 标签（自动处理 AND&#x2F;OR）</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByCondition&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM user</span><br><span class="line">    <span class="tag">&lt;<span class="name">where</span>&gt;</span> <span class="comment">&lt;!-- 自动移除首个AND/OR --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span>AND name = #&#123;name&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age != null&quot;</span>&gt;</span>AND age = #&#123;age&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="（3）set-标签（更新时自动处理逗号）"><a href="#（3）set-标签（更新时自动处理逗号）" class="headerlink" title="（3）set 标签（更新时自动处理逗号）"></a>（3）set 标签（更新时自动处理逗号）</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    UPDATE user</span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span> <span class="comment">&lt;!-- 自动移除末尾逗号 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span>name = #&#123;name&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;age != null&quot;</span>&gt;</span>age = #&#123;age&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    WHERE id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="（4）foreach-标签（循环遍历，批量操作）"><a href="#（4）foreach-标签（循环遍历，批量操作）" class="headerlink" title="（4）foreach 标签（循环遍历，批量操作）"></a>（4）foreach 标签（循环遍历，批量操作）</h4><ul>
<li><strong>批量删除</strong>：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;batchDelete&quot;</span>&gt;</span></span><br><span class="line">    DELETE FROM user WHERE id IN</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span>  &lt;!<span class="attr">--</span> <span class="attr">集合参数名</span>（<span class="attr">list</span>/<span class="attr">map.key</span>/<span class="attr">数组</span>） <span class="attr">--</span>&gt;</span></span><br><span class="line">        item=&quot;id&quot;          <span class="comment">&lt;!-- 遍历元素别名 --&gt;</span></span><br><span class="line">        open=&quot;(&quot;           <span class="comment">&lt;!-- 开始符号 --&gt;</span></span><br><span class="line">        separator=&quot;,&quot;      <span class="comment">&lt;!-- 分隔符 --&gt;</span></span><br><span class="line">        close=&quot;)&quot;&gt;         <span class="comment">&lt;!-- 结束符号 --&gt;</span></span><br><span class="line">        #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>批量插入</strong>：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;batchInsert&quot;</span>&gt;</span></span><br><span class="line">    INSERT INTO user(name, age) VALUES</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;list&quot;</span> <span class="attr">item</span>=<span class="string">&quot;user&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span>&gt;</span></span><br><span class="line">        (#&#123;user.name&#125;, #&#123;user.age&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="（5）choose-标签（分支选择，类似-switch）"><a href="#（5）choose-标签（分支选择，类似-switch）" class="headerlink" title="（5）choose 标签（分支选择，类似 switch）"></a>（5）choose 标签（分支选择，类似 switch）</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByChoose&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span>&gt;</span></span><br><span class="line">    SELECT * FROM user WHERE 1=1</span><br><span class="line">    <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;id != null&quot;</span>&gt;</span>AND id = #&#123;id&#125;<span class="tag">&lt;/<span class="name">when</span>&gt;</span> <span class="comment">&lt;!-- 优先满足的条件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span>AND name = #&#123;name&#125;<span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span>AND age = 18<span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span> <span class="comment">&lt;!-- 所有条件不满足时 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="6-2-缓存机制（一级缓存-二级缓存）"><a href="#6-2-缓存机制（一级缓存-二级缓存）" class="headerlink" title="6.2 缓存机制（一级缓存 + 二级缓存）"></a>6.2 缓存机制（一级缓存 + 二级缓存）</h3><p>缓存用于减少数据库访问，提高查询效率。</p>
<h4 id="6-2-1-一级缓存（SqlSession-级别，默认开启）"><a href="#6-2-1-一级缓存（SqlSession-级别，默认开启）" class="headerlink" title="6.2.1 一级缓存（SqlSession 级别，默认开启）"></a>6.2.1 一级缓存（SqlSession 级别，默认开启）</h4><ul>
<li><strong>作用范围</strong>：同一个 SqlSession 内，多次查询同一数据（相同 SQL + 参数），只执行一次 SQL，后续从缓存获取。</li>
<li>失效场景：<ul>
<li>执行增删改操作（自动清空缓存）</li>
<li>手动调用<code>session.clearCache()</code></li>
<li>关闭 SqlSession 后重新获取</li>
</ul>
</li>
</ul>
<h5 id="一级缓存深度解析"><a href="#一级缓存深度解析" class="headerlink" title="一级缓存深度解析"></a>一级缓存深度解析</h5><p><strong>（1）核心代码逻辑（MyBatis 源码简化）</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// SqlSession的查询方法（简化）</span></span><br><span class="line"><span class="keyword">public</span> &lt;E&gt; List&lt;E&gt; <span class="title function_">query</span><span class="params">(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler)</span> &#123;</span><br><span class="line">    <span class="type">BoundSql</span> <span class="variable">boundSql</span> <span class="operator">=</span> ms.getBoundSql(parameter);</span><br><span class="line">    <span class="type">CacheKey</span> <span class="variable">key</span> <span class="operator">=</span> createCacheKey(ms, parameter, rowBounds, boundSql); <span class="comment">// 生成缓存键</span></span><br><span class="line">    <span class="keyword">return</span> query(ms, parameter, rowBounds, resultHandler, key, boundSql);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> &lt;E&gt; List&lt;E&gt; <span class="title function_">query</span><span class="params">(...)</span> &#123;</span><br><span class="line">    List&lt;E&gt; list;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        list = (List&lt;E&gt;) localCache.getObject(key); <span class="comment">// 从一级缓存获取</span></span><br><span class="line">        <span class="keyword">if</span> (list == <span class="literal">null</span>) &#123;</span><br><span class="line">            list = queryFromDatabase(ms, parameter, rowBounds, resultHandler, key, boundSql); <span class="comment">// 查数据库</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span> list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>（2）localCacheScope 配置的影响</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 默认为SESSION：一级缓存作用于整个SqlSession --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 设置为STATEMENT：每次查询后清空缓存，即一级缓存失效 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;localCacheScope&quot;</span> <span class="attr">value</span>=<span class="string">&quot;STATEMENT&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>SESSION</code>（默认）：同一 SqlSession 内多次查询同一数据，仅执行一次 SQL</li>
<li><code>STATEMENT</code>：每次查询都执行 SQL（适合需要实时数据的场景）</li>
</ul>
<h4 id="6-2-2-二级缓存（Mapper-级别，需手动开启）"><a href="#6-2-2-二级缓存（Mapper-级别，需手动开启）" class="headerlink" title="6.2.2 二级缓存（Mapper 级别，需手动开启）"></a>6.2.2 二级缓存（Mapper 级别，需手动开启）</h4><ul>
<li><strong>作用范围</strong>：同一个 Mapper 接口的不同 SqlSession 共享缓存。</li>
<li><strong>开启步骤</strong>：</li>
</ul>
<p>​	1、全局配置开启（默认已开启）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​	2、在 Mapper.xml 中声明缓存：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 缓存配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cache</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">eviction</span>=<span class="string">&quot;LRU&quot;</span>        &lt;!<span class="attr">--</span> <span class="attr">回收策略</span>：<span class="attr">LRU</span>（<span class="attr">最近最少使用</span>）/<span class="attr">FIFO</span>（<span class="attr">先进先出</span>）<span class="attr">等</span> <span class="attr">--</span>&gt;</span></span><br><span class="line">    flushInterval=&quot;60000&quot; <span class="comment">&lt;!-- 刷新间隔（毫秒） --&gt;</span></span><br><span class="line">    size=&quot;512&quot;            <span class="comment">&lt;!-- 最大缓存对象数 --&gt;</span></span><br><span class="line">    readOnly=&quot;true&quot;/&gt;     <span class="comment">&lt;!-- 是否只读（true：返回缓存对象副本，性能好） --&gt;</span></span><br></pre></td></tr></table></figure>

<p>​	3、实体类需实现 Serializable 接口（二级缓存可能涉及序列化）</p>
<ul>
<li><strong>缓存控制</strong>：<ul>
<li><code>useCache=&quot;false&quot;</code>：当前查询不使用缓存（如实时性要求高的数据）</li>
<li><code>flushCache=&quot;true&quot;</code>：执行后清空缓存（增删改默认 true，查询默认 false）</li>
</ul>
</li>
</ul>
<h5 id="二级缓存深度解析"><a href="#二级缓存深度解析" class="headerlink" title="二级缓存深度解析"></a>二级缓存深度解析</h5><p><strong>（1）查询流程与多层装饰结构</strong></p>
<p>查询顺序：二级缓存 → 一级缓存 → 数据库</p>
<p>二级缓存的装饰链（默认）：<code>PerpetualCache</code>（基础缓存）→ <code>LruCache</code>（淘汰策略）→ <code>LoggingCache</code>（日志）→ <code>SynchronizedCache</code>（线程安全）→ …</p>
<p><strong>（2）缓存一致性问题及解决</strong></p>
<p><strong>问题示例</strong>：两个 SqlSession 操作同一数据，Session1 更新后未同步到二级缓存，导致 Session2 读取旧数据。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Session1更新数据</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">session1</span> <span class="operator">=</span> MybatisUtil.openSession()) &#123;</span><br><span class="line">    session1.getMapper(UserMapper.class).updateUserAge(<span class="number">1</span>, <span class="number">20</span>);</span><br><span class="line">    session1.commit(); <span class="comment">// 提交后会清空UserMapper的二级缓存</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Session2查询（此时二级缓存已清空，会查数据库）</span></span><br><span class="line"><span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">session2</span> <span class="operator">=</span> MybatisUtil.openSession()) &#123;</span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> session2.getMapper(UserMapper.class).selectUserById(<span class="number">1</span>); <span class="comment">// 得到最新数据</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>解决</strong>：MyBatis 在 DML 操作后会自动清空当前 Mapper 的二级缓存（因<code>flushCache=&quot;true&quot;</code>默认开启），确保缓存一致性。</p>
<p><strong>（3）eviction 属性的缓存淘汰算法</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">eviction</span>=<span class="string">&quot;FIFO&quot;</span> &lt;!<span class="attr">--</span> <span class="attr">可选值</span>：</span></span><br><span class="line"><span class="tag">                     <span class="attr">LRU</span>（<span class="attr">最近最少使用</span>，<span class="attr">默认</span>）</span></span><br><span class="line"><span class="tag">                     <span class="attr">FIFO</span>（<span class="attr">先进先出</span>）</span></span><br><span class="line"><span class="tag">                     <span class="attr">SOFT</span>（<span class="attr">软引用</span>，<span class="attr">内存不足时淘汰</span>）</span></span><br><span class="line"><span class="tag">                     <span class="attr">WEAK</span>（<span class="attr">弱引用</span>，<span class="attr">垃圾回收时淘汰</span>）</span></span><br><span class="line"><span class="tag">                    <span class="attr">--</span>&gt;</span></span><br><span class="line">    size=&quot;1000&quot;/&gt; <span class="comment">&lt;!-- 最多缓存1000个对象 --&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="6-2-3-自定义缓存实现"><a href="#6-2-3-自定义缓存实现" class="headerlink" title="6.2.3 自定义缓存实现"></a>6.2.3 自定义缓存实现</h4><h5 id="（1）自定义-Cache-类"><a href="#（1）自定义-Cache-类" class="headerlink" title="（1）自定义 Cache 类"></a>（1）自定义 Cache 类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyRedisCache</span> <span class="keyword">implements</span> <span class="title class_">Cache</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String id; <span class="comment">// 缓存唯一标识（Mapper接口全类名）</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate; <span class="comment">// 假设已配置RedisTemplate</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyRedisCache</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span> &#123; <span class="keyword">return</span> id; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">putObject</span><span class="params">(Object key, Object value)</span> &#123;</span><br><span class="line">        <span class="comment">// 存入Redis，设置过期时间</span></span><br><span class="line">        redisTemplate.opsForValue().set(key.toString(), value, <span class="number">30</span>, TimeUnit.MINUTES);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getObject</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">        <span class="comment">// 从Redis获取</span></span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().get(key.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">removeObject</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">        <span class="comment">// 从Redis删除</span></span><br><span class="line">        redisTemplate.delete(key.toString());</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clear</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 清空当前Mapper的缓存（通过key前缀匹配删除）</span></span><br><span class="line">        Set&lt;String&gt; keys = redisTemplate.keys(id + <span class="string">&quot;:*&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (keys != <span class="literal">null</span>) redisTemplate.delete(keys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 获取缓存数量（简化实现）</span></span><br><span class="line">        <span class="keyword">return</span> redisTemplate.keys(id + <span class="string">&quot;:*&quot;</span>).size();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="（2）启用自定义缓存（XML-或注解）"><a href="#（2）启用自定义缓存（XML-或注解）" class="headerlink" title="（2）启用自定义缓存（XML 或注解）"></a>（2）启用自定义缓存（XML 或注解）</h5><ul>
<li><p>XML 方式（在 Mapper.xml 中）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span> <span class="attr">type</span>=<span class="string">&quot;com.example.cache.MyRedisCache&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>注解方式（在 Mapper 接口上）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@CacheNamespace(implementation = MyRedisCache.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123; ... &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="6-2-4-缓存控制属性详解"><a href="#6-2-4-缓存控制属性详解" class="headerlink" title="6.2.4 缓存控制属性详解"></a>6.2.4 缓存控制属性详解</h4><ul>
<li><p><code>useCache</code>：控制查询是否使用二级缓存（默认<code>true</code>）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span> <span class="attr">useCache</span>=<span class="string">&quot;false&quot;</span>&gt;</span> <span class="comment">&lt;!-- 不使用二级缓存 --&gt;</span></span><br><span class="line">    select * from user where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><code>flushCache</code>：控制操作后是否清空二级缓存（DML 默认<code>true</code>，查询默认<code>false</code>）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;User&quot;</span> <span class="attr">flushCache</span>=<span class="string">&quot;true&quot;</span>&gt;</span> <span class="comment">&lt;!-- 查询后清空二级缓存 --&gt;</span></span><br><span class="line">    select * from user where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="七、高级特性（选学）"><a href="#七、高级特性（选学）" class="headerlink" title="七、高级特性（选学）"></a>七、高级特性（选学）</h2><h3 id="7-1-类型处理器（TypeHandler）"><a href="#7-1-类型处理器（TypeHandler）" class="headerlink" title="7.1 类型处理器（TypeHandler）"></a>7.1 类型处理器（TypeHandler）</h3><p>用于 Java 类型与 JDBC 类型的自定义转换（如 String→自定义对象、Date→LocalDate）。</p>
<h4 id="自定义类型处理器示例"><a href="#自定义类型处理器示例" class="headerlink" title="自定义类型处理器示例"></a>自定义类型处理器示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 自定义String与MyString的转换</span></span><br><span class="line"><span class="meta">@MappedJdbcTypes(JdbcType.VARCHAR)</span> <span class="comment">// 关联JDBC类型</span></span><br><span class="line"><span class="meta">@MappedTypes(MyString.class)</span>       <span class="comment">// 关联Java类型</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyStringHandler</span> <span class="keyword">extends</span> <span class="title class_">BaseTypeHandler</span>&lt;MyString&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置参数（Java→JDBC）</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNonNullParameter</span><span class="params">(PreparedStatement ps, <span class="type">int</span> i, </span></span><br><span class="line"><span class="params">                                  MyString parameter, JdbcType jdbcType)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        ps.setString(i, parameter.getValue()); <span class="comment">// 存储自定义对象的字符串值</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从结果集获取（JDBC→Java）</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> MyString <span class="title function_">getNullableResult</span><span class="params">(ResultSet rs, String columnName)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyString</span>(rs.getString(columnName));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 其他重载方法（按列索引获取）</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> MyString <span class="title function_">getNullableResult</span><span class="params">(ResultSet rs, <span class="type">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyString</span>(rs.getString(columnIndex));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> MyString <span class="title function_">getNullableResult</span><span class="params">(CallableStatement cs, <span class="type">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyString</span>(cs.getString(columnIndex));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="注册类型处理器"><a href="#注册类型处理器" class="headerlink" title="注册类型处理器"></a>注册类型处理器</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;com.example.handler.MyStringHandler&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="7-2-拦截器（插件）"><a href="#7-2-拦截器（插件）" class="headerlink" title="7.2 拦截器（插件）"></a>7.2 拦截器（插件）</h3><p>用于在 SQL 执行过程中插入自定义逻辑（如日志记录、性能监控、SQL 改写）。</p>
<h4 id="自定义拦截器示例"><a href="#自定义拦截器示例" class="headerlink" title="自定义拦截器示例"></a>自定义拦截器示例</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Intercepts(&#123; // 声明拦截的目标方法</span></span><br><span class="line"><span class="meta">    @Signature(</span></span><br><span class="line"><span class="meta">        type = Executor.class,       // 拦截的接口</span></span><br><span class="line"><span class="meta">        method = &quot;query&quot;,            // 拦截的方法名</span></span><br><span class="line"><span class="meta">        args = &#123;MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class&#125; // 方法参数</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogInterceptor</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 拦截逻辑</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// 1. 前置处理（如记录开始时间）</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 2. 执行原方法</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> invocation.proceed();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 3. 后置处理（如记录执行时间）</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        System.out.println(<span class="string">&quot;SQL执行时间：&quot;</span> + (end - start) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成代理对象</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">plugin</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Plugin.wrap(target, <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置属性（从配置文件读取）</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setProperties</span><span class="params">(Properties properties)</span> &#123;</span><br><span class="line">        <span class="comment">// 可通过properties获取配置参数</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="注册拦截器"><a href="#注册拦截器" class="headerlink" title="注册拦截器"></a>注册拦截器</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.example.interceptor.LogInterceptor&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 可选：设置拦截器属性 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;logLevel&quot;</span> <span class="attr">value</span>=<span class="string">&quot;INFO&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="八、最佳实践总结"><a href="#八、最佳实践总结" class="headerlink" title="八、最佳实践总结"></a>八、最佳实践总结</h2><h3 id="8-1-配置优化"><a href="#8-1-配置优化" class="headerlink" title="8.1 配置优化"></a>8.1 配置优化</h3><ul>
<li><strong>连接池配置</strong>：使用 POOLED 数据源，并合理设置连接池参数（初始大小、最大活跃数等）</li>
<li><strong>日志配置</strong>：开发环境开启 DEBUG 日志，生产环境关闭或设为 INFO，便于调试与性能优化</li>
<li><strong>类型别名</strong>：使用包扫描方式配置，减少全类名书写</li>
<li><strong>驼峰映射</strong>：开启<code>mapUnderscoreToCamelCase</code>，减少 resultMap 配置</li>
</ul>
<h3 id="8-2-开发规范"><a href="#8-2-开发规范" class="headerlink" title="8.2 开发规范"></a>8.2 开发规范</h3><ul>
<li><strong>SQL 与代码分离</strong>：复杂 SQL 写在 XML 中，简单 SQL 用注解，提高可维护性</li>
<li><strong>参数传递</strong>：多参数优先用 @Param 注解，避免 Map 传递（可读性差）</li>
<li><strong>结果映射</strong>：字段不一致时优先用 resultMap，而非 SQL 别名（映射规则集中管理）</li>
<li>命名规范：<ul>
<li>Mapper 接口方法名与 XML 中 id 保持一致</li>
<li>表名、列名用小写 + 下划线，实体类用驼峰命名</li>
<li>映射文件与接口同包同名（便于包扫描）</li>
</ul>
</li>
</ul>
<h3 id="8-3-性能优化"><a href="#8-3-性能优化" class="headerlink" title="8.3 性能优化"></a>8.3 性能优化</h3><h4 id="批量操作："><a href="#批量操作：" class="headerlink" title="批量操作："></a>批量操作：</h4><ul>
<li>批量插入 &#x2F; 更新使用<code>ExecutorType.BATCH</code>模式</li>
<li>避免循环调用单条 SQL（N 次网络请求）</li>
</ul>
<p>使用<code>ExecutorType.BATCH</code>模式的完整示例及日志分析：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> sqlSessionFactory.openSession(ExecutorType.BATCH)) &#123; <span class="comment">// 批处理执行器</span></span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> session.getMapper(UserMapper.class);</span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">        user.setName(<span class="string">&quot;user&quot;</span> + i);</span><br><span class="line">        mapper.insertUser(user);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 每500条提交一次（避免内存溢出）</span></span><br><span class="line">        <span class="keyword">if</span> (i % <span class="number">500</span> == <span class="number">0</span>) &#123;</span><br><span class="line">            session.flushStatements(); <span class="comment">// 刷入数据库（未提交事务）</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    session.commit(); <span class="comment">// 最终提交</span></span><br><span class="line">    System.out.println(<span class="string">&quot;耗时：&quot;</span> + (System.currentTimeMillis() - start) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>日志分析</strong>：批处理模式下，MyBatis 会将 SQL 语句预编译一次，多次设置参数后批量执行，日志中只会出现一次<code>Preparing: INSERT INTO user(...)</code>，避免了单条插入的多次预编译开销。</p>
<h4 id="分页查询："><a href="#分页查询：" class="headerlink" title="分页查询："></a>分页查询：</h4><p><strong>分页查询实现（PageHelper 插件）</strong></p>
<p>Mybatis 本身不直接支持分页，推荐使用第三方插件<code>PageHelper</code>简化分页逻辑：</p>
<p>​	<strong>添加依赖</strong>（Maven）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​	<strong>配置插件</strong>（在<code>mybatis-config.xml</code>的<code>&lt;plugins&gt;</code>标签中）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 数据库方言（可选，自动检测） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;helperDialect&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mysql&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 分页参数合理化（页码&lt;=0查第一页，页码&gt;总页数查最后一页） --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;reasonable&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​	<strong>使用方式</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">SqlSession</span> <span class="variable">session</span> <span class="operator">=</span> MybatisUtil.openSession()) &#123;</span><br><span class="line">    <span class="type">UserMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> session.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. 设置分页参数（页码从1开始，每页10条）</span></span><br><span class="line">    PageHelper.startPage(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 执行查询（无需修改SQL，插件自动拼接LIMIT）</span></span><br><span class="line">    List&lt;User&gt; users = mapper.selectAllUser();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. 封装分页结果</span></span><br><span class="line">    Page&lt;User&gt; page = (Page&lt;User&gt;) users;</span><br><span class="line">    System.out.println(<span class="string">&quot;总条数：&quot;</span> + page.getTotal());</span><br><span class="line">    System.out.println(<span class="string">&quot;总页数：&quot;</span> + page.getPages());</span><br><span class="line">    System.out.println(<span class="string">&quot;当前页数据：&quot;</span> + page.getResult());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="缓存策略："><a href="#缓存策略：" class="headerlink" title="缓存策略："></a>缓存策略：</h4><ul>
<li>高频查询、低频修改的数据开启二级缓存</li>
<li>实时性要求高的数据禁用缓存（<code>useCache=false</code>）</li>
</ul>
<h4 id="查询优化："><a href="#查询优化：" class="headerlink" title="查询优化："></a>查询优化：</h4><ul>
<li>避免<code>SELECT *</code>，只查询需要的字段</li>
<li>关联查询优先用 JOIN，避免嵌套查询导致的 N+1 问题</li>
<li>分页查询使用 Mybatis 分页插件（如 PageHelper）</li>
</ul>
<p>通过以上内容，可以系统掌握 Mybatis 的核心用法、高级特性及最佳实践，在实际开发中根据场景灵活选择配置与实现方式，提升开发效率与系统性能。</p>
<h3 id="九、常见问题与解决方案"><a href="#九、常见问题与解决方案" class="headerlink" title="九、常见问题与解决方案"></a>九、常见问题与解决方案</h3><h4 id="9-1-映射文件相关错误"><a href="#9-1-映射文件相关错误" class="headerlink" title="9.1 映射文件相关错误"></a>9.1 映射文件相关错误</h4><ul>
<li><p><strong>错误 1：<code>org.apache.ibatis.binding.BindingException: Invalid bound statement (not found)</code></strong></p>
<p>原因：Mapper 接口与 XML 映射文件未正确绑定</p>
<p>解决：</p>
<ol>
<li>确保 XML 的<code>namespace</code>与接口全类名一致</li>
<li>确保 XML 中<code>id</code>与接口方法名一致</li>
<li>检查 XML 文件是否在<code>mybatis-config.xml</code>的<code>&lt;mappers&gt;</code>中注册</li>
</ol>
</li>
<li><p><strong>错误 2：<code>java.io.IOException: Could not find resource mappers/UserMapper.xml</code></strong></p>
<p>原因：XML 文件路径错误或未被 Maven 打包</p>
<p>解决：</p>
<ol>
<li>Maven 项目中，XML 文件若放在<code>src/main/java</code>下，需在<code>pom.xml</code>中添加资源过滤：</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resources</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">resource</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">directory</span>&gt;</span>src/main/java<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">include</span>&gt;</span>**/*.xml<span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resources</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="9-2-字段映射错误"><a href="#9-2-字段映射错误" class="headerlink" title="9.2 字段映射错误"></a>9.2 字段映射错误</h4><ul>
<li><p>错误：查询结果字段为<code>null</code>（实体类属性与数据库列名不一致）</p>
<p>解决：</p>
<ol>
<li>开启驼峰映射（<code>mapUnderscoreToCamelCase=true</code>）</li>
<li>使用<code>resultMap</code>手动定义映射关系</li>
<li>在 SQL 中给列名添加别名（如<code>id as userId</code>）</li>
</ol>
</li>
</ul>
<h4 id="9-3-事务相关错误"><a href="#9-3-事务相关错误" class="headerlink" title="9.3 事务相关错误"></a>9.3 事务相关错误</h4><ul>
<li><p>错误：插入数据后数据库无记录（未提交事务）</p>
<p>原因：Mybatis 默认关闭自动提交，DML 操作需手动<code>commit()</code>解决：执行<code>session.commit()</code>或开启自动提交（<code>openSession(true)</code>）</p>
</li>
</ul>
<h3 id="十、Mybatis-与-Spring-整合"><a href="#十、Mybatis-与-Spring-整合" class="headerlink" title="十、Mybatis 与 Spring 整合"></a>十、Mybatis 与 Spring 整合</h3><h4 id="10-1-核心依赖（Maven）"><a href="#10-1-核心依赖（Maven）" class="headerlink" title="10.1 核心依赖（Maven）"></a>10.1 核心依赖（Maven）</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Spring核心 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.24<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Spring JDBC（事务管理） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.24<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Mybatis-Spring整合包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="10-2-Spring-配置文件（applicationContext-xml）"><a href="#10-2-Spring-配置文件（applicationContext-xml）" class="headerlink" title="10.2 Spring 配置文件（applicationContext.xml）"></a>10.2 Spring 配置文件（applicationContext.xml）</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 1. 数据源（替换Mybatis原生数据源） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/test?useSSL=false&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;123456&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 2. SqlSessionFactory（由Spring管理） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 加载Mybatis核心配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mybatis-config.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 扫描映射文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mappers/*.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 3. Mapper接口扫描（自动生成代理对象） --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.example.mapper&quot;</span>/&gt;</span> <span class="comment">&lt;!-- Mapper接口所在包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 4. 事务管理器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 开启事务注解 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="10-3-整合后使用方式"><a href="#10-3-整合后使用方式" class="headerlink" title="10.3 整合后使用方式"></a>10.3 整合后使用方式</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 注入Mapper接口（Spring自动管理）</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. 事务控制（通过注解）</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        userMapper.insertUser(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

    
    <section class="post-copyright">
      
      <p class="copyright-item">
        <span>作者:</span>
        <span>老江湖</span>
      </p>
        
      <p class="copyright-item">
        <span>许可证:</span>
        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
      </p>
       
      <p class="copyright-item">
        <span>口号:</span>
        <span><strong>代码是开源的,我们只是它的搬运工。</strong></span>
      </p>
       
        <p class="copyright-item">
        <span>如果觉得我的文章对你有所帮助，请随意转载，感谢支持！</span>
      </p>
      
             
        <p class="copyright-item">
        <span>如有侵权请告知删除🙏</span>
      </p>
             
        <p class="copyright-item">
        <span>如果你有很好的想法💡，请务必联系我。 </span>
        <br>
         <span>2292360909@qq.com</span>
      </p>
    </section>
    
    <section class="post-tags">
      <div>
        <span>标签:</span>
        <span class="tag">
           
          <a href="/tags/Mybatis/"># Mybatis</a>
           
        </span>
      </div>
      <div>
        <a href="javascript:window.history.back();">返回</a>
        <span>· </span>
        <a href="/">首页</a>
      </div>
    </section>
    <section class="post-nav">
      
      <a class="prev" rel="prev" href="/2025/10/15/java/Mybatis-plus%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/"
        >Mybatis-plus快速上手</a
      >
       
      <a class="next" rel="next" href="/2025/10/15/java/Lombok%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/"
        >Lombok快速上手</a
      >
      
    </section>

    <!-- Giscus 评论区挂载点 -->
<div id="giscus-container" style="margin-top: 2.5rem;"></div>

<!-- Giscus 动态加载脚本：初始加载 + 明暗主题切换 -->
<script>
  function createGiscus(theme) {
    const giscusContainer = document.getElementById('giscus-container');
    if (!giscusContainer) return;

    // 清除旧的评论 iframe
    giscusContainer.innerHTML = '';

    const script = document.createElement('script');
    script.src = 'https://giscus.app/client.js';

    // 替换为你的 GitHub 仓库信息（格式：username/repo）
    script.setAttribute('data-repo', 'meisijiya/meisijiya.github.io');

   // 替换为你的 repo-id 和 category-id（在 giscus.app 配置页面生成）
    script.setAttribute('data-repo-id', 'R_kgDOPwTrpQ');
    script.setAttribute('data-category', 'Announcements');
    script.setAttribute('data-category-id', 'DIC_kwDOPwTrpc4CviGR');

    // 其他常规推荐设置
    script.setAttribute('data-mapping', 'pathname');           // 用页面路径匹配评论帖
    script.setAttribute('data-strict', '0');                   // 若无匹配帖则创建新帖
    script.setAttribute('data-reactions-enabled', '1');        // 启用表情反应
    script.setAttribute('data-emit-metadata', '0');            // 不输出元数据
    script.setAttribute('data-input-position', 'top');         // 输入框在评论上方
    script.setAttribute('data-theme', theme);                
    script.setAttribute('data-lang', 'zh-CN');                 // 中文界面
    script.setAttribute('crossorigin', 'anonymous');           // 跨域资源安全
    script.async = true;                                       
     
    giscusContainer.appendChild(script);
  }

  function getCurrentTheme() {
    return document.body.classList.contains('dark-theme') ? 'dark' : 'light';
  }

  document.addEventListener('DOMContentLoaded', () => {
    // 页面首次加载，根据当前主题挂载评论
    createGiscus(getCurrentTheme());

    // 监听按钮点击切换主题 → 重载评论区
    const buttons = [
      document.querySelector('.toggleBtn'),
      document.getElementById('mobile-toggle-theme')
    ];
    buttons.forEach(btn => {
      if (!btn) return;
      btn.addEventListener('click', () => {
        setTimeout(() => {
          createGiscus(getCurrentTheme());
        }, 400); // 稍作延迟，确保 class 切换完毕
      });
    });

    // 监听 body class 改变（保险方案）
    const observer = new MutationObserver(() => {
      createGiscus(getCurrentTheme());
    });
    observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });
  });
</script>

  </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>© 老江湖 | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>
<script src="/js/code-copy.js"></script>


    </div>
</body>
<!-- umami -->
<script defer src="https://cloud.umami.is/script.js" data-website-id="91b923f2-ff2d-43d0-ba5f-bc348d82426a"></script>
</html>