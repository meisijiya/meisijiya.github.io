<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="è€æ±Ÿæ¹–">


    <meta name="subtitle" content="è®°å½•è¿›å…¥æˆ¿é—´é—¨åçš„ç¾å¥½">


    <meta name="description" content="ä¸€å¹´å‰ï¼Œå­¤è‹¦ä¼¶ä»ƒçš„è€æ±Ÿæ¹–ï¼Œå¶ç„¶é—´å‘ç°ä¸€å¤„æˆ¿é—´é—¨ï¼Œæ¨é—¨è€Œå…¥ï¼Œä»æ­¤è¿›å…¥äº†å……æ»¡å¹¸ç¦çš„ä¸–ç•Œã€‚">


    <meta name="keywords" content="è€æ±Ÿæ¹–,åšå®¢,æˆ¿é—´é—¨">


<title>Mybatiså¿«é€Ÿä¸Šæ‰‹ | æ¬¢è¿æ¥åˆ°è€æ±Ÿæ¹–çš„åšå®¢</title>



    <link rel="icon" href="/images/%E9%87%91%E6%AF%9B.png?_t=1758006391547">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    
    <link rel="stylesheet" href="/css/search.css">
    

<!-- highlight.js æ ·å¼ï¼ˆé»˜è®¤äº®è‰²ï¼‰ -->
<link id="hljs-theme" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/github.css">
<!-- highlight.js è‡ªåŠ¨ä¸Šè‰²åŠŸèƒ½ -->
<script src="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/lib/highlight.min.js"></script>
<script>hljs.highlightAll();</script>

<link rel="stylesheet" href="/css/custom.css">



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 7.3.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const pagebody = document.getElementsByTagName('body')[0]

            function setTheme(status) {

                if (status === 'dark') {
                    window.sessionStorage.theme = 'dark'
                    pagebody.classList.add('dark-theme');

                } else if (status === 'light') {
                    window.sessionStorage.theme = 'light'
                    pagebody.classList.remove('dark-theme');
                }
            };

            setTheme(window.sessionStorage.theme)
        })();
    </script>

    <div class="wrapper">
        <header>
  <nav class="navbar">
    <div class="container">
      <div class="navbar-header header-logo">
        <a href="/">è€æ±Ÿæ¹–çš„åšå®¢</a>
      </div>
      <div class="menu navbar-right">
        <!-- åœ¨ç”µè„‘ç«¯çš„å¯¼èˆªé“¾æ¥åŒºåŸŸæ·»åŠ æœç´¢åŠŸèƒ½ -->
        <div class="search-container">
          <a href="javascript:;" onclick="toggleSearchInput()">ğŸ”</a>
          <input
            type="text"
            id="nav-search-input-desktop"
            class="nav-search-input"
            placeholder="æƒ³çŸ¥é“æˆ‘ä»€ä¹ˆç§˜å¯†å‘¢ï¼Œæœæœçœ‹å§"
            oninput="navSearch(this)"
          />
          <div id="nav-search-result-desktop" class="nav-search-result"></div>
        </div>

        
        <a class="menu-item" href="/archives">å½’æ¡£</a>
        
        <a class="menu-item" href="/category">åˆ†ç±»</a>
        
        <a class="menu-item" href="/tag">æ ‡ç­¾</a>
        
        <a class="menu-item" href="/Timer">ä»»åŠ¡è®¡æ—¶å™¨</a>
        
        <a class="menu-item" href="/timeLine">æ—¶é—´çº¿</a>
        
        <a class="menu-item" href="/tongji">ç½‘ç«™ç»Ÿè®¡</a>
        
        <a class="menu-item" href="/about">å…³äº</a>
        

        <input id="switch_default" type="checkbox" class="switch_default" />
        <label for="switch_default" class="toggleBtn"></label>
      </div>
    </div>
  </nav>

  
  <nav class="navbar-mobile" id="nav-mobile">
    <div class="container">
      <div class="navbar-header">
        <div>
          <a href="/">è€æ±Ÿæ¹–çš„åšå®¢</a
          ><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
        </div>

        <div class="menu-toggle" onclick="mobileBtn()">
          <svg
            class="menu-icon"
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
          >
            <path
              fill="currentColor"
              d="M4.5 17.27q-.213 0-.356-.145T4 16.768t.144-.356t.356-.143h15q.213 0 .356.144q.144.144.144.357t-.144.356t-.356.143zm0-4.77q-.213 0-.356-.144T4 11.999t.144-.356t.356-.143h15q.213 0 .356.144t.144.357t-.144.356t-.356.143zm0-4.77q-.213 0-.356-.143Q4 7.443 4 7.23t.144-.356t.356-.143h15q.213 0 .356.144T20 7.23t-.144.356t-.356.144z"
            />
          </svg>
          <svg
            class="close-icon"
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
          >
            <!-- Icon from Material Symbols Light by Google - https://github.com/google/material-design-icons/blob/master/LICENSE -->
            <path
              fill="currentColor"
              d="m12 12.708l-5.246 5.246q-.14.14-.344.15t-.364-.15t-.16-.354t.16-.354L11.292 12L6.046 6.754q-.14-.14-.15-.344t.15-.364t.354-.16t.354.16L12 11.292l5.246-5.246q.14-.14.345-.15q.203-.01.363.15t.16.354t-.16.354L12.708 12l5.246 5.246q.14.14.15.345q.01.203-.15.363t-.354.16t-.354-.16z"
            />
          </svg>
        </div>
      </div>

      <div class="menu" id="mobile-menu">
        
        <a class="menu-item" href="/archives">å½’æ¡£</a>
        
        <a class="menu-item" href="/category">åˆ†ç±»</a>
        
        <a class="menu-item" href="/tag">æ ‡ç­¾</a>
        
        <a class="menu-item" href="/Timer">ä»»åŠ¡è®¡æ—¶å™¨</a>
        
        <a class="menu-item" href="/timeLine">æ—¶é—´çº¿</a>
        
        <a class="menu-item" href="/tongji">ç½‘ç«™ç»Ÿè®¡</a>
        
        <a class="menu-item" href="/about">å…³äº</a>
        
        <!-- æ‰‹æœºæ¨¡å¼æœç´¢æ¡† -->
        <div class="search-container mobile-container">
          <a class="menu-item" href="javascript:;" onclick="toggleSearchInput()"
            >ğŸ”</a
          >
          <input
            type="text"
            id="nav-search-input-mobile"
            class="nav-search-input"
            placeholder="æƒ³çŸ¥é“æˆ‘ä»€ä¹ˆç§˜å¯†å‘¢ï¼Œæœæœçœ‹å§"
            oninput="navSearch(this)"
          />
          <div id="nav-search-result-mobile" class="nav-search-result"></div>
        </div>
      </div>
    </div>
  </nav>
</header>
<script>
  var mobileBtn = function f() {
    var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
    var mobileMenu = document.getElementById("mobile-menu");
    if (toggleMenu.classList.contains("active")) {
      toggleMenu.classList.remove("active");
      mobileMenu.classList.remove("active");
    } else {
      toggleMenu.classList.add("active");
      mobileMenu.classList.add("active");
    }
  };

  function toggleSearchInput() {
    const inputs = document.querySelectorAll(".nav-search-input");
    const results = document.querySelectorAll(".nav-search-result");
    inputs.forEach((input) => {
      input.classList.toggle("active");
      if (input.classList.contains("active")) input.focus();
    });
    results.forEach((r) => (r.style.display = "none"));
  }

  // ç‚¹å‡»å¤–éƒ¨åŒºåŸŸéšè—æœç´¢æ¡†å’Œç»“æœå®¹å™¨çš„å‡½æ•°
  function handleClickOutsideSearch(event) {
    const searchContainers = document.querySelectorAll(".search-container");
    searchContainers.forEach((container) => {
      const searchInput = container.querySelector(".nav-search-input");
      const searchIcon = container.querySelector("a");

      // å¦‚æœç‚¹å‡»çš„å…ƒç´ ä¸æ˜¯æœç´¢è¾“å…¥æ¡†æˆ–æœç´¢å›¾æ ‡ï¼Œåˆ™éšè—æœç´¢æ¡†å’Œç»“æœå®¹å™¨
      if (
        !searchInput.contains(event.target) &&
        !searchIcon.contains(event.target)
      ) {
        searchInput.classList.remove("active");
        searchInput.value = ""
        // æ ¹æ®è¾“å…¥æ¡†IDç¡®å®šå¯¹åº”çš„ç»“æœå®¹å™¨
        let resultContainer;
        if (searchInput.id === "nav-search-input-mobile") {
          // ç§»åŠ¨ç«¯ç»“æœå®¹å™¨
          resultContainer = document.querySelector(
            ".navbar-mobile .nav-search-result"
          );
        } else {
          // æ¡Œé¢ç«¯ç»“æœå®¹å™¨
          resultContainer = document.getElementById(
            "nav-search-result-desktop"
          );
        }

        if (resultContainer) {
          resultContainer.style.display = "none";
          resultContainer.innerHTML = ""; // æ¸…ç©ºç»“æœå®¹å™¨å†…å®¹
        }
      }
    });
  }

  // æ·»åŠ å…¨å±€ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
  document.addEventListener("click", function (event) {
    handleClickOutsideSearch(event);
  });

  // æ–°å¢ï¼šæœç´¢åŠŸèƒ½å®ç°
  let searchData = []; // å…¨å±€å˜é‡å­˜å‚¨æœç´¢æ•°æ®

  // é¡µé¢åŠ è½½å®Œæˆåè·å–æœç´¢æ•°æ®
  document.addEventListener("DOMContentLoaded", function () {
    fetch("/search.xml")
      .then((res) => res.text())
      .then((xmlText) => {
        const parser = new DOMParser();
        const xml = parser.parseFromString(xmlText, "text/xml");
        const entries = xml.getElementsByTagName("entry");
        for (let entry of entries) {
          searchData.push({
            title: entry.getElementsByTagName("title")[0]?.textContent || "",
            content:
              entry.getElementsByTagName("content")[0]?.textContent || "",
            url: entry.getElementsByTagName("url")[0]?.textContent || "",
          });
        }
      })
      .catch((err) => {
        console.error("Failed to load search data:", err);
      });
  });

  // æ–°å¢ï¼šå¯¼èˆªæœç´¢æ–¹æ³•
  function navSearch(inputElement) {
    const keyword = inputElement.value.trim().toLowerCase();
    // æŸ¥æ‰¾å¯¹åº”çš„æœç´¢ç»“æœå®¹å™¨
    let resultContainer;

    if (inputElement.id === "nav-search-input-desktop") {
      // æ¡Œé¢ç«¯
      resultContainer = document.getElementById("nav-search-result-desktop");
    } else if (inputElement.id === "nav-search-input-mobile") {
      // ç§»åŠ¨ç«¯
      resultContainer =
        inputElement.parentNode.querySelector(".nav-search-result");
    }

    if (!resultContainer) return;

    resultContainer.innerHTML = "";

    if (!keyword) {
      resultContainer.style.display = "none";
      return;
    }

    // æ˜¾ç¤ºç»“æœå®¹å™¨
    resultContainer.style.display = "block";

    // è¿‡æ»¤æœç´¢æ•°æ®
    const results = searchData.filter(
      (data) =>
        (data.title && data.title.toLowerCase().includes(keyword)) ||
        (data.content && data.content.toLowerCase().includes(keyword))
    );

    if (results.length === 0) {
      resultContainer.innerHTML =
        '<p class="no-result">æ²¡æœ‰ç»“æœå“Ÿï¼Œæ¢ä¸ªå…³é”®è¯è¯•è¯•å§</p>';
      return;
    }

    // é™åˆ¶æ˜¾ç¤ºç»“æœæ•°é‡
    const maxResults = 10;
    const limitedResults = results.slice(0, maxResults);

    // æ„å»ºç»“æœHTML
    const html = limitedResults
      .map((item) => {
        // æå–åŒ…å«å…³é”®å­—çš„å†…å®¹ç‰‡æ®µ
        let contentSnippet = "";
        if (item.content) {
          // æ‰¾åˆ°åŒ…å«å…³é”®å­—çš„å†…å®¹ç‰‡æ®µ
          const contentLower = item.content.toLowerCase();
          const keywordIndex = contentLower.indexOf(keyword);

          // æå–å…³é”®å­—å‰åçš„å†…å®¹
          const start = Math.max(0, keywordIndex - 3 * keyword.length);
          const end = Math.min(
            item.content.length,
            keywordIndex + 3 * keyword.length
          );
          contentSnippet = item.content.substring(start, end);
        // é«˜äº®å…³é”®å­—
      const keywordRegex = new RegExp(`(${keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
      contentSnippet = contentSnippet.replace(
        keywordRegex,
        "<mark>$1</mark>"
      );
        }

        return `<div class="search-result-item">
  <a href="${item.url}">
    <div>æ ‡é¢˜ï¼š${item.title}</div>
    <div>å†…å®¹ï¼š${contentSnippet}</div>
  </a>
</div>`;
      })
      .join("");
    resultContainer.innerHTML = html;
  }
</script>
<style>
  /* æ‰‹æœºç«¯ä½¿ç”¨flexboxå¸ƒå±€æœç´¢å®¹å™¨ */
  .mobile-container {
    display: flex;
    align-items: center;
    flex-direction: row;
    margin-bottom: 10px;
    margin-left: 10px;
    flex-grow: 1;
    max-width: calc(100% - 40px);
  }


  .search-result-item {
  border: 1px solid #ddd; /* è¾¹æ¡† */
  margin: 4px 0; /* å¤–å±‚é—´è· */
  padding: 0; /* æ— å†…è¾¹è· */
  background: #fff; /* èƒŒæ™¯è‰² */
}

.search-result-item a {
  display: block;
  text-decoration: none;
  color: inherit;
}

.search-result-item div {
  padding: 3px 8px; /* ç´§å‡‘çš„å†…è¾¹è· */
  margin: 0; /* æ— å¤–è¾¹è· */
  line-height: 1.3; /* ç´§å‡‘çš„è¡Œé«˜ */
  word-wrap: break-word; /* å…è®¸é•¿å•è¯æ¢è¡Œ */
  white-space: normal; /* å…è®¸æ­£å¸¸æ¢è¡Œ */
}

.search-result-item div:first-child {
  border-bottom: 1px solid #eee; /* æ ‡é¢˜å’Œå†…å®¹ä¹‹é—´çš„åˆ†éš”çº¿ */
}


</style>

            <div class="main">
                <div class="container">
    <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">å±•å¼€æ‰€æœ‰</a>
        <a onclick="go_top()">è¿”å›é¡¶éƒ¨</a>
        <a onclick="go_bottom()">è¿”å›åº•éƒ¨</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // ä¸º 6 æ—¶å±•å¼€æ‰€æœ‰
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // è¿™ä¸ªå€¼æ˜¯ç”± tocbot æºç é‡Œå®šä¹‰çš„ scrollSmoothDuration å¾—æ¥çš„
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'å±•å¼€æ‰€æœ‰' : 'æŠ˜å æ‰€æœ‰';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>  
  <article class="post-wrap">
    <header class="post-header">
      <h1 class="post-title">Mybatiså¿«é€Ÿä¸Šæ‰‹</h1>
      
      <div class="post-meta">
         ä½œè€…:
        <a itemprop="author" rel="author" href="/">è€æ±Ÿæ¹–</a>
         
        <span class="post-time">
          <br />æ—¥æœŸ:
          <a href="#"
            >åæœˆ 15, 2025&nbsp;&nbsp;1:03:19</a
          >
        </span>
         
        <span class="post-category"
          ><br />
          åˆ†ç±»: 
          <a href="/categories/java/">java</a>
          
        </span>
        
      </div>
      
    </header>

    <div class="post-content"><h2 id="ä¸€ã€Mybatis-ç®€ä»‹ä¸å¿«é€Ÿä¸Šæ‰‹"><a href="#ä¸€ã€Mybatis-ç®€ä»‹ä¸å¿«é€Ÿä¸Šæ‰‹" class="headerlink" title="ä¸€ã€Mybatis ç®€ä»‹ä¸å¿«é€Ÿä¸Šæ‰‹"></a>ä¸€ã€Mybatis ç®€ä»‹ä¸å¿«é€Ÿä¸Šæ‰‹</h2><h3 id="1-1-ä»€ä¹ˆæ˜¯-Mybatis"><a href="#1-1-ä»€ä¹ˆæ˜¯-Mybatis" class="headerlink" title="1.1 ä»€ä¹ˆæ˜¯ Mybatis"></a>1.1 ä»€ä¹ˆæ˜¯ Mybatis</h3><ul>
<li><strong>æ ¸å¿ƒå®šä½</strong>ï¼šMybatis æ˜¯ä¸€æ¬¾<strong>æŒä¹…å±‚æ¡†æ¶</strong>ï¼Œä¸“æ³¨äºè§£å†³ Java åº”ç”¨ä¸æ•°æ®åº“äº¤äº’çš„é—®é¢˜ï¼Œå±äº ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰æŠ€æœ¯çš„ä¸€ç§å®ç°ã€‚</li>
<li><strong>å†å²èƒŒæ™¯</strong>ï¼šå‰èº«æ˜¯ Apache çš„ iBatis æ¡†æ¶ï¼Œ2010 å¹´è¿ç§»åˆ° Google Code å¹¶æ›´åä¸º Mybatisï¼Œåæ‰˜ç®¡äº GitHubï¼Œç›®å‰æœ€æ–°ç¨³å®šç‰ˆä¸º 3.5.xï¼ˆ2025.10ï¼‰ã€‚</li>
<li><strong>è§£å†³çš„é—®é¢˜ï¼š</strong><ul>
<li><strong>æ¶ˆé™¤ JDBC å†—ä½™ä»£ç ï¼ˆæ‰‹åŠ¨åŠ è½½é©±åŠ¨ã€åˆ›å»ºè¿æ¥ã€å¤„ç†ç»“æœé›†ç­‰ï¼‰</strong></li>
<li><strong>å®ç° SQL ä¸ Java ä»£ç åˆ†ç¦»ï¼Œä¾¿äºç»´æŠ¤</strong></li>
<li><strong>æä¾›çµæ´»çš„ SQL å®šåˆ¶èƒ½åŠ›ï¼ˆæ— éœ€åƒ Hibernate é‚£æ ·å—é™äº ORM è‡ªåŠ¨ç”Ÿæˆçš„ SQLï¼‰</strong></li>
</ul>
</li>
<li><strong>æ ¸å¿ƒæ€æƒ³</strong>ï¼šé€šè¿‡é…ç½®æ–‡ä»¶æˆ–æ³¨è§£å®šä¹‰ SQL è¯­å¥ä¸ Java å¯¹è±¡çš„æ˜ å°„å…³ç³»ï¼Œæ¡†æ¶è‡ªåŠ¨å®Œæˆæ•°æ®çš„æŸ¥è¯¢ã€å°è£…ä¸æŒä¹…åŒ–æ“ä½œã€‚</li>
</ul>
<h3 id="1-2-ç¯å¢ƒæ­å»º"><a href="#1-2-ç¯å¢ƒæ­å»º" class="headerlink" title="1.2 ç¯å¢ƒæ­å»º"></a>1.2 ç¯å¢ƒæ­å»º</h3><h4 id="åŸºç¡€ä¾èµ–é…ç½®"><a href="#åŸºç¡€ä¾èµ–é…ç½®" class="headerlink" title="åŸºç¡€ä¾èµ–é…ç½®"></a>åŸºç¡€ä¾èµ–é…ç½®</h4><ul>
<li><strong>Maven ä¾èµ–</strong>ï¼ˆæ ¸å¿ƒ + æ•°æ®åº“é©±åŠ¨ï¼‰ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Mybatisæ ¸å¿ƒä¾èµ– --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line"> Â  Â &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line"> Â  Â &lt;artifactId&gt;mybatis&lt;/artifactId&gt;</span><br><span class="line"> Â  Â &lt;version&gt;3.5.16&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- MySQLé©±åŠ¨ï¼ˆæ ¹æ®æ•°æ®åº“ç±»å‹é€‰æ‹©ï¼‰ --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line"> Â  Â &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line"> Â  Â &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line"> Â  Â &lt;version&gt;8.0.33&lt;/version&gt; &lt;!-- é€‚é…MySQL 8.x --&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Gradle ä¾èµ–</strong>ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation &#x27;org.mybatis:mybatis:3.5.16&#x27;</span><br><span class="line">implementation &#x27;mysql:mysql-connector-java:8.0.33&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="1-3-é…ç½®æ–‡ä»¶ç»“æ„ï¼ˆmybatis-config-xmlï¼‰"><a href="#1-3-é…ç½®æ–‡ä»¶ç»“æ„ï¼ˆmybatis-config-xmlï¼‰" class="headerlink" title="1.3 é…ç½®æ–‡ä»¶ç»“æ„ï¼ˆmybatis-config.xmlï¼‰"></a>1.3 é…ç½®æ–‡ä»¶ç»“æ„ï¼ˆmybatis-config.xmlï¼‰</h3><p><strong>Mybatis æ ¸å¿ƒé…ç½®æ–‡ä»¶åŒ…å«æ¡†æ¶å…¨å±€è®¾ç½®ï¼Œæ ‡ç­¾é¡ºåºæœ‰ä¸¥æ ¼è¦æ±‚ï¼ˆproperties â†’ settings â†’ typeAliases â†’ â€¦ â†’ environments â†’ mappersï¼‰</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line"> Â  Â &lt;!-- 1. å¼•å…¥å¤–éƒ¨é…ç½®æ–‡ä»¶ï¼ˆå¦‚æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼‰ --&gt;</span><br><span class="line"> Â  Â &lt;properties resource=&quot;db.properties&quot;/&gt;</span><br><span class="line"></span><br><span class="line"> Â  Â &lt;!-- 2. å…¨å±€è®¾ç½® --&gt;</span><br><span class="line"> Â  Â &lt;settings&gt;</span><br><span class="line"> Â  Â  Â  Â &lt;!-- å¼€å¯é©¼å³°å‘½åè‡ªåŠ¨æ˜ å°„ï¼ˆæ•°æ®åº“user_name â†’ å®ä½“userNameï¼‰ --&gt;</span><br><span class="line"> Â  Â  Â  Â &lt;setting name=&quot;mapUnderscoreToCamelCase&quot; value=&quot;true&quot;/&gt;</span><br><span class="line"> Â  Â  Â  Â &lt;!-- å¼€å¯æ—¥å¿—ï¼ˆå¯é€‰LOG4Jã€SLF4Jç­‰ï¼‰ --&gt;</span><br><span class="line"> Â  Â  Â  Â &lt;setting name=&quot;logImpl&quot; value=&quot;LOG4J&quot;/&gt;</span><br><span class="line"> Â  Â  Â  Â &lt;!-- äºŒçº§ç¼“å­˜å¼€å…³ --&gt;</span><br><span class="line"> Â  Â  Â  Â &lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt;</span><br><span class="line"> Â  Â &lt;/settings&gt;</span><br><span class="line"></span><br><span class="line"> Â  Â &lt;!-- 3. ç±»å‹åˆ«åï¼ˆç®€åŒ–ç±»åä¹¦å†™ï¼‰ --&gt;</span><br><span class="line"> Â  Â &lt;typeAliases&gt;</span><br><span class="line"> Â  Â  Â  Â &lt;!-- å•ä¸ªç±»åˆ«å --&gt;</span><br><span class="line"> Â  Â  Â  Â &lt;typeAlias type=&quot;com.example.pojo.User&quot; alias=&quot;User&quot;/&gt;</span><br><span class="line"> Â  Â  Â  Â &lt;!-- åŒ…æ‰«æï¼ˆé»˜è®¤åˆ«åä¸ºç±»åé¦–å­—æ¯å°å†™ï¼Œå¦‚Userâ†’userï¼‰ --&gt;</span><br><span class="line"> Â  Â  Â  Â &lt;package name=&quot;com.example.pojo&quot;/&gt;</span><br><span class="line"> Â  Â &lt;/typeAliases&gt;</span><br><span class="line"></span><br><span class="line"> Â  Â &lt;!-- 4. ç¯å¢ƒé…ç½®ï¼ˆå¯é…ç½®å¤šç¯å¢ƒï¼ŒdefaultæŒ‡å®šé»˜è®¤ç¯å¢ƒï¼‰ --&gt;</span><br><span class="line"> Â  Â &lt;environments default=&quot;development&quot;&gt;</span><br><span class="line"> Â  Â  Â  Â &lt;environment id=&quot;development&quot;&gt;</span><br><span class="line"> Â  Â  Â  Â  Â  Â &lt;!-- äº‹åŠ¡ç®¡ç†å™¨ï¼šJDBCï¼ˆä¾èµ–æ•°æ®åº“äº‹åŠ¡ï¼‰/MANAGEDï¼ˆäº¤ç»™å®¹å™¨ç®¡ç†ï¼‰ --&gt;</span><br><span class="line"> Â  Â  Â  Â  Â  Â &lt;transactionManager type=&quot;JDBC&quot;/&gt;</span><br><span class="line"> Â  Â  Â  Â  Â  Â &lt;!-- æ•°æ®æºï¼šPOOLEDï¼ˆè¿æ¥æ± ï¼‰/UNPOOLEDï¼ˆæ— è¿æ¥æ± ï¼‰/JNDIï¼ˆå®¹å™¨æ•°æ®æºï¼‰ --&gt;</span><br><span class="line"> Â  Â  Â  Â  Â  Â &lt;dataSource type=&quot;POOLED&quot;&gt;</span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â &lt;property name=&quot;driver&quot; value=&quot;$&#123;db.driver&#125;&quot;/&gt; &lt;!-- ä»propertiesæ–‡ä»¶è·å– --&gt;</span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â &lt;property name=&quot;url&quot; value=&quot;$&#123;db.url&#125;&quot;/&gt;</span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â &lt;property name=&quot;username&quot; value=&quot;$&#123;db.username&#125;&quot;/&gt;</span><br><span class="line"> Â  Â  Â  Â  Â  Â  Â  Â &lt;property name=&quot;password&quot; value=&quot;$&#123;db.password&#125;&quot;/&gt;</span><br><span class="line"> Â  Â  Â  Â  Â  Â &lt;/dataSource&gt;</span><br><span class="line"> Â  Â  Â  Â &lt;/environment&gt;</span><br><span class="line"> Â  Â &lt;/environments&gt;</span><br><span class="line"></span><br><span class="line"> Â  Â &lt;!-- 5. æ˜ å°„å™¨ï¼ˆæ³¨å†ŒSQLæ˜ å°„æ–‡ä»¶æˆ–æ¥å£ï¼‰ --&gt;</span><br><span class="line"> Â  Â &lt;mappers&gt;</span><br><span class="line"> Â  Â  Â  Â &lt;!-- æ–¹å¼1ï¼šèµ„æºè·¯å¾„ï¼ˆXMLæ–‡ä»¶ï¼‰ --&gt;</span><br><span class="line"> Â  Â  Â  Â &lt;mapper resource=&quot;mappers/UserMapper.xml&quot;/&gt;</span><br><span class="line"> Â  Â  Â  Â &lt;!-- æ–¹å¼2ï¼šæ¥å£å…¨ç±»åï¼ˆéœ€XMLä¸æ¥å£åŒåŒ…åŒåï¼‰ --&gt;</span><br><span class="line"> Â  Â  Â  Â &lt;mapper class=&quot;com.example.mapper.UserMapper&quot;/&gt;</span><br><span class="line"> Â  Â  Â  Â &lt;!-- æ–¹å¼3ï¼šåŒ…æ‰«æï¼ˆæ‰¹é‡æ³¨å†Œæ¥å£ï¼‰ --&gt;</span><br><span class="line"> Â  Â  Â  Â &lt;package name=&quot;com.example.mapper&quot;/&gt;</span><br><span class="line"> Â  Â &lt;/mappers&gt;</span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<p><strong>è¡¥å……</strong>ï¼š<code>db.properties</code> æ–‡ä»¶ç¤ºä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.driver=com.mysql.cj.jdbc.Driver</span><br><span class="line">db.url=jdbc:mysql://localhost:3306/test?useSSL=false&amp;serverTimezone=UTC</span><br><span class="line">db.username=root</span><br><span class="line">db.password=123456</span><br></pre></td></tr></table></figure>

<h3 id="1-4-åŸºç¡€ä½¿ç”¨ç¤ºä¾‹ï¼ˆå·¥å…·ç±»-æ ¸å¿ƒ-APIï¼‰"><a href="#1-4-åŸºç¡€ä½¿ç”¨ç¤ºä¾‹ï¼ˆå·¥å…·ç±»-æ ¸å¿ƒ-APIï¼‰" class="headerlink" title="1.4 åŸºç¡€ä½¿ç”¨ç¤ºä¾‹ï¼ˆå·¥å…·ç±» + æ ¸å¿ƒ APIï¼‰"></a>1.4 åŸºç¡€ä½¿ç”¨ç¤ºä¾‹ï¼ˆå·¥å…·ç±» + æ ¸å¿ƒ APIï¼‰</h3><h4 id="å·¥å…·ç±»å°è£…ï¼ˆMybatisUtilï¼‰"><a href="#å·¥å…·ç±»å°è£…ï¼ˆMybatisUtilï¼‰" class="headerlink" title="å·¥å…·ç±»å°è£…ï¼ˆMybatisUtilï¼‰"></a>å·¥å…·ç±»å°è£…ï¼ˆMybatisUtilï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">public class MybatisUtil &#123;</span><br><span class="line"> Â  Â // SqlSessionFactoryæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå…¨å±€åªéœ€è¦ä¸€ä¸ªå®ä¾‹</span><br><span class="line"> Â  Â private static SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line"> Â  Â static &#123;</span><br><span class="line"> Â  Â  Â  Â try &#123;</span><br><span class="line"> Â  Â  Â  Â  Â  Â // 1. åŠ è½½é…ç½®æ–‡ä»¶ï¼ˆInputStream/Readerå‡å¯ï¼‰</span><br><span class="line"> Â  Â  Â  Â  Â  Â InputStream is = Resources.getResourceAsStream(&quot;mybatis-config.xml&quot;);</span><br><span class="line"> Â  Â  Â  Â  Â  Â // 2. åˆ›å»ºSqlSessionFactoryï¼ˆå»ºé€ è€…æ¨¡å¼ï¼‰</span><br><span class="line"> Â  Â  Â  Â  Â  Â sqlSessionFactory = new SqlSessionFactoryBuilder().build(is);</span><br><span class="line"> Â  Â  Â   &#125; catch (IOException e) &#123;</span><br><span class="line"> Â  Â  Â  Â  Â  Â throw new RuntimeException(&quot;åˆå§‹åŒ–SqlSessionFactoryå¤±è´¥&quot;, e);</span><br><span class="line"> Â  Â  Â   &#125;</span><br><span class="line"> Â   &#125;</span><br><span class="line"></span><br><span class="line"> Â  Â /**</span><br><span class="line"> Â  Â  * è·å–SqlSessionå®ä¾‹</span><br><span class="line"> Â  Â  * @param autoCommit æ˜¯å¦è‡ªåŠ¨æäº¤äº‹åŠ¡ï¼ˆDMLæ“ä½œå»ºè®®å…³é—­è‡ªåŠ¨æäº¤ï¼‰</span><br><span class="line"> Â  Â  * @return SqlSessionï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼Œéœ€å•ç‹¬è·å–ï¼‰</span><br><span class="line"> Â  Â  */</span><br><span class="line"> Â  Â public static SqlSession openSession(boolean autoCommit) &#123;</span><br><span class="line"> Â  Â  Â  Â return sqlSessionFactory.openSession(autoCommit);</span><br><span class="line"> Â   &#125;</span><br><span class="line"></span><br><span class="line"> Â  Â // ç®€åŒ–è°ƒç”¨ï¼šé»˜è®¤ä¸è‡ªåŠ¨æäº¤</span><br><span class="line"> Â  Â public static SqlSession openSession() &#123;</span><br><span class="line"> Â  Â  Â  Â return openSession(false);</span><br><span class="line"> Â   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ ¸å¿ƒ-API-è¯´æ˜"><a href="#æ ¸å¿ƒ-API-è¯´æ˜" class="headerlink" title="æ ¸å¿ƒ API è¯´æ˜"></a>æ ¸å¿ƒ API è¯´æ˜</h4><ul>
<li><strong>SqlSessionFactory</strong>ï¼šå·¥å‚ç±»ï¼Œè´Ÿè´£åˆ›å»º SqlSessionï¼Œå…¨å±€å”¯ä¸€ï¼Œçº¿ç¨‹å®‰å…¨ã€‚</li>
<li><strong>SqlSession</strong>ï¼šä¼šè¯å¯¹è±¡ï¼Œå°è£…äº†æ•°æ®åº“è¿æ¥ï¼Œæä¾› CRUD æ–¹æ³•ï¼Œçº¿ç¨‹ä¸å®‰å…¨ï¼Œéœ€æ¯æ¬¡ä½¿ç”¨æ—¶åˆ›å»ºï¼Œç”¨å®Œå…³é—­ã€‚</li>
<li><strong>ä½¿ç”¨æµç¨‹ï¼š</strong><ol>
<li><strong>é€šè¿‡å·¥å…·ç±»è·å– SqlSession</strong></li>
<li><strong>æ‰§è¡Œ SQL æ“ä½œï¼ˆç›´æ¥è°ƒç”¨ API æˆ–é€šè¿‡ Mapper æ¥å£ï¼‰</strong></li>
<li><strong>æäº¤ &#x2F; å›æ»šäº‹åŠ¡ï¼ˆDML æ“ä½œï¼‰</strong></li>
<li><strong>å…³é—­ SqlSessionï¼ˆtry-with-resources è‡ªåŠ¨å…³é—­ï¼‰</strong></li>
</ol>
</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?content_id=175142038&content_type=Article&match_order=1&q=%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80&zhida_source=entity">æ•°æ®å®šä¹‰è¯­è¨€</a>(DDL)ã€<a target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?content_id=175142038&content_type=Article&match_order=1&q=%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80&zhida_source=entity">æ•°æ®æŸ¥è¯¢è¯­è¨€</a>ï¼ˆDQLï¼‰ã€<a target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?content_id=175142038&content_type=Article&match_order=1&q=%E6%95%B0%E6%8D%AE%E6%93%8D%E7%BA%B5%E8%AF%AD%E8%A8%80&zhida_source=entity">æ•°æ®æ“çºµè¯­è¨€</a>ï¼ˆDMLï¼‰ã€<a target="_blank" rel="noopener" href="https://zhida.zhihu.com/search?content_id=175142038&content_type=Article&match_order=1&q=%E6%95%B0%E6%8D%AE%E6%8E%A7%E5%88%B6%E8%AF%AD%E8%A8%80&zhida_source=entity">æ•°æ®æ§åˆ¶è¯­è¨€</a>ï¼ˆDCLï¼‰</p>
</blockquote>
<h3 id="1-5-MyBatis-ä¸-JDBC-çš„å¯¹æ¯”ï¼ˆè§£å†³-JDBC-çš„æ ¸å¿ƒç—›ç‚¹ï¼‰"><a href="#1-5-MyBatis-ä¸-JDBC-çš„å¯¹æ¯”ï¼ˆè§£å†³-JDBC-çš„æ ¸å¿ƒç—›ç‚¹ï¼‰" class="headerlink" title="1.5 MyBatis ä¸ JDBC çš„å¯¹æ¯”ï¼ˆè§£å†³ JDBC çš„æ ¸å¿ƒç—›ç‚¹ï¼‰"></a>1.5 MyBatis ä¸ JDBC çš„å¯¹æ¯”ï¼ˆè§£å†³ JDBC çš„æ ¸å¿ƒç—›ç‚¹ï¼‰</h3><p><strong>JDBC æ“ä½œæ•°æ®åº“çš„å…¸å‹æµç¨‹ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// JDBCåŸç”Ÿä»£ç ï¼ˆå†—ä½™ä¸”ç¹çï¼‰</span><br><span class="line">Connection conn = null;</span><br><span class="line">PreparedStatement ps = null;</span><br><span class="line">ResultSet rs = null;</span><br><span class="line">try &#123;</span><br><span class="line"> Â  Â // 1. åŠ è½½é©±åŠ¨ï¼ˆç¡¬ç¼–ç ï¼‰</span><br><span class="line"> Â  Â Class.forName(&quot;com.mysql.cj.jdbc.Driver&quot;);</span><br><span class="line"> Â  Â // 2. åˆ›å»ºè¿æ¥ï¼ˆURL/è´¦å·/å¯†ç ç¡¬ç¼–ç ï¼‰</span><br><span class="line"> Â  Â conn = DriverManager.getConnection(&quot;jdbc:mysql://localhost:3306/test&quot;, &quot;root&quot;, &quot;123456&quot;);</span><br><span class="line"> Â  Â // 3. ç¼–å†™SQLï¼ˆå­—ç¬¦ä¸²æ‹¼æ¥æ˜“å¼•å‘æ³¨å…¥ï¼‰</span><br><span class="line"> Â  Â String sql = &quot;select * from user where id = &quot; + id; // å­˜åœ¨SQLæ³¨å…¥é£é™©</span><br><span class="line"> Â  Â ps = conn.prepareStatement(sql);</span><br><span class="line"> Â  Â // 4. æ‰§è¡ŒæŸ¥è¯¢</span><br><span class="line"> Â  Â rs = ps.executeQuery();</span><br><span class="line"> Â  Â // 5. æ‰‹åŠ¨å°è£…ç»“æœé›†ï¼ˆé‡å¤åŠ³åŠ¨ï¼‰</span><br><span class="line"> Â  Â User user = new User();</span><br><span class="line"> Â  Â while (rs.next()) &#123;</span><br><span class="line"> Â  Â  Â  Â user.setId(rs.getInt(&quot;id&quot;));</span><br><span class="line"> Â  Â  Â  Â user.setName(rs.getString(&quot;name&quot;));</span><br><span class="line"> Â  Â  Â  Â // ... æ›´å¤šå­—æ®µæ˜ å°„</span><br><span class="line"> Â   &#125;</span><br><span class="line">&#125; catch (Exception e) &#123;</span><br><span class="line"> Â  Â e.printStackTrace();</span><br><span class="line">&#125; finally &#123;</span><br><span class="line"> Â  Â // 6. æ‰‹åŠ¨å…³é—­èµ„æºï¼ˆç¹çä¸”æ˜“é—æ¼ï¼‰</span><br><span class="line"> Â  Â if (rs != null) try &#123; rs.close(); &#125; catch (SQLException e) &#123;&#125;</span><br><span class="line"> Â  Â if (ps != null) try &#123; ps.close(); &#125; catch (SQLException e) &#123;&#125;</span><br><span class="line"> Â  Â if (conn != null) try &#123; conn.close(); &#125; catch (SQLException e) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>MyBatis çš„ä¼˜åŒ–ç‚¹ï¼š</strong></p>
<ul>
<li><strong>æ¶ˆé™¤ç¡¬ç¼–ç ï¼šé€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†æ•°æ®åº“è¿æ¥ä¿¡æ¯å’Œ SQL</strong></li>
<li><strong>é˜²æ³¨å…¥ï¼šä½¿ç”¨</strong><code>#&#123;&#125;</code> é¢„ç¼–è¯‘å‚æ•°ï¼ˆæ›¿ä»£ JDBC çš„å­—ç¬¦ä¸²æ‹¼æ¥ï¼‰</li>
<li><strong>è‡ªåŠ¨æ˜ å°„ï¼šç»“æœé›†è‡ªåŠ¨å°è£…ä¸º Java å¯¹è±¡ï¼ˆæ— éœ€æ‰‹åŠ¨</strong><code>rs.getXXX()</code>ï¼‰</li>
<li><strong>èµ„æºç®¡ç†ï¼šè‡ªåŠ¨å¤„ç†è¿æ¥ã€Statementã€ResultSet çš„åˆ›å»ºä¸å…³é—­</strong></li>
<li><strong>äº‹åŠ¡ç®€åŒ–ï¼šé€šè¿‡</strong><code>SqlSession</code> çš„ <code>commit()</code>&#x2F;<code>rollback()</code> ç»Ÿä¸€ç®¡ç†</li>
</ul>
<h3 id="1-6-åˆæ¬¡ä½¿ç”¨çš„ç»†èŠ‚è¡¥å……"><a href="#1-6-åˆæ¬¡ä½¿ç”¨çš„ç»†èŠ‚è¡¥å……" class="headerlink" title="1.6 åˆæ¬¡ä½¿ç”¨çš„ç»†èŠ‚è¡¥å……"></a>1.6 åˆæ¬¡ä½¿ç”¨çš„ç»†èŠ‚è¡¥å……</h3><ul>
<li><strong>Mapper é…ç½®æ–‡ä»¶çš„ DTD å¼•å…¥ï¼šåœ¨ XML æ˜ å°„æ–‡ä»¶å¤´éƒ¨æ·»åŠ  DTD çº¦æŸï¼Œç¡®ä¿æ ‡ç­¾æ ¼å¼æ­£ç¡®ï¼ˆIDE ä¼šè‡ªåŠ¨æç¤ºï¼‰ï¼š</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span><br><span class="line">&lt;!DOCTYPE mapper</span><br><span class="line"> Â  Â  Â  Â PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span><br><span class="line"> Â  Â  Â  Â &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;</span><br></pre></td></tr></table></figure></li>
<li><strong>ç¯å¢ƒé…ç½®ç»†èŠ‚</strong>ï¼š<code>environments</code> æ ‡ç­¾çš„ <code>default</code> å±æ€§éœ€ä¸æŸä¸ª <code>environment</code> çš„ <code>id</code> ä¸€è‡´ï¼›<code>transactionManager</code> çš„ <code>MANAGED</code> ç±»å‹ä¼šå°†äº‹åŠ¡äº¤ç»™å®¹å™¨ï¼ˆå¦‚ Springï¼‰ç®¡ç†ï¼Œæ­¤æ—¶ MyBatis ä¸åšä»»ä½•äº‹åŠ¡å¤„ç†ã€‚</li>
</ul>
<h3 id="1-7-XML-æ ¼å¼è§„èŒƒä¸ç‰¹æ®Šå­—ç¬¦å¤„ç†"><a href="#1-7-XML-æ ¼å¼è§„èŒƒä¸ç‰¹æ®Šå­—ç¬¦å¤„ç†" class="headerlink" title="1.7 XML æ ¼å¼è§„èŒƒä¸ç‰¹æ®Šå­—ç¬¦å¤„ç†"></a>1.7 XML æ ¼å¼è§„èŒƒä¸ç‰¹æ®Šå­—ç¬¦å¤„ç†</h3><h5 id="ï¼ˆ1ï¼‰åŸºæœ¬æ ¼å¼è§„åˆ™"><a href="#ï¼ˆ1ï¼‰åŸºæœ¬æ ¼å¼è§„åˆ™" class="headerlink" title="ï¼ˆ1ï¼‰åŸºæœ¬æ ¼å¼è§„åˆ™"></a>ï¼ˆ1ï¼‰åŸºæœ¬æ ¼å¼è§„åˆ™</h5><ul>
<li><strong>æ ¹èŠ‚ç‚¹å”¯ä¸€ï¼šæ ¸å¿ƒé…ç½®æ–‡ä»¶æ ¹èŠ‚ç‚¹ä¸º</strong><code>&lt;configuration&gt;</code>ï¼Œæ˜ å°„æ–‡ä»¶ä¸º <code>&lt;mapper&gt;</code></li>
<li><strong>æ ‡ç­¾åµŒå¥—ä¸¥æ ¼ï¼šå­æ ‡ç­¾å¿…é¡»ç¬¦åˆ MyBatis è§„å®šçš„é¡ºåºï¼ˆå¦‚</strong><code>configuration</code> çš„å­æ ‡ç­¾é¡ºåºä¸å¯ä¹±ï¼‰</li>
<li><strong>å±æ€§å€¼å¼•å·ï¼šå•å¼•å·æˆ–åŒå¼•å·å‡å¯ï¼Œå»ºè®®ç»Ÿä¸€ä½¿ç”¨åŒå¼•å·</strong></li>
</ul>
<h5 id="ï¼ˆ2ï¼‰ç‰¹æ®Šå­—ç¬¦å¤„ç†ï¼ˆè½¬ä¹‰å­—ç¬¦ä¸-CDATAï¼‰"><a href="#ï¼ˆ2ï¼‰ç‰¹æ®Šå­—ç¬¦å¤„ç†ï¼ˆè½¬ä¹‰å­—ç¬¦ä¸-CDATAï¼‰" class="headerlink" title="ï¼ˆ2ï¼‰ç‰¹æ®Šå­—ç¬¦å¤„ç†ï¼ˆè½¬ä¹‰å­—ç¬¦ä¸ CDATAï¼‰"></a>ï¼ˆ2ï¼‰ç‰¹æ®Šå­—ç¬¦å¤„ç†ï¼ˆè½¬ä¹‰å­—ç¬¦ä¸ CDATAï¼‰</h5><p><strong>å½“ SQL ä¸­åŒ…å«</strong><code>&lt;</code>ã€<code>&gt;</code>ã€<code>&amp;</code> ç­‰ç‰¹æ®Šå­—ç¬¦æ—¶ï¼Œæœ‰ä¸¤ç§å¤„ç†æ–¹å¼ï¼š</p>
<ul>
<li><p><strong>è½¬ä¹‰å­—ç¬¦ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- åŸSQLï¼šselect * from user where age &lt; 18 --&gt;</span><br><span class="line">&lt;select id=&quot;selectYoungUser&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line"> Â   select * from user where age &lt; 18 &lt;!-- &lt; å¯¹åº” &lt; --&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p><strong>XML ä¸­å¸¸ç”¨çš„è½¬ä¹‰å­—ç¬¦å½’çº³å¦‚ä¸‹ï¼š</strong></p>
<table>
<thead>
<tr>
<th><strong>è½¬ä¹‰åºåˆ—</strong></th>
<th><strong>å¯¹åº”å­—ç¬¦</strong></th>
<th><strong>è¯´æ˜</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>&amp;amp</code> æˆ– <code>&amp;</code></td>
<td><code>&amp;</code></td>
<td><strong>å’Œ</strong></td>
</tr>
<tr>
<td><code>&amp;lt</code> æˆ– <code>&lt;</code></td>
<td><code>&lt;</code></td>
<td><strong>å°äºå·</strong></td>
</tr>
<tr>
<td><code>&amp;gt</code> æˆ– <code>&gt;</code></td>
<td><code>&gt;</code></td>
<td><strong>å¤§äºå·</strong></td>
</tr>
<tr>
<td><code>&amp;quot</code></td>
<td><code>&quot;</code></td>
<td><strong>åŒå¼•å·</strong></td>
</tr>
<tr>
<td><code>&amp;nbsp</code></td>
<td><strong>ï¼ˆç©ºæ ¼ï¼‰</strong></td>
<td><strong>ç©ºæ ¼</strong></td>
</tr>
<tr>
<td><code>&amp;copy</code></td>
<td><code>Â©</code></td>
<td><strong>ç‰ˆæƒç¬¦</strong></td>
</tr>
<tr>
<td><code>&amp;reg</code></td>
<td><code>Â®</code></td>
<td><strong>æ³¨å†Œç¬¦</strong></td>
</tr>
</tbody></table>
</li>
<li><p><strong>CDATA åŒºåŸŸ</strong><br><strong>ï¼ˆæ— éœ€è½¬ä¹‰ï¼Œé€‚åˆå¤æ‚ SQLï¼‰ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectYoungUser&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line">    &lt;![CDATA[</span><br><span class="line">        select * from user where age &lt; 18 and status &amp; 1 = 1</span><br><span class="line">    ]]&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="ï¼ˆ3ï¼‰Java-è§£æ-XML-ç¤ºä¾‹ï¼ˆäº†è§£-MyBatis-åº•å±‚åŸç†ï¼‰"><a href="#ï¼ˆ3ï¼‰Java-è§£æ-XML-ç¤ºä¾‹ï¼ˆäº†è§£-MyBatis-åº•å±‚åŸç†ï¼‰" class="headerlink" title="ï¼ˆ3ï¼‰Java è§£æ XML ç¤ºä¾‹ï¼ˆäº†è§£ MyBatis åº•å±‚åŸç†ï¼‰"></a>ï¼ˆ3ï¼‰Java è§£æ XML ç¤ºä¾‹ï¼ˆäº†è§£ MyBatis åº•å±‚åŸç†ï¼‰</h5><p><strong>MyBatis é€šè¿‡ DOM è§£æ XML é…ç½®æ–‡ä»¶ï¼Œç®€åŒ–ç¤ºä¾‹ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// è§£æMyBatisæ˜ å°„æ–‡ä»¶ä¸­çš„SQL</span><br><span class="line">public class XmlParser &#123;</span><br><span class="line">    public static void main(String[] args) throws Exception &#123;</span><br><span class="line">        DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();</span><br><span class="line">        DocumentBuilder builder = factory.newDocumentBuilder();</span><br><span class="line">        Document doc = builder.parse(Resources.getResourceAsStream(&quot;mappers/UserMapper.xml&quot;));</span><br><span class="line"></span><br><span class="line">        // è·å–selectæ ‡ç­¾çš„SQLå†…å®¹</span><br><span class="line">        Node node = doc.getElementsByTagName(&quot;select&quot;).item(0);</span><br><span class="line">        String sql = node.getTextContent().trim();</span><br><span class="line">        System.out.println(&quot;è§£æåˆ°çš„SQLï¼š&quot; + sql);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="äºŒã€æ ¸å¿ƒæŸ¥è¯¢æ“ä½œè¯¦è§£"><a href="#äºŒã€æ ¸å¿ƒæŸ¥è¯¢æ“ä½œè¯¦è§£" class="headerlink" title="äºŒã€æ ¸å¿ƒæŸ¥è¯¢æ“ä½œè¯¦è§£"></a>äºŒã€æ ¸å¿ƒæŸ¥è¯¢æ“ä½œè¯¦è§£</h2><h3 id="2-1-åŸºç¡€æŸ¥è¯¢é…ç½®ï¼ˆXML-æ˜ å°„æ–‡ä»¶ï¼‰"><a href="#2-1-åŸºç¡€æŸ¥è¯¢é…ç½®ï¼ˆXML-æ˜ å°„æ–‡ä»¶ï¼‰" class="headerlink" title="2.1 åŸºç¡€æŸ¥è¯¢é…ç½®ï¼ˆXML æ˜ å°„æ–‡ä»¶ï¼‰"></a>2.1 åŸºç¡€æŸ¥è¯¢é…ç½®ï¼ˆXML æ˜ å°„æ–‡ä»¶ï¼‰</h3><p><code>UserMapper.xml</code> æ ¸å¿ƒæ ‡ç­¾è¯´æ˜ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;mapper namespace=&quot;userMapper&quot;&gt; &lt;!-- å‘½åç©ºé—´ï¼šåŒºåˆ†ä¸åŒæ˜ å°„æ–‡ä»¶çš„SQL --&gt;</span><br><span class="line">    &lt;!-- 1. ç®€å•æŸ¥è¯¢ --&gt;</span><br><span class="line">    &lt;select </span><br><span class="line">        id=&quot;selectAllUser&quot;  &lt;!-- SQLå”¯ä¸€æ ‡è¯†ï¼ˆä¸namespaceç»„åˆä¸ºå…¨é™å®šåï¼‰--&gt;</span><br><span class="line">        resultType=&quot;User&quot;   &lt;!-- ç»“æœç±»å‹ï¼ˆå•ä¸ªå¯¹è±¡/é›†åˆå…ƒç´ ç±»å‹ï¼‰ --&gt;</span><br><span class="line">        timeout=&quot;30&quot;&gt;       &lt;!-- è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ --&gt;</span><br><span class="line">        select * from user</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 2. æ¡ä»¶æŸ¥è¯¢ï¼ˆå•ä¸ªå‚æ•°ï¼‰ --&gt;</span><br><span class="line">    &lt;select </span><br><span class="line">        id=&quot;selectUserById&quot; </span><br><span class="line">        parameterType=&quot;int&quot;  &lt;!-- å‚æ•°ç±»å‹ï¼ˆå¯çœç•¥ï¼ŒMybatisè‡ªåŠ¨æ¨æ–­ï¼‰ --&gt;</span><br><span class="line">        resultType=&quot;User&quot;&gt;</span><br><span class="line">        select * from user where id = #&#123;id&#125;  &lt;!-- #&#123;id&#125;ï¼šå‚æ•°å ä½ç¬¦ï¼ˆé¢„ç¼–è¯‘ï¼Œé˜²SQLæ³¨å…¥ï¼‰ --&gt;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 3. å¤šæ¡ä»¶æŸ¥è¯¢ï¼ˆæ³¨æ„å‚æ•°ä¼ é€’æ–¹å¼ï¼‰ --&gt;</span><br><span class="line">    &lt;select id=&quot;selectUserByIdAndAge&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line">        select * from user where id = #&#123;id&#125; and age = #&#123;age&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-2-Java-è°ƒç”¨æ–¹å¼ï¼ˆ3-ç§å¸¸ç”¨æ–¹å¼ï¼‰"><a href="#2-2-Java-è°ƒç”¨æ–¹å¼ï¼ˆ3-ç§å¸¸ç”¨æ–¹å¼ï¼‰" class="headerlink" title="2.2 Java è°ƒç”¨æ–¹å¼ï¼ˆ3 ç§å¸¸ç”¨æ–¹å¼ï¼‰"></a>2.2 Java è°ƒç”¨æ–¹å¼ï¼ˆ3 ç§å¸¸ç”¨æ–¹å¼ï¼‰</h3><h4 id="æ–¹å¼-1ï¼šç›´æ¥é€šè¿‡-SqlSession-è°ƒç”¨ï¼ˆæŒ‡å®šå…¨é™å®šåï¼‰"><a href="#æ–¹å¼-1ï¼šç›´æ¥é€šè¿‡-SqlSession-è°ƒç”¨ï¼ˆæŒ‡å®šå…¨é™å®šåï¼‰" class="headerlink" title="æ–¹å¼ 1ï¼šç›´æ¥é€šè¿‡ SqlSession è°ƒç”¨ï¼ˆæŒ‡å®šå…¨é™å®šåï¼‰"></a>æ–¹å¼ 1ï¼šç›´æ¥é€šè¿‡ SqlSession è°ƒç”¨ï¼ˆæŒ‡å®šå…¨é™å®šåï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">try (SqlSession session = MybatisUtil.openSession()) &#123;</span><br><span class="line">    // å…¨é™å®šå = namespace + id</span><br><span class="line">    User user = session.selectOne(&quot;userMapper.selectUserById&quot;, 1); </span><br><span class="line">    List&lt;User&gt; users = session.selectList(&quot;userMapper.selectAllUser&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ–¹å¼-2ï¼šå¤šå‚æ•°ä¼ é€’ï¼ˆ-Param-æ³¨è§£-Mapï¼‰"><a href="#æ–¹å¼-2ï¼šå¤šå‚æ•°ä¼ é€’ï¼ˆ-Param-æ³¨è§£-Mapï¼‰" class="headerlink" title="æ–¹å¼ 2ï¼šå¤šå‚æ•°ä¼ é€’ï¼ˆ@Param æ³¨è§£ &#x2F; Mapï¼‰"></a>æ–¹å¼ 2ï¼šå¤šå‚æ•°ä¼ é€’ï¼ˆ@Param æ³¨è§£ &#x2F; Mapï¼‰</h4><ul>
<li><strong>@Param æ³¨è§£</strong>ï¼ˆæ¨èï¼Œæ¸…æ™°ç›´è§‚ï¼‰ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// Mapperæ¥å£æ–¹æ³•</span><br><span class="line">User selectUserByIdAndAge(@Param(&quot;id&quot;) int id, @Param(&quot;age&quot;) int age);</span><br><span class="line"></span><br><span class="line">// XMLä¸­ç›´æ¥ä½¿ç”¨#&#123;id&#125;å’Œ#&#123;age&#125;ï¼ˆæ— éœ€é¢å¤–é…ç½®ï¼‰</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Map ä¼ é€’</strong>ï¼ˆé€‚åˆå‚æ•°è¾ƒå¤šçš„åœºæ™¯ï¼‰ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, Object&gt; params = new HashMap&lt;&gt;();</span><br><span class="line">params.put(&quot;id&quot;, 1);</span><br><span class="line">params.put(&quot;age&quot;, 18);</span><br><span class="line">User user = session.selectOne(&quot;selectUserByIdAndAge&quot;, params);</span><br></pre></td></tr></table></figure>

<h4 id="æ–¹å¼-3ï¼šé€šè¿‡å®ä½“ç±»ä¼ é€’å‚æ•°"><a href="#æ–¹å¼-3ï¼šé€šè¿‡å®ä½“ç±»ä¼ é€’å‚æ•°" class="headerlink" title="æ–¹å¼ 3ï¼šé€šè¿‡å®ä½“ç±»ä¼ é€’å‚æ•°"></a>æ–¹å¼ 3ï¼šé€šè¿‡å®ä½“ç±»ä¼ é€’å‚æ•°</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// å®ä½“ç±»</span><br><span class="line">@Data</span><br><span class="line">public class UserQuery &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private int age;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// XMLä¸­ä½¿ç”¨#&#123;å±æ€§å&#125;</span><br><span class="line">&lt;select id=&quot;selectByQuery&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line">    select * from user where id = #&#123;id&#125; and age = #&#123;age&#125;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line"></span><br><span class="line">// è°ƒç”¨</span><br><span class="line">UserQuery query = new UserQuery();</span><br><span class="line">query.setId(1);</span><br><span class="line">query.setAge(18);</span><br><span class="line">User user = session.selectOne(&quot;selectByQuery&quot;, query);</span><br></pre></td></tr></table></figure>

<h3 id="2-3-å­—æ®µæ˜ å°„é—®é¢˜è§£å†³ï¼ˆ3-ç§æ–¹æ¡ˆï¼‰"><a href="#2-3-å­—æ®µæ˜ å°„é—®é¢˜è§£å†³ï¼ˆ3-ç§æ–¹æ¡ˆï¼‰" class="headerlink" title="2.3 å­—æ®µæ˜ å°„é—®é¢˜è§£å†³ï¼ˆ3 ç§æ–¹æ¡ˆï¼‰"></a>2.3 å­—æ®µæ˜ å°„é—®é¢˜è§£å†³ï¼ˆ3 ç§æ–¹æ¡ˆï¼‰</h3><p><strong>å½“å®ä½“ç±»å­—æ®µä¸æ•°æ®åº“åˆ—åä¸ä¸€è‡´æ—¶ï¼ˆå¦‚å®ä½“</strong><code>uid</code> vs æ•°æ®åº“ <code>id</code>ï¼‰ï¼Œéœ€æ‰‹åŠ¨æ˜ å°„ï¼š</p>
<h4 id="æ–¹æ¡ˆ-1ï¼šresultMapï¼ˆæœ€å¸¸ç”¨ï¼ŒXML-é…ç½®ï¼‰"><a href="#æ–¹æ¡ˆ-1ï¼šresultMapï¼ˆæœ€å¸¸ç”¨ï¼ŒXML-é…ç½®ï¼‰" class="headerlink" title="æ–¹æ¡ˆ 1ï¼šresultMapï¼ˆæœ€å¸¸ç”¨ï¼ŒXML é…ç½®ï¼‰"></a>æ–¹æ¡ˆ 1ï¼šresultMapï¼ˆæœ€å¸¸ç”¨ï¼ŒXML é…ç½®ï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- å®šä¹‰æ˜ å°„è§„åˆ™ --&gt;</span><br><span class="line">&lt;resultMap id=&quot;userMap&quot; type=&quot;User&quot;&gt;</span><br><span class="line">    &lt;id property=&quot;uid&quot; column=&quot;id&quot;/&gt; &lt;!-- ä¸»é”®æ˜ å°„ --&gt;</span><br><span class="line">    &lt;result property=&quot;username&quot; column=&quot;name&quot;/&gt; &lt;!-- æ™®é€šå­—æ®µæ˜ å°„ --&gt;</span><br><span class="line">    &lt;result property=&quot;userAge&quot; column=&quot;age&quot;/&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- ä½¿ç”¨æ˜ å°„è§„åˆ™ --&gt;</span><br><span class="line">&lt;select id=&quot;selectUserById&quot; resultMap=&quot;userMap&quot;&gt;</span><br><span class="line">    select * from user where id = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<h4 id="æ–¹æ¡ˆ-2ï¼šSQL-åˆ«åï¼ˆç®€å•åœºæ™¯ï¼‰"><a href="#æ–¹æ¡ˆ-2ï¼šSQL-åˆ«åï¼ˆç®€å•åœºæ™¯ï¼‰" class="headerlink" title="æ–¹æ¡ˆ 2ï¼šSQL åˆ«åï¼ˆç®€å•åœºæ™¯ï¼‰"></a>æ–¹æ¡ˆ 2ï¼šSQL åˆ«åï¼ˆç®€å•åœºæ™¯ï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectUserById&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line">    select id as uid, name as username, age as userAge from user where id = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<h4 id="æ–¹æ¡ˆ-3ï¼šå…¨å±€é©¼å³°æ˜ å°„ï¼ˆé’ˆå¯¹ä¸‹åˆ’çº¿å‘½åï¼‰"><a href="#æ–¹æ¡ˆ-3ï¼šå…¨å±€é©¼å³°æ˜ å°„ï¼ˆé’ˆå¯¹ä¸‹åˆ’çº¿å‘½åï¼‰" class="headerlink" title="æ–¹æ¡ˆ 3ï¼šå…¨å±€é©¼å³°æ˜ å°„ï¼ˆé’ˆå¯¹ä¸‹åˆ’çº¿å‘½åï¼‰"></a>æ–¹æ¡ˆ 3ï¼šå…¨å±€é©¼å³°æ˜ å°„ï¼ˆé’ˆå¯¹ä¸‹åˆ’çº¿å‘½åï¼‰</h4><p><strong>åœ¨</strong><code>mybatis-config.xml</code> ä¸­å¼€å¯ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;settings&gt;</span><br><span class="line">    &lt;setting name=&quot;mapUnderscoreToCamelCase&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">&lt;/settings&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>æ•ˆæœï¼šæ•°æ®åº“</strong><code>user_name</code> â†’ å®ä½“ <code>userName</code>ï¼Œ<code>user_age</code> â†’ <code>userAge</code></li>
</ul>
<h2 id="ä¸‰ã€æ¥å£ç»‘å®šä¸æ³¨è§£å¼€å‘"><a href="#ä¸‰ã€æ¥å£ç»‘å®šä¸æ³¨è§£å¼€å‘" class="headerlink" title="ä¸‰ã€æ¥å£ç»‘å®šä¸æ³¨è§£å¼€å‘"></a>ä¸‰ã€æ¥å£ç»‘å®šä¸æ³¨è§£å¼€å‘</h2><h3 id="3-1-æ¥å£ç»‘å®šï¼ˆæ¨èæ–¹å¼ï¼‰"><a href="#3-1-æ¥å£ç»‘å®šï¼ˆæ¨èæ–¹å¼ï¼‰" class="headerlink" title="3.1 æ¥å£ç»‘å®šï¼ˆæ¨èæ–¹å¼ï¼‰"></a>3.1 æ¥å£ç»‘å®šï¼ˆæ¨èæ–¹å¼ï¼‰</h3><p><strong>æ ¸å¿ƒåŸç†</strong>ï¼šé€šè¿‡åŠ¨æ€ä»£ç†ï¼Œå°† Mapper æ¥å£ä¸ XML æ˜ å°„æ–‡ä»¶ç»‘å®šï¼Œæ— éœ€ç¼–å†™å®ç°ç±»ã€‚</p>
<h4 id="æ­¥éª¤-1ï¼šå®šä¹‰-Mapper-æ¥å£"><a href="#æ­¥éª¤-1ï¼šå®šä¹‰-Mapper-æ¥å£" class="headerlink" title="æ­¥éª¤ 1ï¼šå®šä¹‰ Mapper æ¥å£"></a>æ­¥éª¤ 1ï¼šå®šä¹‰ Mapper æ¥å£</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public interface UserMapper &#123;</span><br><span class="line">    // æ–¹æ³•å = XMLä¸­selectçš„id</span><br><span class="line">    // å‚æ•°ç±»å‹ = parameterType</span><br><span class="line">    // è¿”å›å€¼ç±»å‹ = resultType/resultMap</span><br><span class="line">    User selectUserById(int id);</span><br><span class="line">    List&lt;User&gt; selectAllUser();</span><br><span class="line">    int insertUser(User user);</span><br><span class="line">    int updateUserAge(@Param(&quot;id&quot;) int id, @Param(&quot;age&quot;) int age);</span><br><span class="line">    int deleteUserById(int id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ­¥éª¤-2ï¼šé…ç½®-XML-æ˜ å°„æ–‡ä»¶ï¼ˆnamespace-å¿…é¡»ä¸ºæ¥å£å…¨ç±»åï¼‰"><a href="#æ­¥éª¤-2ï¼šé…ç½®-XML-æ˜ å°„æ–‡ä»¶ï¼ˆnamespace-å¿…é¡»ä¸ºæ¥å£å…¨ç±»åï¼‰" class="headerlink" title="æ­¥éª¤ 2ï¼šé…ç½® XML æ˜ å°„æ–‡ä»¶ï¼ˆnamespace å¿…é¡»ä¸ºæ¥å£å…¨ç±»åï¼‰"></a>æ­¥éª¤ 2ï¼šé…ç½® XML æ˜ å°„æ–‡ä»¶ï¼ˆnamespace å¿…é¡»ä¸ºæ¥å£å…¨ç±»åï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;mapper namespace=&quot;com.example.mapper.UserMapper&quot;&gt; &lt;!-- æ¥å£å…¨ç±»å --&gt;</span><br><span class="line">    &lt;select id=&quot;selectUserById&quot; resultType=&quot;User&quot;&gt; &lt;!-- id = æ–¹æ³•å --&gt;</span><br><span class="line">        select * from user where id = #&#123;id&#125;</span><br><span class="line">    &lt;/select&gt;</span><br><span class="line">&lt;/mapper&gt;</span><br></pre></td></tr></table></figure>

<h4 id="æ­¥éª¤-3ï¼šé€šè¿‡æ¥å£è°ƒç”¨"><a href="#æ­¥éª¤-3ï¼šé€šè¿‡æ¥å£è°ƒç”¨" class="headerlink" title="æ­¥éª¤ 3ï¼šé€šè¿‡æ¥å£è°ƒç”¨"></a>æ­¥éª¤ 3ï¼šé€šè¿‡æ¥å£è°ƒç”¨</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">try (SqlSession session = MybatisUtil.openSession()) &#123;</span><br><span class="line">    // è·å–æ¥å£ä»£ç†å¯¹è±¡</span><br><span class="line">    UserMapper mapper = session.getMapper(UserMapper.class);</span><br><span class="line">    // è°ƒç”¨æ–¹æ³•ï¼ˆè‡ªåŠ¨æ‰§è¡Œå¯¹åº”SQLï¼‰</span><br><span class="line">    User user = mapper.selectUserById(1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-2-æ³¨è§£å¼€å‘ï¼ˆç®€åŒ–é…ç½®ï¼‰"><a href="#3-2-æ³¨è§£å¼€å‘ï¼ˆç®€åŒ–é…ç½®ï¼‰" class="headerlink" title="3.2 æ³¨è§£å¼€å‘ï¼ˆç®€åŒ–é…ç½®ï¼‰"></a>3.2 æ³¨è§£å¼€å‘ï¼ˆç®€åŒ–é…ç½®ï¼‰</h3><p><strong>é€‚åˆç®€å• SQLï¼Œå¤æ‚ SQL å»ºè®®ç”¨ XMLã€‚</strong></p>
<h4 id="å¸¸ç”¨æ³¨è§£è¯´æ˜"><a href="#å¸¸ç”¨æ³¨è§£è¯´æ˜" class="headerlink" title="å¸¸ç”¨æ³¨è§£è¯´æ˜"></a>å¸¸ç”¨æ³¨è§£è¯´æ˜</h4><table>
<thead>
<tr>
<th><strong>æ³¨è§£</strong></th>
<th><strong>ä½œç”¨</strong></th>
<th><strong>ç¤ºä¾‹</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>@Select</strong></td>
<td><strong>æŸ¥è¯¢æ“ä½œ</strong></td>
<td><strong>@Select(â€œSELECT * FROM user WHERE id &#x3D; #{id}â€)</strong></td>
</tr>
<tr>
<td><strong>@Insert</strong></td>
<td><strong>æ’å…¥æ“ä½œ</strong></td>
<td><strong>@Insert(â€œINSERT INTO user(name) VALUES(#{name})â€)</strong></td>
</tr>
<tr>
<td><strong>@Update</strong></td>
<td><strong>æ›´æ–°æ“ä½œ</strong></td>
<td><strong>@Update(â€œUPDATE user SET name &#x3D; #{name} WHERE id &#x3D; #{id}â€)</strong></td>
</tr>
<tr>
<td><strong>@Delete</strong></td>
<td><strong>åˆ é™¤æ“ä½œ</strong></td>
<td><strong>@Delete(â€œDELETE FROM user WHERE id &#x3D; #{id}â€)</strong></td>
</tr>
<tr>
<td><strong>@Results</strong></td>
<td><strong>å®šä¹‰ç»“æœæ˜ å°„</strong></td>
<td><strong>@Results({@Result(property&#x3D;â€uidâ€, column&#x3D;â€idâ€)})</strong></td>
</tr>
<tr>
<td><strong>@Param</strong></td>
<td><strong>å£°æ˜å‚æ•°å</strong></td>
<td><strong>æ–¹æ³•å‚æ•°å‰åŠ  @Param (â€œidâ€)</strong></td>
</tr>
<tr>
<td><strong>@Options</strong></td>
<td><strong>é¢å¤–é…ç½®ï¼ˆå¦‚è‡ªå¢ä¸»é”®ï¼‰</strong></td>
<td><strong>@Options(useGeneratedKeys &#x3D; true, keyProperty &#x3D; â€œidâ€)</strong></td>
</tr>
</tbody></table>
<h4 id="ç¤ºä¾‹ä»£ç "><a href="#ç¤ºä¾‹ä»£ç " class="headerlink" title="ç¤ºä¾‹ä»£ç "></a>ç¤ºä¾‹ä»£ç </h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public interface UserMapper &#123;</span><br><span class="line">    // åŸºç¡€æŸ¥è¯¢</span><br><span class="line">    @Select(&quot;SELECT * FROM user WHERE id = #&#123;id&#125;&quot;)</span><br><span class="line">    User selectUserById(int id);</span><br><span class="line"></span><br><span class="line">    // æ’å…¥å¹¶è¿”å›è‡ªå¢ä¸»é”®</span><br><span class="line">    @Options(useGeneratedKeys = true, keyProperty = &quot;id&quot;) // ä¸»é”®å›å†™è‡³å®ä½“idå±æ€§</span><br><span class="line">    @Insert(&quot;INSERT INTO user(name, age) VALUES(#&#123;name&#125;, #&#123;age&#125;)&quot;)</span><br><span class="line">    int insertUser(User user);</span><br><span class="line"></span><br><span class="line">    // ç»“æœæ˜ å°„ï¼ˆè§£å†³å­—æ®µä¸ä¸€è‡´ï¼‰</span><br><span class="line">    @Results(&#123;</span><br><span class="line">        @Result(property = &quot;uid&quot;, column = &quot;id&quot;),       // ä¸»é”®æ˜ å°„</span><br><span class="line">        @Result(property = &quot;username&quot;, column = &quot;name&quot;) // æ™®é€šå­—æ®µæ˜ å°„</span><br><span class="line">    &#125;)</span><br><span class="line">    @Select(&quot;SELECT * FROM user&quot;)</span><br><span class="line">    List&lt;User&gt; selectAllUser();</span><br><span class="line"></span><br><span class="line">    // åŠ¨æ€SQLï¼ˆæ³¨è§£ä¸­ç”¨&lt;script&gt;åŒ…è£¹ï¼‰</span><br><span class="line">    @Select(&quot;&lt;script&gt;&quot; +</span><br><span class="line">            &quot;SELECT * FROM user WHERE 1=1&quot; +</span><br><span class="line">            &quot;&lt;if test=&#x27;name != null&#x27;&gt; AND name = #&#123;name&#125;&lt;/if&gt;&quot; +</span><br><span class="line">            &quot;&lt;if test=&#x27;age != null&#x27;&gt; AND age = #&#123;age&#125;&lt;/if&gt;&quot; +</span><br><span class="line">            &quot;&lt;/script&gt;&quot;)</span><br><span class="line">    List&lt;User&gt; selectByCondition(User user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="å››ã€å¤æ‚å…³ç³»æŸ¥è¯¢ï¼ˆå…³è”æ˜ å°„ï¼‰"><a href="#å››ã€å¤æ‚å…³ç³»æŸ¥è¯¢ï¼ˆå…³è”æ˜ å°„ï¼‰" class="headerlink" title="å››ã€å¤æ‚å…³ç³»æŸ¥è¯¢ï¼ˆå…³è”æ˜ å°„ï¼‰"></a>å››ã€å¤æ‚å…³ç³»æŸ¥è¯¢ï¼ˆå…³è”æ˜ å°„ï¼‰</h2><h3 id="4-1-ä¸€å¯¹ä¸€æŸ¥è¯¢ï¼ˆå¦‚-User-ä¸-UserDetailï¼‰"><a href="#4-1-ä¸€å¯¹ä¸€æŸ¥è¯¢ï¼ˆå¦‚-User-ä¸-UserDetailï¼‰" class="headerlink" title="4.1 ä¸€å¯¹ä¸€æŸ¥è¯¢ï¼ˆå¦‚ User ä¸ UserDetailï¼‰"></a>4.1 ä¸€å¯¹ä¸€æŸ¥è¯¢ï¼ˆå¦‚ User ä¸ UserDetailï¼‰</h3><h4 id="å®ä½“ç±»è®¾è®¡"><a href="#å®ä½“ç±»è®¾è®¡" class="headerlink" title="å®ä½“ç±»è®¾è®¡"></a>å®ä½“ç±»è®¾è®¡</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">public class User &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String name;</span><br><span class="line">    private UserDetail detail; // ä¸€å¯¹ä¸€å…³è”ï¼ˆä¸€ä¸ªç”¨æˆ·å¯¹åº”ä¸€ä¸ªè¯¦æƒ…ï¼‰</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">public class UserDetail &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String address;</span><br><span class="line">    private Date registerTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å…³è”æŸ¥è¯¢å®ç°ï¼ˆ2-ç§æ–¹å¼ï¼‰"><a href="#å…³è”æŸ¥è¯¢å®ç°ï¼ˆ2-ç§æ–¹å¼ï¼‰" class="headerlink" title="å…³è”æŸ¥è¯¢å®ç°ï¼ˆ2 ç§æ–¹å¼ï¼‰"></a>å…³è”æŸ¥è¯¢å®ç°ï¼ˆ2 ç§æ–¹å¼ï¼‰</h4><h5 id="æ–¹å¼-1ï¼šå…³è”æŸ¥è¯¢ï¼ˆJOIN-è¯­å¥ï¼Œä¸€æ¬¡æŸ¥è¯¢ï¼‰"><a href="#æ–¹å¼-1ï¼šå…³è”æŸ¥è¯¢ï¼ˆJOIN-è¯­å¥ï¼Œä¸€æ¬¡æŸ¥è¯¢ï¼‰" class="headerlink" title="æ–¹å¼ 1ï¼šå…³è”æŸ¥è¯¢ï¼ˆJOIN è¯­å¥ï¼Œä¸€æ¬¡æŸ¥è¯¢ï¼‰"></a>æ–¹å¼ 1ï¼šå…³è”æŸ¥è¯¢ï¼ˆJOIN è¯­å¥ï¼Œä¸€æ¬¡æŸ¥è¯¢ï¼‰</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap id=&quot;userWithDetail&quot; type=&quot;User&quot;&gt;</span><br><span class="line">    &lt;id property=&quot;id&quot; column=&quot;id&quot;/&gt;</span><br><span class="line">    &lt;result property=&quot;name&quot; column=&quot;name&quot;/&gt;</span><br><span class="line">    &lt;!-- associationï¼šä¸€å¯¹ä¸€å…³è” --&gt;</span><br><span class="line">    &lt;association </span><br><span class="line">        property=&quot;detail&quot;      &lt;!-- å®ä½“ä¸­å…³è”å±æ€§å --&gt;</span><br><span class="line">        javaType=&quot;UserDetail&quot;&gt; &lt;!-- å…³è”å±æ€§ç±»å‹ --&gt;</span><br><span class="line">        &lt;id property=&quot;id&quot; column=&quot;detail_id&quot;/&gt; &lt;!-- æ³¨æ„columnä¸æŸ¥è¯¢ç»“æœåˆ«åå¯¹åº” --&gt;</span><br><span class="line">        &lt;result property=&quot;address&quot; column=&quot;address&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;registerTime&quot; column=&quot;register_time&quot;/&gt;</span><br><span class="line">    &lt;/association&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">&lt;select id=&quot;selectUserWithDetail&quot; resultMap=&quot;userWithDetail&quot;&gt;</span><br><span class="line">    SELECT </span><br><span class="line">        u.id, u.name, </span><br><span class="line">        ud.id as detail_id, ud.address, ud.register_time </span><br><span class="line">    FROM user u </span><br><span class="line">    LEFT JOIN user_detail ud ON u.id = ud.user_id </span><br><span class="line">    WHERE u.id = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<h5 id="æ–¹å¼-2ï¼šåµŒå¥—æŸ¥è¯¢ï¼ˆå­æŸ¥è¯¢ï¼Œå¤šæ¬¡æŸ¥è¯¢ï¼‰"><a href="#æ–¹å¼-2ï¼šåµŒå¥—æŸ¥è¯¢ï¼ˆå­æŸ¥è¯¢ï¼Œå¤šæ¬¡æŸ¥è¯¢ï¼‰" class="headerlink" title="æ–¹å¼ 2ï¼šåµŒå¥—æŸ¥è¯¢ï¼ˆå­æŸ¥è¯¢ï¼Œå¤šæ¬¡æŸ¥è¯¢ï¼‰"></a>æ–¹å¼ 2ï¼šåµŒå¥—æŸ¥è¯¢ï¼ˆå­æŸ¥è¯¢ï¼Œå¤šæ¬¡æŸ¥è¯¢ï¼‰</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap id=&quot;userWithDetail&quot; type=&quot;User&quot;&gt;</span><br><span class="line">    &lt;id property=&quot;id&quot; column=&quot;id&quot;/&gt;</span><br><span class="line">    &lt;result property=&quot;name&quot; column=&quot;name&quot;/&gt;</span><br><span class="line">    &lt;association </span><br><span class="line">        property=&quot;detail&quot; </span><br><span class="line">        javaType=&quot;UserDetail&quot;</span><br><span class="line">        column=&quot;id&quot;                   &lt;!-- ä¼ é€’ç»™å­æŸ¥è¯¢çš„å‚æ•°ï¼ˆuserçš„idï¼‰ --&gt;</span><br><span class="line">        select=&quot;selectUserDetail&quot;/&gt;   &lt;!-- å­æŸ¥è¯¢çš„id --&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- ä¸»æŸ¥è¯¢ --&gt;</span><br><span class="line">&lt;select id=&quot;selectUserWithDetail&quot; resultMap=&quot;userWithDetail&quot;&gt;</span><br><span class="line">    select * from user where id = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- å­æŸ¥è¯¢ï¼ˆæ ¹æ®user_idæŸ¥è¯¦æƒ…ï¼‰ --&gt;</span><br><span class="line">&lt;select id=&quot;selectUserDetail&quot; resultType=&quot;UserDetail&quot;&gt;</span><br><span class="line">    select * from user_detail where user_id = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p><strong>æ³¨æ„</strong>ï¼šåµŒå¥—æŸ¥è¯¢å¯èƒ½å¯¼è‡´ N+1 é—®é¢˜ï¼ˆæŸ¥è¯¢ 1 ä¸ªç”¨æˆ·å¼•å‘ 1 æ¬¡ä¸»æŸ¥è¯¢ + N æ¬¡å­æŸ¥è¯¢ï¼‰ï¼Œå»ºè®®ä¼˜å…ˆç”¨å…³è”æŸ¥è¯¢ã€‚</p>
<h4 id="å¤šå‚æ•°ä¼ é€’"><a href="#å¤šå‚æ•°ä¼ é€’" class="headerlink" title="å¤šå‚æ•°ä¼ é€’"></a>å¤šå‚æ•°ä¼ é€’</h4><p><code>association</code> æ ‡ç­¾çš„ <code>column</code> å±æ€§æ”¯æŒå¤šåˆ—ä¼ é€’ï¼ˆç”¨äºå­æŸ¥è¯¢éœ€è¦å¤šä¸ªå‚æ•°çš„åœºæ™¯ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap id=&quot;userWithDetail&quot; type=&quot;User&quot;&gt;</span><br><span class="line">    &lt;id property=&quot;id&quot; column=&quot;id&quot;/&gt;</span><br><span class="line">    &lt;result property=&quot;name&quot; column=&quot;name&quot;/&gt;</span><br><span class="line">    &lt;association </span><br><span class="line">        property=&quot;detail&quot; </span><br><span class="line">        javaType=&quot;UserDetail&quot;</span><br><span class="line">        column=&quot;&#123;userId=id, status=status&#125;&quot; &lt;!-- å¤šåˆ—å‚æ•°ï¼ˆkeyä¸ºå­æŸ¥è¯¢å‚æ•°åï¼Œvalueä¸ºå½“å‰æŸ¥è¯¢åˆ—åï¼‰ --&gt;</span><br><span class="line">        select=&quot;selectUserDetailByMultiParams&quot;/&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- å­æŸ¥è¯¢æ¥æ”¶å¤šå‚æ•° --&gt;</span><br><span class="line">&lt;select id=&quot;selectUserDetailByMultiParams&quot; resultType=&quot;UserDetail&quot;&gt;</span><br><span class="line">    select * from user_detail where user_id = #&#123;userId&#125; and status = #&#123;status&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-ä¸€å¯¹å¤šæŸ¥è¯¢ï¼ˆå¦‚-User-ä¸-Bookï¼‰"><a href="#4-2-ä¸€å¯¹å¤šæŸ¥è¯¢ï¼ˆå¦‚-User-ä¸-Bookï¼‰" class="headerlink" title="4.2 ä¸€å¯¹å¤šæŸ¥è¯¢ï¼ˆå¦‚ User ä¸ Bookï¼‰"></a>4.2 ä¸€å¯¹å¤šæŸ¥è¯¢ï¼ˆå¦‚ User ä¸ Bookï¼‰</h3><h4 id="å®ä½“ç±»è®¾è®¡-1"><a href="#å®ä½“ç±»è®¾è®¡-1" class="headerlink" title="å®ä½“ç±»è®¾è®¡"></a>å®ä½“ç±»è®¾è®¡</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">public class User &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String name;</span><br><span class="line">    private List&lt;Book&gt; books; // ä¸€å¯¹å¤šå…³è”ï¼ˆä¸€ä¸ªç”¨æˆ·æœ‰å¤šæœ¬ä¹¦ï¼‰</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">public class Book &#123;</span><br><span class="line">    private int id;</span><br><span class="line">    private String title;</span><br><span class="line">    private int userId; // å…³è”ç”¨æˆ·id</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="å®ç°æ–¹å¼ï¼ˆå…³è”æŸ¥è¯¢ï¼‰"><a href="#å®ç°æ–¹å¼ï¼ˆå…³è”æŸ¥è¯¢ï¼‰" class="headerlink" title="å®ç°æ–¹å¼ï¼ˆå…³è”æŸ¥è¯¢ï¼‰"></a>å®ç°æ–¹å¼ï¼ˆå…³è”æŸ¥è¯¢ï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap id=&quot;userWithBooks&quot; type=&quot;User&quot;&gt;</span><br><span class="line">    &lt;id property=&quot;id&quot; column=&quot;id&quot;/&gt;</span><br><span class="line">    &lt;result property=&quot;name&quot; column=&quot;name&quot;/&gt;</span><br><span class="line">    &lt;!-- collectionï¼šä¸€å¯¹å¤šå…³è” --&gt;</span><br><span class="line">    &lt;collection </span><br><span class="line">        property=&quot;books&quot;    &lt;!-- é›†åˆå±æ€§å --&gt;</span><br><span class="line">        ofType=&quot;Book&quot;&gt;      &lt;!-- é›†åˆå…ƒç´ ç±»å‹ï¼ˆåŒºåˆ«äºjavaTypeï¼‰ --&gt;</span><br><span class="line">        &lt;id property=&quot;id&quot; column=&quot;book_id&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;title&quot; column=&quot;title&quot;/&gt;</span><br><span class="line">        &lt;result property=&quot;userId&quot; column=&quot;user_id&quot;/&gt;</span><br><span class="line">    &lt;/collection&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">&lt;select id=&quot;selectUserWithBooks&quot; resultMap=&quot;userWithBooks&quot;&gt;</span><br><span class="line">    SELECT </span><br><span class="line">        u.id, u.name, </span><br><span class="line">        b.id as book_id, b.title, b.user_id </span><br><span class="line">    FROM user u </span><br><span class="line">    LEFT JOIN book b ON u.id = b.user_id </span><br><span class="line">    WHERE u.id = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<h4 id="åŠ è½½æ–¹å¼"><a href="#åŠ è½½æ–¹å¼" class="headerlink" title="åŠ è½½æ–¹å¼"></a>åŠ è½½æ–¹å¼</h4><p><code>collection</code> æ ‡ç­¾çš„ <code>fetchType</code> å±æ€§æ§åˆ¶åŠ è½½æ–¹å¼ï¼ˆ<code>eager</code> ç«‹å³åŠ è½½ &#x2F; <code>lazy</code> å»¶è¿ŸåŠ è½½ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap id=&quot;userWithBooks&quot; type=&quot;User&quot;&gt;</span><br><span class="line">    &lt;id property=&quot;id&quot; column=&quot;id&quot;/&gt;</span><br><span class="line">    &lt;result property=&quot;name&quot; column=&quot;name&quot;/&gt;</span><br><span class="line">    &lt;collection </span><br><span class="line">        property=&quot;books&quot; </span><br><span class="line">        ofType=&quot;Book&quot;</span><br><span class="line">        column=&quot;id&quot;</span><br><span class="line">        select=&quot;selectBooksByUserId&quot;</span><br><span class="line">        fetchType=&quot;lazy&quot;/&gt; &lt;!-- å»¶è¿ŸåŠ è½½ï¼šåªæœ‰è°ƒç”¨user.getBooks()æ—¶æ‰æ‰§è¡Œå­æŸ¥è¯¢ --&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br><span class="line"></span><br><span class="line">&lt;select id=&quot;selectBooksByUserId&quot; resultType=&quot;Book&quot;&gt;</span><br><span class="line">    select * from book where user_id = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p><strong>å»¶è¿ŸåŠ è½½é…ç½®</strong>ï¼ˆéœ€åœ¨å…¨å±€è®¾ç½®ä¸­å¼€å¯ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;settings&gt;</span><br><span class="line">    &lt;setting name=&quot;lazyLoadingEnabled&quot; value=&quot;true&quot;/&gt; &lt;!-- å…¨å±€å»¶è¿ŸåŠ è½½å¼€å…³ --&gt;</span><br><span class="line">    &lt;setting name=&quot;aggressiveLazyLoading&quot; value=&quot;false&quot;/&gt; &lt;!-- æŒ‰éœ€åŠ è½½ï¼ˆä¸è§¦å‘å…³è”å¯¹è±¡å…¨åŠ è½½ï¼‰ --&gt;</span><br><span class="line">&lt;/settings&gt;</span><br></pre></td></tr></table></figure>

<h2 id="äº”ã€DML-æ“ä½œä¸äº‹åŠ¡"><a href="#äº”ã€DML-æ“ä½œä¸äº‹åŠ¡" class="headerlink" title="äº”ã€DML æ“ä½œä¸äº‹åŠ¡"></a>äº”ã€DML æ“ä½œä¸äº‹åŠ¡</h2><h3 id="5-1-å¢åˆ æ”¹æ“ä½œï¼ˆXML-é…ç½®ï¼‰"><a href="#5-1-å¢åˆ æ”¹æ“ä½œï¼ˆXML-é…ç½®ï¼‰" class="headerlink" title="5.1 å¢åˆ æ”¹æ“ä½œï¼ˆXML é…ç½®ï¼‰"></a>5.1 å¢åˆ æ”¹æ“ä½œï¼ˆXML é…ç½®ï¼‰</h3><h4 id="æ’å…¥æ“ä½œï¼ˆå«è‡ªå¢ä¸»é”®ï¼‰"><a href="#æ’å…¥æ“ä½œï¼ˆå«è‡ªå¢ä¸»é”®ï¼‰" class="headerlink" title="æ’å…¥æ“ä½œï¼ˆå«è‡ªå¢ä¸»é”®ï¼‰"></a>æ’å…¥æ“ä½œï¼ˆå«è‡ªå¢ä¸»é”®ï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;insert </span><br><span class="line">    id=&quot;insertUser&quot; </span><br><span class="line">    parameterType=&quot;User&quot;</span><br><span class="line">    useGeneratedKeys=&quot;true&quot;  &lt;!-- å¼€å¯è‡ªå¢ä¸»é”®è·å– --&gt;</span><br><span class="line">    keyProperty=&quot;id&quot;&gt;        &lt;!-- ä¸»é”®å€¼å›å†™è‡³å®ä½“çš„idå±æ€§ --&gt;</span><br><span class="line">    INSERT INTO user(name, age) VALUES(#&#123;name&#125;, #&#123;age&#125;)</span><br><span class="line">&lt;/insert&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>è°ƒç”¨åå¯é€šè¿‡</strong><code>user.getId()</code> è·å–è‡ªåŠ¨ç”Ÿæˆçš„ä¸»é”®</li>
</ul>
<p><strong>éè‡ªå¢ä¸»é”®ï¼ˆå¦‚ UUIDï¼‰çš„è·å–æ–¹å¼ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;insert id=&quot;insertUserWithUUID&quot;&gt;</span><br><span class="line">    &lt;!-- æ’å…¥å‰ç”ŸæˆUUID --&gt;</span><br><span class="line">    &lt;selectKey </span><br><span class="line">        keyProperty=&quot;id&quot;    &lt;!-- ä¸»é”®å›å†™è‡³å®ä½“çš„idå±æ€§ --&gt;</span><br><span class="line">        resultType=&quot;String&quot; &lt;!-- ä¸»é”®ç±»å‹ --&gt;</span><br><span class="line">        order=&quot;BEFORE&quot;&gt;     &lt;!-- æ‰§è¡Œæ—¶æœºï¼šBEFOREï¼ˆæ’å…¥å‰ï¼‰/AFTERï¼ˆæ’å…¥åï¼‰ --&gt;</span><br><span class="line">        SELECT REPLACE(UUID(), &#x27;-&#x27;, &#x27;&#x27;) AS id</span><br><span class="line">    &lt;/selectKey&gt;</span><br><span class="line">    INSERT INTO user(id, name) VALUES(#&#123;id&#125;, #&#123;name&#125;)</span><br><span class="line">&lt;/insert&gt;</span><br></pre></td></tr></table></figure>

<p><strong>è”åˆä¸»é”®åœºæ™¯ï¼ˆ<code>keyColumn</code> æŒ‡å®šæ•°æ®åº“åˆ—åï¼‰ï¼š</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;insert id=&quot;insertOrderItem&quot; useGeneratedKeys=&quot;true&quot; </span><br><span class="line">        keyProperty=&quot;itemId&quot; keyColumn=&quot;item_id&quot;&gt; &lt;!-- å¤šä¸»é”®ç”¨é€—å·åˆ†éš”ï¼škeyColumn=&quot;col1,col2&quot; --&gt;</span><br><span class="line">    INSERT INTO order_item(order_id, product_id, quantity) </span><br><span class="line">    VALUES(#&#123;orderId&#125;, #&#123;productId&#125;, #&#123;quantity&#125;)</span><br><span class="line">&lt;/insert&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>æ­¤é…ç½®é¿å…äº†æ’å…¥åéœ€æ‰‹åŠ¨æŸ¥è¯¢ä¸»é”®çš„é¢å¤–æ“ä½œï¼Œç®€åŒ–äº†å…³è”æ•°æ®çš„æ’å…¥é€»è¾‘ã€‚</strong></li>
</ul>
<h4 id="æ›´æ–°æ“ä½œ"><a href="#æ›´æ–°æ“ä½œ" class="headerlink" title="æ›´æ–°æ“ä½œ"></a>æ›´æ–°æ“ä½œ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;update id=&quot;updateUser&quot; parameterType=&quot;User&quot;&gt;</span><br><span class="line">    UPDATE user </span><br><span class="line">    SET name = #&#123;name&#125;, age = #&#123;age&#125; </span><br><span class="line">    WHERE id = #&#123;id&#125;</span><br><span class="line">&lt;/update&gt;</span><br></pre></td></tr></table></figure>

<h4 id="åˆ é™¤æ“ä½œ"><a href="#åˆ é™¤æ“ä½œ" class="headerlink" title="åˆ é™¤æ“ä½œ"></a>åˆ é™¤æ“ä½œ</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;delete id=&quot;deleteUserById&quot; parameterType=&quot;int&quot;&gt;</span><br><span class="line">    DELETE FROM user WHERE id = #&#123;id&#125;</span><br><span class="line">&lt;/delete&gt;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-äº‹åŠ¡ç®¡ç†"><a href="#5-2-äº‹åŠ¡ç®¡ç†" class="headerlink" title="5.2 äº‹åŠ¡ç®¡ç†"></a>5.2 äº‹åŠ¡ç®¡ç†</h3><p><strong>Mybatis äº‹åŠ¡é»˜è®¤ä¾èµ– JDBC äº‹åŠ¡ç®¡ç†å™¨ï¼Œéœ€æ‰‹åŠ¨æ§åˆ¶æäº¤ &#x2F; å›æ»šã€‚</strong></p>
<h4 id="äº‹åŠ¡æ“ä½œæµç¨‹"><a href="#äº‹åŠ¡æ“ä½œæµç¨‹" class="headerlink" title="äº‹åŠ¡æ“ä½œæµç¨‹"></a>äº‹åŠ¡æ“ä½œæµç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">try (SqlSession session = MybatisUtil.openSession()) &#123; // å…³é—­è‡ªåŠ¨æäº¤ï¼ˆé»˜è®¤ï¼‰</span><br><span class="line">    UserMapper mapper = session.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        // æ‰§è¡Œå¤šä¸ªDMLæ“ä½œ</span><br><span class="line">        mapper.insertUser(user1);</span><br><span class="line">        mapper.updateUser(user2);</span><br><span class="line"></span><br><span class="line">        session.commit(); // å…¨éƒ¨æˆåŠŸåˆ™æäº¤</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        session.rollback(); // å¤±è´¥åˆ™å›æ»š</span><br><span class="line">        throw new RuntimeException(&quot;äº‹åŠ¡æ‰§è¡Œå¤±è´¥&quot;, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="äº‹åŠ¡ç‰¹æ€§"><a href="#äº‹åŠ¡ç‰¹æ€§" class="headerlink" title="äº‹åŠ¡ç‰¹æ€§"></a>äº‹åŠ¡ç‰¹æ€§</h4><ul>
<li><strong>åŸå­æ€§</strong>ï¼šå¤šä¸ªæ“ä½œè¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å¤±è´¥</li>
<li><strong>ä¸€è‡´æ€§</strong>ï¼šäº‹åŠ¡å‰åæ•°æ®çŠ¶æ€ä¸€è‡´</li>
<li><strong>éš”ç¦»æ€§</strong>ï¼šä¸åŒäº‹åŠ¡äº’ä¸å¹²æ‰°ï¼ˆä¾èµ–æ•°æ®åº“éš”ç¦»çº§åˆ«ï¼‰</li>
<li><strong>æŒä¹…æ€§</strong>ï¼šæäº¤åæ•°æ®æ°¸ä¹…ä¿å­˜</li>
</ul>
<h2 id="å…­ã€åŠ¨æ€-SQL-ä¸ç¼“å­˜"><a href="#å…­ã€åŠ¨æ€-SQL-ä¸ç¼“å­˜" class="headerlink" title="å…­ã€åŠ¨æ€ SQL ä¸ç¼“å­˜"></a>å…­ã€åŠ¨æ€ SQL ä¸ç¼“å­˜</h2><h3 id="6-1-åŠ¨æ€-SQLï¼ˆXML-æ ‡ç­¾è¯¦è§£ï¼‰"><a href="#6-1-åŠ¨æ€-SQLï¼ˆXML-æ ‡ç­¾è¯¦è§£ï¼‰" class="headerlink" title="6.1 åŠ¨æ€ SQLï¼ˆXML æ ‡ç­¾è¯¦è§£ï¼‰"></a>6.1 åŠ¨æ€ SQLï¼ˆXML æ ‡ç­¾è¯¦è§£ï¼‰</h3><p><strong>åŠ¨æ€ SQL ç”¨äºæ ¹æ®æ¡ä»¶åŠ¨æ€ç”Ÿæˆ SQL è¯­å¥ï¼Œé¿å…å­—ç¬¦ä¸²æ‹¼æ¥çš„ç¹çä¸é£é™©ã€‚</strong></p>
<h4 id="ï¼ˆ1ï¼‰if-æ ‡ç­¾ï¼ˆæ¡ä»¶åˆ¤æ–­ï¼‰"><a href="#ï¼ˆ1ï¼‰if-æ ‡ç­¾ï¼ˆæ¡ä»¶åˆ¤æ–­ï¼‰" class="headerlink" title="ï¼ˆ1ï¼‰if æ ‡ç­¾ï¼ˆæ¡ä»¶åˆ¤æ–­ï¼‰"></a>ï¼ˆ1ï¼‰if æ ‡ç­¾ï¼ˆæ¡ä»¶åˆ¤æ–­ï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectByCondition&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line">    SELECT * FROM user WHERE 1=1</span><br><span class="line">    &lt;if test=&quot;name != null and name != &#x27;&#x27;&quot;&gt; &lt;!-- testä¸­ç”¨OGNLè¡¨è¾¾å¼ --&gt;</span><br><span class="line">        AND name = #&#123;name&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">    &lt;if test=&quot;age != null&quot;&gt;</span><br><span class="line">        AND age = #&#123;age&#125;</span><br><span class="line">    &lt;/if&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<p><strong>åŠ¨æ€ SQL ä¸­ <code>if</code> æ ‡ç­¾çš„å¤æ‚åœºæ™¯</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- å¤šæ¡ä»¶æ¨¡ç³ŠæŸ¥è¯¢ + èŒƒå›´æŸ¥è¯¢ --&gt;</span><br><span class="line">&lt;select id=&quot;selectUserByAdvancedCondition&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line">    SELECT * FROM user</span><br><span class="line">    &lt;where&gt;</span><br><span class="line">        &lt;if test=&quot;name != null and name != &#x27;&#x27;&quot;&gt;</span><br><span class="line">            AND name LIKE CONCAT(&#x27;%&#x27;, #&#123;name&#125;, &#x27;%&#x27;) &lt;!-- æ¨¡ç³ŠæŸ¥è¯¢æ‹¼æ¥ --&gt;</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">        &lt;if test=&quot;ageRange != null&quot;&gt; &lt;!-- ä¼ å…¥Map&lt;String, Integer&gt; ageRangeï¼ŒåŒ…å«minå’Œmax --&gt;</span><br><span class="line">            AND age BETWEEN #&#123;ageRange.min&#125; AND #&#123;ageRange.max&#125;</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">        &lt;if test=&quot;statusList != null and statusList.size() &gt; 0&quot;&gt; &lt;!-- ä¼ å…¥List&lt;Integer&gt; --&gt;</span><br><span class="line">            AND status IN</span><br><span class="line">            &lt;foreach collection=&quot;statusList&quot; item=&quot;s&quot; open=&quot;(&quot; separator=&quot;,&quot; close=&quot;)&quot;&gt;</span><br><span class="line">                #&#123;s&#125;</span><br><span class="line">            &lt;/foreach&gt;</span><br><span class="line">        &lt;/if&gt;</span><br><span class="line">    &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<h4 id="ï¼ˆ2ï¼‰where-æ ‡ç­¾ï¼ˆè‡ªåŠ¨å¤„ç†-AND-ORï¼‰"><a href="#ï¼ˆ2ï¼‰where-æ ‡ç­¾ï¼ˆè‡ªåŠ¨å¤„ç†-AND-ORï¼‰" class="headerlink" title="ï¼ˆ2ï¼‰where æ ‡ç­¾ï¼ˆè‡ªåŠ¨å¤„ç† AND&#x2F;ORï¼‰"></a>ï¼ˆ2ï¼‰where æ ‡ç­¾ï¼ˆè‡ªåŠ¨å¤„ç† AND&#x2F;ORï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectByCondition&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line">    SELECT * FROM user</span><br><span class="line">    &lt;where&gt; &lt;!-- è‡ªåŠ¨ç§»é™¤é¦–ä¸ªAND/OR --&gt;</span><br><span class="line">        &lt;if test=&quot;name != null&quot;&gt;AND name = #&#123;name&#125;&lt;/if&gt;</span><br><span class="line">        &lt;if test=&quot;age != null&quot;&gt;AND age = #&#123;age&#125;&lt;/if&gt;</span><br><span class="line">    &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<h4 id="ï¼ˆ3ï¼‰set-æ ‡ç­¾ï¼ˆæ›´æ–°æ—¶è‡ªåŠ¨å¤„ç†é€—å·ï¼‰"><a href="#ï¼ˆ3ï¼‰set-æ ‡ç­¾ï¼ˆæ›´æ–°æ—¶è‡ªåŠ¨å¤„ç†é€—å·ï¼‰" class="headerlink" title="ï¼ˆ3ï¼‰set æ ‡ç­¾ï¼ˆæ›´æ–°æ—¶è‡ªåŠ¨å¤„ç†é€—å·ï¼‰"></a>ï¼ˆ3ï¼‰set æ ‡ç­¾ï¼ˆæ›´æ–°æ—¶è‡ªåŠ¨å¤„ç†é€—å·ï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;update id=&quot;updateUser&quot; parameterType=&quot;User&quot;&gt;</span><br><span class="line">    UPDATE user</span><br><span class="line">    &lt;set&gt; &lt;!-- è‡ªåŠ¨ç§»é™¤æœ«å°¾é€—å· --&gt;</span><br><span class="line">        &lt;if test=&quot;name != null&quot;&gt;name = #&#123;name&#125;,&lt;/if&gt;</span><br><span class="line">        &lt;if test=&quot;age != null&quot;&gt;age = #&#123;age&#125;&lt;/if&gt;</span><br><span class="line">    &lt;/set&gt;</span><br><span class="line">    WHERE id = #&#123;id&#125;</span><br><span class="line">&lt;/update&gt;</span><br></pre></td></tr></table></figure>

<h4 id="ï¼ˆ4ï¼‰foreach-æ ‡ç­¾ï¼ˆå¾ªç¯éå†ï¼Œæ‰¹é‡æ“ä½œï¼‰"><a href="#ï¼ˆ4ï¼‰foreach-æ ‡ç­¾ï¼ˆå¾ªç¯éå†ï¼Œæ‰¹é‡æ“ä½œï¼‰" class="headerlink" title="ï¼ˆ4ï¼‰foreach æ ‡ç­¾ï¼ˆå¾ªç¯éå†ï¼Œæ‰¹é‡æ“ä½œï¼‰"></a>ï¼ˆ4ï¼‰foreach æ ‡ç­¾ï¼ˆå¾ªç¯éå†ï¼Œæ‰¹é‡æ“ä½œï¼‰</h4><ul>
<li><strong>æ‰¹é‡åˆ é™¤</strong>ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;delete id=&quot;batchDelete&quot;&gt;</span><br><span class="line">    DELETE FROM user WHERE id IN</span><br><span class="line">    &lt;foreach </span><br><span class="line">        collection=&quot;list&quot;  &lt;!-- é›†åˆå‚æ•°åï¼ˆlist/map.key/æ•°ç»„ï¼‰ --&gt;</span><br><span class="line">        item=&quot;id&quot;          &lt;!-- éå†å…ƒç´ åˆ«å --&gt;</span><br><span class="line">        open=&quot;(&quot;           &lt;!-- å¼€å§‹ç¬¦å· --&gt;</span><br><span class="line">        separator=&quot;,&quot;      &lt;!-- åˆ†éš”ç¬¦ --&gt;</span><br><span class="line">        close=&quot;)&quot;&gt;         &lt;!-- ç»“æŸç¬¦å· --&gt;</span><br><span class="line">        #&#123;id&#125;</span><br><span class="line">    &lt;/foreach&gt;</span><br><span class="line">&lt;/delete&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>æ‰¹é‡æ’å…¥</strong>ï¼š</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;insert id=&quot;batchInsert&quot;&gt;</span><br><span class="line">    INSERT INTO user(name, age) VALUES</span><br><span class="line">    &lt;foreach collection=&quot;list&quot; item=&quot;user&quot; separator=&quot;,&quot;&gt;</span><br><span class="line">        (#&#123;user.name&#125;, #&#123;user.age&#125;)</span><br><span class="line">    &lt;/foreach&gt;</span><br><span class="line">&lt;/insert&gt;</span><br></pre></td></tr></table></figure>

<h4 id="ï¼ˆ5ï¼‰choose-æ ‡ç­¾ï¼ˆåˆ†æ”¯é€‰æ‹©ï¼Œç±»ä¼¼-switchï¼‰"><a href="#ï¼ˆ5ï¼‰choose-æ ‡ç­¾ï¼ˆåˆ†æ”¯é€‰æ‹©ï¼Œç±»ä¼¼-switchï¼‰" class="headerlink" title="ï¼ˆ5ï¼‰choose æ ‡ç­¾ï¼ˆåˆ†æ”¯é€‰æ‹©ï¼Œç±»ä¼¼ switchï¼‰"></a>ï¼ˆ5ï¼‰choose æ ‡ç­¾ï¼ˆåˆ†æ”¯é€‰æ‹©ï¼Œç±»ä¼¼ switchï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectByChoose&quot; resultType=&quot;User&quot;&gt;</span><br><span class="line">    SELECT * FROM user WHERE 1=1</span><br><span class="line">    &lt;choose&gt;</span><br><span class="line">        &lt;when test=&quot;id != null&quot;&gt;AND id = #&#123;id&#125;&lt;/when&gt; &lt;!-- ä¼˜å…ˆæ»¡è¶³çš„æ¡ä»¶ --&gt;</span><br><span class="line">        &lt;when test=&quot;name != null&quot;&gt;AND name = #&#123;name&#125;&lt;/when&gt;</span><br><span class="line">        &lt;otherwise&gt;AND age = 18&lt;/otherwise&gt; &lt;!-- æ‰€æœ‰æ¡ä»¶ä¸æ»¡è¶³æ—¶ --&gt;</span><br><span class="line">    &lt;/choose&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-ç¼“å­˜æœºåˆ¶ï¼ˆä¸€çº§ç¼“å­˜-äºŒçº§ç¼“å­˜ï¼‰"><a href="#6-2-ç¼“å­˜æœºåˆ¶ï¼ˆä¸€çº§ç¼“å­˜-äºŒçº§ç¼“å­˜ï¼‰" class="headerlink" title="6.2 ç¼“å­˜æœºåˆ¶ï¼ˆä¸€çº§ç¼“å­˜ + äºŒçº§ç¼“å­˜ï¼‰"></a>6.2 ç¼“å­˜æœºåˆ¶ï¼ˆä¸€çº§ç¼“å­˜ + äºŒçº§ç¼“å­˜ï¼‰</h3><p><strong>ç¼“å­˜ç”¨äºå‡å°‘æ•°æ®åº“è®¿é—®ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</strong></p>
<h4 id="6-2-1-ä¸€çº§ç¼“å­˜ï¼ˆSqlSession-çº§åˆ«ï¼Œé»˜è®¤å¼€å¯ï¼‰"><a href="#6-2-1-ä¸€çº§ç¼“å­˜ï¼ˆSqlSession-çº§åˆ«ï¼Œé»˜è®¤å¼€å¯ï¼‰" class="headerlink" title="6.2.1 ä¸€çº§ç¼“å­˜ï¼ˆSqlSession çº§åˆ«ï¼Œé»˜è®¤å¼€å¯ï¼‰"></a>6.2.1 ä¸€çº§ç¼“å­˜ï¼ˆSqlSession çº§åˆ«ï¼Œé»˜è®¤å¼€å¯ï¼‰</h4><ul>
<li><strong>ä½œç”¨èŒƒå›´</strong>ï¼šåŒä¸€ä¸ª SqlSession å†…ï¼Œå¤šæ¬¡æŸ¥è¯¢åŒä¸€æ•°æ®ï¼ˆç›¸åŒ SQL + å‚æ•°ï¼‰ï¼Œåªæ‰§è¡Œä¸€æ¬¡ SQLï¼Œåç»­ä»ç¼“å­˜è·å–ã€‚</li>
<li><strong>å¤±æ•ˆåœºæ™¯ï¼š</strong><ul>
<li><strong>æ‰§è¡Œå¢åˆ æ”¹æ“ä½œï¼ˆè‡ªåŠ¨æ¸…ç©ºç¼“å­˜ï¼‰</strong></li>
<li><strong>æ‰‹åŠ¨è°ƒç”¨</strong><code>session.clearCache()</code></li>
<li><strong>å…³é—­ SqlSession åé‡æ–°è·å–</strong></li>
</ul>
</li>
</ul>
<h5 id="ä¸€çº§ç¼“å­˜æ·±åº¦è§£æ"><a href="#ä¸€çº§ç¼“å­˜æ·±åº¦è§£æ" class="headerlink" title="ä¸€çº§ç¼“å­˜æ·±åº¦è§£æ"></a>ä¸€çº§ç¼“å­˜æ·±åº¦è§£æ</h5><p><strong>ï¼ˆ1ï¼‰æ ¸å¿ƒä»£ç é€»è¾‘ï¼ˆMyBatis æºç ç®€åŒ–ï¼‰</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// SqlSessionçš„æŸ¥è¯¢æ–¹æ³•ï¼ˆç®€åŒ–ï¼‰</span><br><span class="line">public &lt;E&gt; List&lt;E&gt; query(MappedStatement ms, Object parameter, RowBounds rowBounds, ResultHandler resultHandler) &#123;</span><br><span class="line">    BoundSql boundSql = ms.getBoundSql(parameter);</span><br><span class="line">    CacheKey key = createCacheKey(ms, parameter, rowBounds, boundSql); // ç”Ÿæˆç¼“å­˜é”®</span><br><span class="line">    return query(ms, parameter, rowBounds, resultHandler, key, boundSql);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private &lt;E&gt; List&lt;E&gt; query(...) &#123;</span><br><span class="line">    List&lt;E&gt; list;</span><br><span class="line">    try &#123;</span><br><span class="line">        list = (List&lt;E&gt;) localCache.getObject(key); // ä»ä¸€çº§ç¼“å­˜è·å–</span><br><span class="line">        if (list == null) &#123;</span><br><span class="line">            list = queryFromDatabase(ms, parameter, rowBounds, resultHandler, key, boundSql); // æŸ¥æ•°æ®åº“</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; // ...</span><br><span class="line">    return list;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ï¼ˆ2ï¼‰localCacheScope é…ç½®çš„å½±å“</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;settings&gt;</span><br><span class="line">    &lt;!-- é»˜è®¤ä¸ºSESSIONï¼šä¸€çº§ç¼“å­˜ä½œç”¨äºæ•´ä¸ªSqlSession --&gt;</span><br><span class="line">    &lt;!-- è®¾ç½®ä¸ºSTATEMENTï¼šæ¯æ¬¡æŸ¥è¯¢åæ¸…ç©ºç¼“å­˜ï¼Œå³ä¸€çº§ç¼“å­˜å¤±æ•ˆ --&gt;</span><br><span class="line">    &lt;setting name=&quot;localCacheScope&quot; value=&quot;STATEMENT&quot;/&gt;</span><br><span class="line">&lt;/settings&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>SESSION</code>ï¼ˆé»˜è®¤ï¼‰ï¼šåŒä¸€ SqlSession å†…å¤šæ¬¡æŸ¥è¯¢åŒä¸€æ•°æ®ï¼Œä»…æ‰§è¡Œä¸€æ¬¡ SQL</li>
<li><code>STATEMENT</code>ï¼šæ¯æ¬¡æŸ¥è¯¢éƒ½æ‰§è¡Œ SQLï¼ˆé€‚åˆéœ€è¦å®æ—¶æ•°æ®çš„åœºæ™¯ï¼‰</li>
</ul>
<h4 id="6-2-2-äºŒçº§ç¼“å­˜ï¼ˆMapper-çº§åˆ«ï¼Œéœ€æ‰‹åŠ¨å¼€å¯ï¼‰"><a href="#6-2-2-äºŒçº§ç¼“å­˜ï¼ˆMapper-çº§åˆ«ï¼Œéœ€æ‰‹åŠ¨å¼€å¯ï¼‰" class="headerlink" title="6.2.2 äºŒçº§ç¼“å­˜ï¼ˆMapper çº§åˆ«ï¼Œéœ€æ‰‹åŠ¨å¼€å¯ï¼‰"></a>6.2.2 äºŒçº§ç¼“å­˜ï¼ˆMapper çº§åˆ«ï¼Œéœ€æ‰‹åŠ¨å¼€å¯ï¼‰</h4><ul>
<li><strong>ä½œç”¨èŒƒå›´</strong>ï¼šåŒä¸€ä¸ª Mapper æ¥å£çš„ä¸åŒ SqlSession å…±äº«ç¼“å­˜ã€‚</li>
<li><strong>å¼€å¯æ­¥éª¤</strong>ï¼š</li>
</ul>
<p>**	**1ã€å…¨å±€é…ç½®å¼€å¯ï¼ˆé»˜è®¤å·²å¼€å¯ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;settings&gt;</span><br><span class="line">    &lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">&lt;/settings&gt;</span><br></pre></td></tr></table></figure>

<p>**	**2ã€åœ¨ Mapper.xml ä¸­å£°æ˜ç¼“å­˜ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- ç¼“å­˜é…ç½® --&gt;</span><br><span class="line">&lt;cache </span><br><span class="line">    eviction=&quot;LRU&quot;        &lt;!-- å›æ”¶ç­–ç•¥ï¼šLRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰/FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ç­‰ --&gt;</span><br><span class="line">    flushInterval=&quot;60000&quot; &lt;!-- åˆ·æ–°é—´éš”ï¼ˆæ¯«ç§’ï¼‰ --&gt;</span><br><span class="line">    size=&quot;512&quot;            &lt;!-- æœ€å¤§ç¼“å­˜å¯¹è±¡æ•° --&gt;</span><br><span class="line">    readOnly=&quot;true&quot;/&gt;     &lt;!-- æ˜¯å¦åªè¯»ï¼ˆtrueï¼šè¿”å›ç¼“å­˜å¯¹è±¡å‰¯æœ¬ï¼Œæ€§èƒ½å¥½ï¼‰ --&gt;</span><br></pre></td></tr></table></figure>

<p>**	**3ã€å®ä½“ç±»éœ€å®ç° Serializable æ¥å£ï¼ˆäºŒçº§ç¼“å­˜å¯èƒ½æ¶‰åŠåºåˆ—åŒ–ï¼‰</p>
<ul>
<li><strong>ç¼“å­˜æ§åˆ¶</strong>ï¼š<ul>
<li><code>useCache=&quot;false&quot;</code>ï¼šå½“å‰æŸ¥è¯¢ä¸ä½¿ç”¨ç¼“å­˜ï¼ˆå¦‚å®æ—¶æ€§è¦æ±‚é«˜çš„æ•°æ®ï¼‰</li>
<li><code>flushCache=&quot;true&quot;</code>ï¼šæ‰§è¡Œåæ¸…ç©ºç¼“å­˜ï¼ˆå¢åˆ æ”¹é»˜è®¤ trueï¼ŒæŸ¥è¯¢é»˜è®¤ falseï¼‰</li>
</ul>
</li>
</ul>
<h5 id="äºŒçº§ç¼“å­˜æ·±åº¦è§£æ"><a href="#äºŒçº§ç¼“å­˜æ·±åº¦è§£æ" class="headerlink" title="äºŒçº§ç¼“å­˜æ·±åº¦è§£æ"></a>äºŒçº§ç¼“å­˜æ·±åº¦è§£æ</h5><p><strong>ï¼ˆ1ï¼‰æŸ¥è¯¢æµç¨‹ä¸å¤šå±‚è£…é¥°ç»“æ„</strong></p>
<p><strong>æŸ¥è¯¢é¡ºåºï¼šäºŒçº§ç¼“å­˜ â†’ ä¸€çº§ç¼“å­˜ â†’ æ•°æ®åº“</strong></p>
<p><strong>äºŒçº§ç¼“å­˜çš„è£…é¥°é“¾ï¼ˆé»˜è®¤ï¼‰ï¼š</strong><code>PerpetualCache</code>ï¼ˆåŸºç¡€ç¼“å­˜ï¼‰â†’ <code>LruCache</code>ï¼ˆæ·˜æ±°ç­–ç•¥ï¼‰â†’ <code>LoggingCache</code>ï¼ˆæ—¥å¿—ï¼‰â†’ <code>SynchronizedCache</code>ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰â†’ â€¦</p>
<p><strong>ï¼ˆ2ï¼‰ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜åŠè§£å†³</strong></p>
<p><strong>é—®é¢˜ç¤ºä¾‹</strong>ï¼šä¸¤ä¸ª SqlSession æ“ä½œåŒä¸€æ•°æ®ï¼ŒSession1 æ›´æ–°åæœªåŒæ­¥åˆ°äºŒçº§ç¼“å­˜ï¼Œå¯¼è‡´ Session2 è¯»å–æ—§æ•°æ®ã€‚</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// Session1æ›´æ–°æ•°æ®</span><br><span class="line">try (SqlSession session1 = MybatisUtil.openSession()) &#123;</span><br><span class="line">    session1.getMapper(UserMapper.class).updateUserAge(1, 20);</span><br><span class="line">    session1.commit(); // æäº¤åä¼šæ¸…ç©ºUserMapperçš„äºŒçº§ç¼“å­˜</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// Session2æŸ¥è¯¢ï¼ˆæ­¤æ—¶äºŒçº§ç¼“å­˜å·²æ¸…ç©ºï¼Œä¼šæŸ¥æ•°æ®åº“ï¼‰</span><br><span class="line">try (SqlSession session2 = MybatisUtil.openSession()) &#123;</span><br><span class="line">    User user = session2.getMapper(UserMapper.class).selectUserById(1); // å¾—åˆ°æœ€æ–°æ•°æ®</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>è§£å†³</strong>ï¼šMyBatis åœ¨ DML æ“ä½œåä¼šè‡ªåŠ¨æ¸…ç©ºå½“å‰ Mapper çš„äºŒçº§ç¼“å­˜ï¼ˆå›  <code>flushCache=&quot;true&quot;</code> é»˜è®¤å¼€å¯ï¼‰ï¼Œç¡®ä¿ç¼“å­˜ä¸€è‡´æ€§ã€‚</p>
<p><strong>ï¼ˆ3ï¼‰eviction å±æ€§çš„ç¼“å­˜æ·˜æ±°ç®—æ³•</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;cache </span><br><span class="line">    eviction=&quot;FIFO&quot; &lt;!-- å¯é€‰å€¼ï¼š</span><br><span class="line">                     LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼Œé»˜è®¤ï¼‰</span><br><span class="line">                     FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰</span><br><span class="line">                     SOFTï¼ˆè½¯å¼•ç”¨ï¼Œå†…å­˜ä¸è¶³æ—¶æ·˜æ±°ï¼‰</span><br><span class="line">                     WEAKï¼ˆå¼±å¼•ç”¨ï¼Œåƒåœ¾å›æ”¶æ—¶æ·˜æ±°ï¼‰</span><br><span class="line">                    --&gt;</span><br><span class="line">    size=&quot;1000&quot;/&gt; &lt;!-- æœ€å¤šç¼“å­˜1000ä¸ªå¯¹è±¡ --&gt;</span><br></pre></td></tr></table></figure>

<h4 id="6-2-3-è‡ªå®šä¹‰ç¼“å­˜å®ç°"><a href="#6-2-3-è‡ªå®šä¹‰ç¼“å­˜å®ç°" class="headerlink" title="6.2.3 è‡ªå®šä¹‰ç¼“å­˜å®ç°"></a>6.2.3 è‡ªå®šä¹‰ç¼“å­˜å®ç°</h4><h5 id="ï¼ˆ1ï¼‰è‡ªå®šä¹‰-Cache-ç±»"><a href="#ï¼ˆ1ï¼‰è‡ªå®šä¹‰-Cache-ç±»" class="headerlink" title="ï¼ˆ1ï¼‰è‡ªå®šä¹‰ Cache ç±»"></a>ï¼ˆ1ï¼‰è‡ªå®šä¹‰ Cache ç±»</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">public class MyRedisCache implements Cache &#123;</span><br><span class="line">    private final String id; // ç¼“å­˜å”¯ä¸€æ ‡è¯†ï¼ˆMapperæ¥å£å…¨ç±»åï¼‰</span><br><span class="line">    private RedisTemplate&lt;String, Object&gt; redisTemplate; // å‡è®¾å·²é…ç½®RedisTemplate</span><br><span class="line"></span><br><span class="line">    public MyRedisCache(String id) &#123;</span><br><span class="line">        this.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String getId() &#123; return id; &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void putObject(Object key, Object value) &#123;</span><br><span class="line">        // å­˜å…¥Redisï¼Œè®¾ç½®è¿‡æœŸæ—¶é—´</span><br><span class="line">        redisTemplate.opsForValue().set(key.toString(), value, 30, TimeUnit.MINUTES);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object getObject(Object key) &#123;</span><br><span class="line">        // ä»Redisè·å–</span><br><span class="line">        return redisTemplate.opsForValue().get(key.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Object removeObject(Object key) &#123;</span><br><span class="line">        // ä»Redisåˆ é™¤</span><br><span class="line">        redisTemplate.delete(key.toString());</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void clear() &#123;</span><br><span class="line">        // æ¸…ç©ºå½“å‰Mapperçš„ç¼“å­˜ï¼ˆé€šè¿‡keyå‰ç¼€åŒ¹é…åˆ é™¤ï¼‰</span><br><span class="line">        Set&lt;String&gt; keys = redisTemplate.keys(id + &quot;:*&quot;);</span><br><span class="line">        if (keys != null) redisTemplate.delete(keys);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public int getSize() &#123;</span><br><span class="line">        // è·å–ç¼“å­˜æ•°é‡ï¼ˆç®€åŒ–å®ç°ï¼‰</span><br><span class="line">        return redisTemplate.keys(id + &quot;:*&quot;).size();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="ï¼ˆ2ï¼‰å¯ç”¨è‡ªå®šä¹‰ç¼“å­˜ï¼ˆXML-æˆ–æ³¨è§£ï¼‰"><a href="#ï¼ˆ2ï¼‰å¯ç”¨è‡ªå®šä¹‰ç¼“å­˜ï¼ˆXML-æˆ–æ³¨è§£ï¼‰" class="headerlink" title="ï¼ˆ2ï¼‰å¯ç”¨è‡ªå®šä¹‰ç¼“å­˜ï¼ˆXML æˆ–æ³¨è§£ï¼‰"></a>ï¼ˆ2ï¼‰å¯ç”¨è‡ªå®šä¹‰ç¼“å­˜ï¼ˆXML æˆ–æ³¨è§£ï¼‰</h5><ul>
<li><strong>XML æ–¹å¼ï¼ˆåœ¨ Mapper.xml ä¸­ï¼‰ï¼š</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;cache type=&quot;com.example.cache.MyRedisCache&quot;/&gt;</span><br></pre></td></tr></table></figure></li>
<li><strong>æ³¨è§£æ–¹å¼ï¼ˆåœ¨ Mapper æ¥å£ä¸Šï¼‰ï¼š</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@CacheNamespace(implementation = MyRedisCache.class)</span><br><span class="line">public interface UserMapper &#123; ... &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="6-2-4-ç¼“å­˜æ§åˆ¶å±æ€§è¯¦è§£"><a href="#6-2-4-ç¼“å­˜æ§åˆ¶å±æ€§è¯¦è§£" class="headerlink" title="6.2.4 ç¼“å­˜æ§åˆ¶å±æ€§è¯¦è§£"></a>6.2.4 ç¼“å­˜æ§åˆ¶å±æ€§è¯¦è§£</h4><ul>
<li><code>useCache</code>ï¼šæ§åˆ¶æŸ¥è¯¢æ˜¯å¦ä½¿ç”¨äºŒçº§ç¼“å­˜ï¼ˆé»˜è®¤ <code>true</code>ï¼‰<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectUserById&quot; resultType=&quot;User&quot; useCache=&quot;false&quot;&gt; &lt;!-- ä¸ä½¿ç”¨äºŒçº§ç¼“å­˜ --&gt;</span><br><span class="line">    select * from user where id = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure></li>
<li><code>flushCache</code>ï¼šæ§åˆ¶æ“ä½œåæ˜¯å¦æ¸…ç©ºäºŒçº§ç¼“å­˜ï¼ˆDML é»˜è®¤ <code>true</code>ï¼ŒæŸ¥è¯¢é»˜è®¤ <code>false</code>ï¼‰<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=&quot;selectUserById&quot; resultType=&quot;User&quot; flushCache=&quot;true&quot;&gt; &lt;!-- æŸ¥è¯¢åæ¸…ç©ºäºŒçº§ç¼“å­˜ --&gt;</span><br><span class="line">    select * from user where id = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="ä¸ƒã€é«˜çº§ç‰¹æ€§ï¼ˆé€‰å­¦ï¼‰"><a href="#ä¸ƒã€é«˜çº§ç‰¹æ€§ï¼ˆé€‰å­¦ï¼‰" class="headerlink" title="ä¸ƒã€é«˜çº§ç‰¹æ€§ï¼ˆé€‰å­¦ï¼‰"></a>ä¸ƒã€é«˜çº§ç‰¹æ€§ï¼ˆé€‰å­¦ï¼‰</h2><h3 id="7-1-ç±»å‹å¤„ç†å™¨ï¼ˆTypeHandlerï¼‰"><a href="#7-1-ç±»å‹å¤„ç†å™¨ï¼ˆTypeHandlerï¼‰" class="headerlink" title="7.1 ç±»å‹å¤„ç†å™¨ï¼ˆTypeHandlerï¼‰"></a>7.1 ç±»å‹å¤„ç†å™¨ï¼ˆTypeHandlerï¼‰</h3><p><strong>ç”¨äº Java ç±»å‹ä¸ JDBC ç±»å‹çš„è‡ªå®šä¹‰è½¬æ¢ï¼ˆå¦‚ Stringâ†’ è‡ªå®šä¹‰å¯¹è±¡ã€Dateâ†’LocalDateï¼‰ã€‚</strong></p>
<h4 id="è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨ç¤ºä¾‹"><a href="#è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨ç¤ºä¾‹" class="headerlink" title="è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨ç¤ºä¾‹"></a>è‡ªå®šä¹‰ç±»å‹å¤„ç†å™¨ç¤ºä¾‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">// è‡ªå®šä¹‰Stringä¸MyStringçš„è½¬æ¢</span><br><span class="line">@MappedJdbcTypes(JdbcType.VARCHAR) // å…³è”JDBCç±»å‹</span><br><span class="line">@MappedTypes(MyString.class)       // å…³è”Javaç±»å‹</span><br><span class="line">public class MyStringHandler extends BaseTypeHandler&lt;MyString&gt; &#123;</span><br><span class="line"></span><br><span class="line">    // è®¾ç½®å‚æ•°ï¼ˆJavaâ†’JDBCï¼‰</span><br><span class="line">    @Override</span><br><span class="line">    public void setNonNullParameter(PreparedStatement ps, int i, </span><br><span class="line">                                  MyString parameter, JdbcType jdbcType) throws SQLException &#123;</span><br><span class="line">        ps.setString(i, parameter.getValue()); // å­˜å‚¨è‡ªå®šä¹‰å¯¹è±¡çš„å­—ç¬¦ä¸²å€¼</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ä»ç»“æœé›†è·å–ï¼ˆJDBCâ†’Javaï¼‰</span><br><span class="line">    @Override</span><br><span class="line">    public MyString getNullableResult(ResultSet rs, String columnName) throws SQLException &#123;</span><br><span class="line">        return new MyString(rs.getString(columnName));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // å…¶ä»–é‡è½½æ–¹æ³•ï¼ˆæŒ‰åˆ—ç´¢å¼•è·å–ï¼‰</span><br><span class="line">    @Override</span><br><span class="line">    public MyString getNullableResult(ResultSet rs, int columnIndex) throws SQLException &#123;</span><br><span class="line">        return new MyString(rs.getString(columnIndex));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public MyString getNullableResult(CallableStatement cs, int columnIndex) throws SQLException &#123;</span><br><span class="line">        return new MyString(cs.getString(columnIndex));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ³¨å†Œç±»å‹å¤„ç†å™¨"><a href="#æ³¨å†Œç±»å‹å¤„ç†å™¨" class="headerlink" title="æ³¨å†Œç±»å‹å¤„ç†å™¨"></a>æ³¨å†Œç±»å‹å¤„ç†å™¨</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;typeHandlers&gt;</span><br><span class="line">    &lt;typeHandler handler=&quot;com.example.handler.MyStringHandler&quot;/&gt;</span><br><span class="line">&lt;/typeHandlers&gt;</span><br></pre></td></tr></table></figure>

<h3 id="7-2-æ‹¦æˆªå™¨ï¼ˆæ’ä»¶ï¼‰"><a href="#7-2-æ‹¦æˆªå™¨ï¼ˆæ’ä»¶ï¼‰" class="headerlink" title="7.2 æ‹¦æˆªå™¨ï¼ˆæ’ä»¶ï¼‰"></a>7.2 æ‹¦æˆªå™¨ï¼ˆæ’ä»¶ï¼‰</h3><p><strong>ç”¨äºåœ¨ SQL æ‰§è¡Œè¿‡ç¨‹ä¸­æ’å…¥è‡ªå®šä¹‰é€»è¾‘ï¼ˆå¦‚æ—¥å¿—è®°å½•ã€æ€§èƒ½ç›‘æ§ã€SQL æ”¹å†™ï¼‰ã€‚</strong></p>
<h4 id="è‡ªå®šä¹‰æ‹¦æˆªå™¨ç¤ºä¾‹"><a href="#è‡ªå®šä¹‰æ‹¦æˆªå™¨ç¤ºä¾‹" class="headerlink" title="è‡ªå®šä¹‰æ‹¦æˆªå™¨ç¤ºä¾‹"></a>è‡ªå®šä¹‰æ‹¦æˆªå™¨ç¤ºä¾‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">@Intercepts(&#123; // å£°æ˜æ‹¦æˆªçš„ç›®æ ‡æ–¹æ³•</span><br><span class="line">    @Signature(</span><br><span class="line">        type = Executor.class,       // æ‹¦æˆªçš„æ¥å£</span><br><span class="line">        method = &quot;query&quot;,            // æ‹¦æˆªçš„æ–¹æ³•å</span><br><span class="line">        args = &#123;MappedStatement.class, Object.class, RowBounds.class, ResultHandler.class&#125; // æ–¹æ³•å‚æ•°</span><br><span class="line">    )</span><br><span class="line">&#125;)</span><br><span class="line">public class LogInterceptor implements Interceptor &#123;</span><br><span class="line"></span><br><span class="line">    // æ‹¦æˆªé€»è¾‘</span><br><span class="line">    @Override</span><br><span class="line">    public Object intercept(Invocation invocation) throws Throwable &#123;</span><br><span class="line">        // 1. å‰ç½®å¤„ç†ï¼ˆå¦‚è®°å½•å¼€å§‹æ—¶é—´ï¼‰</span><br><span class="line">        long start = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        // 2. æ‰§è¡ŒåŸæ–¹æ³•</span><br><span class="line">        Object result = invocation.proceed();</span><br><span class="line"></span><br><span class="line">        // 3. åç½®å¤„ç†ï¼ˆå¦‚è®°å½•æ‰§è¡Œæ—¶é—´ï¼‰</span><br><span class="line">        long end = System.currentTimeMillis();</span><br><span class="line">        System.out.println(&quot;SQLæ‰§è¡Œæ—¶é—´ï¼š&quot; + (end - start) + &quot;ms&quot;);</span><br><span class="line"></span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // ç”Ÿæˆä»£ç†å¯¹è±¡</span><br><span class="line">    @Override</span><br><span class="line">    public Object plugin(Object target) &#123;</span><br><span class="line">        return Plugin.wrap(target, this);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // è®¾ç½®å±æ€§ï¼ˆä»é…ç½®æ–‡ä»¶è¯»å–ï¼‰</span><br><span class="line">    @Override</span><br><span class="line">    public void setProperties(Properties properties) &#123;</span><br><span class="line">        // å¯é€šè¿‡propertiesè·å–é…ç½®å‚æ•°</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="æ³¨å†Œæ‹¦æˆªå™¨"><a href="#æ³¨å†Œæ‹¦æˆªå™¨" class="headerlink" title="æ³¨å†Œæ‹¦æˆªå™¨"></a>æ³¨å†Œæ‹¦æˆªå™¨</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugins&gt;</span><br><span class="line">    &lt;plugin interceptor=&quot;com.example.interceptor.LogInterceptor&quot;&gt;</span><br><span class="line">        &lt;!-- å¯é€‰ï¼šè®¾ç½®æ‹¦æˆªå™¨å±æ€§ --&gt;</span><br><span class="line">        &lt;property name=&quot;logLevel&quot; value=&quot;INFO&quot;/&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line">&lt;/plugins&gt;</span><br></pre></td></tr></table></figure>

<h2 id="å…«ã€æœ€ä½³å®è·µæ€»ç»“"><a href="#å…«ã€æœ€ä½³å®è·µæ€»ç»“" class="headerlink" title="å…«ã€æœ€ä½³å®è·µæ€»ç»“"></a>å…«ã€æœ€ä½³å®è·µæ€»ç»“</h2><h3 id="8-1-é…ç½®ä¼˜åŒ–"><a href="#8-1-é…ç½®ä¼˜åŒ–" class="headerlink" title="8.1 é…ç½®ä¼˜åŒ–"></a>8.1 é…ç½®ä¼˜åŒ–</h3><ul>
<li><strong>è¿æ¥æ± é…ç½®</strong>ï¼šä½¿ç”¨ POOLED æ•°æ®æºï¼Œå¹¶åˆç†è®¾ç½®è¿æ¥æ± å‚æ•°ï¼ˆåˆå§‹å¤§å°ã€æœ€å¤§æ´»è·ƒæ•°ç­‰ï¼‰</li>
<li><strong>æ—¥å¿—é…ç½®</strong>ï¼šå¼€å‘ç¯å¢ƒå¼€å¯ DEBUG æ—¥å¿—ï¼Œç”Ÿäº§ç¯å¢ƒå…³é—­æˆ–è®¾ä¸º INFOï¼Œä¾¿äºè°ƒè¯•ä¸æ€§èƒ½ä¼˜åŒ–</li>
<li><strong>ç±»å‹åˆ«å</strong>ï¼šä½¿ç”¨åŒ…æ‰«ææ–¹å¼é…ç½®ï¼Œå‡å°‘å…¨ç±»åä¹¦å†™</li>
<li><strong>é©¼å³°æ˜ å°„</strong>ï¼šå¼€å¯ <code>mapUnderscoreToCamelCase</code>ï¼Œå‡å°‘ resultMap é…ç½®</li>
</ul>
<h3 id="8-2-å¼€å‘è§„èŒƒ"><a href="#8-2-å¼€å‘è§„èŒƒ" class="headerlink" title="8.2 å¼€å‘è§„èŒƒ"></a>8.2 å¼€å‘è§„èŒƒ</h3><ul>
<li><strong>SQL ä¸ä»£ç åˆ†ç¦»</strong>ï¼šå¤æ‚ SQL å†™åœ¨ XML ä¸­ï¼Œç®€å• SQL ç”¨æ³¨è§£ï¼Œæé«˜å¯ç»´æŠ¤æ€§</li>
<li><strong>å‚æ•°ä¼ é€’</strong>ï¼šå¤šå‚æ•°ä¼˜å…ˆç”¨ @Param æ³¨è§£ï¼Œé¿å… Map ä¼ é€’ï¼ˆå¯è¯»æ€§å·®ï¼‰</li>
<li><strong>ç»“æœæ˜ å°„</strong>ï¼šå­—æ®µä¸ä¸€è‡´æ—¶ä¼˜å…ˆç”¨ resultMapï¼Œè€Œé SQL åˆ«åï¼ˆæ˜ å°„è§„åˆ™é›†ä¸­ç®¡ç†ï¼‰</li>
<li><strong>å‘½åè§„èŒƒï¼š</strong><ul>
<li><strong>Mapper æ¥å£æ–¹æ³•åä¸ XML ä¸­ id ä¿æŒä¸€è‡´</strong></li>
<li><strong>è¡¨åã€åˆ—åç”¨å°å†™ + ä¸‹åˆ’çº¿ï¼Œå®ä½“ç±»ç”¨é©¼å³°å‘½å</strong></li>
<li><strong>æ˜ å°„æ–‡ä»¶ä¸æ¥å£åŒåŒ…åŒåï¼ˆä¾¿äºåŒ…æ‰«æï¼‰</strong></li>
</ul>
</li>
</ul>
<h3 id="8-3-æ€§èƒ½ä¼˜åŒ–"><a href="#8-3-æ€§èƒ½ä¼˜åŒ–" class="headerlink" title="8.3 æ€§èƒ½ä¼˜åŒ–"></a>8.3 æ€§èƒ½ä¼˜åŒ–</h3><h4 id="æ‰¹é‡æ“ä½œï¼š"><a href="#æ‰¹é‡æ“ä½œï¼š" class="headerlink" title="æ‰¹é‡æ“ä½œï¼š"></a>æ‰¹é‡æ“ä½œï¼š</h4><ul>
<li><strong>æ‰¹é‡æ’å…¥ &#x2F; æ›´æ–°ä½¿ç”¨</strong><code>ExecutorType.BATCH</code> æ¨¡å¼</li>
<li><strong>é¿å…å¾ªç¯è°ƒç”¨å•æ¡ SQLï¼ˆN æ¬¡ç½‘ç»œè¯·æ±‚ï¼‰</strong></li>
</ul>
<p><strong>ä½¿ç”¨</strong><code>ExecutorType.BATCH</code> æ¨¡å¼çš„å®Œæ•´ç¤ºä¾‹åŠæ—¥å¿—åˆ†æï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">try (SqlSession session = sqlSessionFactory.openSession(ExecutorType.BATCH)) &#123; // æ‰¹å¤„ç†æ‰§è¡Œå™¨</span><br><span class="line">    UserMapper mapper = session.getMapper(UserMapper.class);</span><br><span class="line">    long start = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">    for (int i = 0; i &lt; 1000; i++) &#123;</span><br><span class="line">        User user = new User();</span><br><span class="line">        user.setName(&quot;user&quot; + i);</span><br><span class="line">        mapper.insertUser(user);</span><br><span class="line"></span><br><span class="line">        // æ¯500æ¡æäº¤ä¸€æ¬¡ï¼ˆé¿å…å†…å­˜æº¢å‡ºï¼‰</span><br><span class="line">        if (i % 500 == 0) &#123;</span><br><span class="line">            session.flushStatements(); // åˆ·å…¥æ•°æ®åº“ï¼ˆæœªæäº¤äº‹åŠ¡ï¼‰</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    session.commit(); // æœ€ç»ˆæäº¤</span><br><span class="line">    System.out.println(&quot;è€—æ—¶ï¼š&quot; + (System.currentTimeMillis() - start) + &quot;ms&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ—¥å¿—åˆ†æ</strong>ï¼šæ‰¹å¤„ç†æ¨¡å¼ä¸‹ï¼ŒMyBatis ä¼šå°† SQL è¯­å¥é¢„ç¼–è¯‘ä¸€æ¬¡ï¼Œå¤šæ¬¡è®¾ç½®å‚æ•°åæ‰¹é‡æ‰§è¡Œï¼Œæ—¥å¿—ä¸­åªä¼šå‡ºç°ä¸€æ¬¡ <code>Preparing: INSERT INTO user(...)</code>ï¼Œé¿å…äº†å•æ¡æ’å…¥çš„å¤šæ¬¡é¢„ç¼–è¯‘å¼€é”€ã€‚</p>
<h4 id="åˆ†é¡µæŸ¥è¯¢ï¼š"><a href="#åˆ†é¡µæŸ¥è¯¢ï¼š" class="headerlink" title="åˆ†é¡µæŸ¥è¯¢ï¼š"></a>åˆ†é¡µæŸ¥è¯¢ï¼š</h4><p><strong>åˆ†é¡µæŸ¥è¯¢å®ç°ï¼ˆPageHelper æ’ä»¶ï¼‰</strong></p>
<p><strong>Mybatis æœ¬èº«ä¸ç›´æ¥æ”¯æŒåˆ†é¡µï¼Œæ¨èä½¿ç”¨ç¬¬ä¸‰æ–¹æ’ä»¶</strong><code>PageHelper</code> ç®€åŒ–åˆ†é¡µé€»è¾‘ï¼š</p>
<p>**	**<strong>æ·»åŠ ä¾èµ–</strong>ï¼ˆMavenï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.github.pagehelper&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;pagehelper&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.3.3&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>**	**<strong>é…ç½®æ’ä»¶</strong>ï¼ˆåœ¨ <code>mybatis-config.xml</code> çš„ <code>&lt;plugins&gt;</code> æ ‡ç­¾ä¸­ï¼‰ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugin interceptor=&quot;com.github.pagehelper.PageInterceptor&quot;&gt;</span><br><span class="line">    &lt;!-- æ•°æ®åº“æ–¹è¨€ï¼ˆå¯é€‰ï¼Œè‡ªåŠ¨æ£€æµ‹ï¼‰ --&gt;</span><br><span class="line">    &lt;property name=&quot;helperDialect&quot; value=&quot;mysql&quot;/&gt;</span><br><span class="line">    &lt;!-- åˆ†é¡µå‚æ•°åˆç†åŒ–ï¼ˆé¡µç &lt;=0æŸ¥ç¬¬ä¸€é¡µï¼Œé¡µç &gt;æ€»é¡µæ•°æŸ¥æœ€åä¸€é¡µï¼‰ --&gt;</span><br><span class="line">    &lt;property name=&quot;reasonable&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">&lt;/plugin&gt;</span><br></pre></td></tr></table></figure>

<p>**	**<strong>ä½¿ç”¨æ–¹å¼</strong>ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">try (SqlSession session = MybatisUtil.openSession()) &#123;</span><br><span class="line">    UserMapper mapper = session.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">    // 1. è®¾ç½®åˆ†é¡µå‚æ•°ï¼ˆé¡µç ä»1å¼€å§‹ï¼Œæ¯é¡µ10æ¡ï¼‰</span><br><span class="line">    PageHelper.startPage(1, 10);</span><br><span class="line"></span><br><span class="line">    // 2. æ‰§è¡ŒæŸ¥è¯¢ï¼ˆæ— éœ€ä¿®æ”¹SQLï¼Œæ’ä»¶è‡ªåŠ¨æ‹¼æ¥LIMITï¼‰</span><br><span class="line">    List&lt;User&gt; users = mapper.selectAllUser();</span><br><span class="line"></span><br><span class="line">    // 3. å°è£…åˆ†é¡µç»“æœ</span><br><span class="line">    Page&lt;User&gt; page = (Page&lt;User&gt;) users;</span><br><span class="line">    System.out.println(&quot;æ€»æ¡æ•°ï¼š&quot; + page.getTotal());</span><br><span class="line">    System.out.println(&quot;æ€»é¡µæ•°ï¼š&quot; + page.getPages());</span><br><span class="line">    System.out.println(&quot;å½“å‰é¡µæ•°æ®ï¼š&quot; + page.getResult());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ç¼“å­˜ç­–ç•¥ï¼š"><a href="#ç¼“å­˜ç­–ç•¥ï¼š" class="headerlink" title="ç¼“å­˜ç­–ç•¥ï¼š"></a>ç¼“å­˜ç­–ç•¥ï¼š</h4><ul>
<li><strong>é«˜é¢‘æŸ¥è¯¢ã€ä½é¢‘ä¿®æ”¹çš„æ•°æ®å¼€å¯äºŒçº§ç¼“å­˜</strong></li>
<li><strong>å®æ—¶æ€§è¦æ±‚é«˜çš„æ•°æ®ç¦ç”¨ç¼“å­˜ï¼ˆ</strong><code>useCache=false</code>ï¼‰</li>
</ul>
<h4 id="æŸ¥è¯¢ä¼˜åŒ–ï¼š"><a href="#æŸ¥è¯¢ä¼˜åŒ–ï¼š" class="headerlink" title="æŸ¥è¯¢ä¼˜åŒ–ï¼š"></a>æŸ¥è¯¢ä¼˜åŒ–ï¼š</h4><ul>
<li><strong>é¿å…</strong><code>SELECT *</code>ï¼ŒåªæŸ¥è¯¢éœ€è¦çš„å­—æ®µ</li>
<li><strong>å…³è”æŸ¥è¯¢ä¼˜å…ˆç”¨ JOINï¼Œé¿å…åµŒå¥—æŸ¥è¯¢å¯¼è‡´çš„ N+1 é—®é¢˜</strong></li>
<li><strong>åˆ†é¡µæŸ¥è¯¢ä½¿ç”¨ Mybatis åˆ†é¡µæ’ä»¶ï¼ˆå¦‚ PageHelperï¼‰</strong></li>
</ul>
<p><strong>é€šè¿‡ä»¥ä¸Šå†…å®¹ï¼Œå¯ä»¥ç³»ç»ŸæŒæ¡ Mybatis çš„æ ¸å¿ƒç”¨æ³•ã€é«˜çº§ç‰¹æ€§åŠæœ€ä½³å®è·µï¼Œåœ¨å®é™…å¼€å‘ä¸­æ ¹æ®åœºæ™¯çµæ´»é€‰æ‹©é…ç½®ä¸å®ç°æ–¹å¼ï¼Œæå‡å¼€å‘æ•ˆç‡ä¸ç³»ç»Ÿæ€§èƒ½ã€‚</strong></p>
<h3 id="ä¹ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"><a href="#ä¹ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¹ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ"></a>ä¹ã€å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h3><h4 id="9-1-æ˜ å°„æ–‡ä»¶ç›¸å…³é”™è¯¯"><a href="#9-1-æ˜ å°„æ–‡ä»¶ç›¸å…³é”™è¯¯" class="headerlink" title="9.1 æ˜ å°„æ–‡ä»¶ç›¸å…³é”™è¯¯"></a>9.1 æ˜ å°„æ–‡ä»¶ç›¸å…³é”™è¯¯</h4><ul>
<li><p><strong>é”™è¯¯ 1ï¼š<code>org.apache.ibatis.binding.BindingException: Invalid bound statement (not found)</code></strong><br><strong>åŸå› ï¼šMapper æ¥å£ä¸ XML æ˜ å°„æ–‡ä»¶æœªæ­£ç¡®ç»‘å®š</strong><br><strong>è§£å†³ï¼š</strong></p>
<ol>
<li><strong>ç¡®ä¿ XML çš„</strong><code>namespace</code> ä¸æ¥å£å…¨ç±»åä¸€è‡´</li>
<li><strong>ç¡®ä¿ XML ä¸­</strong><code>id</code> ä¸æ¥å£æ–¹æ³•åä¸€è‡´</li>
<li><strong>æ£€æŸ¥ XML æ–‡ä»¶æ˜¯å¦åœ¨</strong><code>mybatis-config.xml</code> çš„ <code>&lt;mappers&gt;</code> ä¸­æ³¨å†Œ</li>
</ol>
</li>
<li><p><strong>é”™è¯¯ 2ï¼š<code>java.io.IOException: Could not find resource mappers/UserMapper.xml</code></strong><br><strong>åŸå› ï¼šXML æ–‡ä»¶è·¯å¾„é”™è¯¯æˆ–æœªè¢« Maven æ‰“åŒ…</strong><br><strong>è§£å†³ï¼š</strong></p>
<ol>
<li><strong>Maven é¡¹ç›®ä¸­ï¼ŒXML æ–‡ä»¶è‹¥æ”¾åœ¨</strong><code>src/main/java</code> ä¸‹ï¼Œéœ€åœ¨ <code>pom.xml</code> ä¸­æ·»åŠ èµ„æºè¿‡æ»¤ï¼š</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;resources&gt;</span><br><span class="line">        &lt;resource&gt;</span><br><span class="line">            &lt;directory&gt;src/main/java&lt;/directory&gt;</span><br><span class="line">            &lt;includes&gt;</span><br><span class="line">                &lt;include&gt;**/*.xml&lt;/include&gt;</span><br><span class="line">            &lt;/includes&gt;</span><br><span class="line">        &lt;/resource&gt;</span><br><span class="line">    &lt;/resources&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="9-2-å­—æ®µæ˜ å°„é”™è¯¯"><a href="#9-2-å­—æ®µæ˜ å°„é”™è¯¯" class="headerlink" title="9.2 å­—æ®µæ˜ å°„é”™è¯¯"></a>9.2 å­—æ®µæ˜ å°„é”™è¯¯</h4><ul>
<li><strong>é”™è¯¯ï¼šæŸ¥è¯¢ç»“æœå­—æ®µä¸º</strong><code>null</code>ï¼ˆå®ä½“ç±»å±æ€§ä¸æ•°æ®åº“åˆ—åä¸ä¸€è‡´ï¼‰<br><strong>è§£å†³ï¼š</strong><ol>
<li><strong>å¼€å¯é©¼å³°æ˜ å°„ï¼ˆ</strong><code>mapUnderscoreToCamelCase=true</code>ï¼‰</li>
<li><strong>ä½¿ç”¨</strong><code>resultMap</code> æ‰‹åŠ¨å®šä¹‰æ˜ å°„å…³ç³»</li>
<li><strong>åœ¨ SQL ä¸­ç»™åˆ—åæ·»åŠ åˆ«åï¼ˆå¦‚</strong><code>id as userId</code>ï¼‰</li>
</ol>
</li>
</ul>
<h4 id="9-3-äº‹åŠ¡ç›¸å…³é”™è¯¯"><a href="#9-3-äº‹åŠ¡ç›¸å…³é”™è¯¯" class="headerlink" title="9.3 äº‹åŠ¡ç›¸å…³é”™è¯¯"></a>9.3 äº‹åŠ¡ç›¸å…³é”™è¯¯</h4><ul>
<li><strong>é”™è¯¯ï¼šæ’å…¥æ•°æ®åæ•°æ®åº“æ— è®°å½•ï¼ˆæœªæäº¤äº‹åŠ¡ï¼‰</strong><br><strong>åŸå› ï¼šMybatis é»˜è®¤å…³é—­è‡ªåŠ¨æäº¤ï¼ŒDML æ“ä½œéœ€æ‰‹åŠ¨</strong><code>commit()</code> è§£å†³ï¼šæ‰§è¡Œ <code>session.commit()</code> æˆ–å¼€å¯è‡ªåŠ¨æäº¤ï¼ˆ<code>openSession(true)</code>ï¼‰</li>
</ul>
<h3 id="åã€Mybatis-ä¸-Spring-æ•´åˆ"><a href="#åã€Mybatis-ä¸-Spring-æ•´åˆ" class="headerlink" title="åã€Mybatis ä¸ Spring æ•´åˆ"></a>åã€Mybatis ä¸ Spring æ•´åˆ</h3><h4 id="10-1-æ ¸å¿ƒä¾èµ–ï¼ˆMavenï¼‰"><a href="#10-1-æ ¸å¿ƒä¾èµ–ï¼ˆMavenï¼‰" class="headerlink" title="10.1 æ ¸å¿ƒä¾èµ–ï¼ˆMavenï¼‰"></a>10.1 æ ¸å¿ƒä¾èµ–ï¼ˆMavenï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- Springæ ¸å¿ƒ --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.3.24&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- Spring JDBCï¼ˆäº‹åŠ¡ç®¡ç†ï¼‰ --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.3.24&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- Mybatis-Springæ•´åˆåŒ… --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis-spring&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.0.7&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h4 id="10-2-Spring-é…ç½®æ–‡ä»¶ï¼ˆapplicationContext-xmlï¼‰"><a href="#10-2-Spring-é…ç½®æ–‡ä»¶ï¼ˆapplicationContext-xmlï¼‰" class="headerlink" title="10.2 Spring é…ç½®æ–‡ä»¶ï¼ˆapplicationContext.xmlï¼‰"></a>10.2 Spring é…ç½®æ–‡ä»¶ï¼ˆapplicationContext.xmlï¼‰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 1. æ•°æ®æºï¼ˆæ›¿æ¢MybatisåŸç”Ÿæ•°æ®æºï¼‰ --&gt;</span><br><span class="line">&lt;bean id=&quot;dataSource&quot; class=&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;driverClassName&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot;/&gt;</span><br><span class="line">    &lt;property name=&quot;url&quot; value=&quot;jdbc:mysql://localhost:3306/test?useSSL=false&quot;/&gt;</span><br><span class="line">    &lt;property name=&quot;username&quot; value=&quot;root&quot;/&gt;</span><br><span class="line">    &lt;property name=&quot;password&quot; value=&quot;123456&quot;/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 2. SqlSessionFactoryï¼ˆç”±Springç®¡ç†ï¼‰ --&gt;</span><br><span class="line">&lt;bean id=&quot;sqlSessionFactory&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;</span><br><span class="line">    &lt;!-- åŠ è½½Mybatisæ ¸å¿ƒé…ç½® --&gt;</span><br><span class="line">    &lt;property name=&quot;configLocation&quot; value=&quot;classpath:mybatis-config.xml&quot;/&gt;</span><br><span class="line">    &lt;!-- æ‰«ææ˜ å°„æ–‡ä»¶ --&gt;</span><br><span class="line">    &lt;property name=&quot;mapperLocations&quot; value=&quot;classpath:mappers/*.xml&quot;/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 3. Mapperæ¥å£æ‰«æï¼ˆè‡ªåŠ¨ç”Ÿæˆä»£ç†å¯¹è±¡ï¼‰ --&gt;</span><br><span class="line">&lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;basePackage&quot; value=&quot;com.example.mapper&quot;/&gt; &lt;!-- Mapperæ¥å£æ‰€åœ¨åŒ… --&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 4. äº‹åŠ¡ç®¡ç†å™¨ --&gt;</span><br><span class="line">&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- å¼€å¯äº‹åŠ¡æ³¨è§£ --&gt;</span><br><span class="line">&lt;tx:annotation-driven transaction-manager=&quot;transactionManager&quot;/&gt;</span><br></pre></td></tr></table></figure>

<h4 id="10-3-æ•´åˆåä½¿ç”¨æ–¹å¼"><a href="#10-3-æ•´åˆåä½¿ç”¨æ–¹å¼" class="headerlink" title="10.3 æ•´åˆåä½¿ç”¨æ–¹å¼"></a>10.3 æ•´åˆåä½¿ç”¨æ–¹å¼</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">// 1. æ³¨å…¥Mapperæ¥å£ï¼ˆSpringè‡ªåŠ¨ç®¡ç†ï¼‰</span><br><span class="line">@Service</span><br><span class="line">public class UserService &#123;</span><br><span class="line"> Â  Â @Autowired</span><br><span class="line"> Â  Â private UserMapper userMapper;</span><br><span class="line"></span><br><span class="line"> Â  Â // 2. äº‹åŠ¡æ§åˆ¶ï¼ˆé€šè¿‡æ³¨è§£ï¼‰</span><br><span class="line"> Â  Â @Transactional</span><br><span class="line"> Â  Â public void addUser(User user) &#123;</span><br><span class="line"> Â  Â  Â  Â userMapper.insertUser(user);</span><br><span class="line"> Â   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div>

    
    <section class="post-copyright">
      
      <p class="copyright-item">
        <span>ä½œè€…:</span>
        <span>è€æ±Ÿæ¹–</span>
      </p>
        
      <p class="copyright-item">
        <span>è®¸å¯è¯:</span>
        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
      </p>
       
      <p class="copyright-item">
        <span>å£å·:</span>
        <span><strong>ä»£ç æ˜¯å¼€æºçš„,æˆ‘ä»¬åªæ˜¯å®ƒçš„æ¬è¿å·¥ã€‚</strong></span>
      </p>
       
        <p class="copyright-item">
        <span>å¦‚æœè§‰å¾—æˆ‘çš„æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè¯·éšæ„è½¬è½½ï¼Œæ„Ÿè°¢æ”¯æŒï¼</span>
      </p>
      
             
        <p class="copyright-item">
        <span>å¦‚æœ‰ä¾µæƒè¯·å‘ŠçŸ¥åˆ é™¤ğŸ™</span>
      </p>
             
        <p class="copyright-item">
        <span>å¦‚æœä½ æœ‰å¾ˆå¥½çš„æƒ³æ³•ğŸ’¡ï¼Œè¯·åŠ¡å¿…è”ç³»æˆ‘ã€‚ </span>
        <br>
         <span>2292360909@qq.com</span>
      </p>
    </section>
    
    <section class="post-tags">
      <div>
        <span>æ ‡ç­¾:</span>
        <span class="tag">
           
          <a href="/tags/Mybatis/"># Mybatis</a>
           
        </span>
      </div>
      <div>
        <a href="javascript:window.history.back();">è¿”å›</a>
        <span>Â· </span>
        <a href="/">é¦–é¡µ</a>
      </div>
    </section>
    <section class="post-nav">
      
      <a class="prev" rel="prev" href="/2025/10/15/java/Mybatis-plus%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/"
        >Mybatis-pluså¿«é€Ÿä¸Šæ‰‹</a
      >
       
      <a class="next" rel="next" href="/2025/10/15/java/Lombok%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B/"
        >Lombokå¿«é€Ÿä¸Šæ‰‹</a
      >
      
    </section>

    <!-- Giscus è¯„è®ºåŒºæŒ‚è½½ç‚¹ -->
<div id="giscus-container" style="margin-top: 2.5rem;"></div>

<!-- Giscus åŠ¨æ€åŠ è½½è„šæœ¬ï¼šåˆå§‹åŠ è½½ + æ˜æš—ä¸»é¢˜åˆ‡æ¢ -->
<script>
  function createGiscus(theme) {
    const giscusContainer = document.getElementById('giscus-container');
    if (!giscusContainer) return;

    // æ¸…é™¤æ—§çš„è¯„è®º iframe
    giscusContainer.innerHTML = '';

    const script = document.createElement('script');
    script.src = 'https://giscus.app/client.js';

    // æ›¿æ¢ä¸ºä½ çš„ GitHub ä»“åº“ä¿¡æ¯ï¼ˆæ ¼å¼ï¼šusername/repoï¼‰
    script.setAttribute('data-repo', 'meisijiya/meisijiya.github.io');

   // æ›¿æ¢ä¸ºä½ çš„ repo-id å’Œ category-idï¼ˆåœ¨ giscus.app é…ç½®é¡µé¢ç”Ÿæˆï¼‰
    script.setAttribute('data-repo-id', 'R_kgDOPwTrpQ');
    script.setAttribute('data-category', 'Announcements');
    script.setAttribute('data-category-id', 'DIC_kwDOPwTrpc4CviGR');

    // å…¶ä»–å¸¸è§„æ¨èè®¾ç½®
    script.setAttribute('data-mapping', 'pathname');           // ç”¨é¡µé¢è·¯å¾„åŒ¹é…è¯„è®ºå¸–
    script.setAttribute('data-strict', '0');                   // è‹¥æ— åŒ¹é…å¸–åˆ™åˆ›å»ºæ–°å¸–
    script.setAttribute('data-reactions-enabled', '1');        // å¯ç”¨è¡¨æƒ…ååº”
    script.setAttribute('data-emit-metadata', '0');            // ä¸è¾“å‡ºå…ƒæ•°æ®
    script.setAttribute('data-input-position', 'top');         // è¾“å…¥æ¡†åœ¨è¯„è®ºä¸Šæ–¹
    script.setAttribute('data-theme', theme);                
    script.setAttribute('data-lang', 'zh-CN');                 // ä¸­æ–‡ç•Œé¢
    script.setAttribute('crossorigin', 'anonymous');           // è·¨åŸŸèµ„æºå®‰å…¨
    script.async = true;                                       
     
    giscusContainer.appendChild(script);
  }

  function getCurrentTheme() {
    return document.body.classList.contains('dark-theme') ? 'dark' : 'light';
  }

  document.addEventListener('DOMContentLoaded', () => {
    // é¡µé¢é¦–æ¬¡åŠ è½½ï¼Œæ ¹æ®å½“å‰ä¸»é¢˜æŒ‚è½½è¯„è®º
    createGiscus(getCurrentTheme());

    // ç›‘å¬æŒ‰é’®ç‚¹å‡»åˆ‡æ¢ä¸»é¢˜ â†’ é‡è½½è¯„è®ºåŒº
    const buttons = [
      document.querySelector('.toggleBtn'),
      document.getElementById('mobile-toggle-theme')
    ];
    buttons.forEach(btn => {
      if (!btn) return;
      btn.addEventListener('click', () => {
        setTimeout(() => {
          createGiscus(getCurrentTheme());
        }, 400); // ç¨ä½œå»¶è¿Ÿï¼Œç¡®ä¿ class åˆ‡æ¢å®Œæ¯•
      });
    });

    // ç›‘å¬ body class æ”¹å˜ï¼ˆä¿é™©æ–¹æ¡ˆï¼‰
    const observer = new MutationObserver(() => {
      createGiscus(getCurrentTheme());
    });
    observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });
  });
</script>

  </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© è€æ±Ÿæ¹– | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>
<script src="/js/code-copy.js"></script>


    </div>
</body>
<!-- umami -->
<script defer src="https://cloud.umami.is/script.js" data-website-id="91b923f2-ff2d-43d0-ba5f-bc348d82426a"></script>
</html>