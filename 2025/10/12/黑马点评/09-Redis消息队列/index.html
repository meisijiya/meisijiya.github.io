<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="è€æ±Ÿæ¹–">


    <meta name="subtitle" content="è®°å½•è¿›å…¥æˆ¿é—´é—¨åçš„ç¾å¥½">


    <meta name="description" content="ä¸€å¹´å‰ï¼Œå­¤è‹¦ä¼¶ä»ƒçš„è€æ±Ÿæ¹–ï¼Œå¶ç„¶é—´å‘ç°ä¸€å¤„æˆ¿é—´é—¨ï¼Œæ¨é—¨è€Œå…¥ï¼Œä»æ­¤è¿›å…¥äº†å……æ»¡å¹¸ç¦çš„ä¸–ç•Œã€‚">


    <meta name="keywords" content="è€æ±Ÿæ¹–,åšå®¢,æˆ¿é—´é—¨">


<title>09-Redisæ¶ˆæ¯é˜Ÿåˆ— | æ¬¢è¿æ¥åˆ°è€æ±Ÿæ¹–çš„åšå®¢</title>



    <link rel="icon" href="/images/%E9%87%91%E6%AF%9B.png?_t=1758006391547">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    
    <link rel="stylesheet" href="/css/search.css">
    

<!-- highlight.js æ ·å¼ï¼ˆé»˜è®¤äº®è‰²ï¼‰ -->
<link id="hljs-theme" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/github.css">
<!-- highlight.js è‡ªåŠ¨ä¸Šè‰²åŠŸèƒ½ -->
<script src="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/lib/highlight.min.js"></script>
<script>hljs.highlightAll();</script>

<link rel="stylesheet" href="/css/custom.css">



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 7.3.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const pagebody = document.getElementsByTagName('body')[0]

            function setTheme(status) {

                if (status === 'dark') {
                    window.sessionStorage.theme = 'dark'
                    pagebody.classList.add('dark-theme');

                } else if (status === 'light') {
                    window.sessionStorage.theme = 'light'
                    pagebody.classList.remove('dark-theme');
                }
            };

            setTheme(window.sessionStorage.theme)
        })();
    </script>

    <div class="wrapper">
        <header>
  <nav class="navbar">
    <div class="container">
      <div class="navbar-header header-logo">
        <a href="/">è€æ±Ÿæ¹–çš„åšå®¢</a>
      </div>
      <div class="menu navbar-right">
        <!-- åœ¨ç”µè„‘ç«¯çš„å¯¼èˆªé“¾æ¥åŒºåŸŸæ·»åŠ æœç´¢åŠŸèƒ½ -->
        <div class="search-container">
          <a href="javascript:;" onclick="toggleSearchInput()">ğŸ”</a>
          <input
            type="text"
            id="nav-search-input-desktop"
            class="nav-search-input"
            placeholder="æƒ³çŸ¥é“æˆ‘ä»€ä¹ˆç§˜å¯†å‘¢ï¼Œæœæœçœ‹å§"
            oninput="navSearch(this)"
          />
          <div id="nav-search-result-desktop" class="nav-search-result"></div>
        </div>

        
        <a class="menu-item" href="/archives">å½’æ¡£</a>
        
        <a class="menu-item" href="/category">åˆ†ç±»</a>
        
        <a class="menu-item" href="/tag">æ ‡ç­¾</a>
        
        <a class="menu-item" href="/Timer">ä»»åŠ¡è®¡æ—¶å™¨</a>
        
        <a class="menu-item" href="/timeLine">æ—¶é—´çº¿</a>
        
        <a class="menu-item" href="/tongji">ç½‘ç«™ç»Ÿè®¡</a>
        
        <a class="menu-item" href="/about">å…³äº</a>
        

        <input id="switch_default" type="checkbox" class="switch_default" />
        <label for="switch_default" class="toggleBtn"></label>
      </div>
    </div>
  </nav>

  
  <nav class="navbar-mobile" id="nav-mobile">
    <div class="container">
      <div class="navbar-header">
        <div>
          <a href="/">è€æ±Ÿæ¹–çš„åšå®¢</a
          ><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
        </div>

        <div class="menu-toggle" onclick="mobileBtn()">
          <svg
            class="menu-icon"
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
          >
            <path
              fill="currentColor"
              d="M4.5 17.27q-.213 0-.356-.145T4 16.768t.144-.356t.356-.143h15q.213 0 .356.144q.144.144.144.357t-.144.356t-.356.143zm0-4.77q-.213 0-.356-.144T4 11.999t.144-.356t.356-.143h15q.213 0 .356.144t.144.357t-.144.356t-.356.143zm0-4.77q-.213 0-.356-.143Q4 7.443 4 7.23t.144-.356t.356-.143h15q.213 0 .356.144T20 7.23t-.144.356t-.356.144z"
            />
          </svg>
          <svg
            class="close-icon"
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
          >
            <!-- Icon from Material Symbols Light by Google - https://github.com/google/material-design-icons/blob/master/LICENSE -->
            <path
              fill="currentColor"
              d="m12 12.708l-5.246 5.246q-.14.14-.344.15t-.364-.15t-.16-.354t.16-.354L11.292 12L6.046 6.754q-.14-.14-.15-.344t.15-.364t.354-.16t.354.16L12 11.292l5.246-5.246q.14-.14.345-.15q.203-.01.363.15t.16.354t-.16.354L12.708 12l5.246 5.246q.14.14.15.345q.01.203-.15.363t-.354.16t-.354-.16z"
            />
          </svg>
        </div>
      </div>

      <div class="menu" id="mobile-menu">
        
        <a class="menu-item" href="/archives">å½’æ¡£</a>
        
        <a class="menu-item" href="/category">åˆ†ç±»</a>
        
        <a class="menu-item" href="/tag">æ ‡ç­¾</a>
        
        <a class="menu-item" href="/Timer">ä»»åŠ¡è®¡æ—¶å™¨</a>
        
        <a class="menu-item" href="/timeLine">æ—¶é—´çº¿</a>
        
        <a class="menu-item" href="/tongji">ç½‘ç«™ç»Ÿè®¡</a>
        
        <a class="menu-item" href="/about">å…³äº</a>
        
        <!-- æ‰‹æœºæ¨¡å¼æœç´¢æ¡† -->
        <div class="search-container mobile-container">
          <a class="menu-item" href="javascript:;" onclick="toggleSearchInput()"
            >ğŸ”</a
          >
          <input
            type="text"
            id="nav-search-input-mobile"
            class="nav-search-input"
            placeholder="æƒ³çŸ¥é“æˆ‘ä»€ä¹ˆç§˜å¯†å‘¢ï¼Œæœæœçœ‹å§"
            oninput="navSearch(this)"
          />
          <div id="nav-search-result-mobile" class="nav-search-result"></div>
        </div>
      </div>
    </div>
  </nav>
</header>
<script>
  var mobileBtn = function f() {
    var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
    var mobileMenu = document.getElementById("mobile-menu");
    if (toggleMenu.classList.contains("active")) {
      toggleMenu.classList.remove("active");
      mobileMenu.classList.remove("active");
    } else {
      toggleMenu.classList.add("active");
      mobileMenu.classList.add("active");
    }
  };

  function toggleSearchInput() {
    const inputs = document.querySelectorAll(".nav-search-input");
    const results = document.querySelectorAll(".nav-search-result");
    inputs.forEach((input) => {
      input.classList.toggle("active");
      if (input.classList.contains("active")) input.focus();
    });
    results.forEach((r) => (r.style.display = "none"));
  }

  // ç‚¹å‡»å¤–éƒ¨åŒºåŸŸéšè—æœç´¢æ¡†å’Œç»“æœå®¹å™¨çš„å‡½æ•°
  function handleClickOutsideSearch(event) {
    const searchContainers = document.querySelectorAll(".search-container");
    searchContainers.forEach((container) => {
      const searchInput = container.querySelector(".nav-search-input");
      const searchIcon = container.querySelector("a");

      // å¦‚æœç‚¹å‡»çš„å…ƒç´ ä¸æ˜¯æœç´¢è¾“å…¥æ¡†æˆ–æœç´¢å›¾æ ‡ï¼Œåˆ™éšè—æœç´¢æ¡†å’Œç»“æœå®¹å™¨
      if (
        !searchInput.contains(event.target) &&
        !searchIcon.contains(event.target)
      ) {
        searchInput.classList.remove("active");
        searchInput.value = ""
        // æ ¹æ®è¾“å…¥æ¡†IDç¡®å®šå¯¹åº”çš„ç»“æœå®¹å™¨
        let resultContainer;
        if (searchInput.id === "nav-search-input-mobile") {
          // ç§»åŠ¨ç«¯ç»“æœå®¹å™¨
          resultContainer = document.querySelector(
            ".navbar-mobile .nav-search-result"
          );
        } else {
          // æ¡Œé¢ç«¯ç»“æœå®¹å™¨
          resultContainer = document.getElementById(
            "nav-search-result-desktop"
          );
        }

        if (resultContainer) {
          resultContainer.style.display = "none";
          resultContainer.innerHTML = ""; // æ¸…ç©ºç»“æœå®¹å™¨å†…å®¹
        }
      }
    });
  }

  // æ·»åŠ å…¨å±€ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
  document.addEventListener("click", function (event) {
    handleClickOutsideSearch(event);
  });

  // æ–°å¢ï¼šæœç´¢åŠŸèƒ½å®ç°
  let searchData = []; // å…¨å±€å˜é‡å­˜å‚¨æœç´¢æ•°æ®

  // é¡µé¢åŠ è½½å®Œæˆåè·å–æœç´¢æ•°æ®
  document.addEventListener("DOMContentLoaded", function () {
    fetch("/search.xml")
      .then((res) => res.text())
      .then((xmlText) => {
        const parser = new DOMParser();
        const xml = parser.parseFromString(xmlText, "text/xml");
        const entries = xml.getElementsByTagName("entry");
        for (let entry of entries) {
          searchData.push({
            title: entry.getElementsByTagName("title")[0]?.textContent || "",
            content:
              entry.getElementsByTagName("content")[0]?.textContent || "",
            url: entry.getElementsByTagName("url")[0]?.textContent || "",
          });
        }
      })
      .catch((err) => {
        console.error("Failed to load search data:", err);
      });
  });

  // æ–°å¢ï¼šå¯¼èˆªæœç´¢æ–¹æ³•
  function navSearch(inputElement) {
    const keyword = inputElement.value.trim().toLowerCase();
    // æŸ¥æ‰¾å¯¹åº”çš„æœç´¢ç»“æœå®¹å™¨
    let resultContainer;

    if (inputElement.id === "nav-search-input-desktop") {
      // æ¡Œé¢ç«¯
      resultContainer = document.getElementById("nav-search-result-desktop");
    } else if (inputElement.id === "nav-search-input-mobile") {
      // ç§»åŠ¨ç«¯
      resultContainer =
        inputElement.parentNode.querySelector(".nav-search-result");
    }

    if (!resultContainer) return;

    resultContainer.innerHTML = "";

    if (!keyword) {
      resultContainer.style.display = "none";
      return;
    }

    // æ˜¾ç¤ºç»“æœå®¹å™¨
    resultContainer.style.display = "block";

    // è¿‡æ»¤æœç´¢æ•°æ®
    const results = searchData.filter(
      (data) =>
        (data.title && data.title.toLowerCase().includes(keyword)) ||
        (data.content && data.content.toLowerCase().includes(keyword))
    );

    if (results.length === 0) {
      resultContainer.innerHTML =
        '<p class="no-result">æ²¡æœ‰ç»“æœå“Ÿï¼Œæ¢ä¸ªå…³é”®è¯è¯•è¯•å§</p>';
      return;
    }

    // é™åˆ¶æ˜¾ç¤ºç»“æœæ•°é‡
    const maxResults = 10;
    const limitedResults = results.slice(0, maxResults);

    // æ„å»ºç»“æœHTML
    const html = limitedResults
      .map((item) => {
        // æå–åŒ…å«å…³é”®å­—çš„å†…å®¹ç‰‡æ®µ
        let contentSnippet = "";
        if (item.content) {
          // æ‰¾åˆ°åŒ…å«å…³é”®å­—çš„å†…å®¹ç‰‡æ®µ
          const contentLower = item.content.toLowerCase();
          const keywordIndex = contentLower.indexOf(keyword);

          // æå–å…³é”®å­—å‰åçš„å†…å®¹
          const start = Math.max(0, keywordIndex - 3 * keyword.length);
          const end = Math.min(
            item.content.length,
            keywordIndex + 3 * keyword.length
          );
          contentSnippet = item.content.substring(start, end);
        // é«˜äº®å…³é”®å­—
      const keywordRegex = new RegExp(`(${keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
      contentSnippet = contentSnippet.replace(
        keywordRegex,
        "<mark>$1</mark>"
      );
        }

        return `<div class="search-result-item">
  <a href="${item.url}">
    <div>æ ‡é¢˜ï¼š${item.title}</div>
    <div>å†…å®¹ï¼š${contentSnippet}</div>
  </a>
</div>`;
      })
      .join("");
    resultContainer.innerHTML = html;
  }
</script>
<style>
  /* æ‰‹æœºç«¯ä½¿ç”¨flexboxå¸ƒå±€æœç´¢å®¹å™¨ */
  .mobile-container {
    display: flex;
    align-items: center;
    flex-direction: row;
    margin-bottom: 10px;
    margin-left: 10px;
    flex-grow: 1;
    max-width: calc(100% - 40px);
  }


  .search-result-item {
  border: 1px solid #ddd; /* è¾¹æ¡† */
  margin: 4px 0; /* å¤–å±‚é—´è· */
  padding: 0; /* æ— å†…è¾¹è· */
  background: #fff; /* èƒŒæ™¯è‰² */
}

.search-result-item a {
  display: block;
  text-decoration: none;
  color: inherit;
}

.search-result-item div {
  padding: 3px 8px; /* ç´§å‡‘çš„å†…è¾¹è· */
  margin: 0; /* æ— å¤–è¾¹è· */
  line-height: 1.3; /* ç´§å‡‘çš„è¡Œé«˜ */
  word-wrap: break-word; /* å…è®¸é•¿å•è¯æ¢è¡Œ */
  white-space: normal; /* å…è®¸æ­£å¸¸æ¢è¡Œ */
}

.search-result-item div:first-child {
  border-bottom: 1px solid #eee; /* æ ‡é¢˜å’Œå†…å®¹ä¹‹é—´çš„åˆ†éš”çº¿ */
}


</style>

            <div class="main">
                <div class="container">
    <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">å±•å¼€æ‰€æœ‰</a>
        <a onclick="go_top()">è¿”å›é¡¶éƒ¨</a>
        <a onclick="go_bottom()">è¿”å›åº•éƒ¨</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // ä¸º 6 æ—¶å±•å¼€æ‰€æœ‰
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // è¿™ä¸ªå€¼æ˜¯ç”± tocbot æºç é‡Œå®šä¹‰çš„ scrollSmoothDuration å¾—æ¥çš„
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'å±•å¼€æ‰€æœ‰' : 'æŠ˜å æ‰€æœ‰';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>  
  <article class="post-wrap">
    <header class="post-header">
      <h1 class="post-title">09-Redisæ¶ˆæ¯é˜Ÿåˆ—</h1>
      
      <div class="post-meta">
         ä½œè€…:
        <a itemprop="author" rel="author" href="/">è€æ±Ÿæ¹–</a>
         
        <span class="post-time">
          <br />æ—¥æœŸ:
          <a href="#"
            >åæœˆ 12, 2025&nbsp;&nbsp;0:00:00</a
          >
        </span>
         
        <span class="post-category"
          ><br />
          åˆ†ç±»: 
          <a href="/categories/%E9%BB%91%E9%A9%AC%E7%82%B9%E8%AF%84/">é»‘é©¬ç‚¹è¯„</a>
          
        </span>
        
      </div>
      
    </header>

    <div class="post-content"><h1 id="Redis-æ¶ˆæ¯é˜Ÿåˆ—æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“"><a href="#Redis-æ¶ˆæ¯é˜Ÿåˆ—æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“" class="headerlink" title="Redis æ¶ˆæ¯é˜Ÿåˆ—æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“"></a>Redis æ¶ˆæ¯é˜Ÿåˆ—æ ¸å¿ƒçŸ¥è¯†ç‚¹æ€»ç»“</h1><h2 id="ä¸€ã€æ¶ˆæ¯é˜Ÿåˆ—çš„åŸºç¡€ä»·å€¼"><a href="#ä¸€ã€æ¶ˆæ¯é˜Ÿåˆ—çš„åŸºç¡€ä»·å€¼" class="headerlink" title="ä¸€ã€æ¶ˆæ¯é˜Ÿåˆ—çš„åŸºç¡€ä»·å€¼"></a>ä¸€ã€æ¶ˆæ¯é˜Ÿåˆ—çš„åŸºç¡€ä»·å€¼</h2><p>æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆMessage Queueï¼‰åŒ…å« <strong>ç”Ÿäº§è€…</strong>ï¼ˆå‘é€æ¶ˆæ¯ï¼‰ã€<strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼ˆå­˜å‚¨ä¸ç®¡ç†æ¶ˆæ¯ï¼‰ã€<strong>æ¶ˆè´¹è€…</strong>ï¼ˆè·å–å¹¶å¤„ç†æ¶ˆæ¯ï¼‰ä¸‰ä¸ªæ ¸å¿ƒè§’è‰²ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯ <strong>è§£è€¦</strong>ï¼ˆç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…é€šè¿‡é˜Ÿåˆ—é—´æ¥é€šä¿¡ï¼Œé¿å…ä¸€æ–¹ç­‰å¾…å¦ä¸€æ–¹ï¼Œå…¸å‹åœºæ™¯å¦‚ç§’æ€ï¼šç”Ÿäº§è€…æ ¡éªŒä¸‹å•èµ„æ ¼åå‘æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…å¼‚æ­¥å¤„ç†ä¸‹å•ï¼Œå¤§å¹…æå‡å“åº”é€Ÿåº¦ï¼‰ã€‚</p>
<h2 id="äºŒã€Redis-å®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸‰ç§æ–¹å¼"><a href="#äºŒã€Redis-å®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸‰ç§æ–¹å¼" class="headerlink" title="äºŒã€Redis å®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸‰ç§æ–¹å¼"></a>äºŒã€Redis å®ç°æ¶ˆæ¯é˜Ÿåˆ—çš„ä¸‰ç§æ–¹å¼</h2><h3 id="1-åŸºäºListçš„æ¶ˆæ¯é˜Ÿåˆ—"><a href="#1-åŸºäºListçš„æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="1. åŸºäºListçš„æ¶ˆæ¯é˜Ÿåˆ—"></a>1. åŸºäº<code>List</code>çš„æ¶ˆæ¯é˜Ÿåˆ—</h3><ul>
<li><strong>åŸç†</strong>ï¼šåˆ©ç”¨ Redis <code>List</code>ï¼ˆåŒå‘é“¾è¡¨ï¼‰çš„ <code>LPUSH</code>ï¼ˆå·¦ç«¯æ·»åŠ æ¶ˆæ¯ï¼‰ + <code>BRPOP</code>ï¼ˆå³ç«¯<strong>é˜»å¡</strong>è·å–æ¶ˆæ¯ï¼Œé˜Ÿåˆ—ç©ºæ—¶æŒç»­ç­‰å¾…ï¼‰ï¼Œæ¨¡æ‹Ÿ â€œå…ˆè¿›å…ˆå‡ºâ€ çš„é˜Ÿåˆ—é€»è¾‘ã€‚</li>
<li>æ ¸å¿ƒå‘½ä»¤ï¼š<ul>
<li>ç”Ÿäº§è€…ï¼š<code>LPUSH queue:xxx &quot;msg&quot;</code>ï¼ˆå‘é˜Ÿåˆ— <code>queue:xxx</code> å·¦ä¾§æ¨é€æ¶ˆæ¯ï¼‰ã€‚</li>
<li>æ¶ˆè´¹è€…ï¼š<code>BRPOP queue:xxx 0</code>ï¼ˆä»é˜Ÿåˆ—å³ä¾§é˜»å¡è·å–æ¶ˆæ¯ï¼Œ<code>0</code> è¡¨ç¤º â€œæ°¸ä¹…é˜»å¡â€ï¼Œç›´åˆ°æœ‰æ¶ˆæ¯ï¼‰ã€‚</li>
</ul>
</li>
<li>ä¼˜ç¼ºç‚¹ï¼š<ul>
<li>ä¼˜ç‚¹ï¼š<ul>
<li>å­˜å‚¨ä¾èµ– Redisï¼Œä¸å— JVM å†…å­˜å®¹é‡é™åˆ¶ï¼›</li>
<li>å€ŸåŠ© Redis æŒä¹…åŒ–ï¼ˆRDB&#x2F;AOFï¼‰ï¼Œæ•°æ®å®‰å…¨æ€§æœ‰åŸºç¡€ä¿éšœï¼›</li>
<li>å¤©ç„¶æ”¯æŒ <strong>æ¶ˆæ¯æœ‰åºæ€§</strong>ï¼ˆList æ˜¯æœ‰åºé“¾è¡¨ï¼Œæ¶ˆæ¯æŒ‰å…¥é˜Ÿé¡ºåºæ¶ˆè´¹ï¼‰ã€‚</li>
</ul>
</li>
<li>ç¼ºç‚¹ï¼š<ul>
<li>æ—  â€œæ¶ˆè´¹ç¡®è®¤â€ æœºåˆ¶ï¼Œæ¶ˆæ¯ä¸¢å¤±é£é™©é«˜ï¼ˆå¦‚æ¶ˆè´¹è€…å¤„ç†å¤±è´¥æœªé‡è¯•ï¼‰ï¼›</li>
<li>ä»…æ”¯æŒ <strong>å•æ¶ˆè´¹è€…</strong>ï¼ˆåŒä¸€æ¡æ¶ˆæ¯åªèƒ½è¢«ä¸€ä¸ªæ¶ˆè´¹è€…è·å–ï¼Œæ— æ³•å¤šæ¶ˆè´¹ç»„å…±äº«ï¼‰ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="2-åŸºäºPubSubï¼ˆå‘å¸ƒ-è®¢é˜…ï¼‰çš„æ¶ˆæ¯é˜Ÿåˆ—"><a href="#2-åŸºäºPubSubï¼ˆå‘å¸ƒ-è®¢é˜…ï¼‰çš„æ¶ˆæ¯é˜Ÿåˆ—" class="headerlink" title="2. åŸºäºPubSubï¼ˆå‘å¸ƒ - è®¢é˜…ï¼‰çš„æ¶ˆæ¯é˜Ÿåˆ—"></a>2. åŸºäº<code>PubSub</code>ï¼ˆå‘å¸ƒ - è®¢é˜…ï¼‰çš„æ¶ˆæ¯é˜Ÿåˆ—</h3><ul>
<li><strong>åŸç†</strong>ï¼šé‡‡ç”¨ â€œå‘å¸ƒ - è®¢é˜…â€ æ¨¡å‹ï¼Œç”Ÿäº§è€…å‘**é¢‘é“ï¼ˆChannelï¼‰**å‘å¸ƒæ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…è®¢é˜…é¢‘é“åå¯å®æ—¶æ¥æ”¶æ¶ˆæ¯ï¼Œæ”¯æŒ**å¤šç”Ÿäº§è€…ã€å¤šæ¶ˆè´¹è€…**ã€‚</li>
<li>æ ¸å¿ƒå‘½ä»¤ï¼š<ul>
<li>ç”Ÿäº§è€…ï¼š<code>PUBLISH channel:xxx &quot;msg&quot;</code>ï¼ˆå‘é¢‘é“ <code>channel:xxx</code> å‘å¸ƒæ¶ˆæ¯ï¼‰ã€‚</li>
<li>æ¶ˆè´¹è€…ï¼š<code>SUBSCRIBE channel:xxx</code>ï¼ˆè®¢é˜…æŒ‡å®šé¢‘é“ï¼Œå®æ—¶æ¥æ”¶æ¶ˆæ¯ï¼‰ï¼›æˆ– <code>PSUBSCRIBE channel:*</code>ï¼ˆé€šé…ç¬¦è®¢é˜…ï¼ŒåŒ¹é…æ‰€æœ‰ <code>channel:*</code> æ ¼å¼çš„é¢‘é“ï¼‰ã€‚</li>
</ul>
</li>
<li>ä¼˜ç¼ºç‚¹ï¼š<ul>
<li>ä¼˜ç‚¹ï¼š<ul>
<li>æ”¯æŒ <strong>å¤šç”Ÿäº§è€…ã€å¤šæ¶ˆè´¹è€…</strong>ï¼ˆå¤šä¸ªç”Ÿäº§è€…å¯å‘åŒä¸€é¢‘é“ï¼Œå¤šä¸ªæ¶ˆè´¹è€…å¯è®¢é˜…åŒä¸€é¢‘é“ï¼‰ï¼›</li>
<li>è®¢é˜…å…³ç³»çµæ´»ï¼ˆ<code>PSUBSCRIBE</code> æ”¯æŒé€šé…ç¬¦ï¼Œæ‰¹é‡è®¢é˜…åŒ¹é…é¢‘é“ï¼‰ã€‚</li>
</ul>
</li>
<li>ç¼ºç‚¹ï¼š<ul>
<li><strong>ä¸æ”¯æŒæ•°æ®æŒä¹…åŒ–</strong>ï¼ˆRedis é‡å¯åï¼Œè®¢é˜…å…³ç³»å’Œæœªæ¶ˆè´¹çš„æ¶ˆæ¯ä¼šç›´æ¥ä¸¢å¤±ï¼‰ï¼›</li>
<li><strong>æ— æ¶ˆæ¯ç¡®è®¤æœºåˆ¶</strong>ï¼Œæ¶ˆæ¯ä¸¢å¤±æ— æ³•é¿å…ï¼›</li>
<li><strong>æ¶ˆæ¯å †ç§¯æœ‰ä¸Šé™</strong>ï¼ˆä¾èµ– Redis å†…å­˜ï¼Œå †ç§¯è¿‡å¤šä¼šå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼‰ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="3-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆRedis-5-0-ï¼Œä¼ä¸šçº§é¦–é€‰ï¼‰"><a href="#3-åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆRedis-5-0-ï¼Œä¼ä¸šçº§é¦–é€‰ï¼‰" class="headerlink" title="3. åŸºäºStreamçš„æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆRedis 5.0+ï¼Œä¼ä¸šçº§é¦–é€‰ï¼‰"></a>3. åŸºäº<code>Stream</code>çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆRedis 5.0+ï¼Œä¼ä¸šçº§é¦–é€‰ï¼‰</h3><p><code>Stream</code>æ˜¯ Redis ä¸“ä¸ºæ¶ˆæ¯é˜Ÿåˆ—è®¾è®¡çš„ç±»å‹ï¼Œæ”¯æŒ <strong>æŒä¹…åŒ–ã€æ¶ˆè´¹ç»„ã€æ¶ˆæ¯ç¡®è®¤ã€æ¶ˆæ¯å›æº¯</strong> ç­‰ä¼ä¸šçº§ç‰¹æ€§ï¼Œæ˜¯ç”Ÿäº§ç¯å¢ƒçš„é¦–é€‰æ–¹æ¡ˆã€‚</p>
<h6 id="ï¼ˆ1ï¼‰åŸºç¡€ç”Ÿäº§ä¸æ¶ˆè´¹"><a href="#ï¼ˆ1ï¼‰åŸºç¡€ç”Ÿäº§ä¸æ¶ˆè´¹" class="headerlink" title="ï¼ˆ1ï¼‰åŸºç¡€ç”Ÿäº§ä¸æ¶ˆè´¹"></a>ï¼ˆ1ï¼‰åŸºç¡€ç”Ÿäº§ä¸æ¶ˆè´¹</h6><ul>
<li><p>ç”Ÿäº§æ¶ˆæ¯ï¼š<code>XADD key * field1 value1 field2 value2 ...</code>ï¼ˆ<code>*</code>è¡¨ç¤º Redis è‡ªåŠ¨ç”Ÿæˆæ¶ˆæ¯ IDï¼Œæ ¼å¼ä¸º â€œ<strong>æ—¶é—´æˆ³ - é€’å¢æ•°</strong>â€ï¼Œæ¶ˆæ¯ä»¥<code>key-value</code>é”®å€¼å¯¹å½¢å¼å­˜å‚¨ï¼‰ã€‚</p>
<ul>
<li>ç¤ºä¾‹ï¼š<code>XADD users * name jack age 21</code>ï¼ˆå‘<code>users</code>é˜Ÿåˆ—å‘é€æ¶ˆæ¯ï¼Œå†…å®¹ä¸º <code>&#123;name: &quot;jack&quot;, age: 21&#125;</code>ï¼‰ã€‚</li>
</ul>
</li>
<li><p>æ¶ˆè´¹æ¶ˆæ¯ï¼š</p>
<p><code>XREAD COUNT n BLOCK millis STREAMS key ID</code>ï¼ˆ<code>COUNT</code> é™åˆ¶å•æ¬¡è¯»å–æ•°é‡ï¼›<code>BLOCK</code>é…ç½®é˜»å¡æ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰ï¼›<code>ID</code>ä¸ºèµ·å§‹æ¶ˆæ¯ IDï¼Œ<code>0</code>è¡¨ç¤ºä»ç¬¬ä¸€æ¡æ¶ˆæ¯å¼€å§‹è¯»ï¼Œ<code>$</code>è¡¨ç¤ºä»æœ€æ–°æ¶ˆæ¯å¼€å§‹è¯»ï¼‰ã€‚</p>
<ul>
<li>ç¤ºä¾‹ï¼š<code>XREAD COUNT 1 STREAMS users 0</code>ï¼ˆä»<code>users</code>é˜Ÿåˆ—çš„ç¬¬ä¸€æ¡æ¶ˆæ¯å¼€å§‹ï¼Œè¯»å– 1 æ¡æ¶ˆæ¯ï¼‰ï¼›</li>
<li>é˜»å¡æ¶ˆè´¹ç¤ºä¾‹ï¼š<code>XREAD COUNT 1 BLOCK 1000 STREAMS users $</code>ï¼ˆé˜»å¡ 1 ç§’ï¼Œè¯»å–<code>users</code>é˜Ÿåˆ—çš„æœ€æ–°æ¶ˆæ¯ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h6 id="ï¼ˆ2ï¼‰æ¶ˆè´¹ç»„ï¼ˆConsumer-Groupï¼‰ï¼šæ ¸å¿ƒä¼ä¸šçº§ç‰¹æ€§"><a href="#ï¼ˆ2ï¼‰æ¶ˆè´¹ç»„ï¼ˆConsumer-Groupï¼‰ï¼šæ ¸å¿ƒä¼ä¸šçº§ç‰¹æ€§" class="headerlink" title="ï¼ˆ2ï¼‰æ¶ˆè´¹ç»„ï¼ˆConsumer Groupï¼‰ï¼šæ ¸å¿ƒä¼ä¸šçº§ç‰¹æ€§"></a>ï¼ˆ2ï¼‰æ¶ˆè´¹ç»„ï¼ˆConsumer Groupï¼‰ï¼šæ ¸å¿ƒä¼ä¸šçº§ç‰¹æ€§</h6><p>æ¶ˆè´¹ç»„å°†å¤šä¸ªæ¶ˆè´¹è€…åˆ’åˆ†åˆ°ä¸€ä¸ªç»„ä¸­ï¼Œå…±åŒç›‘å¬åŒä¸€ä¸ªé˜Ÿåˆ—ï¼Œå…·å¤‡ <strong>æ¶ˆæ¯åˆ†æµã€è¿›åº¦æ ‡è®°ã€æ¶ˆæ¯ç¡®è®¤</strong> ä¸‰å¤§æ ¸å¿ƒèƒ½åŠ›ï¼š</p>
<ul>
<li><strong>åˆ›å»ºæ¶ˆè´¹ç»„</strong>ï¼š<code>XGROUP CREATE key groupName ID [MKSTREAM]</code>ï¼ˆ<code>ID</code> ä¸ºèµ·å§‹æ¶ˆæ¯ IDï¼Œ<code>$</code> è¡¨ç¤ºä»æœ€æ–°æ¶ˆæ¯å¼€å§‹ï¼Œ<code>0</code> è¡¨ç¤ºä»ç¬¬ä¸€æ¡æ¶ˆæ¯å¼€å§‹ï¼›<code>MKSTREAM</code> è¡¨ç¤ºé˜Ÿåˆ—ä¸å­˜åœ¨æ—¶è‡ªåŠ¨åˆ›å»ºï¼‰ã€‚</li>
<li><strong>ä»æ¶ˆè´¹ç»„æ¶ˆè´¹</strong>ï¼š<code>XREADGROUP GROUP group consumer COUNT n BLOCK millis STREAMS key &gt;</code>ï¼ˆ<code>group</code> ä¸ºæ¶ˆè´¹ç»„åç§°ï¼›<code>consumer</code> ä¸ºæ¶ˆè´¹è€…åç§°ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰ï¼›<code>&gt;</code> è¡¨ç¤ºä» â€œæœªè¢«æ¶ˆè´¹çš„æ¶ˆæ¯â€ å¼€å§‹è¯»å–ï¼‰ã€‚</li>
<li><strong>æ¶ˆæ¯ç¡®è®¤</strong>ï¼š<code>XACK key groupName msgId</code>ï¼ˆæ¶ˆè´¹è€…å¤„ç†å®Œæ¶ˆæ¯åï¼Œéœ€æ‰‹åŠ¨ç¡®è®¤æ¶ˆæ¯ï¼Œç¡®è®¤åæ¶ˆæ¯ä¼šä» <code>pending-list</code>ï¼ˆæœªç¡®è®¤æ¶ˆæ¯åˆ—è¡¨ï¼‰ä¸­ç§»é™¤ï¼Œä¿è¯ â€œæ¶ˆæ¯è‡³å°‘è¢«æ¶ˆè´¹ä¸€æ¬¡â€ï¼‰ã€‚</li>
</ul>
<h6 id="ï¼ˆ3ï¼‰ä¼˜ç¼ºç‚¹"><a href="#ï¼ˆ3ï¼‰ä¼˜ç¼ºç‚¹" class="headerlink" title="ï¼ˆ3ï¼‰ä¼˜ç¼ºç‚¹"></a>ï¼ˆ3ï¼‰ä¼˜ç¼ºç‚¹</h6><ul>
<li>ä¼˜ç‚¹ï¼š<ul>
<li><strong>æ”¯æŒæŒä¹…åŒ–</strong>ï¼ˆæ¶ˆæ¯å­˜å‚¨åœ¨ Redis ä¸­ï¼Œä¾èµ– Redis è‡ªèº«çš„æŒä¹…åŒ–æœºåˆ¶ï¼ˆRDB&#x2F;AOFï¼‰ä¿éšœæ•°æ®å®‰å…¨ï¼‰ï¼›</li>
<li><strong>æ”¯æŒé˜»å¡è¯»å–</strong>ï¼ˆ<code>XREAD/XREADGROUP</code> å‡æ”¯æŒ <code>BLOCK</code> å‚æ•°ï¼Œå®ç°æ¶ˆè´¹è€…é˜»å¡ç­‰å¾…æ¶ˆæ¯ï¼‰ï¼›</li>
<li><strong>æ¶ˆæ¯åˆ†æµ</strong>ï¼ˆæ¶ˆè´¹ç»„å†…å¤šä¸ªæ¶ˆè´¹è€…å¯åˆ†æ‘Šæ¶ˆæ¯ï¼Œæå‡æ•´ä½“å¤„ç†é€Ÿåº¦ï¼‰ï¼›</li>
<li><strong>æ¶ˆæ¯ç¡®è®¤ï¼ˆACKï¼‰</strong>ï¼šé€šè¿‡<code>XACK</code>ä¿è¯æ¶ˆæ¯ â€œè‡³å°‘è¢«æ¶ˆè´¹ä¸€æ¬¡â€ï¼Œé¿å…ä¸¢å¤±ï¼›</li>
<li><strong>æ¶ˆæ¯å›æº¯</strong>ï¼šå¯é€šè¿‡æŒ‡å®š<code>ID</code>é‡æ–°æ¶ˆè´¹å†å²æ¶ˆæ¯ï¼ˆå¦‚å¤„ç†å¤±è´¥åé‡è¯•ï¼‰ã€‚</li>
</ul>
</li>
<li>ç¼ºç‚¹ï¼š<ul>
<li>ä¾èµ– Redis é›†ç¾¤çš„ç¨³å®šæ€§ï¼ˆéœ€ä¿è¯ Redis éƒ¨ç½²é«˜å¯ç”¨ï¼Œå¦åˆ™é˜Ÿåˆ—æœåŠ¡ä¼šå—å½±å“ï¼‰ï¼›</li>
<li>å¤æ‚åœºæ™¯ä¸‹ï¼ˆå¦‚å¤§é‡æ¶ˆè´¹ç»„ã€é«˜æ¶ˆæ¯å †ç§¯ï¼‰éœ€å…³æ³¨ Redis æ€§èƒ½ã€‚</li>
</ul>
</li>
</ul>
<h2 id="ä¸‰ã€ä¸‰ç§å®ç°æ–¹å¼çš„å¯¹æ¯”ä¸é€‚ç”¨åœºæ™¯"><a href="#ä¸‰ã€ä¸‰ç§å®ç°æ–¹å¼çš„å¯¹æ¯”ä¸é€‚ç”¨åœºæ™¯" class="headerlink" title="ä¸‰ã€ä¸‰ç§å®ç°æ–¹å¼çš„å¯¹æ¯”ä¸é€‚ç”¨åœºæ™¯"></a>ä¸‰ã€ä¸‰ç§å®ç°æ–¹å¼çš„å¯¹æ¯”ä¸é€‚ç”¨åœºæ™¯</h2><table>
<thead>
<tr>
<th>å®ç°æ–¹å¼</th>
<th>æ¶ˆæ¯æŒä¹…åŒ–</th>
<th>é˜»å¡è¯»å–</th>
<th>æ¶ˆæ¯ç¡®è®¤</th>
<th>å¤šæ¶ˆè´¹è€…å…±äº«</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td>List</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td>å•æ¶ˆè´¹è€…ã€å¯¹æœ‰åºæ€§è¦æ±‚é«˜çš„è½»é‡åœºæ™¯</td>
</tr>
<tr>
<td>PubSub</td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>ä¸æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>å®æ—¶å¹¿æ’­ï¼ˆå¦‚é€šçŸ¥ï¼‰ã€æ— æŒä¹…åŒ–è¦æ±‚çš„åœºæ™¯</td>
</tr>
<tr>
<td>Stream</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>æ”¯æŒ</td>
<td>ä¼ä¸šçº§æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆç§’æ€ã€è®¢å•å¼‚æ­¥å¤„ç†ç­‰å¼ºå¯é æ€§åœºæ™¯ï¼‰</td>
</tr>
</tbody></table>
<h2 id="å››ã€Streamåœ¨-â€œå¼‚æ­¥ç§’æ€ä¸‹å•â€-ä¸­çš„å®æˆ˜åº”ç”¨"><a href="#å››ã€Streamåœ¨-â€œå¼‚æ­¥ç§’æ€ä¸‹å•â€-ä¸­çš„å®æˆ˜åº”ç”¨" class="headerlink" title="å››ã€Streamåœ¨ â€œå¼‚æ­¥ç§’æ€ä¸‹å•â€ ä¸­çš„å®æˆ˜åº”ç”¨"></a>å››ã€<code>Stream</code>åœ¨ â€œå¼‚æ­¥ç§’æ€ä¸‹å•â€ ä¸­çš„å®æˆ˜åº”ç”¨</h2><p>ç§’æ€åœºæ™¯ä¸­ï¼Œé€šè¿‡<code>Stream</code>å®ç° â€œRedis å‰ç½®æ ¡éªŒ + å¼‚æ­¥ä¸‹å•â€ çš„æ ¸å¿ƒæµç¨‹ï¼š</p>
<ol>
<li><strong>ç”Ÿäº§è€…ï¼ˆç§’æ€æ¥å£ï¼‰</strong>ï¼šé€šè¿‡ Lua è„šæœ¬åŸå­æ€§æ ¡éªŒ â€œåº“å­˜æ˜¯å¦å……è¶³â€â€œæ˜¯å¦ä¸€äººä¸€å•â€ï¼Œæ ¡éªŒé€šè¿‡åï¼Œç”¨<code>XADD</code>å‘<code>stream.orders</code>é˜Ÿåˆ—å‘é€æ¶ˆæ¯ï¼ˆåŒ…å«<code>voucherId</code>ã€<code>userId</code>ã€<code>orderId</code>ç­‰å…³é”®ä¿¡æ¯ï¼‰ã€‚</li>
<li>æ¶ˆè´¹è€…ï¼ˆåå°çº¿ç¨‹ï¼‰ï¼šé¡¹ç›®å¯åŠ¨æ—¶ï¼Œåˆ›å»ºæ¶ˆè´¹ç»„ï¼ˆå¦‚<code>XGROUP CREATE stream.orders g1 0 MKSTREAM</code>ï¼‰ï¼Œå¹¶å¯åŠ¨çº¿ç¨‹å¾ªç¯æ‰§è¡Œï¼š<ul>
<li>é€šè¿‡<code>XREADGROUP</code>é˜»å¡æ¶ˆè´¹<code>stream.orders</code>çš„æ¶ˆæ¯ï¼›</li>
<li>æ‹¿åˆ°æ¶ˆæ¯åï¼Œæ‰§è¡Œ â€œæ‰£å‡æ•°æ®åº“åº“å­˜ã€åˆ›å»ºè®¢å•â€ çš„ä¸šåŠ¡é€»è¾‘ï¼›</li>
<li>ä¸šåŠ¡å®Œæˆåï¼Œé€šè¿‡<code>XACK</code>ç¡®è®¤æ¶ˆæ¯ï¼Œé¿å…é‡å¤æ¶ˆè´¹ã€‚</li>
</ul>
</li>
<li><strong>å¼‚å¸¸å¤„ç†</strong>ï¼šè‹¥æ¶ˆæ¯å¤„ç†å¤±è´¥ï¼Œä¼šæš‚å­˜äº<code>pending-list</code>ï¼ˆæœªç¡®è®¤æ¶ˆæ¯åˆ—è¡¨ï¼‰ï¼Œæ¶ˆè´¹è€…éœ€é€šè¿‡é‡è¯•é€»è¾‘ï¼ˆå¦‚å®šæ—¶è¯»å–<code>pending-list</code>ï¼‰å¤„ç†å¤±è´¥æ¶ˆæ¯ï¼Œä¿è¯ â€œè‡³å°‘æ¶ˆè´¹ä¸€æ¬¡â€ã€‚</li>
</ol>
<h4 id="åŸºäº-Redis-Stream-å®ç°å¼‚æ­¥ç§’æ€ä¸‹å•çš„æ ¸å¿ƒé€»è¾‘æ€»ç»“"><a href="#åŸºäº-Redis-Stream-å®ç°å¼‚æ­¥ç§’æ€ä¸‹å•çš„æ ¸å¿ƒé€»è¾‘æ€»ç»“" class="headerlink" title="åŸºäº Redis Stream å®ç°å¼‚æ­¥ç§’æ€ä¸‹å•çš„æ ¸å¿ƒé€»è¾‘æ€»ç»“"></a>åŸºäº Redis Stream å®ç°å¼‚æ­¥ç§’æ€ä¸‹å•çš„æ ¸å¿ƒé€»è¾‘æ€»ç»“</h4><h5 id="ä¸€ã€éœ€æ±‚ä¸æ ¸å¿ƒæ€è·¯"><a href="#ä¸€ã€éœ€æ±‚ä¸æ ¸å¿ƒæ€è·¯" class="headerlink" title="ä¸€ã€éœ€æ±‚ä¸æ ¸å¿ƒæ€è·¯"></a>ä¸€ã€éœ€æ±‚ä¸æ ¸å¿ƒæ€è·¯</h5><p>é€šè¿‡ <strong>Redis Stream</strong> ä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå°† â€œç§’æ€èµ„æ ¼æ ¡éªŒâ€ ä¸ â€œè®¢å•åˆ›å»ºï¼ˆæ‰£åº“å­˜ã€å†™è®¢å•ï¼‰â€ è§£è€¦ï¼š</p>
<ul>
<li>ç§’æ€æ¥å£ï¼ˆç”Ÿäº§è€…ï¼‰ï¼šæ ¡éªŒé€šè¿‡åï¼Œå‘ Stream å‘é€ â€œå¾…ä¸‹å•â€ æ¶ˆæ¯ï¼›</li>
<li>åå°çº¿ç¨‹ï¼ˆæ¶ˆè´¹è€…ï¼‰ï¼šæŒç»­ä» Stream è¯»å–æ¶ˆæ¯ï¼Œå¼‚æ­¥æ‰§è¡Œä¸‹å•é€»è¾‘ï¼›</li>
<li>åˆ©ç”¨ Stream çš„<strong>æ¶ˆè´¹ç»„ã€æ¶ˆæ¯ç¡®è®¤ã€Pending-List</strong> ä¿è¯æ¶ˆæ¯å¯é æ¶ˆè´¹ã€‚</li>
</ul>
<h5 id="äºŒã€å…³é”®æ­¥éª¤ä¸ä»£ç è§£æ"><a href="#äºŒã€å…³é”®æ­¥éª¤ä¸ä»£ç è§£æ" class="headerlink" title="äºŒã€å…³é”®æ­¥éª¤ä¸ä»£ç è§£æ"></a>äºŒã€å…³é”®æ­¥éª¤ä¸ä»£ç è§£æ</h5><h6 id="1-Lua-è„šæœ¬ï¼šæ ¡éªŒé€šè¿‡åå‘é€æ¶ˆæ¯åˆ°-Stream"><a href="#1-Lua-è„šæœ¬ï¼šæ ¡éªŒé€šè¿‡åå‘é€æ¶ˆæ¯åˆ°-Stream" class="headerlink" title="1.Lua è„šæœ¬ï¼šæ ¡éªŒé€šè¿‡åå‘é€æ¶ˆæ¯åˆ° Stream"></a>1.Lua è„šæœ¬ï¼šæ ¡éªŒé€šè¿‡åå‘é€æ¶ˆæ¯åˆ° Stream</h6><p>åœ¨åŸç§’æ€æ ¡éªŒ Lua è„šæœ¬ä¸­ï¼Œæ–°å¢ â€œå‘é€æ¶ˆæ¯åˆ° Streamâ€ çš„é€»è¾‘ï¼š</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 3.6 å‘é€æ¶ˆæ¯åˆ°Streamé˜Ÿåˆ—ï¼ˆstream.ordersï¼‰</span></span><br><span class="line">redis.call(<span class="string">&#x27;xadd&#x27;</span>, <span class="string">&#x27;stream.orders&#x27;</span>, <span class="string">&#x27;*&#x27;</span>, <span class="string">&#x27;userId&#x27;</span>, userId, <span class="string">&#x27;voucherId&#x27;</span>, voucherId, <span class="string">&#x27;id&#x27;</span>, orderId)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>xadd stream.orders * ...</code>ï¼šå‘<code>stream.orders</code>æ·»åŠ æ¶ˆæ¯ï¼Œ<code>*</code> è¡¨ç¤ºç”± Redis è‡ªåŠ¨ç”Ÿæˆ<strong>å”¯ä¸€æ¶ˆæ¯ ID</strong>ï¼ˆæ ¼å¼ï¼š<code>æ—¶é—´æˆ³-é€’å¢åºå·</code>ï¼‰ï¼›</li>
<li>æ¶ˆæ¯å†…å®¹åŒ…å« <code>userId</code>ï¼ˆç”¨æˆ· IDï¼‰ã€<code>voucherId</code>ï¼ˆä¼˜æƒ åˆ¸ IDï¼‰ã€<code>orderId</code>ï¼ˆè®¢å• IDï¼‰ï¼Œä¸ºåç»­ä¸‹å•æä¾›å‚æ•°ã€‚</li>
</ul>
<h6 id="2-æ¶ˆè´¹è€…çº¿ç¨‹ï¼šæŒç»­è¯»å–å¹¶å¤„ç†-Stream-æ¶ˆæ¯"><a href="#2-æ¶ˆè´¹è€…çº¿ç¨‹ï¼šæŒç»­è¯»å–å¹¶å¤„ç†-Stream-æ¶ˆæ¯" class="headerlink" title="2. æ¶ˆè´¹è€…çº¿ç¨‹ï¼šæŒç»­è¯»å–å¹¶å¤„ç† Stream æ¶ˆæ¯"></a>2. æ¶ˆè´¹è€…çº¿ç¨‹ï¼šæŒç»­è¯»å–å¹¶å¤„ç† Stream æ¶ˆæ¯</h6><p>é€šè¿‡å†…éƒ¨ç±» <code>VoucherOrderHandler</code> å®ç°<code>Runnable</code>ï¼Œåå°çº¿ç¨‹å¾ªç¯æ¶ˆè´¹ Stream æ¶ˆæ¯ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">VoucherOrderHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 1.è·å–æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„è®¢å•ä¿¡æ¯ XREADGROUP GROUP g1 c1 COUNT 1 BLOCK 2000 STREAMS s1 &gt;</span></span><br><span class="line">                List&lt;MapRecord&lt;String, Object, Object&gt;&gt; list = stringRedisTemplate.opsForStream().read(</span><br><span class="line">                    Consumer.from(<span class="string">&quot;g1&quot;</span>, <span class="string">&quot;c1&quot;</span>),</span><br><span class="line">                    StreamReadOptions.empty().count(<span class="number">1</span>).block(Duration.ofSeconds(<span class="number">2</span>)),</span><br><span class="line">                    StreamOffset.create(<span class="string">&quot;stream.orders&quot;</span>, ReadOffset.lastConsumed())</span><br><span class="line">                );</span><br><span class="line">                <span class="comment">// 2.åˆ¤æ–­è®¢å•ä¿¡æ¯æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">                <span class="keyword">if</span> (list == <span class="literal">null</span> || list.isEmpty()) &#123;</span><br><span class="line">                    <span class="comment">// å¦‚æœä¸ºnullï¼Œè¯´æ˜æ²¡æœ‰æ¶ˆæ¯ï¼Œç»§ç»­ä¸‹ä¸€æ¬¡å¾ªç¯</span></span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// è§£ææ•°æ®</span></span><br><span class="line">                MapRecord&lt;String, Object, Object&gt; record = list.get(<span class="number">0</span>);</span><br><span class="line">                Map&lt;Object, Object&gt; value = record.getValue();</span><br><span class="line">                <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(value, <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>(), <span class="literal">true</span>);</span><br><span class="line">                <span class="comment">// 3.åˆ›å»ºè®¢å•</span></span><br><span class="line">                createVoucherOrder(voucherOrder);</span><br><span class="line">                <span class="comment">// 4.ç¡®è®¤æ¶ˆæ¯ XACK</span></span><br><span class="line">                stringRedisTemplate.opsForStream().acknowledge(<span class="string">&quot;s1&quot;</span>, <span class="string">&quot;g1&quot;</span>, record.getId());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;å¤„ç†è®¢å•å¼‚å¸¸&quot;</span>, e);</span><br><span class="line">                <span class="comment">//å¤„ç†å¼‚å¸¸æ¶ˆæ¯</span></span><br><span class="line">                handlePendingList();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handlePendingList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 1.è·å–pending-listä¸­çš„è®¢å•ä¿¡æ¯ XREADGROUP GROUP g1 c1 COUNT 1 BLOCK 2000 STREAMS s1 0</span></span><br><span class="line">                List&lt;MapRecord&lt;String, Object, Object&gt;&gt; list = stringRedisTemplate.opsForStream().read(</span><br><span class="line">                    Consumer.from(<span class="string">&quot;g1&quot;</span>, <span class="string">&quot;c1&quot;</span>),</span><br><span class="line">                    StreamReadOptions.empty().count(<span class="number">1</span>),</span><br><span class="line">                    StreamOffset.create(<span class="string">&quot;stream.orders&quot;</span>, ReadOffset.from(<span class="string">&quot;0&quot;</span>))</span><br><span class="line">                );</span><br><span class="line">                <span class="comment">// 2.åˆ¤æ–­è®¢å•ä¿¡æ¯æ˜¯å¦ä¸ºç©º</span></span><br><span class="line">                <span class="keyword">if</span> (list == <span class="literal">null</span> || list.isEmpty()) &#123;</span><br><span class="line">                    <span class="comment">// å¦‚æœä¸ºnullï¼Œè¯´æ˜æ²¡æœ‰å¼‚å¸¸æ¶ˆæ¯ï¼Œç»“æŸå¾ªç¯</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// è§£ææ•°æ®</span></span><br><span class="line">                MapRecord&lt;String, Object, Object&gt; record = list.get(<span class="number">0</span>);</span><br><span class="line">                Map&lt;Object, Object&gt; value = record.getValue();</span><br><span class="line">                <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(value, <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>(), <span class="literal">true</span>);</span><br><span class="line">                <span class="comment">// 3.åˆ›å»ºè®¢å•</span></span><br><span class="line">                createVoucherOrder(voucherOrder);</span><br><span class="line">                <span class="comment">// 4.ç¡®è®¤æ¶ˆæ¯ XACK</span></span><br><span class="line">                stringRedisTemplate.opsForStream().acknowledge(<span class="string">&quot;s1&quot;</span>, <span class="string">&quot;g1&quot;</span>, record.getId());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                log.error(<span class="string">&quot;å¤„ç†penddingè®¢å•å¼‚å¸¸&quot;</span>, e);</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    Thread.sleep(<span class="number">20</span>);</span><br><span class="line">                &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>å…³é”®ç»†èŠ‚</strong>ï¼š</p>
<ul>
<li><strong>æ¶ˆè´¹ç»„ï¼ˆConsumer Groupï¼‰</strong>ï¼š<code>Consumer.from(&quot;g1&quot;, &quot;c1&quot;)</code> è¡¨ç¤º â€œæ¶ˆè´¹ç»„ g1 ä¸­çš„æ¶ˆè´¹è€… c1â€ï¼Œå¤šä¸ªæ¶ˆè´¹è€…å¯åŠ å…¥åŒä¸€ç»„ï¼Œåˆ†æ‘Šæ¶ˆæ¯å¤„ç†å‹åŠ›ï¼›</li>
<li><strong>é˜»å¡è¯»å–</strong>ï¼š<code>block(Duration.ofSeconds(2))</code> é¿å…æ— æ¶ˆæ¯æ—¶çš„ â€œç©ºè½®è¯¢â€ï¼Œé™ä½èµ„æºæ¶ˆè€—ï¼›</li>
<li><strong>æ¶ˆæ¯ä½ç½®</strong>ï¼š<code>ReadOffset.lastConsumed()</code> è¡¨ç¤º â€œä»ä¸Šæ¬¡æ¶ˆè´¹çš„æœ€åä½ç½®ç»§ç»­è¯»â€ï¼Œä¿è¯æ¶ˆæ¯ä¸é‡å¤ã€ä¸é—æ¼ï¼›</li>
<li><strong>æ¶ˆæ¯ç¡®è®¤ï¼ˆACKï¼‰</strong>ï¼š<code>acknowledge(...)</code> é€šçŸ¥ Redis â€œæ¶ˆæ¯å·²å¤„ç†å®Œæˆâ€ï¼Œå¦åˆ™æ¶ˆæ¯ä¼šç•™åœ¨<strong>Pending-List</strong>ï¼ˆæœªç¡®è®¤æ¶ˆæ¯åˆ—è¡¨ï¼‰ä¸­ï¼Œä¾›åç»­é‡è¯•ã€‚</li>
</ul>
<h6 id="3-å¼‚å¸¸å¤„ç†ï¼šPending-List-é‡è¯•æœºåˆ¶"><a href="#3-å¼‚å¸¸å¤„ç†ï¼šPending-List-é‡è¯•æœºåˆ¶" class="headerlink" title="3. å¼‚å¸¸å¤„ç†ï¼šPending-List é‡è¯•æœºåˆ¶"></a>3. å¼‚å¸¸å¤„ç†ï¼šPending-List é‡è¯•æœºåˆ¶</h6><p>å½“æ¶ˆæ¯å¤„ç†è¿‡ç¨‹ä¸­æŠ¥é”™ï¼ˆå¦‚æœåŠ¡å®•æœºã€æ•°æ®åº“å¼‚å¸¸ï¼‰ï¼Œæ¶ˆæ¯ä¼šæš‚å­˜äº<code>Pending-List</code>ï¼Œéœ€é€šè¿‡é‡è¯•ä¿è¯ â€œè‡³å°‘æ¶ˆè´¹ä¸€æ¬¡â€ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">handlePendingList</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1. ä»Pending-Listè¯»å–æœªç¡®è®¤æ¶ˆæ¯ï¼ˆä»ID=0å¼€å§‹ï¼Œè¯»å–æ‰€æœ‰æœªç¡®è®¤æ¶ˆæ¯ï¼‰</span></span><br><span class="line">            List&lt;MapRecord&lt;String, Object, Object&gt;&gt; list = stringRedisTemplate.opsForStream().read(</span><br><span class="line">                Consumer.from(<span class="string">&quot;g1&quot;</span>, <span class="string">&quot;c1&quot;</span>),</span><br><span class="line">                StreamReadOptions.empty().count(<span class="number">1</span>),</span><br><span class="line">                StreamOffset.create(<span class="string">&quot;stream.orders&quot;</span>, ReadOffset.from(<span class="string">&quot;0&quot;</span>))</span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 2. æ— å¼‚å¸¸æ¶ˆæ¯åˆ™é€€å‡ºå¾ªç¯</span></span><br><span class="line">            <span class="keyword">if</span> (list == <span class="literal">null</span> || list.isEmpty()) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 3. è§£æå¹¶é‡æ–°å¤„ç†æ¶ˆæ¯ï¼ˆåŒæ­£å¸¸æ¶ˆè´¹é€»è¾‘ï¼‰</span></span><br><span class="line">            MapRecord&lt;String, Object, Object&gt; record = list.get(<span class="number">0</span>);</span><br><span class="line">            Map&lt;Object, Object&gt; value = record.getValue();</span><br><span class="line">            <span class="type">VoucherOrder</span> <span class="variable">voucherOrder</span> <span class="operator">=</span> BeanUtil.fillBeanWithMap(value, <span class="keyword">new</span> <span class="title class_">VoucherOrder</span>(), <span class="literal">true</span>);</span><br><span class="line">            <span class="comment">//åˆ›å»ºè®¢å•</span></span><br><span class="line">            createVoucherOrder(voucherOrder);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4. ç¡®è®¤æ¶ˆæ¯ XACKï¼ˆä»Pending-Listç§»é™¤ï¼‰</span></span><br><span class="line">            stringRedisTemplate.opsForStream().acknowledge(<span class="string">&quot;stream.orders&quot;</span>, <span class="string">&quot;g1&quot;</span>, record.getId());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;å¤„ç†Pendingè®¢å•å¼‚å¸¸&quot;</span>, e);</span><br><span class="line">            <span class="keyword">try</span>&#123;</span><br><span class="line">            	Thread.sleep(<span class="number">20</span>); <span class="comment">// é‡è¯•é—´éš”ï¼Œé¿å…é¢‘ç¹å¤±è´¥</span></span><br><span class="line">            &#125;<span class="keyword">catch</span>(Exception e)&#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>æ ¸å¿ƒä½œç”¨</strong>ï¼š</p>
<ul>
<li><code>ReadOffset.from(&quot;0&quot;)</code>ï¼šè¡¨ç¤º â€œä» Pending-List çš„ç¬¬ä¸€æ¡æ¶ˆæ¯å¼€å§‹è¯»å–â€ï¼Œç¡®ä¿æ‰€æœ‰æœªç¡®è®¤çš„æ¶ˆæ¯éƒ½èƒ½è¢«é‡è¯•ï¼›</li>
<li><code>Thread.sleep(20)</code>ï¼šå¼‚å¸¸æ—¶çŸ­æš‚ä¼‘çœ ï¼Œé¿å… â€œå¤±è´¥ - ç«‹å³é‡è¯• - å†å¤±è´¥â€ çš„æ­»å¾ªç¯ï¼Œå‡è½»ç³»ç»Ÿå‹åŠ›ã€‚</li>
</ul>
<h5 id="ä¸‰ã€Redis-Stream-çš„æ ¸å¿ƒç‰¹æ€§ä¸ä»·å€¼"><a href="#ä¸‰ã€Redis-Stream-çš„æ ¸å¿ƒç‰¹æ€§ä¸ä»·å€¼" class="headerlink" title="ä¸‰ã€Redis Stream çš„æ ¸å¿ƒç‰¹æ€§ä¸ä»·å€¼"></a>ä¸‰ã€Redis Stream çš„æ ¸å¿ƒç‰¹æ€§ä¸ä»·å€¼</h5><ol>
<li><strong>æ¶ˆè´¹ç»„ï¼ˆConsumer Groupï¼‰</strong>ï¼š<ul>
<li>å¤šæ¶ˆè´¹è€…å¯åŠ å…¥åŒä¸€ç»„ï¼Œ<strong>åˆ†æ‘Šæ¶ˆæ¯å¤„ç†å‹åŠ›</strong>ï¼Œæå‡æ•´ä½“æ¶ˆè´¹é€Ÿåº¦ï¼›</li>
<li>æ¶ˆè´¹ç»„ä¼šè®°å½•æ¯ä¸ªæ¶ˆè´¹è€…çš„ â€œæ¶ˆè´¹è¿›åº¦â€ï¼Œé¿å…åŒä¸€æ¡æ¶ˆæ¯è¢«å¤šä¸ªæ¶ˆè´¹è€…é‡å¤æ¶ˆè´¹ã€‚</li>
</ul>
</li>
<li><strong>æ¶ˆæ¯ç¡®è®¤ï¼ˆACKï¼‰ä¸ Pending-List</strong>ï¼š<ul>
<li>æ¶ˆæ¯è¢«è¯»å–åï¼Œéœ€æ‰‹åŠ¨è°ƒç”¨<code>XACK</code>ç¡®è®¤ï¼Œå¦åˆ™ä¼šæš‚å­˜äº<code>Pending-List</code>ï¼›</li>
<li>ä¿è¯ â€œæ¶ˆæ¯å¤„ç†å¤±è´¥æ—¶å¯é‡è¯•â€ï¼Œé¿å…è®¢å•ä¸¢å¤±ï¼Œå®ç° <strong>â€œè‡³å°‘ä¸€æ¬¡æ¶ˆè´¹â€</strong> çš„å¯é æ€§ã€‚</li>
</ul>
</li>
<li><strong>å¼‚æ­¥è§£è€¦</strong>ï¼š<ul>
<li>ç§’æ€æ¥å£åªéœ€ â€œå‘æ¶ˆæ¯â€ï¼Œæ— éœ€ç­‰å¾…è®¢å•åˆ›å»ºå®Œæˆï¼Œ<strong>å“åº”é€Ÿåº¦æå‡æ•°å€</strong>ï¼›</li>
<li>ä¸‹å•é€»è¾‘ç”±åå°çº¿ç¨‹å¼‚æ­¥æ‰§è¡Œï¼Œä¸å ç”¨ Tomcat è¯·æ±‚çº¿ç¨‹ï¼Œç³»ç»Ÿå¹¶å‘èƒ½åŠ›å¤§å¹…å¢å¼ºã€‚</li>
</ul>
</li>
</ol>
<h5 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="headerlink" title="å››ã€æ€»ç»“"></a>å››ã€æ€»ç»“</h5><p>åŸºäº Redis Stream çš„å¼‚æ­¥ç§’æ€ä¸‹å•ï¼Œé€šè¿‡ <strong>â€œæ¶ˆè´¹ç»„åˆ†æµ + æ¶ˆæ¯ç¡®è®¤ + Pending-List é‡è¯•â€</strong>ï¼Œå®Œç¾è§£å†³äº† â€œé«˜å¹¶å‘å“åº”â€ ä¸ â€œè®¢å•å¯é æ€§â€ çš„çŸ›ç›¾ï¼š</p>
<ul>
<li>ç§’æ€æ¥å£å“åº”æ›´å¿«ï¼ˆå¼‚æ­¥è§£è€¦ï¼‰ï¼›</li>
<li>è®¢å•åˆ›å»ºæ›´å¯é ï¼ˆæ¶ˆæ¯ä¸ä¸¢å¤±ã€å¤±è´¥å¯é‡è¯•ï¼‰ï¼›</li>
<li>ç³»ç»Ÿæ›´ç¨³å®šï¼ˆè¯·æ±‚çº¿ç¨‹ä¸ä¸šåŠ¡çº¿ç¨‹åˆ†ç¦»ï¼Œèµ„æºå ç”¨æ›´åˆç†ï¼‰ã€‚</li>
</ul>
<p>ç›¸æ¯” Redis Listã€PubSubï¼ŒStream æä¾›äº†æ›´<strong>ä¼ä¸šçº§çš„æ¶ˆæ¯é˜Ÿåˆ—èƒ½åŠ›</strong>ï¼Œæ˜¯ç§’æ€ã€è®¢å•å¼‚æ­¥å¤„ç†ç­‰æ ¸å¿ƒåœºæ™¯çš„ä¼˜é€‰æ–¹æ¡ˆã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>Redis æä¾›äº†ä» â€œè½»é‡ç®€å•â€ åˆ° â€œä¼ä¸šçº§å¯é â€ çš„æ¶ˆæ¯é˜Ÿåˆ—æ–¹æ¡ˆï¼š</p>
<ul>
<li><code>List</code>é€‚åˆ<strong>å•æ¶ˆè´¹è€…ã€æœ‰åºæ€§è¦æ±‚é«˜</strong>çš„è½»é‡åœºæ™¯ï¼›</li>
<li><code>PubSub</code>é€‚åˆ<strong>å®æ—¶å¹¿æ’­ã€æ— æŒä¹…åŒ–è¦æ±‚</strong>çš„åœºæ™¯ï¼›</li>
<li><code>Stream</code>æ˜¯<strong>ç”Ÿäº§çº§æ¶ˆæ¯é˜Ÿåˆ—çš„é¦–é€‰</strong>ï¼Œå°¤å…¶åœ¨ç§’æ€ã€è®¢å•å¼‚æ­¥å¤„ç†ç­‰å¯¹ â€œå¯é æ€§ã€å¯è¿½æº¯ã€å¤šæ¶ˆè´¹è€…ååŒâ€ æœ‰è¦æ±‚çš„åœºæ™¯ä¸­ï¼Œèƒ½æœ‰æ•ˆè§£è€¦ç³»ç»Ÿå¹¶ä¿è¯æ¶ˆæ¯ä¸€è‡´æ€§ã€‚</li>
</ul>
</div>

    
    <section class="post-copyright">
      
      <p class="copyright-item">
        <span>ä½œè€…:</span>
        <span>è€æ±Ÿæ¹–</span>
      </p>
        
      <p class="copyright-item">
        <span>è®¸å¯è¯:</span>
        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
      </p>
       
      <p class="copyright-item">
        <span>å£å·:</span>
        <span><strong>ä»£ç æ˜¯å¼€æºçš„,æˆ‘ä»¬åªæ˜¯å®ƒçš„æ¬è¿å·¥ã€‚</strong></span>
      </p>
       
        <p class="copyright-item">
        <span>å¦‚æœè§‰å¾—æˆ‘çš„æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè¯·éšæ„è½¬è½½ï¼Œæ„Ÿè°¢æ”¯æŒï¼</span>
      </p>
      
             
        <p class="copyright-item">
        <span>å¦‚æœ‰ä¾µæƒè¯·å‘ŠçŸ¥åˆ é™¤ğŸ™</span>
      </p>
             
        <p class="copyright-item">
        <span>å¦‚æœä½ æœ‰å¾ˆå¥½çš„æƒ³æ³•ğŸ’¡ï¼Œè¯·åŠ¡å¿…è”ç³»æˆ‘ã€‚ </span>
        <br>
         <span>2292360909@qq.com</span>
      </p>
    </section>
    
    <section class="post-tags">
      <div>
        <span>æ ‡ç­¾:</span>
        <span class="tag">
          
        </span>
      </div>
      <div>
        <a href="javascript:window.history.back();">è¿”å›</a>
        <span>Â· </span>
        <a href="/">é¦–é¡µ</a>
      </div>
    </section>
    <section class="post-nav">
      
      <a class="prev" rel="prev" href="/2025/10/12/%E9%BB%91%E9%A9%AC%E7%82%B9%E8%AF%84/07-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81-redission/"
        >07-åˆ†å¸ƒå¼é”-redission</a
      >
       
      <a class="next" rel="next" href="/2025/10/12/%E9%BB%91%E9%A9%AC%E7%82%B9%E8%AF%84/11-%E5%A5%BD%E5%8F%8B%E5%85%B3%E6%B3%A8/"
        >11-å¥½å‹å…³æ³¨</a
      >
      
    </section>

    <!-- Giscus è¯„è®ºåŒºæŒ‚è½½ç‚¹ -->
<div id="giscus-container" style="margin-top: 2.5rem;"></div>

<!-- Giscus åŠ¨æ€åŠ è½½è„šæœ¬ï¼šåˆå§‹åŠ è½½ + æ˜æš—ä¸»é¢˜åˆ‡æ¢ -->
<script>
  function createGiscus(theme) {
    const giscusContainer = document.getElementById('giscus-container');
    if (!giscusContainer) return;

    // æ¸…é™¤æ—§çš„è¯„è®º iframe
    giscusContainer.innerHTML = '';

    const script = document.createElement('script');
    script.src = 'https://giscus.app/client.js';

    // æ›¿æ¢ä¸ºä½ çš„ GitHub ä»“åº“ä¿¡æ¯ï¼ˆæ ¼å¼ï¼šusername/repoï¼‰
    script.setAttribute('data-repo', 'meisijiya/meisijiya.github.io');

   // æ›¿æ¢ä¸ºä½ çš„ repo-id å’Œ category-idï¼ˆåœ¨ giscus.app é…ç½®é¡µé¢ç”Ÿæˆï¼‰
    script.setAttribute('data-repo-id', 'R_kgDOPwTrpQ');
    script.setAttribute('data-category', 'Announcements');
    script.setAttribute('data-category-id', 'DIC_kwDOPwTrpc4CviGR');

    // å…¶ä»–å¸¸è§„æ¨èè®¾ç½®
    script.setAttribute('data-mapping', 'pathname');           // ç”¨é¡µé¢è·¯å¾„åŒ¹é…è¯„è®ºå¸–
    script.setAttribute('data-strict', '0');                   // è‹¥æ— åŒ¹é…å¸–åˆ™åˆ›å»ºæ–°å¸–
    script.setAttribute('data-reactions-enabled', '1');        // å¯ç”¨è¡¨æƒ…ååº”
    script.setAttribute('data-emit-metadata', '0');            // ä¸è¾“å‡ºå…ƒæ•°æ®
    script.setAttribute('data-input-position', 'top');         // è¾“å…¥æ¡†åœ¨è¯„è®ºä¸Šæ–¹
    script.setAttribute('data-theme', theme);                
    script.setAttribute('data-lang', 'zh-CN');                 // ä¸­æ–‡ç•Œé¢
    script.setAttribute('crossorigin', 'anonymous');           // è·¨åŸŸèµ„æºå®‰å…¨
    script.async = true;                                       
     
    giscusContainer.appendChild(script);
  }

  function getCurrentTheme() {
    return document.body.classList.contains('dark-theme') ? 'dark' : 'light';
  }

  document.addEventListener('DOMContentLoaded', () => {
    // é¡µé¢é¦–æ¬¡åŠ è½½ï¼Œæ ¹æ®å½“å‰ä¸»é¢˜æŒ‚è½½è¯„è®º
    createGiscus(getCurrentTheme());

    // ç›‘å¬æŒ‰é’®ç‚¹å‡»åˆ‡æ¢ä¸»é¢˜ â†’ é‡è½½è¯„è®ºåŒº
    const buttons = [
      document.querySelector('.toggleBtn'),
      document.getElementById('mobile-toggle-theme')
    ];
    buttons.forEach(btn => {
      if (!btn) return;
      btn.addEventListener('click', () => {
        setTimeout(() => {
          createGiscus(getCurrentTheme());
        }, 400); // ç¨ä½œå»¶è¿Ÿï¼Œç¡®ä¿ class åˆ‡æ¢å®Œæ¯•
      });
    });

    // ç›‘å¬ body class æ”¹å˜ï¼ˆä¿é™©æ–¹æ¡ˆï¼‰
    const observer = new MutationObserver(() => {
      createGiscus(getCurrentTheme());
    });
    observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });
  });
</script>

  </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© è€æ±Ÿæ¹– | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>
<script src="/js/code-copy.js"></script>


    </div>
</body>
<!-- umami -->
<script defer src="https://cloud.umami.is/script.js" data-website-id="91b923f2-ff2d-43d0-ba5f-bc348d82426a"></script>
</html>