<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="è€æ±Ÿæ¹–">


    <meta name="subtitle" content="è®°å½•è¿›å…¥æˆ¿é—´é—¨åçš„ç¾å¥½">


    <meta name="description" content="ä¸€å¹´å‰ï¼Œå­¤è‹¦ä¼¶ä»ƒçš„è€æ±Ÿæ¹–ï¼Œå¶ç„¶é—´å‘ç°ä¸€å¤„æˆ¿é—´é—¨ï¼Œæ¨é—¨è€Œå…¥ï¼Œä»æ­¤è¿›å…¥äº†å……æ»¡å¹¸ç¦çš„ä¸–ç•Œã€‚">


    <meta name="keywords" content="è€æ±Ÿæ¹–,åšå®¢,æˆ¿é—´é—¨">


<title>11-å¥½å‹å…³æ³¨ | æ¬¢è¿æ¥åˆ°è€æ±Ÿæ¹–çš„åšå®¢</title>



    <link rel="icon" href="/images/%E9%87%91%E6%AF%9B.png?_t=1758006391547">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    
    <link rel="stylesheet" href="/css/search.css">
    

<!-- highlight.js æ ·å¼ï¼ˆé»˜è®¤äº®è‰²ï¼‰ -->
<link id="hljs-theme" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/github.css">
<!-- highlight.js è‡ªåŠ¨ä¸Šè‰²åŠŸèƒ½ -->
<script src="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/lib/highlight.min.js"></script>
<script>hljs.highlightAll();</script>

<link rel="stylesheet" href="/css/custom.css">



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 7.3.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const pagebody = document.getElementsByTagName('body')[0]

            function setTheme(status) {

                if (status === 'dark') {
                    window.sessionStorage.theme = 'dark'
                    pagebody.classList.add('dark-theme');

                } else if (status === 'light') {
                    window.sessionStorage.theme = 'light'
                    pagebody.classList.remove('dark-theme');
                }
            };

            setTheme(window.sessionStorage.theme)
        })();
    </script>

    <div class="wrapper">
        <header>
  <nav class="navbar">
    <div class="container">
      <div class="navbar-header header-logo">
        <a href="/">è€æ±Ÿæ¹–çš„åšå®¢</a>
      </div>
      <div class="menu navbar-right">
        <!-- åœ¨ç”µè„‘ç«¯çš„å¯¼èˆªé“¾æ¥åŒºåŸŸæ·»åŠ æœç´¢åŠŸèƒ½ -->
        <div class="search-container">
          <a href="javascript:;" onclick="toggleSearchInput()">ğŸ”</a>
          <input
            type="text"
            id="nav-search-input-desktop"
            class="nav-search-input"
            placeholder="æƒ³çŸ¥é“æˆ‘ä»€ä¹ˆç§˜å¯†å‘¢ï¼Œæœæœçœ‹å§"
            oninput="navSearch(this)"
          />
          <div id="nav-search-result-desktop" class="nav-search-result"></div>
        </div>

        
        <a class="menu-item" href="/archives">å½’æ¡£</a>
        
        <a class="menu-item" href="/category">åˆ†ç±»</a>
        
        <a class="menu-item" href="/tag">æ ‡ç­¾</a>
        
        <a class="menu-item" href="/Timer">ä»»åŠ¡è®¡æ—¶å™¨</a>
        
        <a class="menu-item" href="/timeLine">æ—¶é—´çº¿</a>
        
        <a class="menu-item" href="/tongji">ç½‘ç«™ç»Ÿè®¡</a>
        
        <a class="menu-item" href="/about">å…³äº</a>
        

        <input id="switch_default" type="checkbox" class="switch_default" />
        <label for="switch_default" class="toggleBtn"></label>
      </div>
    </div>
  </nav>

  
  <nav class="navbar-mobile" id="nav-mobile">
    <div class="container">
      <div class="navbar-header">
        <div>
          <a href="/">è€æ±Ÿæ¹–çš„åšå®¢</a
          ><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
        </div>

        <div class="menu-toggle" onclick="mobileBtn()">
          <svg
            class="menu-icon"
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
          >
            <path
              fill="currentColor"
              d="M4.5 17.27q-.213 0-.356-.145T4 16.768t.144-.356t.356-.143h15q.213 0 .356.144q.144.144.144.357t-.144.356t-.356.143zm0-4.77q-.213 0-.356-.144T4 11.999t.144-.356t.356-.143h15q.213 0 .356.144t.144.357t-.144.356t-.356.143zm0-4.77q-.213 0-.356-.143Q4 7.443 4 7.23t.144-.356t.356-.143h15q.213 0 .356.144T20 7.23t-.144.356t-.356.144z"
            />
          </svg>
          <svg
            class="close-icon"
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
          >
            <!-- Icon from Material Symbols Light by Google - https://github.com/google/material-design-icons/blob/master/LICENSE -->
            <path
              fill="currentColor"
              d="m12 12.708l-5.246 5.246q-.14.14-.344.15t-.364-.15t-.16-.354t.16-.354L11.292 12L6.046 6.754q-.14-.14-.15-.344t.15-.364t.354-.16t.354.16L12 11.292l5.246-5.246q.14-.14.345-.15q.203-.01.363.15t.16.354t-.16.354L12.708 12l5.246 5.246q.14.14.15.345q.01.203-.15.363t-.354.16t-.354-.16z"
            />
          </svg>
        </div>
      </div>

      <div class="menu" id="mobile-menu">
        
        <a class="menu-item" href="/archives">å½’æ¡£</a>
        
        <a class="menu-item" href="/category">åˆ†ç±»</a>
        
        <a class="menu-item" href="/tag">æ ‡ç­¾</a>
        
        <a class="menu-item" href="/Timer">ä»»åŠ¡è®¡æ—¶å™¨</a>
        
        <a class="menu-item" href="/timeLine">æ—¶é—´çº¿</a>
        
        <a class="menu-item" href="/tongji">ç½‘ç«™ç»Ÿè®¡</a>
        
        <a class="menu-item" href="/about">å…³äº</a>
        
        <!-- æ‰‹æœºæ¨¡å¼æœç´¢æ¡† -->
        <div class="search-container mobile-container">
          <a class="menu-item" href="javascript:;" onclick="toggleSearchInput()"
            >ğŸ”</a
          >
          <input
            type="text"
            id="nav-search-input-mobile"
            class="nav-search-input"
            placeholder="æƒ³çŸ¥é“æˆ‘ä»€ä¹ˆç§˜å¯†å‘¢ï¼Œæœæœçœ‹å§"
            oninput="navSearch(this)"
          />
          <div id="nav-search-result-mobile" class="nav-search-result"></div>
        </div>
      </div>
    </div>
  </nav>
</header>
<script>
  var mobileBtn = function f() {
    var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
    var mobileMenu = document.getElementById("mobile-menu");
    if (toggleMenu.classList.contains("active")) {
      toggleMenu.classList.remove("active");
      mobileMenu.classList.remove("active");
    } else {
      toggleMenu.classList.add("active");
      mobileMenu.classList.add("active");
    }
  };

  function toggleSearchInput() {
    const inputs = document.querySelectorAll(".nav-search-input");
    const results = document.querySelectorAll(".nav-search-result");
    inputs.forEach((input) => {
      input.classList.toggle("active");
      if (input.classList.contains("active")) input.focus();
    });
    results.forEach((r) => (r.style.display = "none"));
  }

  // ç‚¹å‡»å¤–éƒ¨åŒºåŸŸéšè—æœç´¢æ¡†å’Œç»“æœå®¹å™¨çš„å‡½æ•°
  function handleClickOutsideSearch(event) {
    const searchContainers = document.querySelectorAll(".search-container");
    searchContainers.forEach((container) => {
      const searchInput = container.querySelector(".nav-search-input");
      const searchIcon = container.querySelector("a");

      // å¦‚æœç‚¹å‡»çš„å…ƒç´ ä¸æ˜¯æœç´¢è¾“å…¥æ¡†æˆ–æœç´¢å›¾æ ‡ï¼Œåˆ™éšè—æœç´¢æ¡†å’Œç»“æœå®¹å™¨
      if (
        !searchInput.contains(event.target) &&
        !searchIcon.contains(event.target)
      ) {
        searchInput.classList.remove("active");
        searchInput.value = ""
        // æ ¹æ®è¾“å…¥æ¡†IDç¡®å®šå¯¹åº”çš„ç»“æœå®¹å™¨
        let resultContainer;
        if (searchInput.id === "nav-search-input-mobile") {
          // ç§»åŠ¨ç«¯ç»“æœå®¹å™¨
          resultContainer = document.querySelector(
            ".navbar-mobile .nav-search-result"
          );
        } else {
          // æ¡Œé¢ç«¯ç»“æœå®¹å™¨
          resultContainer = document.getElementById(
            "nav-search-result-desktop"
          );
        }

        if (resultContainer) {
          resultContainer.style.display = "none";
          resultContainer.innerHTML = ""; // æ¸…ç©ºç»“æœå®¹å™¨å†…å®¹
        }
      }
    });
  }

  // æ·»åŠ å…¨å±€ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
  document.addEventListener("click", function (event) {
    handleClickOutsideSearch(event);
  });

  // æ–°å¢ï¼šæœç´¢åŠŸèƒ½å®ç°
  let searchData = []; // å…¨å±€å˜é‡å­˜å‚¨æœç´¢æ•°æ®

  // é¡µé¢åŠ è½½å®Œæˆåè·å–æœç´¢æ•°æ®
  document.addEventListener("DOMContentLoaded", function () {
    fetch("/search.xml")
      .then((res) => res.text())
      .then((xmlText) => {
        const parser = new DOMParser();
        const xml = parser.parseFromString(xmlText, "text/xml");
        const entries = xml.getElementsByTagName("entry");
        for (let entry of entries) {
          searchData.push({
            title: entry.getElementsByTagName("title")[0]?.textContent || "",
            content:
              entry.getElementsByTagName("content")[0]?.textContent || "",
            url: entry.getElementsByTagName("url")[0]?.textContent || "",
          });
        }
      })
      .catch((err) => {
        console.error("Failed to load search data:", err);
      });
  });

  // æ–°å¢ï¼šå¯¼èˆªæœç´¢æ–¹æ³•
  function navSearch(inputElement) {
    const keyword = inputElement.value.trim().toLowerCase();
    // æŸ¥æ‰¾å¯¹åº”çš„æœç´¢ç»“æœå®¹å™¨
    let resultContainer;

    if (inputElement.id === "nav-search-input-desktop") {
      // æ¡Œé¢ç«¯
      resultContainer = document.getElementById("nav-search-result-desktop");
    } else if (inputElement.id === "nav-search-input-mobile") {
      // ç§»åŠ¨ç«¯
      resultContainer =
        inputElement.parentNode.querySelector(".nav-search-result");
    }

    if (!resultContainer) return;

    resultContainer.innerHTML = "";

    if (!keyword) {
      resultContainer.style.display = "none";
      return;
    }

    // æ˜¾ç¤ºç»“æœå®¹å™¨
    resultContainer.style.display = "block";

    // è¿‡æ»¤æœç´¢æ•°æ®
    const results = searchData.filter(
      (data) =>
        (data.title && data.title.toLowerCase().includes(keyword)) ||
        (data.content && data.content.toLowerCase().includes(keyword))
    );

    if (results.length === 0) {
      resultContainer.innerHTML =
        '<p class="no-result">æ²¡æœ‰ç»“æœå“Ÿï¼Œæ¢ä¸ªå…³é”®è¯è¯•è¯•å§</p>';
      return;
    }

    // é™åˆ¶æ˜¾ç¤ºç»“æœæ•°é‡
    const maxResults = 10;
    const limitedResults = results.slice(0, maxResults);

    // æ„å»ºç»“æœHTML
    const html = limitedResults
      .map((item) => {
        // æå–åŒ…å«å…³é”®å­—çš„å†…å®¹ç‰‡æ®µ
        let contentSnippet = "";
        if (item.content) {
          // æ‰¾åˆ°åŒ…å«å…³é”®å­—çš„å†…å®¹ç‰‡æ®µ
          const contentLower = item.content.toLowerCase();
          const keywordIndex = contentLower.indexOf(keyword);

          // æå–å…³é”®å­—å‰åçš„å†…å®¹
          const start = Math.max(0, keywordIndex - 3 * keyword.length);
          const end = Math.min(
            item.content.length,
            keywordIndex + 3 * keyword.length
          );
          contentSnippet = item.content.substring(start, end);
        // é«˜äº®å…³é”®å­—
      const keywordRegex = new RegExp(`(${keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
      contentSnippet = contentSnippet.replace(
        keywordRegex,
        "<mark>$1</mark>"
      );
        }

        return `<div class="search-result-item">
  <a href="${item.url}">
    <div>æ ‡é¢˜ï¼š${item.title}</div>
    <div>å†…å®¹ï¼š${contentSnippet}</div>
  </a>
</div>`;
      })
      .join("");
    resultContainer.innerHTML = html;
  }
</script>
<style>
  /* æ‰‹æœºç«¯ä½¿ç”¨flexboxå¸ƒå±€æœç´¢å®¹å™¨ */
  .mobile-container {
    display: flex;
    align-items: center;
    flex-direction: row;
    margin-bottom: 10px;
    margin-left: 10px;
    flex-grow: 1;
    max-width: calc(100% - 40px);
  }


  .search-result-item {
  border: 1px solid #ddd; /* è¾¹æ¡† */
  margin: 4px 0; /* å¤–å±‚é—´è· */
  padding: 0; /* æ— å†…è¾¹è· */
  background: #fff; /* èƒŒæ™¯è‰² */
}

.search-result-item a {
  display: block;
  text-decoration: none;
  color: inherit;
}

.search-result-item div {
  padding: 3px 8px; /* ç´§å‡‘çš„å†…è¾¹è· */
  margin: 0; /* æ— å¤–è¾¹è· */
  line-height: 1.3; /* ç´§å‡‘çš„è¡Œé«˜ */
  word-wrap: break-word; /* å…è®¸é•¿å•è¯æ¢è¡Œ */
  white-space: normal; /* å…è®¸æ­£å¸¸æ¢è¡Œ */
}

.search-result-item div:first-child {
  border-bottom: 1px solid #eee; /* æ ‡é¢˜å’Œå†…å®¹ä¹‹é—´çš„åˆ†éš”çº¿ */
}


</style>

            <div class="main">
                <div class="container">
    <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">å±•å¼€æ‰€æœ‰</a>
        <a onclick="go_top()">è¿”å›é¡¶éƒ¨</a>
        <a onclick="go_bottom()">è¿”å›åº•éƒ¨</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // ä¸º 6 æ—¶å±•å¼€æ‰€æœ‰
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // è¿™ä¸ªå€¼æ˜¯ç”± tocbot æºç é‡Œå®šä¹‰çš„ scrollSmoothDuration å¾—æ¥çš„
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'å±•å¼€æ‰€æœ‰' : 'æŠ˜å æ‰€æœ‰';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>  
  <article class="post-wrap">
    <header class="post-header">
      <h1 class="post-title">11-å¥½å‹å…³æ³¨</h1>
      
      <div class="post-meta">
         ä½œè€…:
        <a itemprop="author" rel="author" href="/">è€æ±Ÿæ¹–</a>
         
        <span class="post-time">
          <br />æ—¥æœŸ:
          <a href="#"
            >åæœˆ 12, 2025&nbsp;&nbsp;0:00:00</a
          >
        </span>
         
        <span class="post-category"
          ><br />
          åˆ†ç±»: 
          <a href="/categories/%E9%BB%91%E9%A9%AC%E7%82%B9%E8%AF%84/">é»‘é©¬ç‚¹è¯„</a>
          
        </span>
        
      </div>
      
    </header>

    <div class="post-content"><h1 id="ä¸€ã€å¥½å‹å…³æ³¨"><a href="#ä¸€ã€å¥½å‹å…³æ³¨" class="headerlink" title="ä¸€ã€å¥½å‹å…³æ³¨"></a>ä¸€ã€å¥½å‹å…³æ³¨</h1><h2 id="ä¸€ã€åŸºç¡€åŠŸèƒ½ï¼šå…³æ³¨ä¸å–æ¶ˆå…³æ³¨"><a href="#ä¸€ã€åŸºç¡€åŠŸèƒ½ï¼šå…³æ³¨ä¸å–æ¶ˆå…³æ³¨" class="headerlink" title="ä¸€ã€åŸºç¡€åŠŸèƒ½ï¼šå…³æ³¨ä¸å–æ¶ˆå…³æ³¨"></a>ä¸€ã€åŸºç¡€åŠŸèƒ½ï¼šå…³æ³¨ä¸å–æ¶ˆå…³æ³¨</h2><p><strong>ä¸šåŠ¡åœºæ™¯</strong>ï¼šæ”¯æŒç”¨æˆ·å¯¹å…¶ä»–ç”¨æˆ·æ‰§è¡Œ â€œå…³æ³¨â€â€œå–æ¶ˆå…³æ³¨â€ æ“ä½œï¼ŒåŠæŸ¥è¯¢ â€œæ˜¯å¦å·²å…³æ³¨â€ çŠ¶æ€ã€‚</p>
<p><strong>æŠ€æœ¯å®ç°</strong>ï¼š</p>
<ol>
<li><p><strong>è¡¨ç»“æ„</strong>ï¼š<code>tb_follow</code> å­˜å‚¨å…³æ³¨å…³ç³»</p>
<ul>
<li>æ ¸å¿ƒå­—æ®µ <code>user_id</code>ï¼ˆå…³æ³¨è€… IDï¼‰</li>
<li><code>follow_user_id</code>ï¼ˆè¢«å…³æ³¨è€… IDï¼‰</li>
<li>create_time&#96;ï¼ˆå…³æ³¨æ—¶é—´ï¼‰ã€‚</li>
</ul>
<p>æ³¨æ„: è¿™é‡ŒæŠŠä¸»é”®ä¿®æ”¹ä¸ºè‡ªå¢é•¿ï¼Œç®€åŒ–å¼€å‘ã€‚</p>
</li>
<li><p>æ¥å£è®¾è®¡ï¼š</p>
<ul>
<li>å…³æ³¨ &#x2F; å–å…³ï¼š<code>PUT  /follow/&#123;id&#125;/&#123;isFollow&#125;</code>ï¼Œé€šè¿‡ <code>isFollow</code> å¸ƒå°”å€¼åˆ‡æ¢å…³æ³¨çŠ¶æ€ï¼›</li>
<li>æŸ¥è¯¢å…³æ³¨çŠ¶æ€ï¼š<code>GET  /follow/or/not/&#123;id&#125;</code>ï¼Œç»Ÿè®¡æ•°æ®åº“ä¸­å…³ç³»è®°å½•çš„å­˜åœ¨æ€§ã€‚</li>
</ul>
<p>FollowControllerï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å…³æ³¨</span></span><br><span class="line"><span class="meta">@PutMapping(&quot;/&#123;id&#125;/&#123;isFollow&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">follow</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long followUserId, <span class="meta">@PathVariable(&quot;isFollow&quot;)</span> Boolean isFollow)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> followService.follow(followUserId, isFollow);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å–æ¶ˆå…³æ³¨</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/or/not/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">isFollow</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long followUserId)</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> followService.isFollow(followUserId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>æ ¸å¿ƒé€»è¾‘ï¼š</p>
<ul>
<li>å…³æ³¨ï¼šå‘ <code>tb_follow</code> æ’å…¥è®°å½•ï¼›</li>
<li>å–æ¶ˆå…³æ³¨ï¼šä» <code>tb_follow</code> åˆ é™¤å¯¹åº”è®°å½•ï¼›</li>
<li>ä¾èµ– <code>UserHolder</code>ï¼ˆåŸºäº <code>ThreadLocal</code>ï¼‰è·å–å½“å‰ç™»å½•ç”¨æˆ· IDï¼Œè¯†åˆ« â€œæ“ä½œå‘èµ·è€…â€ã€‚</li>
</ul>
<p>FollowServiceï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//å–æ¶ˆå…³æ³¨service</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">isFollow</span><span class="params">(Long followUserId)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">        <span class="comment">// 2.æŸ¥è¯¢æ˜¯å¦å…³æ³¨ select count(*) from tb_follow where user_id = ? and follow_user_id = ?</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">count</span> <span class="operator">=</span> query().eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;follow_user_id&quot;</span>, followUserId).count();</span><br><span class="line">        <span class="comment">// 3.åˆ¤æ–­</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(count &gt; <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…³æ³¨service</span></span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">follow</span><span class="params">(Long followUserId, Boolean isFollow)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;follows:&quot;</span> + userId;</span><br><span class="line">        <span class="comment">// 1.åˆ¤æ–­åˆ°åº•æ˜¯å…³æ³¨è¿˜æ˜¯å–å…³</span></span><br><span class="line">        <span class="keyword">if</span> (isFollow) &#123;</span><br><span class="line">            <span class="comment">// 2.å…³æ³¨ï¼Œæ–°å¢æ•°æ®</span></span><br><span class="line">            <span class="type">Follow</span> <span class="variable">follow</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Follow</span>();</span><br><span class="line">            follow.setUserId(userId);</span><br><span class="line">            follow.setFollowUserId(followUserId);</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> save(follow);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 3.å–å…³ï¼Œåˆ é™¤ delete from tb_follow where user_id = ? and follow_user_id = ?</span></span><br><span class="line">            remove(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;Follow&gt;()</span><br><span class="line">                    .eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;follow_user_id&quot;</span>, followUserId));</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="æŸ¥çœ‹ç”¨æˆ·è¯¦æƒ…ã€æŸ¥è¯¢ç”¨æˆ·ç¬”è®°"><a href="#æŸ¥çœ‹ç”¨æˆ·è¯¦æƒ…ã€æŸ¥è¯¢ç”¨æˆ·ç¬”è®°" class="headerlink" title="æŸ¥çœ‹ç”¨æˆ·è¯¦æƒ…ã€æŸ¥è¯¢ç”¨æˆ·ç¬”è®°"></a>æŸ¥çœ‹ç”¨æˆ·è¯¦æƒ…ã€æŸ¥è¯¢ç”¨æˆ·ç¬”è®°</h2><p>æƒ³è¦å»çœ‹å…±åŒå…³æ³¨çš„å¥½å‹ï¼Œéœ€è¦é¦–å…ˆè¿›å…¥åˆ°è¿™ä¸ªé¡µé¢ï¼Œè¿™ä¸ªé¡µé¢ä¼šå‘èµ·ä¸¤ä¸ªè¯·æ±‚</p>
<p>1ã€å»æŸ¥è¯¢ç”¨æˆ·çš„è¯¦æƒ…</p>
<p>2ã€å»æŸ¥è¯¢ç”¨æˆ·çš„ç¬”è®°</p>
<p>ä»¥ä¸Šä¸¤ä¸ªåŠŸèƒ½å’Œå…±åŒå…³æ³¨æ²¡æœ‰ä»€ä¹ˆå…³ç³»ï¼Œä½†æ˜¯éœ€è¦å®Œå–„åŠŸèƒ½ï¼Œä¿è¯åŠŸèƒ½å®Œæ•´ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// UserController æ ¹æ®idæŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryUserById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long userId)</span>&#123;</span><br><span class="line">	<span class="comment">// æŸ¥è¯¢è¯¦æƒ…</span></span><br><span class="line">	<span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.getById(userId);</span><br><span class="line">	<span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">		<span class="keyword">return</span> Result.ok();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> BeanUtil.copyProperties(user, UserDTO.class);</span><br><span class="line">	<span class="comment">// è¿”å›</span></span><br><span class="line">	<span class="keyword">return</span> Result.ok(userDTO);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// BlogController  æ ¹æ®idæŸ¥è¯¢åšä¸»çš„æ¢åº—ç¬”è®°</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/of/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogByUserId</span><span class="params">(</span></span><br><span class="line"><span class="params">		<span class="meta">@RequestParam(value = &quot;current&quot;, defaultValue = &quot;1&quot;)</span> Integer current,</span></span><br><span class="line"><span class="params">		<span class="meta">@RequestParam(&quot;id&quot;)</span> Long id)</span> &#123;</span><br><span class="line">	<span class="comment">// æ ¹æ®ç”¨æˆ·æŸ¥è¯¢</span></span><br><span class="line">	Page&lt;Blog&gt; page = blogService.query()</span><br><span class="line">			.eq(<span class="string">&quot;user_id&quot;</span>, id).page(<span class="keyword">new</span> <span class="title class_">Page</span>&lt;&gt;(current, SystemConstants.MAX_PAGE_SIZE));</span><br><span class="line">	<span class="comment">// è·å–å½“å‰é¡µæ•°æ®</span></span><br><span class="line">	List&lt;Blog&gt; records = page.getRecords();</span><br><span class="line">	<span class="keyword">return</span> Result.ok(records);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="äºŒã€æ‹“å±•åŠŸèƒ½ï¼šå…±åŒå…³æ³¨ï¼ˆRedis-Set-åº”ç”¨ï¼‰"><a href="#äºŒã€æ‹“å±•åŠŸèƒ½ï¼šå…±åŒå…³æ³¨ï¼ˆRedis-Set-åº”ç”¨ï¼‰" class="headerlink" title="äºŒã€æ‹“å±•åŠŸèƒ½ï¼šå…±åŒå…³æ³¨ï¼ˆRedis Set åº”ç”¨ï¼‰"></a>äºŒã€æ‹“å±•åŠŸèƒ½ï¼šå…±åŒå…³æ³¨ï¼ˆRedis Set åº”ç”¨ï¼‰</h2><p><strong>ä¸šåŠ¡åœºæ™¯</strong>ï¼šå±•ç¤º â€œå½“å‰ç”¨æˆ·â€ ä¸ â€œç›®æ ‡åšä¸»â€ çš„å…±åŒå…³æ³¨åˆ—è¡¨ã€‚</p>
<p><strong>æŠ€æœ¯å‡çº§ï¼ˆRedis Set ä¼˜åŒ–ï¼‰</strong>ï¼š</p>
<ol>
<li><p>æ”¹é€ å…³æ³¨é€»è¾‘ï¼ˆåŒå†™æ•°æ®åº“ä¸ Redisï¼‰ï¼š</p>
<ul>
<li>å…³æ³¨æ—¶ï¼šé™¤å†™å…¥ <code>tb_follow</code>ï¼Œè¿˜å‘ Redis <code>Set</code>ï¼ˆé”®ä¸º <code>follows:&#123;userId&#125;</code>ï¼‰æ·»åŠ  <code>follow_user_id</code>ï¼›</li>
<li>å–å…³æ—¶ï¼šé™¤åˆ é™¤ <code>tb_follow</code> è®°å½•ï¼Œè¿˜ä» Redis <code>Set</code> ç§»é™¤å¯¹åº” <code>follow_user_id</code>ï¼›</li>
<li>ç›®çš„ï¼šåˆ©ç”¨ Redis <code>Set</code> çš„<strong>é›†åˆè¿ç®—èƒ½åŠ›</strong>ï¼Œå¿«é€Ÿå®ç° â€œå…±åŒå…³æ³¨â€ æŸ¥è¯¢ã€‚</li>
</ul>
<p>FollowServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">follow</span><span class="params">(Long followUserId, Boolean isFollow)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;follows:&quot;</span> + userId;</span><br><span class="line">    <span class="comment">// 1.åˆ¤æ–­åˆ°åº•æ˜¯å…³æ³¨è¿˜æ˜¯å–å…³</span></span><br><span class="line">    <span class="keyword">if</span> (isFollow) &#123;</span><br><span class="line">        <span class="comment">// 2.å…³æ³¨ï¼Œæ–°å¢æ•°æ®</span></span><br><span class="line">        <span class="type">Follow</span> <span class="variable">follow</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Follow</span>();</span><br><span class="line">        follow.setUserId(userId);</span><br><span class="line">        follow.setFollowUserId(followUserId);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> save(follow);</span><br><span class="line">        <span class="keyword">if</span> (isSuccess) &#123;</span><br><span class="line">            <span class="comment">// æŠŠå…³æ³¨ç”¨æˆ·çš„idï¼Œæ”¾å…¥redisçš„seté›†åˆ sadd userId followerUserId</span></span><br><span class="line">            stringRedisTemplate.opsForSet().add(key, followUserId.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 3.å–å…³ï¼Œåˆ é™¤ delete from tb_follow where user_id = ? and follow_user_id = ?</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> remove(<span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;Follow&gt;()</span><br><span class="line">                .eq(<span class="string">&quot;user_id&quot;</span>, userId).eq(<span class="string">&quot;follow_user_id&quot;</span>, followUserId));</span><br><span class="line">        <span class="keyword">if</span> (isSuccess) &#123;</span><br><span class="line">            <span class="comment">// æŠŠå…³æ³¨ç”¨æˆ·çš„idä»Redisé›†åˆä¸­ç§»é™¤</span></span><br><span class="line">            stringRedisTemplate.opsForSet().remove(key, followUserId.toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>å…±åŒå…³æ³¨å®ç°ï¼š</p>
<ul>
<li>åˆ†åˆ«è·å– â€œå½“å‰ç”¨æˆ·çš„å…³æ³¨é›†åˆï¼ˆ<code>follows:&#123;currentUserId&#125;</code>ï¼‰â€ å’Œ â€œç›®æ ‡åšä¸»çš„å…³æ³¨é›†åˆï¼ˆ<code>follows:&#123;bloggerId&#125;</code>ï¼‰â€ï¼›</li>
<li>é€šè¿‡ <code>opsForSet().intersect(key1, key2)</code> æ±‚ä¸¤ä¸ª <code>Set</code> çš„<strong>äº¤é›†</strong>ï¼ˆå³å…±åŒå…³æ³¨çš„ç”¨æˆ· IDï¼‰ï¼›</li>
<li>æ ¹æ®äº¤é›† ID æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œè¿”å›å…±åŒå…³æ³¨åˆ—è¡¨ã€‚</li>
</ul>
<p>FollowServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">followCommons</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–å½“å‰ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;follows:&quot;</span> + userId;</span><br><span class="line">    <span class="comment">// 2.æ±‚äº¤é›†</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key2</span> <span class="operator">=</span> <span class="string">&quot;follows:&quot;</span> + id;</span><br><span class="line">    Set&lt;String&gt; intersect = stringRedisTemplate.opsForSet().intersect(key, key2);</span><br><span class="line">    <span class="keyword">if</span> (intersect == <span class="literal">null</span> || intersect.isEmpty()) &#123;</span><br><span class="line">        <span class="comment">// æ— äº¤é›†</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(Collections.emptyList());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.è§£æidé›†åˆ</span></span><br><span class="line">    List&lt;Long&gt; ids = intersect.stream().map(Long::valueOf).collect(Collectors.toList());</span><br><span class="line">    <span class="comment">// 4.æŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">    List&lt;UserDTO&gt; users = userService.listByIds(ids)</span><br><span class="line">            .stream()</span><br><span class="line">            .map(user -&gt; BeanUtil.copyProperties(user, UserDTO.class))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    <span class="keyword">return</span> Result.ok(users);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="ä¸‰ã€æŠ€æœ¯è¦ç‚¹ä¸ä¼˜åŠ¿"><a href="#ä¸‰ã€æŠ€æœ¯è¦ç‚¹ä¸ä¼˜åŠ¿" class="headerlink" title="ä¸‰ã€æŠ€æœ¯è¦ç‚¹ä¸ä¼˜åŠ¿"></a>ä¸‰ã€æŠ€æœ¯è¦ç‚¹ä¸ä¼˜åŠ¿</h2><ol>
<li>Redis Set çš„æ ¸å¿ƒä»·å€¼ï¼š<ul>
<li>å…ƒç´ å”¯ä¸€æ€§ï¼šå¤©ç„¶ä¿è¯ â€œå…³æ³¨å…³ç³»æ— é‡å¤â€ï¼›</li>
<li>é«˜æ•ˆé›†åˆè¿ç®—ï¼š<code>äº¤é›†/å¹¶é›†/å·®é›†</code> æ“ä½œæ—¶é—´å¤æ‚åº¦ä¸º O (n)ï¼Œè¿œè¶…æ•°æ®åº“ <code>JOIN</code> æŸ¥è¯¢ï¼Œé€‚åˆ â€œå…±åŒå…³æ³¨â€ ç­‰åœºæ™¯ï¼›</li>
<li>è½»é‡ç¼“å­˜ï¼šç›¸æ¯”æ•°æ®åº“ï¼ŒRedis æ“ä½œæ›´é«˜æ•ˆï¼Œé™ä½æ•°æ®åº“å‹åŠ›ã€‚</li>
</ul>
</li>
<li>ç”¨æˆ·ä¸Šä¸‹æ–‡ä¼ é€’ï¼š<ul>
<li>ä¾èµ– <code>UserHolder</code>ï¼ˆ<code>ThreadLocal</code> å°è£…ï¼‰ä¼ é€’å½“å‰ç™»å½•ç”¨æˆ· IDï¼Œç®€åŒ– â€œæ“ä½œç”¨æˆ·è¯†åˆ«â€ é€»è¾‘ã€‚</li>
</ul>
</li>
<li>æ•°æ®ä¸€è‡´æ€§ï¼š<ul>
<li>å…³æ³¨ &#x2F; å–å…³éœ€<strong>åŒæ—¶ç»´æŠ¤æ•°æ®åº“å’Œ Redis</strong>ï¼ˆåŒå†™ï¼‰ï¼›è‹¥å¯¹ä¸€è‡´æ€§è¦æ±‚æé«˜ï¼Œå¯é‡‡ç”¨ â€œæ•°æ®åº“ä¸ºæºï¼ŒRedis å®šæœŸåŒæ­¥â€ çš„æœ€ç»ˆä¸€è‡´æ€§æ–¹æ¡ˆã€‚</li>
</ul>
</li>
</ol>
<h2 id="å››ã€æ€»ç»“"><a href="#å››ã€æ€»ç»“" class="headerlink" title="å››ã€æ€»ç»“"></a>å››ã€æ€»ç»“</h2><p>â€œå¥½å‹å…³æ³¨â€ æ¨¡å—ä½“ç°äº† <strong>â€œæ•°æ®åº“å­˜äº‹å®ã€ç¼“å­˜å­˜è®¡ç®—å‹æ•°æ®â€</strong> çš„åˆ†å±‚è®¾è®¡æ€æƒ³ï¼šåŸºç¡€å…³æ³¨å…³ç³»ç”±æ•°æ®åº“æŒä¹…åŒ–ï¼Œè€Œ â€œå…±åŒå…³æ³¨â€ è¿™ç±»éœ€é›†åˆè¿ç®—çš„åœºæ™¯ï¼Œé€šè¿‡ Redis Set ä¼˜åŒ–æ€§èƒ½ä¸é€»è¾‘å¤æ‚åº¦ï¼Œæ˜¯ç¼“å­˜è¾…åŠ©ä¸šåŠ¡çš„å…¸å‹å®è·µã€‚</p>
<h1 id="äºŒã€å¥½å‹å…³æ³¨-Feedæµå®ç°æ–¹æ³•"><a href="#äºŒã€å¥½å‹å…³æ³¨-Feedæµå®ç°æ–¹æ³•" class="headerlink" title="äºŒã€å¥½å‹å…³æ³¨ - Feedæµå®ç°æ–¹æ³•"></a>äºŒã€å¥½å‹å…³æ³¨ - Feedæµå®ç°æ–¹æ³•</h1><h3 id="ä¸€ã€Feed-æµçš„æ¦‚å¿µä¸æ¨¡å¼"><a href="#ä¸€ã€Feed-æµçš„æ¦‚å¿µä¸æ¨¡å¼" class="headerlink" title="ä¸€ã€Feed æµçš„æ¦‚å¿µä¸æ¨¡å¼"></a>ä¸€ã€Feed æµçš„æ¦‚å¿µä¸æ¨¡å¼</h3><blockquote>
<ul>
<li>å¯¹äºä¼ ç»Ÿçš„æ¨¡å¼çš„å†…å®¹è§£é”ï¼šæˆ‘ä»¬æ˜¯éœ€è¦ç”¨æˆ·å»é€šè¿‡æœç´¢å¼•æ“æˆ–è€…æ˜¯å…¶ä»–çš„æ–¹å¼å»è§£é”æƒ³è¦çœ‹çš„å†…å®¹</li>
<li>å¯¹äºæ–°å‹çš„Feedæµçš„çš„æ•ˆæœï¼šä¸éœ€è¦æˆ‘ä»¬ç”¨æˆ·å†å»æ¨é€ä¿¡æ¯ï¼Œè€Œæ˜¯ç³»ç»Ÿåˆ†æç”¨æˆ·åˆ°åº•æƒ³è¦ä»€ä¹ˆï¼Œç„¶åç›´æ¥æŠŠå†…å®¹æ¨é€ç»™ç”¨æˆ·ï¼Œä»è€Œä½¿ç”¨æˆ·èƒ½å¤Ÿæ›´åŠ çš„èŠ‚çº¦æ—¶é—´ï¼Œä¸ç”¨ä¸»åŠ¨å»å¯»æ‰¾ã€‚</li>
</ul>
</blockquote>
<p>Feed æµï¼ˆâ€œæŠ•å–‚â€ æµï¼‰æ˜¯ä¸ºç”¨æˆ·æŒç»­æä¾›æ²‰æµ¸å¼å†…å®¹çš„æœºåˆ¶ï¼Œè®©ç”¨æˆ·æ— éœ€ä¸»åŠ¨æœç´¢å³å¯è·å–æ„Ÿå…´è¶£ä¿¡æ¯ã€‚</p>
<p>Feedæµäº§å“æœ‰ä¸¤ç§å¸¸è§æ¨¡å¼ï¼š<br>Timelineï¼šä¸åšå†…å®¹ç­›é€‰ï¼Œç®€å•çš„æŒ‰ç…§å†…å®¹å‘å¸ƒæ—¶é—´æ’åºï¼Œå¸¸ç”¨äºå¥½å‹æˆ–å…³æ³¨ã€‚ä¾‹å¦‚æœ‹å‹åœˆ</p>
<ul>
<li>ä¼˜ç‚¹ï¼šä¿¡æ¯å…¨é¢ï¼Œä¸ä¼šæœ‰ç¼ºå¤±ã€‚å¹¶ä¸”å®ç°ä¹Ÿç›¸å¯¹ç®€å•</li>
<li>ç¼ºç‚¹ï¼šä¿¡æ¯å™ªéŸ³è¾ƒå¤šï¼Œç”¨æˆ·ä¸ä¸€å®šæ„Ÿå…´è¶£ï¼Œå†…å®¹è·å–æ•ˆç‡ä½</li>
</ul>
<p>æ™ºèƒ½æ’åºï¼šåˆ©ç”¨æ™ºèƒ½ç®—æ³•å±è”½æ‰è¿è§„çš„ã€ç”¨æˆ·ä¸æ„Ÿå…´è¶£çš„å†…å®¹ã€‚æ¨é€ç”¨æˆ·æ„Ÿå…´è¶£ä¿¡æ¯æ¥å¸å¼•ç”¨æˆ·</p>
<ul>
<li>ä¼˜ç‚¹ï¼šæŠ•å–‚ç”¨æˆ·æ„Ÿå…´è¶£ä¿¡æ¯ï¼Œç”¨æˆ·ç²˜åº¦å¾ˆé«˜ï¼Œå®¹æ˜“æ²‰è¿·</li>
<li>ç¼ºç‚¹ï¼šå¦‚æœç®—æ³•ä¸ç²¾å‡†ï¼Œå¯èƒ½èµ·åˆ°åä½œç”¨<br>æœ¬ä¾‹ä¸­çš„ä¸ªäººé¡µé¢ï¼Œæ˜¯åŸºäºå…³æ³¨çš„å¥½å‹æ¥åšFeedæµï¼Œå› æ­¤é‡‡ç”¨Timelineçš„æ¨¡å¼ã€‚è¯¥æ¨¡å¼çš„å®ç°æ–¹æ¡ˆæœ‰ä¸‰ç§ï¼š</li>
</ul>
<p>æœ¬ä¾‹ä¸­çš„ä¸ªäººé¡µé¢ï¼Œæ˜¯åŸºäºå…³æ³¨çš„å¥½å‹æ¥åšFeedæµï¼Œå› æ­¤é‡‡ç”¨<strong>Timeline</strong>çš„æ¨¡å¼ã€‚ï¼ˆæŒ‰å†…å®¹å‘å¸ƒæ—¶é—´æ’åºï¼Œå±•ç¤ºå…³æ³¨ç”¨æˆ·çš„åŠ¨æ€ï¼‰ã€‚</p>
<p>Timelineæ¨¡å¼çš„å®ç°æ–¹æ¡ˆæœ‰ä¸‰ç§ï¼š</p>
<table>
<thead>
<tr>
<th>æ¨¡å¼</th>
<th>æ ¸å¿ƒé€»è¾‘</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td>æ‹‰æ¨¡å¼ï¼ˆè¯»æ‰©æ•£ï¼‰</td>
<td>ç”¨æˆ·è¯»å–æ—¶ï¼Œä»æ‰€æœ‰å…³æ³¨å¯¹è±¡ä¸­æ‹‰å–å†…å®¹åèšåˆæ’åºã€‚</td>
<td>èŠ‚çœå­˜å‚¨ï¼ˆæ— å†—ä½™æ¨é€ï¼‰</td>
<td>è¯»å–å»¶è¿Ÿé«˜ã€é«˜å¹¶å‘å‹åŠ›å¤§</td>
</tr>
<tr>
<td>æ¨æ¨¡å¼ï¼ˆå†™æ‰©æ•£ï¼‰</td>
<td>å†…å®¹å‘å¸ƒæ—¶ï¼Œä¸»åŠ¨æ¨é€åˆ°æ‰€æœ‰ç²‰ä¸çš„ â€œæ”¶ä»¶ç®±â€ã€‚</td>
<td>è¯»å–æ—¶æ•ˆå¿«</td>
<td>å¤§ V ç²‰ä¸å¤šæ—¶æœ‰å­˜å‚¨å‹åŠ›</td>
</tr>
<tr>
<td>æ¨æ‹‰ç»“åˆ</td>
<td>æ™®é€šç”¨æˆ·ç”¨ â€œæ¨æ¨¡å¼â€ï¼Œå¤§ V ç”¨ â€œæ‹‰æ¨¡å¼â€ï¼Œå¹³è¡¡å­˜å‚¨ä¸è¯»å–ã€‚</td>
<td>å…¼é¡¾ä¸¤è€…ä¼˜åŠ¿</td>
<td>é€»è¾‘å¤æ‚</td>
</tr>
</tbody></table>
<h3 id="äºŒã€å¥½å‹å…³æ³¨åœºæ™¯çš„-Feed-æµå®ç°ï¼ˆæ¨æ¨¡å¼ï¼‰"><a href="#äºŒã€å¥½å‹å…³æ³¨åœºæ™¯çš„-Feed-æµå®ç°ï¼ˆæ¨æ¨¡å¼ï¼‰" class="headerlink" title="äºŒã€å¥½å‹å…³æ³¨åœºæ™¯çš„ Feed æµå®ç°ï¼ˆæ¨æ¨¡å¼ï¼‰"></a>äºŒã€å¥½å‹å…³æ³¨åœºæ™¯çš„ Feed æµå®ç°ï¼ˆæ¨æ¨¡å¼ï¼‰</h3><p><strong>éœ€æ±‚</strong>ï¼š</p>
<ul>
<li>ä¿®æ”¹æ–°å¢æ¢åº—ç¬”è®°çš„ä¸šåŠ¡ï¼Œåœ¨ä¿å­˜blogåˆ°æ•°æ®åº“çš„åŒæ—¶ï¼Œæ¨é€åˆ°ç²‰ä¸çš„Redisæ”¶ä»¶ç®±</li>
<li>æ”¶ä»¶ç®±æ»¡è¶³å¯ä»¥æ ¹æ®æ—¶é—´æˆ³æ’åºï¼Œå¿…é¡»ç”¨Redisçš„æ•°æ®ç»“æ„å®ç°</li>
<li>æŸ¥è¯¢æ”¶ä»¶ç®±æ•°æ®æ—¶ï¼Œå¯ä»¥å®ç°åˆ†é¡µæŸ¥è¯¢</li>
</ul>
<p><strong>æ¨é€é€»è¾‘ï¼ˆå‘å¸ƒç¬”è®°æ—¶è§¦å‘ï¼‰</strong></p>
<p>ç”¨æˆ·å‘å¸ƒç¬”è®°æ—¶ï¼Œéœ€å®Œæˆ â€œä¿å­˜ç¬”è®° + å‘æ‰€æœ‰ç²‰ä¸æ¨é€â€ï¼š</p>
<ul>
<li>ä¿å­˜ç¬”è®°åˆ°æ•°æ®åº“ï¼›</li>
<li>æŸ¥è¯¢è¯¥ç”¨æˆ·çš„æ‰€æœ‰ç²‰ä¸ï¼›</li>
<li>ç”¨ Redis <code>SortedSet</code> å‘æ¯ä¸ªç²‰ä¸çš„ â€œæ”¶ä»¶ç®±â€ æ¨é€ç¬”è®° IDï¼ˆ<code>score</code>ä¸º<strong>å½“å‰æ—¶é—´æˆ³</strong>ï¼Œä¿è¯æŒ‰æ—¶é—´æ’åºï¼‰ã€‚</li>
</ul>
<p>æ ¸å¿ƒä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">saveBlog</span><span class="params">(Blog blog)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–ç™»å½•ç”¨æˆ·</span></span><br><span class="line">    <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> UserHolder.getUser();</span><br><span class="line">    blog.setUserId(user.getId());</span><br><span class="line">    <span class="comment">// 2.ä¿å­˜æ¢åº—ç¬”è®°</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">isSuccess</span> <span class="operator">=</span> save(blog);</span><br><span class="line">    <span class="keyword">if</span>(!isSuccess)&#123;</span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ–°å¢ç¬”è®°å¤±è´¥!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.æŸ¥è¯¢ç¬”è®°ä½œè€…çš„æ‰€æœ‰ç²‰ä¸ select * from tb_follow where follow_user_id = ?</span></span><br><span class="line">    List&lt;Follow&gt; follows = followService.query().eq(<span class="string">&quot;follow_user_id&quot;</span>, user.getId()).list();</span><br><span class="line">    <span class="comment">// 4.æ¨é€ç¬”è®°idç»™æ‰€æœ‰ç²‰ä¸</span></span><br><span class="line">    <span class="keyword">for</span> (Follow follow : follows) &#123;</span><br><span class="line">        <span class="comment">// 4.1.è·å–ç²‰ä¸id</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">fanId</span> <span class="operator">=</span> follow.getUserId();</span><br><span class="line">        <span class="comment">// 4.2.æ¨é€</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> FEED_KEY + fanId;</span><br><span class="line">        stringRedisTemplate.opsForZSet().add(key, blog.getId().toString(), System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 5.è¿”å›id</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok(blog.getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ä¸‰ã€å¥½å‹å…³æ³¨-æ»šåŠ¨åˆ†é¡µæŸ¥è¯¢ï¼ˆç²‰ä¸è¯»å–æ”¶ä»¶ç®±ï¼‰"><a href="#ä¸‰ã€å¥½å‹å…³æ³¨-æ»šåŠ¨åˆ†é¡µæŸ¥è¯¢ï¼ˆç²‰ä¸è¯»å–æ”¶ä»¶ç®±ï¼‰" class="headerlink" title="ä¸‰ã€å¥½å‹å…³æ³¨ - æ»šåŠ¨åˆ†é¡µæŸ¥è¯¢ï¼ˆç²‰ä¸è¯»å–æ”¶ä»¶ç®±ï¼‰"></a>ä¸‰ã€å¥½å‹å…³æ³¨ - æ»šåŠ¨åˆ†é¡µæŸ¥è¯¢ï¼ˆç²‰ä¸è¯»å–æ”¶ä»¶ç®±ï¼‰</h3><p><strong>éœ€æ±‚</strong>ï¼šåœ¨ä¸ªäººä¸»é¡µçš„â€œå…³æ³¨â€å¡ç‰‡ä¸­ï¼ŒæŸ¥è¯¢å¹¶å±•ç¤ºæ¨é€çš„Blogä¿¡æ¯ï¼š</p>
<p><strong>å…·ä½“æ“ä½œå¦‚ä¸‹</strong>ï¼š</p>
<ol>
<li><p>æ¯æ¬¡æŸ¥è¯¢å®Œæˆåï¼Œæˆ‘ä»¬è¦åˆ†æå‡ºæŸ¥è¯¢å‡ºæ•°æ®çš„æœ€å°æ—¶é—´æˆ³ï¼Œè¿™ä¸ªå€¼ä¼šä½œä¸ºä¸‹ä¸€æ¬¡æŸ¥è¯¢çš„æ¡ä»¶</p>
</li>
<li><p>æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸ä¸Šä¸€æ¬¡æŸ¥è¯¢ç›¸åŒçš„æŸ¥è¯¢ä¸ªæ•°ä½œä¸ºåç§»é‡ï¼Œä¸‹æ¬¡æŸ¥è¯¢æ—¶ï¼Œè·³è¿‡è¿™äº›æŸ¥è¯¢è¿‡çš„æ•°æ®ï¼Œæ‹¿åˆ°æˆ‘ä»¬éœ€è¦çš„æ•°æ®</p>
</li>
</ol>
<p>ä¼ ç»Ÿåˆ†é¡µï¼ˆ<code>page</code>+<code>size</code>ï¼‰ä¼šå›  Feed æµå®æ—¶æ›´æ–°å¯¼è‡´é‡å¤ &#x2F; ç¼ºå¤±ï¼Œéœ€ç”¨ <strong>â€œæœ€å°æ—¶é—´æˆ³ + åç§»é‡â€</strong> å®ç°æ»šåŠ¨åˆ†é¡µï¼š</p>
<ul>
<li><strong>è¯·æ±‚å‚æ•°</strong>ï¼š<code>lastId</code>ï¼ˆä¸Šä¸€æ¬¡æŸ¥è¯¢çš„æœ€å°æ—¶é—´æˆ³ï¼‰ã€<code>offset</code>ï¼ˆåç§»é‡ï¼Œè·³è¿‡é‡å¤æ•°æ®ï¼‰ï¼›</li>
<li><strong>Redis æ“ä½œ</strong>ï¼šç”¨<code>ZREVRANGEBYSCORE</code>æŒ‰æ—¶é—´æˆ³å€’åºæŸ¥è¯¢ï¼ŒèŒƒå›´<code>0 ~ lastId</code>ï¼Œè·³è¿‡<code>offset</code>æ¡åå–æŒ‡å®šæ•°é‡ï¼›</li>
<li><strong>ç»“æœå¤„ç†</strong>ï¼šè§£æç¬”è®° IDã€è®¡ç®—æ–°çš„<code>minTime</code>ï¼ˆæœ¬æ¬¡æŸ¥è¯¢çš„æœ€å°æ—¶é—´æˆ³ï¼‰å’Œ<code>offset</code>ï¼ˆä¸‹æ¬¡æŸ¥è¯¢çš„åç§»é‡ï¼‰ã€‚</li>
</ul>
<p><strong>å®šä¹‰å‡ºæ¥å…·ä½“çš„è¿”å›å€¼å®ä½“ç±»</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ScrollResult</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;?&gt; list;</span><br><span class="line">    <span class="keyword">private</span> Long minTime;</span><br><span class="line">    <span class="keyword">private</span> Integer offset;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>BlogController</strong>:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/of/follow&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogOfFollow</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="meta">@RequestParam(&quot;lastId&quot;)</span> Long max, <span class="meta">@RequestParam(value = &quot;offset&quot;, defaultValue = &quot;0&quot;)</span> Integer offset)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> blogService.queryBlogOfFollow(max, offset);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ³¨æ„ï¼šRequestParam è¡¨ç¤ºæ¥å—urlåœ°å€æ ä¼ å‚çš„æ³¨è§£ï¼Œå½“æ–¹æ³•ä¸Šå‚æ•°çš„åç§°å’Œurlåœ°å€æ ä¸ç›¸åŒæ—¶ï¼Œå¯ä»¥é€šè¿‡RequestParam æ¥è¿›è¡ŒæŒ‡å®š</p>
<p><strong>æ ¸å¿ƒä»£ç  BlogServiceImplï¼š</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">queryBlogOfFollow</span><span class="params">(Long max, Integer offset)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.è·å–å½“å‰ç”¨æˆ·</span></span><br><span class="line">    <span class="type">Long</span> <span class="variable">userId</span> <span class="operator">=</span> UserHolder.getUser().getId();</span><br><span class="line">    <span class="comment">// 2.æŸ¥è¯¢æ”¶ä»¶ç®± ZREVRANGEBYSCORE key Max Min LIMIT offset count</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> FEED_KEY + userId;</span><br><span class="line">        <span class="comment">//ä»Redisæ”¶ä»¶ç®±æŸ¥è¯¢ï¼šå€’åºã€èŒƒå›´0~maxã€è·³è¿‡offsetæ¡ã€å–2æ¡</span></span><br><span class="line">    Set&lt;ZSetOperations.TypedTuple&lt;String&gt;&gt; typedTuples = stringRedisTemplate.opsForZSet()</span><br><span class="line">        .reverseRangeByScoreWithScores(key, <span class="number">0</span>, max, offset, <span class="number">2</span>);</span><br><span class="line">    <span class="comment">// 3.éç©ºåˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (typedTuples == <span class="literal">null</span> || typedTuples.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4.è§£ææ•°æ®ï¼šblogIdã€minTimeï¼ˆæ—¶é—´æˆ³ï¼‰ã€offset</span></span><br><span class="line">    List&lt;Long&gt; blogIds = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(typedTuples.size());</span><br><span class="line">    <span class="type">long</span> <span class="variable">minTime</span> <span class="operator">=</span> <span class="number">0</span>; </span><br><span class="line">    <span class="type">int</span> <span class="variable">os</span> <span class="operator">=</span> <span class="number">1</span>; <span class="comment">//newOffset åˆå§‹åç§»é‡</span></span><br><span class="line">    <span class="keyword">for</span> (ZSetOperations.TypedTuple&lt;String&gt; tuple : typedTuples) &#123; </span><br><span class="line">        <span class="comment">// 4.1.è·å–id</span></span><br><span class="line">        blogIds.add(Long.valueOf(tuple.getValue()));</span><br><span class="line">        <span class="comment">// 4.2.è·å–åˆ†æ•°(æ—¶é—´æˆ³ï¼‰</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">time</span> <span class="operator">=</span> tuple.getScore().longValue();</span><br><span class="line">        <span class="keyword">if</span>(time == minTime)&#123;</span><br><span class="line">            os++;<span class="comment">// ç›¸åŒæ—¶é—´æˆ³ï¼Œåç§»é‡+1</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            minTime = time;</span><br><span class="line">            os = <span class="number">1</span>;<span class="comment">// æ–°æ—¶é—´æˆ³ï¼Œé‡ç½®åç§»é‡</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	os = minTime == max ? os : os + offset;</span><br><span class="line">    <span class="comment">// 5.æ ¹æ®idæŸ¥è¯¢blog</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">idStr</span> <span class="operator">=</span> StrUtil.join(<span class="string">&quot;,&quot;</span>, blogIds);</span><br><span class="line">    List&lt;Blog&gt; blogs = query().in(<span class="string">&quot;id&quot;</span>, blogIds).last(<span class="string">&quot;ORDER BY FIELD(id,&quot;</span> + idStr + <span class="string">&quot;)&quot;</span>).list();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (Blog blog : blogs) &#123;</span><br><span class="line">        <span class="comment">// 5.1.æŸ¥è¯¢blogæœ‰å…³çš„ç”¨æˆ·</span></span><br><span class="line">        queryBlogUser(blog);</span><br><span class="line">        <span class="comment">// 5.2.æŸ¥è¯¢blogæ˜¯å¦è¢«ç‚¹èµ</span></span><br><span class="line">        isBlogLiked(blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6.å°è£…å¹¶è¿”å›ï¼ˆå«ä¸‹æ¬¡æŸ¥è¯¢çš„minTimeå’Œoffsetï¼‰</span></span><br><span class="line">    <span class="type">ScrollResult</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ScrollResult</span>();</span><br><span class="line">    result.setList(blogs);</span><br><span class="line">    result.setOffset(os);</span><br><span class="line">    result.setMinTime(minTime);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Result.ok(result);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="å››ã€æŠ€æœ¯è¦ç‚¹ä¸ä»·å€¼"><a href="#å››ã€æŠ€æœ¯è¦ç‚¹ä¸ä»·å€¼" class="headerlink" title="å››ã€æŠ€æœ¯è¦ç‚¹ä¸ä»·å€¼"></a>å››ã€æŠ€æœ¯è¦ç‚¹ä¸ä»·å€¼</h3><ol>
<li><p><strong>Redis SortedSet çš„æ ¸å¿ƒä½œç”¨</strong>ï¼š</p>
<ul>
<li>æŒ‰<code>score</code>ï¼ˆæ—¶é—´æˆ³ï¼‰æ’åºï¼Œå¤©ç„¶æ”¯æŒ â€œæŒ‰å‘å¸ƒæ—¶é—´å€’åºâ€ çš„ Timeline éœ€æ±‚ï¼›</li>
<li>æ”¯æŒèŒƒå›´æŸ¥è¯¢ï¼ˆ<code>ZREVRANGEBYSCORE</code>ï¼‰ï¼Œç»“åˆ<code>offset</code>å®ç°<strong>æ»šåŠ¨åˆ†é¡µ</strong>ï¼Œè§£å†³ä¼ ç»Ÿåˆ†é¡µçš„ â€œé‡å¤ &#x2F; ç¼ºå¤±â€ é—®é¢˜ã€‚</li>
</ul>
</li>
<li><p><strong>æ¨æ¨¡å¼çš„é€‚ç”¨åœºæ™¯</strong>ï¼š</p>
<p>å¥½å‹å…³æ³¨åœºæ™¯ä¸­ï¼Œç”¨æˆ·ç²‰ä¸é‡é€šå¸¸ä¸å¤§ï¼Œæ¨æ¨¡å¼çš„ â€œå­˜å‚¨å‹åŠ›â€ å¯æ¥å—ï¼Œä¸”èƒ½ä¿è¯<strong>è¯»å–æ—¶æ•ˆ</strong>ï¼ˆç²‰ä¸ç›´æ¥ä»è‡ªå·±çš„æ”¶ä»¶ç®±å–æ•°æ®ï¼Œæ— éœ€å®æ—¶èšåˆï¼‰ã€‚</p>
</li>
<li><p><strong>æ»šåŠ¨åˆ†é¡µçš„é€»è¾‘</strong>ï¼š</p>
<p>é€šè¿‡ â€œè®°å½•ä¸Šæ¬¡æŸ¥è¯¢çš„æœ€å°æ—¶é—´æˆ³ + ç›¸åŒæ—¶é—´æˆ³çš„åç§»é‡â€ï¼Œç¡®ä¿æ¯æ¬¡æŸ¥è¯¢ â€œæ¥ç€ä¸Šä¸€æ¬¡çš„ä½ç½®ç»§ç»­è¯»â€ï¼Œæ—¢ä¸é‡å¤ä¹Ÿä¸é—æ¼ã€‚</p>
</li>
</ol>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å¥½å‹å…³æ³¨çš„ Feed æµé‡‡ç”¨ <strong>æ¨æ¨¡å¼ + Redis SortedSet + æ»šåŠ¨åˆ†é¡µ</strong>ï¼Œæ—¢ä¿è¯äº† â€œå…³æ³¨åŠ¨æ€çš„å®æ—¶æ¨é€â€ï¼Œåˆè§£å†³äº† â€œFeed æµå®æ—¶æ›´æ–°å¯¼è‡´çš„åˆ†é¡µæ··ä¹±â€ é—®é¢˜ï¼Œæ˜¯ â€œå†™æ‰©æ•£â€ åœ¨ä¸­å°è§„æ¨¡ç²‰ä¸åœºæ™¯ä¸‹çš„å…¸å‹å®è·µã€‚</p>
</div>

    
    <section class="post-copyright">
      
      <p class="copyright-item">
        <span>ä½œè€…:</span>
        <span>è€æ±Ÿæ¹–</span>
      </p>
        
      <p class="copyright-item">
        <span>è®¸å¯è¯:</span>
        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
      </p>
       
      <p class="copyright-item">
        <span>å£å·:</span>
        <span><strong>ä»£ç æ˜¯å¼€æºçš„,æˆ‘ä»¬åªæ˜¯å®ƒçš„æ¬è¿å·¥ã€‚</strong></span>
      </p>
       
        <p class="copyright-item">
        <span>å¦‚æœè§‰å¾—æˆ‘çš„æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè¯·éšæ„è½¬è½½ï¼Œæ„Ÿè°¢æ”¯æŒï¼</span>
      </p>
      
             
        <p class="copyright-item">
        <span>å¦‚æœ‰ä¾µæƒè¯·å‘ŠçŸ¥åˆ é™¤ğŸ™</span>
      </p>
             
        <p class="copyright-item">
        <span>å¦‚æœä½ æœ‰å¾ˆå¥½çš„æƒ³æ³•ğŸ’¡ï¼Œè¯·åŠ¡å¿…è”ç³»æˆ‘ã€‚ </span>
        <br>
         <span>2292360909@qq.com</span>
      </p>
    </section>
    
    <section class="post-tags">
      <div>
        <span>æ ‡ç­¾:</span>
        <span class="tag">
          
        </span>
      </div>
      <div>
        <a href="javascript:window.history.back();">è¿”å›</a>
        <span>Â· </span>
        <a href="/">é¦–é¡µ</a>
      </div>
    </section>
    <section class="post-nav">
      
      <a class="prev" rel="prev" href="/2025/10/12/%E9%BB%91%E9%A9%AC%E7%82%B9%E8%AF%84/09-Redis%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"
        >09-Redisæ¶ˆæ¯é˜Ÿåˆ—</a
      >
       
      <a class="next" rel="next" href="/2025/10/12/%E9%BB%91%E9%A9%AC%E7%82%B9%E8%AF%84/13-%E7%94%A8%E6%88%B7%E7%AD%BE%E5%88%B0/"
        >13-ç”¨æˆ·ç­¾åˆ°</a
      >
      
    </section>

    <!-- Giscus è¯„è®ºåŒºæŒ‚è½½ç‚¹ -->
<div id="giscus-container" style="margin-top: 2.5rem;"></div>

<!-- Giscus åŠ¨æ€åŠ è½½è„šæœ¬ï¼šåˆå§‹åŠ è½½ + æ˜æš—ä¸»é¢˜åˆ‡æ¢ -->
<script>
  function createGiscus(theme) {
    const giscusContainer = document.getElementById('giscus-container');
    if (!giscusContainer) return;

    // æ¸…é™¤æ—§çš„è¯„è®º iframe
    giscusContainer.innerHTML = '';

    const script = document.createElement('script');
    script.src = 'https://giscus.app/client.js';

    // æ›¿æ¢ä¸ºä½ çš„ GitHub ä»“åº“ä¿¡æ¯ï¼ˆæ ¼å¼ï¼šusername/repoï¼‰
    script.setAttribute('data-repo', 'meisijiya/meisijiya.github.io');

   // æ›¿æ¢ä¸ºä½ çš„ repo-id å’Œ category-idï¼ˆåœ¨ giscus.app é…ç½®é¡µé¢ç”Ÿæˆï¼‰
    script.setAttribute('data-repo-id', 'R_kgDOPwTrpQ');
    script.setAttribute('data-category', 'Announcements');
    script.setAttribute('data-category-id', 'DIC_kwDOPwTrpc4CviGR');

    // å…¶ä»–å¸¸è§„æ¨èè®¾ç½®
    script.setAttribute('data-mapping', 'pathname');           // ç”¨é¡µé¢è·¯å¾„åŒ¹é…è¯„è®ºå¸–
    script.setAttribute('data-strict', '0');                   // è‹¥æ— åŒ¹é…å¸–åˆ™åˆ›å»ºæ–°å¸–
    script.setAttribute('data-reactions-enabled', '1');        // å¯ç”¨è¡¨æƒ…ååº”
    script.setAttribute('data-emit-metadata', '0');            // ä¸è¾“å‡ºå…ƒæ•°æ®
    script.setAttribute('data-input-position', 'top');         // è¾“å…¥æ¡†åœ¨è¯„è®ºä¸Šæ–¹
    script.setAttribute('data-theme', theme);                
    script.setAttribute('data-lang', 'zh-CN');                 // ä¸­æ–‡ç•Œé¢
    script.setAttribute('crossorigin', 'anonymous');           // è·¨åŸŸèµ„æºå®‰å…¨
    script.async = true;                                       
     
    giscusContainer.appendChild(script);
  }

  function getCurrentTheme() {
    return document.body.classList.contains('dark-theme') ? 'dark' : 'light';
  }

  document.addEventListener('DOMContentLoaded', () => {
    // é¡µé¢é¦–æ¬¡åŠ è½½ï¼Œæ ¹æ®å½“å‰ä¸»é¢˜æŒ‚è½½è¯„è®º
    createGiscus(getCurrentTheme());

    // ç›‘å¬æŒ‰é’®ç‚¹å‡»åˆ‡æ¢ä¸»é¢˜ â†’ é‡è½½è¯„è®ºåŒº
    const buttons = [
      document.querySelector('.toggleBtn'),
      document.getElementById('mobile-toggle-theme')
    ];
    buttons.forEach(btn => {
      if (!btn) return;
      btn.addEventListener('click', () => {
        setTimeout(() => {
          createGiscus(getCurrentTheme());
        }, 400); // ç¨ä½œå»¶è¿Ÿï¼Œç¡®ä¿ class åˆ‡æ¢å®Œæ¯•
      });
    });

    // ç›‘å¬ body class æ”¹å˜ï¼ˆä¿é™©æ–¹æ¡ˆï¼‰
    const observer = new MutationObserver(() => {
      createGiscus(getCurrentTheme());
    });
    observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });
  });
</script>

  </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© è€æ±Ÿæ¹– | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>
<script src="/js/code-copy.js"></script>


    </div>
</body>
<!-- umami -->
<script defer src="https://cloud.umami.is/script.js" data-website-id="91b923f2-ff2d-43d0-ba5f-bc348d82426a"></script>
</html>