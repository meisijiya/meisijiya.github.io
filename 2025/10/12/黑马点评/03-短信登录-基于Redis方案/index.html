<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="è€æ±Ÿæ¹–">


    <meta name="subtitle" content="è®°å½•è¿›å…¥æˆ¿é—´é—¨åçš„ç¾å¥½">


    <meta name="description" content="ä¸€å¹´å‰ï¼Œå­¤è‹¦ä¼¶ä»ƒçš„è€æ±Ÿæ¹–ï¼Œå¶ç„¶é—´å‘ç°ä¸€å¤„æˆ¿é—´é—¨ï¼Œæ¨é—¨è€Œå…¥ï¼Œä»æ­¤è¿›å…¥äº†å……æ»¡å¹¸ç¦çš„ä¸–ç•Œã€‚">


    <meta name="keywords" content="è€æ±Ÿæ¹–,åšå®¢,æˆ¿é—´é—¨">


<title>03-çŸ­ä¿¡ç™»å½•-åŸºäºRedisæ–¹æ¡ˆ | æ¬¢è¿æ¥åˆ°è€æ±Ÿæ¹–çš„åšå®¢</title>



    <link rel="icon" href="/images/%E9%87%91%E6%AF%9B.png?_t=1758006391547">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    
    <link rel="stylesheet" href="/css/search.css">
    

<!-- highlight.js æ ·å¼ï¼ˆé»˜è®¤äº®è‰²ï¼‰ -->
<link id="hljs-theme" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/github.css">
<!-- highlight.js è‡ªåŠ¨ä¸Šè‰²åŠŸèƒ½ -->
<script src="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/lib/highlight.min.js"></script>
<script>hljs.highlightAll();</script>

<link rel="stylesheet" href="/css/custom.css">



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 7.3.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const pagebody = document.getElementsByTagName('body')[0]

            function setTheme(status) {

                if (status === 'dark') {
                    window.sessionStorage.theme = 'dark'
                    pagebody.classList.add('dark-theme');

                } else if (status === 'light') {
                    window.sessionStorage.theme = 'light'
                    pagebody.classList.remove('dark-theme');
                }
            };

            setTheme(window.sessionStorage.theme)
        })();
    </script>

    <div class="wrapper">
        <header>
  <nav class="navbar">
    <div class="container">
      <div class="navbar-header header-logo">
        <a href="/">è€æ±Ÿæ¹–çš„åšå®¢</a>
      </div>
      <div class="menu navbar-right">
        <!-- åœ¨ç”µè„‘ç«¯çš„å¯¼èˆªé“¾æ¥åŒºåŸŸæ·»åŠ æœç´¢åŠŸèƒ½ -->
        <div class="search-container">
          <a href="javascript:;" onclick="toggleSearchInput()">ğŸ”</a>
          <input
            type="text"
            id="nav-search-input-desktop"
            class="nav-search-input"
            placeholder="æƒ³çŸ¥é“æˆ‘ä»€ä¹ˆç§˜å¯†å‘¢ï¼Œæœæœçœ‹å§"
            oninput="navSearch(this)"
          />
          <div id="nav-search-result-desktop" class="nav-search-result"></div>
        </div>

        
        <a class="menu-item" href="/archives">å½’æ¡£</a>
        
        <a class="menu-item" href="/category">åˆ†ç±»</a>
        
        <a class="menu-item" href="/tag">æ ‡ç­¾</a>
        
        <a class="menu-item" href="/Timer">ä»»åŠ¡è®¡æ—¶å™¨</a>
        
        <a class="menu-item" href="/timeLine">æ—¶é—´çº¿</a>
        
        <a class="menu-item" href="/tongji">ç½‘ç«™ç»Ÿè®¡</a>
        
        <a class="menu-item" href="/about">å…³äº</a>
        

        <input id="switch_default" type="checkbox" class="switch_default" />
        <label for="switch_default" class="toggleBtn"></label>
      </div>
    </div>
  </nav>

  
  <nav class="navbar-mobile" id="nav-mobile">
    <div class="container">
      <div class="navbar-header">
        <div>
          <a href="/">è€æ±Ÿæ¹–çš„åšå®¢</a
          ><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
        </div>

        <div class="menu-toggle" onclick="mobileBtn()">
          <svg
            class="menu-icon"
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
          >
            <path
              fill="currentColor"
              d="M4.5 17.27q-.213 0-.356-.145T4 16.768t.144-.356t.356-.143h15q.213 0 .356.144q.144.144.144.357t-.144.356t-.356.143zm0-4.77q-.213 0-.356-.144T4 11.999t.144-.356t.356-.143h15q.213 0 .356.144t.144.357t-.144.356t-.356.143zm0-4.77q-.213 0-.356-.143Q4 7.443 4 7.23t.144-.356t.356-.143h15q.213 0 .356.144T20 7.23t-.144.356t-.356.144z"
            />
          </svg>
          <svg
            class="close-icon"
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
          >
            <!-- Icon from Material Symbols Light by Google - https://github.com/google/material-design-icons/blob/master/LICENSE -->
            <path
              fill="currentColor"
              d="m12 12.708l-5.246 5.246q-.14.14-.344.15t-.364-.15t-.16-.354t.16-.354L11.292 12L6.046 6.754q-.14-.14-.15-.344t.15-.364t.354-.16t.354.16L12 11.292l5.246-5.246q.14-.14.345-.15q.203-.01.363.15t.16.354t-.16.354L12.708 12l5.246 5.246q.14.14.15.345q.01.203-.15.363t-.354.16t-.354-.16z"
            />
          </svg>
        </div>
      </div>

      <div class="menu" id="mobile-menu">
        
        <a class="menu-item" href="/archives">å½’æ¡£</a>
        
        <a class="menu-item" href="/category">åˆ†ç±»</a>
        
        <a class="menu-item" href="/tag">æ ‡ç­¾</a>
        
        <a class="menu-item" href="/Timer">ä»»åŠ¡è®¡æ—¶å™¨</a>
        
        <a class="menu-item" href="/timeLine">æ—¶é—´çº¿</a>
        
        <a class="menu-item" href="/tongji">ç½‘ç«™ç»Ÿè®¡</a>
        
        <a class="menu-item" href="/about">å…³äº</a>
        
        <!-- æ‰‹æœºæ¨¡å¼æœç´¢æ¡† -->
        <div class="search-container mobile-container">
          <a class="menu-item" href="javascript:;" onclick="toggleSearchInput()"
            >ğŸ”</a
          >
          <input
            type="text"
            id="nav-search-input-mobile"
            class="nav-search-input"
            placeholder="æƒ³çŸ¥é“æˆ‘ä»€ä¹ˆç§˜å¯†å‘¢ï¼Œæœæœçœ‹å§"
            oninput="navSearch(this)"
          />
          <div id="nav-search-result-mobile" class="nav-search-result"></div>
        </div>
      </div>
    </div>
  </nav>
</header>
<script>
  var mobileBtn = function f() {
    var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
    var mobileMenu = document.getElementById("mobile-menu");
    if (toggleMenu.classList.contains("active")) {
      toggleMenu.classList.remove("active");
      mobileMenu.classList.remove("active");
    } else {
      toggleMenu.classList.add("active");
      mobileMenu.classList.add("active");
    }
  };

  function toggleSearchInput() {
    const inputs = document.querySelectorAll(".nav-search-input");
    const results = document.querySelectorAll(".nav-search-result");
    inputs.forEach((input) => {
      input.classList.toggle("active");
      if (input.classList.contains("active")) input.focus();
    });
    results.forEach((r) => (r.style.display = "none"));
  }

  // ç‚¹å‡»å¤–éƒ¨åŒºåŸŸéšè—æœç´¢æ¡†å’Œç»“æœå®¹å™¨çš„å‡½æ•°
  function handleClickOutsideSearch(event) {
    const searchContainers = document.querySelectorAll(".search-container");
    searchContainers.forEach((container) => {
      const searchInput = container.querySelector(".nav-search-input");
      const searchIcon = container.querySelector("a");

      // å¦‚æœç‚¹å‡»çš„å…ƒç´ ä¸æ˜¯æœç´¢è¾“å…¥æ¡†æˆ–æœç´¢å›¾æ ‡ï¼Œåˆ™éšè—æœç´¢æ¡†å’Œç»“æœå®¹å™¨
      if (
        !searchInput.contains(event.target) &&
        !searchIcon.contains(event.target)
      ) {
        searchInput.classList.remove("active");
        searchInput.value = ""
        // æ ¹æ®è¾“å…¥æ¡†IDç¡®å®šå¯¹åº”çš„ç»“æœå®¹å™¨
        let resultContainer;
        if (searchInput.id === "nav-search-input-mobile") {
          // ç§»åŠ¨ç«¯ç»“æœå®¹å™¨
          resultContainer = document.querySelector(
            ".navbar-mobile .nav-search-result"
          );
        } else {
          // æ¡Œé¢ç«¯ç»“æœå®¹å™¨
          resultContainer = document.getElementById(
            "nav-search-result-desktop"
          );
        }

        if (resultContainer) {
          resultContainer.style.display = "none";
          resultContainer.innerHTML = ""; // æ¸…ç©ºç»“æœå®¹å™¨å†…å®¹
        }
      }
    });
  }

  // æ·»åŠ å…¨å±€ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
  document.addEventListener("click", function (event) {
    handleClickOutsideSearch(event);
  });

  // æ–°å¢ï¼šæœç´¢åŠŸèƒ½å®ç°
  let searchData = []; // å…¨å±€å˜é‡å­˜å‚¨æœç´¢æ•°æ®

  // é¡µé¢åŠ è½½å®Œæˆåè·å–æœç´¢æ•°æ®
  document.addEventListener("DOMContentLoaded", function () {
    fetch("/search.xml")
      .then((res) => res.text())
      .then((xmlText) => {
        const parser = new DOMParser();
        const xml = parser.parseFromString(xmlText, "text/xml");
        const entries = xml.getElementsByTagName("entry");
        for (let entry of entries) {
          searchData.push({
            title: entry.getElementsByTagName("title")[0]?.textContent || "",
            content:
              entry.getElementsByTagName("content")[0]?.textContent || "",
            url: entry.getElementsByTagName("url")[0]?.textContent || "",
          });
        }
      })
      .catch((err) => {
        console.error("Failed to load search data:", err);
      });
  });

  // æ–°å¢ï¼šå¯¼èˆªæœç´¢æ–¹æ³•
  function navSearch(inputElement) {
    const keyword = inputElement.value.trim().toLowerCase();
    // æŸ¥æ‰¾å¯¹åº”çš„æœç´¢ç»“æœå®¹å™¨
    let resultContainer;

    if (inputElement.id === "nav-search-input-desktop") {
      // æ¡Œé¢ç«¯
      resultContainer = document.getElementById("nav-search-result-desktop");
    } else if (inputElement.id === "nav-search-input-mobile") {
      // ç§»åŠ¨ç«¯
      resultContainer =
        inputElement.parentNode.querySelector(".nav-search-result");
    }

    if (!resultContainer) return;

    resultContainer.innerHTML = "";

    if (!keyword) {
      resultContainer.style.display = "none";
      return;
    }

    // æ˜¾ç¤ºç»“æœå®¹å™¨
    resultContainer.style.display = "block";

    // è¿‡æ»¤æœç´¢æ•°æ®
    const results = searchData.filter(
      (data) =>
        (data.title && data.title.toLowerCase().includes(keyword)) ||
        (data.content && data.content.toLowerCase().includes(keyword))
    );

    if (results.length === 0) {
      resultContainer.innerHTML =
        '<p class="no-result">æ²¡æœ‰ç»“æœå“Ÿï¼Œæ¢ä¸ªå…³é”®è¯è¯•è¯•å§</p>';
      return;
    }

    // é™åˆ¶æ˜¾ç¤ºç»“æœæ•°é‡
    const maxResults = 10;
    const limitedResults = results.slice(0, maxResults);

    // æ„å»ºç»“æœHTML
    const html = limitedResults
      .map((item) => {
        // æå–åŒ…å«å…³é”®å­—çš„å†…å®¹ç‰‡æ®µ
        let contentSnippet = "";
        if (item.content) {
          // æ‰¾åˆ°åŒ…å«å…³é”®å­—çš„å†…å®¹ç‰‡æ®µ
          const contentLower = item.content.toLowerCase();
          const keywordIndex = contentLower.indexOf(keyword);

          // æå–å…³é”®å­—å‰åçš„å†…å®¹
          const start = Math.max(0, keywordIndex - 3 * keyword.length);
          const end = Math.min(
            item.content.length,
            keywordIndex + 3 * keyword.length
          );
          contentSnippet = item.content.substring(start, end);
        // é«˜äº®å…³é”®å­—
      const keywordRegex = new RegExp(`(${keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
      contentSnippet = contentSnippet.replace(
        keywordRegex,
        "<mark>$1</mark>"
      );
        }

        return `<div class="search-result-item">
  <a href="${item.url}">
    <div>æ ‡é¢˜ï¼š${item.title}</div>
    <div>å†…å®¹ï¼š${contentSnippet}</div>
  </a>
</div>`;
      })
      .join("");
    resultContainer.innerHTML = html;
  }
</script>
<style>
  /* æ‰‹æœºç«¯ä½¿ç”¨flexboxå¸ƒå±€æœç´¢å®¹å™¨ */
  .mobile-container {
    display: flex;
    align-items: center;
    flex-direction: row;
    margin-bottom: 10px;
    margin-left: 10px;
    flex-grow: 1;
    max-width: calc(100% - 40px);
  }


  .search-result-item {
  border: 1px solid #ddd; /* è¾¹æ¡† */
  margin: 4px 0; /* å¤–å±‚é—´è· */
  padding: 0; /* æ— å†…è¾¹è· */
  background: #fff; /* èƒŒæ™¯è‰² */
}

.search-result-item a {
  display: block;
  text-decoration: none;
  color: inherit;
}

.search-result-item div {
  padding: 3px 8px; /* ç´§å‡‘çš„å†…è¾¹è· */
  margin: 0; /* æ— å¤–è¾¹è· */
  line-height: 1.3; /* ç´§å‡‘çš„è¡Œé«˜ */
  word-wrap: break-word; /* å…è®¸é•¿å•è¯æ¢è¡Œ */
  white-space: normal; /* å…è®¸æ­£å¸¸æ¢è¡Œ */
}

.search-result-item div:first-child {
  border-bottom: 1px solid #eee; /* æ ‡é¢˜å’Œå†…å®¹ä¹‹é—´çš„åˆ†éš”çº¿ */
}


</style>

            <div class="main">
                <div class="container">
    <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">å±•å¼€æ‰€æœ‰</a>
        <a onclick="go_top()">è¿”å›é¡¶éƒ¨</a>
        <a onclick="go_bottom()">è¿”å›åº•éƒ¨</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // ä¸º 6 æ—¶å±•å¼€æ‰€æœ‰
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // è¿™ä¸ªå€¼æ˜¯ç”± tocbot æºç é‡Œå®šä¹‰çš„ scrollSmoothDuration å¾—æ¥çš„
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'å±•å¼€æ‰€æœ‰' : 'æŠ˜å æ‰€æœ‰';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>  
  <article class="post-wrap">
    <header class="post-header">
      <h1 class="post-title">03-çŸ­ä¿¡ç™»å½•-åŸºäºRedisæ–¹æ¡ˆ</h1>
      
      <div class="post-meta">
         ä½œè€…:
        <a itemprop="author" rel="author" href="/">è€æ±Ÿæ¹–</a>
         
        <span class="post-time">
          <br />æ—¥æœŸ:
          <a href="#"
            >åæœˆ 12, 2025&nbsp;&nbsp;0:00:00</a
          >
        </span>
         
        <span class="post-category"
          ><br />
          åˆ†ç±»: 
          <a href="/categories/%E9%BB%91%E9%A9%AC%E7%82%B9%E8%AF%84/">é»‘é©¬ç‚¹è¯„</a>
          
        </span>
        
      </div>
      
    </header>

    <div class="post-content"><h1 id="åŸºäºRedisæ–¹æ¡ˆ"><a href="#åŸºäºRedisæ–¹æ¡ˆ" class="headerlink" title="åŸºäºRedisæ–¹æ¡ˆ"></a>åŸºäºRedisæ–¹æ¡ˆ</h1><p>å‘é€çŸ­ä¿¡éªŒè¯ç æ—¶ï¼Œå›  Redis æ•°æ®ç»“æ„å¤šæ ·ï¼ŒéªŒè¯ç ç®€å•æ•…é€‰ç”¨ string ç±»å‹ï¼Œä¸”ä¸èƒ½ç”¨ code è€Œè¦ç”¨æ‰‹æœºå·ä½œä¸º keyï¼Œä»¥ä¿è¯å”¯ä¸€æ€§å’Œæ–¹ä¾¿è·å–ã€‚ä¿å­˜ç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œå¯¹æ¯” string å’Œå“ˆå¸Œä¸¤ç§æ•°æ®ç±»å‹ï¼Œæ¨èç”¨å“ˆå¸Œç»“æ„ï¼›ä¿å­˜ç”¨æˆ·ä¿¡æ¯çš„ keyï¼Œå»ºè®®ç”¨éšæœº token è€Œéæ‰‹æœºå·ï¼Œè¦å°† token è¿”å›å‰ç«¯å¹¶ä¿å­˜ï¼Œå‰ç«¯é€šè¿‡ session storage å­˜å‚¨ï¼Œaxos æ‹¦æˆªå™¨å°†å…¶æ”¾å…¥è¯·æ±‚å¤´å®ç°æ¯æ¬¡è¯·æ±‚æºå¸¦ï¼Œä»¥æ­¤å®ç°ç™»å½•æ ¡éªŒã€‚</p>
<h2 id="RedisåŸºç¡€"><a href="#RedisåŸºç¡€" class="headerlink" title="RedisåŸºç¡€"></a>RedisåŸºç¡€</h2><p>Redisæ˜¯å…¸å‹çš„key-valueæ•°æ®åº“ï¼Œkeyä¸€èˆ¬æ˜¯å­—ç¬¦ä¸²ï¼Œè€ŒvalueåŒ…å«å¾ˆå¤šä¸åŒçš„æ•°æ®ç±»å‹ï¼š</p>
<p><img src="/images/%E9%BB%91%E9%A9%AC%E7%82%B9%E8%AF%84/image-20250923160535557.png" alt="image-20250923160535557.png"></p>
<p>Redisä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬å­¦ä¹ ï¼Œå°†æ“ä½œä¸åŒæ•°æ®ç±»å‹çš„å‘½ä»¤ä¹Ÿåšäº†åˆ†ç»„ï¼Œåœ¨å®˜ç½‘ï¼ˆ <a target="_blank" rel="noopener" href="https://redis.io/commands">https://redis.io/commands </a>ï¼‰å¯ä»¥æŸ¥çœ‹åˆ°ä¸åŒçš„å‘½ä»¤ï¼š</p>
<h2 id="Redisçš„Javaå®¢æˆ·ç«¯-SpringDataRedis"><a href="#Redisçš„Javaå®¢æˆ·ç«¯-SpringDataRedis" class="headerlink" title="Redisçš„Javaå®¢æˆ·ç«¯-SpringDataRedis"></a>Redisçš„Javaå®¢æˆ·ç«¯-SpringDataRedis</h2><p>SpringDataæ˜¯Springä¸­æ•°æ®æ“ä½œçš„æ¨¡å—ï¼ŒåŒ…å«å¯¹å„ç§æ•°æ®åº“çš„é›†æˆï¼Œå…¶ä¸­å¯¹Redisçš„é›†æˆæ¨¡å—å°±å«åšSpringDataRedisï¼Œå®˜ç½‘åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://spring.io/projects/spring-data-redis">https://spring.io/projects/spring-data-redis</a></p>
<ul>
<li>æä¾›äº†å¯¹ä¸åŒRediså®¢æˆ·ç«¯çš„æ•´åˆï¼ˆLettuceå’ŒJedisï¼‰</li>
<li>æä¾›äº†RedisTemplateç»Ÿä¸€APIæ¥æ“ä½œRedis</li>
<li>æ”¯æŒRedisçš„å‘å¸ƒè®¢é˜…æ¨¡å‹</li>
<li>æ”¯æŒRediså“¨å…µå’ŒRedisé›†ç¾¤</li>
<li>æ”¯æŒåŸºäºLettuceçš„å“åº”å¼ç¼–ç¨‹</li>
<li>æ”¯æŒåŸºäºJDK.JSON.å­—ç¬¦ä¸².Springå¯¹è±¡çš„æ•°æ®åºåˆ—åŒ–åŠååºåˆ—åŒ–</li>
<li>æ”¯æŒåŸºäºRedisçš„JDKCollectionå®ç°</li>
</ul>
<p>SpringDataRedisä¸­æä¾›äº†RedisTemplateå·¥å…·ç±»ï¼Œå…¶ä¸­å°è£…äº†å„ç§å¯¹Redisçš„æ“ä½œã€‚å¹¶ä¸”å°†ä¸åŒæ•°æ®ç±»å‹çš„æ“ä½œAPIå°è£…åˆ°äº†ä¸åŒçš„ç±»å‹ä¸­ï¼š</p>
<table>
<thead>
<tr>
<th>API</th>
<th>è¿”å›å€¼ç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>redisTemplate.opsForValue()</td>
<td>ValueOperation</td>
<td>æ“ä½œStringç±»å‹æ•°æ®</td>
</tr>
<tr>
<td>redisTemplate.opsForHash()</td>
<td>HashOperation</td>
<td>æ“ä½œHashç±»å‹æ•°æ®</td>
</tr>
<tr>
<td>redisTemplate.opsForList()</td>
<td>ListOperation</td>
<td>æ“ä½œListç±»å‹æ•°æ®</td>
</tr>
<tr>
<td>redisTemplate.opsForSet()</td>
<td>SetOperations</td>
<td>æ“ä½œSetç±»å‹æ•°æ®</td>
</tr>
<tr>
<td>redisTemplate.opsForZSet()</td>
<td>ZSetOperation</td>
<td>æ“ä½œSortedSetç±»å‹æ•°æ®</td>
</tr>
<tr>
<td>redisTemplate</td>
<td></td>
<td>é€šç”¨çš„å‘½ä»¤</td>
</tr>
</tbody></table>
<h3 id="å¿«é€Ÿå…¥é—¨"><a href="#å¿«é€Ÿå…¥é—¨" class="headerlink" title="å¿«é€Ÿå…¥é—¨"></a>å¿«é€Ÿå…¥é—¨</h3><p>SpringBootå·²ç»æä¾›äº†å¯¹SpringDataRedisçš„æ”¯æŒï¼Œä½¿ç”¨éå¸¸ç®€å•ï¼š</p>
<h4 id="1-å¯¼å…¥pomåæ ‡"><a href="#1-å¯¼å…¥pomåæ ‡" class="headerlink" title="1.å¯¼å…¥pomåæ ‡"></a>1.å¯¼å…¥pomåæ ‡</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.heima<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>redis-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>redis-demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--redisä¾èµ–--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--common-pool--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--Jacksonä¾èµ–--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>     </span><br><span class="line">                        <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-é…ç½®æ–‡ä»¶"><a href="#2-é…ç½®æ–‡ä»¶" class="headerlink" title="2 .é…ç½®æ–‡ä»¶"></a>2 .é…ç½®æ–‡ä»¶</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.150</span><span class="number">.101</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123321</span></span><br><span class="line">    <span class="attr">lettuce:</span></span><br><span class="line">      <span class="attr">pool:</span></span><br><span class="line">        <span class="attr">max-active:</span> <span class="number">8</span>  <span class="comment">#æœ€å¤§è¿æ¥</span></span><br><span class="line">        <span class="attr">max-idle:</span> <span class="number">8</span>   <span class="comment">#æœ€å¤§ç©ºé—²è¿æ¥</span></span><br><span class="line">        <span class="attr">min-idle:</span> <span class="number">0</span>   <span class="comment">#æœ€å°ç©ºé—²è¿æ¥</span></span><br><span class="line">        <span class="attr">max-wait:</span> <span class="string">100ms</span> <span class="comment">#è¿æ¥ç­‰å¾…æ—¶é—´</span></span><br></pre></td></tr></table></figure>

<h4 id="3-æ³¨å…¥RedisTemplate"><a href="#3-æ³¨å…¥RedisTemplate" class="headerlink" title="3.æ³¨å…¥RedisTemplate"></a>3.æ³¨å…¥RedisTemplate</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br></pre></td></tr></table></figure>

<h4 id="4-åºåˆ—åŒ–æ–¹æ¡ˆ"><a href="#4-åºåˆ—åŒ–æ–¹æ¡ˆ" class="headerlink" title="4.åºåˆ—åŒ–æ–¹æ¡ˆ"></a>4.åºåˆ—åŒ–æ–¹æ¡ˆ</h4><h5 id="é»˜è®¤-JDK-åºåˆ—åŒ–çš„é—®é¢˜"><a href="#é»˜è®¤-JDK-åºåˆ—åŒ–çš„é—®é¢˜" class="headerlink" title="é»˜è®¤ JDK åºåˆ—åŒ–çš„é—®é¢˜"></a>é»˜è®¤ JDK åºåˆ—åŒ–çš„é—®é¢˜</h5><p><code>RedisTemplate</code> é»˜è®¤ä½¿ç”¨ <strong>JDK åºåˆ—åŒ–</strong>ï¼Œå°†å¯¹è±¡è½¬ä¸ºå­—èŠ‚æ•°ç»„å­˜å‚¨ï¼Œå­˜åœ¨æ˜æ˜¾ç¼ºé™·ï¼š</p>
<ul>
<li><strong>å¯è¯»æ€§å·®</strong>ï¼šå­˜å‚¨ç»“æœä¸ºä¹±ç æ ¼å¼ï¼Œæ— æ³•ç›´æ¥è¯†åˆ«å†…å®¹ã€‚</li>
<li><strong>å†…å­˜å ç”¨å¤§</strong>ï¼šåºåˆ—åŒ–ç»“æœåŒ…å«å¤§é‡å†—ä½™ä¿¡æ¯ï¼Œæ¶ˆè€—æ›´å¤š Redis å†…å­˜ã€‚</li>
</ul>
<h5 id="ä¸¤ç§è§£å†³æ–¹æ¡ˆ"><a href="#ä¸¤ç§è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ä¸¤ç§è§£å†³æ–¹æ¡ˆ"></a>ä¸¤ç§è§£å†³æ–¹æ¡ˆ</h5><p><strong>ä¸¤ç§åºåˆ—åŒ–å®è·µæ–¹æ¡ˆå¯¹æ¯”</strong></p>
<table>
<thead>
<tr>
<th>å¯¹æ¯”ç»´åº¦</th>
<th>æ–¹æ¡ˆä¸€ï¼šè‡ªå®šä¹‰ RedisTemplateï¼ˆJSON è‡ªåŠ¨åºåˆ—åŒ–ï¼‰</th>
<th align="left">æ–¹æ¡ˆäºŒï¼šä½¿ç”¨ StringRedisTemplateï¼ˆæ‰‹åŠ¨ JSON åºåˆ—åŒ–ï¼‰</th>
</tr>
</thead>
<tbody><tr>
<td>æ ¸å¿ƒç»„ä»¶</td>
<td><code>RedisTemplate&lt;String, Object&gt;</code> + <code>GenericJackson2JsonRedisSerializer</code></td>
<td align="left"><code>StringRedisTemplate</code>ï¼ˆé»˜è®¤ String åºåˆ—åŒ–ï¼‰ + <code>ObjectMapper</code></td>
</tr>
<tr>
<td>åºåˆ—åŒ–æ–¹å¼</td>
<td>è‡ªåŠ¨ï¼ˆæ¡†æ¶å®Œæˆå¯¹è±¡ä¸ JSON çš„è½¬æ¢ï¼‰</td>
<td align="left">æ‰‹åŠ¨ï¼ˆå¼€å‘è€…é€šè¿‡<code>ObjectMapper</code> æ§åˆ¶åºåˆ—åŒ– &#x2F; ååºåˆ—åŒ–ï¼‰</td>
</tr>
<tr>
<td>é¢å¤–å†…å­˜å¼€é”€</td>
<td>æœ‰ï¼ˆJSON ä¸­åŒ…å«ç±»çš„<code>class</code> ä¿¡æ¯ï¼Œç”¨äºååºåˆ—åŒ–ï¼‰</td>
<td align="left">æ— ï¼ˆä»…å­˜å‚¨çº¯ JSON æ•°æ®ï¼Œæ— å†—ä½™ç±»ä¿¡æ¯ï¼‰</td>
</tr>
<tr>
<td>ä»£ç å¤æ‚åº¦</td>
<td>ä½ï¼ˆé…ç½®ä¸€æ¬¡å³å¯å…¨å±€ä½¿ç”¨ï¼‰</td>
<td align="left">ä¸­ï¼ˆæ¯æ¬¡æ“ä½œéœ€æ‰‹åŠ¨å†™åºåˆ—åŒ– &#x2F; ååºåˆ—åŒ–ä»£ç ï¼‰</td>
</tr>
<tr>
<td>é€‚ç”¨åœºæ™¯</td>
<td>å¿«é€Ÿå¼€å‘ã€å¯¹è±¡ç±»å‹å›ºå®šã€å¯¹å†…å­˜å¼€é”€ä¸æ•æ„Ÿçš„åœºæ™¯</td>
<td align="left">é«˜å¹¶å‘ã€å¯¹å†…å­˜å ç”¨è¦æ±‚ä¸¥æ ¼ã€éœ€ç²¾ç»†æ§åˆ¶åºåˆ—åŒ–çš„åœºæ™¯</td>
</tr>
</tbody></table>
<h6 id="è‡ªå®šä¹‰-RedisTemplateï¼ˆè‡ªåŠ¨-JSON-åºåˆ—åŒ–ï¼‰"><a href="#è‡ªå®šä¹‰-RedisTemplateï¼ˆè‡ªåŠ¨-JSON-åºåˆ—åŒ–ï¼‰" class="headerlink" title="è‡ªå®šä¹‰ RedisTemplateï¼ˆè‡ªåŠ¨ JSON åºåˆ—åŒ–ï¼‰"></a>è‡ªå®šä¹‰ RedisTemplateï¼ˆè‡ªåŠ¨ JSON åºåˆ—åŒ–ï¼‰</h6><p>é€šè¿‡é…ç½®ç±»ä¿®æ”¹ <code>RedisTemplate</code> çš„é»˜è®¤åºåˆ—åŒ–å™¨ï¼Œä½¿ç”¨ JSON æ ¼å¼è‡ªåŠ¨å¤„ç†å¯¹è±¡è½¬æ¢ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedisConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title function_">redisTemplate</span><span class="params">(RedisConnectionFactory connectionFactory)</span> &#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> <span class="title class_">RedisTemplate</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// é…ç½®è¿æ¥å·¥å‚</span></span><br><span class="line">        template.setConnectionFactory(connectionFactory);</span><br><span class="line">        <span class="comment">// JSON åºåˆ—åŒ–å·¥å…·</span></span><br><span class="line">        <span class="type">GenericJackson2JsonRedisSerializer</span> <span class="variable">jsonSerializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericJackson2JsonRedisSerializer</span>();</span><br><span class="line">        <span class="comment">// Key/HashKey ç”¨ String åºåˆ—åŒ–ï¼ˆä¿è¯å¯è¯»æ€§ï¼‰</span></span><br><span class="line">        template.setKeySerializer(RedisSerializer.string());</span><br><span class="line">        template.setHashKeySerializer(RedisSerializer.string());</span><br><span class="line">        <span class="comment">// Value/HashValue ç”¨ JSON åºåˆ—åŒ–ï¼ˆè‡ªåŠ¨è½¬æ¢å¯¹è±¡ï¼‰</span></span><br><span class="line">        template.setValueSerializer(jsonSerializer);</span><br><span class="line">        template.setHashValueSerializer(jsonSerializer);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç‰¹ç‚¹</strong></p>
<ul>
<li>ä¼˜åŠ¿ï¼šæ— éœ€æ‰‹åŠ¨å¤„ç† JSON è½¬æ¢ï¼Œå¼€å‘æ•ˆç‡é«˜ï¼Œæ”¯æŒå¯¹è±¡ä¸ JSON çš„è‡ªåŠ¨æ˜ å°„ã€‚</li>
<li>åŠ£åŠ¿ï¼šJSON æ•°æ®ä¸­ä¼šæºå¸¦ <code>@class</code> å­—æ®µï¼ˆå¦‚ <code>&#123;&quot;@class&quot;:&quot;com.example.User&quot;,&quot;name&quot;:&quot;è™å“¥&quot;,&quot;age&quot;:21&#125;</code>ï¼‰ï¼Œå ç”¨é¢å¤–å†…å­˜ã€‚</li>
</ul>
<h6 id="ä½¿ç”¨-StringRedisTemplateï¼ˆæ‰‹åŠ¨-JSON-åºåˆ—åŒ–ï¼‰"><a href="#ä½¿ç”¨-StringRedisTemplateï¼ˆæ‰‹åŠ¨-JSON-åºåˆ—åŒ–ï¼‰" class="headerlink" title="ä½¿ç”¨ StringRedisTemplateï¼ˆæ‰‹åŠ¨ JSON åºåˆ—åŒ–ï¼‰"></a>ä½¿ç”¨ StringRedisTemplateï¼ˆæ‰‹åŠ¨ JSON åºåˆ—åŒ–ï¼‰</h6><p><code>StringRedisTemplate</code> æ˜¯ <code>RedisTemplate</code> çš„å­ç±»ï¼Œé»˜è®¤ Key å’Œ Value å‡ä½¿ç”¨ <strong>String åºåˆ—åŒ–</strong>ï¼Œéœ€å¼€å‘è€…æ‰‹åŠ¨é€šè¿‡ <code>ObjectMapper</code> å®Œæˆå¯¹è±¡ä¸ JSON çš„è½¬æ¢ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StringRedisTemplateTests</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">    <span class="comment">// æ‰‹åŠ¨ JSON å·¥å…·</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ObjectMapper</span> <span class="variable">MAPPER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testSaveUser</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException &#123;</span><br><span class="line">        <span class="comment">// 1. åˆ›å»ºå¯¹è±¡</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;è™å“¥&quot;</span>, <span class="number">21</span>);</span><br><span class="line">        <span class="comment">// 2. æ‰‹åŠ¨åºåˆ—åŒ–ï¼ˆå¯¹è±¡ â†’ JSON å­—ç¬¦ä¸²ï¼‰</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> MAPPER.writeValueAsString(user);</span><br><span class="line">        <span class="comment">// 3. å†™å…¥ Redis</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(<span class="string">&quot;user:200&quot;</span>, json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. è¯»å– Redis</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonUser</span> <span class="operator">=</span> stringRedisTemplate.opsForValue().get(<span class="string">&quot;user:200&quot;</span>);</span><br><span class="line">        <span class="comment">// 5. æ‰‹åŠ¨ååºåˆ—åŒ–ï¼ˆJSON å­—ç¬¦ä¸² â†’ å¯¹è±¡ï¼‰</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> MAPPER.readValue(jsonUser, User.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;user1 = &quot;</span> + user1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>ç‰¹ç‚¹</strong></p>
<ul>
<li>ä¼˜åŠ¿ï¼šJSON æ•°æ®æ— å†—ä½™ <code>class</code> ä¿¡æ¯ï¼Œå†…å­˜å ç”¨æå°ï¼Œåºåˆ—åŒ–è¿‡ç¨‹å®Œå…¨å¯æ§ã€‚</li>
<li>åŠ£åŠ¿ï¼šæ¯æ¬¡æ“ä½œéœ€é‡å¤ç¼–å†™åºåˆ—åŒ– &#x2F; ååºåˆ—åŒ–ä»£ç ï¼Œä»£ç é‡ç•¥å¤šã€‚</li>
</ul>
<h6 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h6><p>RedisTemplateçš„ä¸¤ç§åºåˆ—åŒ–å®è·µæ–¹æ¡ˆï¼š</p>
<ul>
<li><p>æ–¹æ¡ˆä¸€ï¼š</p>
<ul>
<li>è‡ªå®šä¹‰RedisTemplate</li>
<li>ä¿®æ”¹RedisTemplateçš„åºåˆ—åŒ–å™¨ä¸ºGenericJackson2JsonRedisSerializer</li>
</ul>
</li>
<li><p>æ–¹æ¡ˆäºŒï¼š</p>
<ul>
<li>ä½¿ç”¨StringRedisTemplate</li>
<li>å†™å…¥Redisæ—¶ï¼Œæ‰‹åŠ¨æŠŠå¯¹è±¡åºåˆ—åŒ–ä¸ºJSON</li>
<li>è¯»å–Redisæ—¶ï¼Œæ‰‹åŠ¨æŠŠè¯»å–åˆ°çš„JSONååºåˆ—åŒ–ä¸ºå¯¹è±¡</li>
</ul>
</li>
</ul>
<h4 id="5-Redis-Hashæ“ä½œ"><a href="#5-Redis-Hashæ“ä½œ" class="headerlink" title="5.Redis Hashæ“ä½œ"></a>5.Redis Hashæ“ä½œ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RedisHashTests</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">    <span class="comment">// æ‰‹åŠ¨JSONåºåˆ—åŒ–å·¥å…·ï¼ˆè‹¥Hashå€¼ä¸ºå¯¹è±¡æ—¶ä½¿ç”¨ï¼‰</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ObjectMapper</span> <span class="variable">MAPPER</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectMapper</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1. å‘Hashä¸­æ·»åŠ å•ä¸ªå­—æ®µï¼ˆå€¼ä¸ºæ™®é€šå­—ç¬¦ä¸²ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testHashPut</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æ“ä½œHashï¼škey=user:info:100ï¼ˆç”¨æˆ·100çš„ä¿¡æ¯ï¼‰ï¼ŒhashKey=name/ageï¼ŒhashValue=å¯¹åº”å€¼</span></span><br><span class="line">        stringRedisTemplate.opsForHash().put(<span class="string">&quot;user:info:100&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;è™å“¥&quot;</span>);</span><br><span class="line">        stringRedisTemplate.opsForHash().put(<span class="string">&quot;user:info:100&quot;</span>, <span class="string">&quot;age&quot;</span>, <span class="string">&quot;21&quot;</span>);</span><br><span class="line">        stringRedisTemplate.opsForHash().put(<span class="string">&quot;user:info:100&quot;</span>, <span class="string">&quot;gender&quot;</span>, <span class="string">&quot;ç”·&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 2. å‘Hashä¸­æ‰¹é‡æ·»åŠ å­—æ®µï¼ˆå€¼å«å¯¹è±¡ï¼Œéœ€æ‰‹åŠ¨åºåˆ—åŒ–ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testHashPutAll</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException &#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿå¤æ‚å€¼ï¼šåœ°å€å¯¹è±¡ï¼ˆéœ€è½¬JSONå­—ç¬¦ä¸²ï¼‰</span></span><br><span class="line">        <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Address</span>(<span class="string">&quot;åŒ—äº¬å¸‚&quot;</span>, <span class="string">&quot;æœé˜³åŒº&quot;</span>, <span class="string">&quot;XXè¡—é“&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">addressJson</span> <span class="operator">=</span> MAPPER.writeValueAsString(address);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰¹é‡å°è£…Hashå­—æ®µ</span></span><br><span class="line">        Map&lt;String, Object&gt; hashMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        hashMap.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;è™å“¥&quot;</span>);</span><br><span class="line">        hashMap.put(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;21&quot;</span>);</span><br><span class="line">        hashMap.put(<span class="string">&quot;address&quot;</span>, addressJson); <span class="comment">// å­˜å‚¨åºåˆ—åŒ–åçš„å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰¹é‡å†™å…¥Hash</span></span><br><span class="line">        stringRedisTemplate.opsForHash().putAll(<span class="string">&quot;user:info:100&quot;</span>, hashMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 3. è·å–Hashä¸­å•ä¸ªå­—æ®µçš„å€¼</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testHashGet</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException &#123;</span><br><span class="line">        <span class="comment">// è·å–æ™®é€šå­—æ®µï¼ˆname/ageï¼‰</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">name</span> <span class="operator">=</span> stringRedisTemplate.opsForHash().get(<span class="string">&quot;user:info:100&quot;</span>, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">age</span> <span class="operator">=</span> stringRedisTemplate.opsForHash().get(<span class="string">&quot;user:info:100&quot;</span>, <span class="string">&quot;age&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;å§“åï¼š&quot;</span> + name + <span class="string">&quot;ï¼Œå¹´é¾„ï¼š&quot;</span> + age);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å¯¹è±¡å­—æ®µï¼ˆaddressï¼Œéœ€æ‰‹åŠ¨ååºåˆ—åŒ–ï¼‰</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">addressJson</span> <span class="operator">=</span> (String) stringRedisTemplate.opsForHash().get(<span class="string">&quot;user:info:100&quot;</span>, <span class="string">&quot;address&quot;</span>);</span><br><span class="line">        <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> MAPPER.readValue(addressJson, Address.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;åœ°å€ï¼š&quot;</span> + address);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 4. è·å–Hashä¸­æ‰€æœ‰å­—æ®µå’Œå€¼ï¼ˆé”®å€¼å¯¹ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testHashGetAll</span><span class="params">()</span> <span class="keyword">throws</span> JsonProcessingException &#123;</span><br><span class="line">        Map&lt;Object, Object&gt; hashEntries = stringRedisTemplate.opsForHash().entries(<span class="string">&quot;user:info:100&quot;</span>);</span><br><span class="line">        <span class="comment">// éå†å¤„ç†ï¼šæ™®é€šå­—æ®µç›´æ¥è·å–ï¼Œå¯¹è±¡å­—æ®µéœ€ååºåˆ—åŒ–</span></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;Object, Object&gt; entry : hashEntries.entrySet()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">hashKey</span> <span class="operator">=</span> (String) entry.getKey();</span><br><span class="line">            <span class="type">Object</span> <span class="variable">hashValue</span> <span class="operator">=</span> entry.getValue();</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">&quot;address&quot;</span>.equals(hashKey)) &#123;</span><br><span class="line">                <span class="comment">// ååºåˆ—åŒ–åœ°å€å¯¹è±¡</span></span><br><span class="line">                <span class="type">Address</span> <span class="variable">address</span> <span class="operator">=</span> MAPPER.readValue((String) hashValue, Address.class);</span><br><span class="line">                System.out.println(hashKey + <span class="string">&quot;ï¼š&quot;</span> + address);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(hashKey + <span class="string">&quot;ï¼š&quot;</span> + hashValue);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 5. è·å–Hashä¸­æ‰€æœ‰å­—æ®µï¼ˆä»…é”®ï¼‰/ æ‰€æœ‰å€¼ï¼ˆä»…å€¼ï¼‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testHashKeysAndValues</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–æ‰€æœ‰å­—æ®µï¼ˆHashKeyï¼‰</span></span><br><span class="line">        Set&lt;Object&gt; hashKeys = stringRedisTemplate.opsForHash().keys(<span class="string">&quot;user:info:100&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰€æœ‰å­—æ®µï¼š&quot;</span> + hashKeys);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–æ‰€æœ‰å€¼ï¼ˆHashValueï¼‰</span></span><br><span class="line">        List&lt;Object&gt; hashValues = stringRedisTemplate.opsForHash().values(<span class="string">&quot;user:info:100&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰€æœ‰å€¼ï¼š&quot;</span> + hashValues);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 6. åˆ é™¤Hashä¸­çš„æŒ‡å®šå­—æ®µ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testHashDelete</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ é™¤å•ä¸ª/å¤šä¸ªå­—æ®µï¼ˆè¿”å›åˆ é™¤æˆåŠŸçš„å­—æ®µæ•°é‡ï¼‰</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">deleteCount</span> <span class="operator">=</span> stringRedisTemplate.opsForHash().delete(<span class="string">&quot;user:info:100&quot;</span>, <span class="string">&quot;gender&quot;</span>, <span class="string">&quot;age&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;åˆ é™¤æˆåŠŸçš„å­—æ®µæ•°ï¼š&quot;</span> + deleteCount);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 7. åˆ¤æ–­Hashä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šå­—æ®µ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testHashHasKey</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">hasName</span> <span class="operator">=</span> stringRedisTemplate.opsForHash().hasKey(<span class="string">&quot;user:info:100&quot;</span>, <span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">hasGender</span> <span class="operator">=</span> stringRedisTemplate.opsForHash().hasKey(<span class="string">&quot;user:info:100&quot;</span>, <span class="string">&quot;gender&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ˜¯å¦å­˜åœ¨nameå­—æ®µï¼š&quot;</span> + hasName);</span><br><span class="line">        System.out.println(<span class="string">&quot;æ˜¯å¦å­˜åœ¨genderå­—æ®µï¼š&quot;</span> + hasGender);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿåœ°å€å¯¹è±¡ï¼ˆç”¨äºæµ‹è¯•å¤æ‚å€¼å­˜å‚¨ï¼‰</span></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="meta">@NoArgsConstructor</span></span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Address</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> String province;</span><br><span class="line">        <span class="keyword">private</span> String city;</span><br><span class="line">        <span class="keyword">private</span> String detail;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿç”¨æˆ·å¯¹è±¡ï¼ˆå¤ç”¨ä¹‹å‰é€»è¾‘ï¼‰</span></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="meta">@NoArgsConstructor</span></span><br><span class="line">    <span class="meta">@AllArgsConstructor</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="keyword">private</span> Integer age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¦†ç›–äº† Hash ç»“æ„çš„æ ¸å¿ƒæ“ä½œåœºæ™¯ï¼š</p>
<ul>
<li>æ™®é€šé”®å€¼å­˜å‚¨ &#x2F; è¯»å–ã€æ‰¹é‡æ“ä½œ</li>
<li>å¤æ‚å¯¹è±¡ï¼ˆå¦‚ <code>Address</code>ï¼‰çš„æ‰‹åŠ¨åºåˆ—åŒ– &#x2F; ååºåˆ—åŒ–</li>
<li>å­—æ®µåˆ é™¤ã€å­˜åœ¨æ€§åˆ¤æ–­ã€å…¨é‡é”®å€¼è·å–</li>
</ul>
<h2 id="Redisä»£æ›¿sessionçš„ä¸šåŠ¡æµç¨‹"><a href="#Redisä»£æ›¿sessionçš„ä¸šåŠ¡æµç¨‹" class="headerlink" title="Redisä»£æ›¿sessionçš„ä¸šåŠ¡æµç¨‹"></a>Redisä»£æ›¿sessionçš„ä¸šåŠ¡æµç¨‹</h2><h4 id="è®¾è®¡key"><a href="#è®¾è®¡key" class="headerlink" title="è®¾è®¡key"></a>è®¾è®¡key</h4><ul>
<li>1ã€keyè¦å…·æœ‰å”¯ä¸€æ€§</li>
<li>2ã€keyè¦æ–¹ä¾¿æºå¸¦</li>
</ul>
<h4 id="æ•°æ®ç±»å‹é€‰æ‹©"><a href="#æ•°æ®ç±»å‹é€‰æ‹©" class="headerlink" title="æ•°æ®ç±»å‹é€‰æ‹©"></a>æ•°æ®ç±»å‹é€‰æ‹©</h4><p>ç”¨æˆ·ä¿¡æ¯ç”¨Hash</p>
<p><img src="/images/%E9%BB%91%E9%A9%AC%E7%82%B9%E8%AF%84/image-20250922161925366.png" alt="image-20250922161925366.png"></p>
<p>éªŒè¯ç codeé€‰æ‹©String</p>
<h4 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h4><h5 id="å¼•å…¥"><a href="#å¼•å…¥" class="headerlink" title="å¼•å…¥"></a>å¼•å…¥</h5><p>LoginInterceptoræ‹¦æˆªå™¨ç±»æ²¡æœ‰@componentæ³¨è§£ï¼Œå› æ­¤ä¸èƒ½è‡ªåŠ¨æ³¨å…¥Beanï¼Œéœ€è¦é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ã€‚æ³¨å…¥çš„åŸåˆ™æ˜¯è°ä½¿ç”¨è°æ³¨å…¥ï¼Œåœ¨MvcConfigæ‹¦æˆªå™¨é…ç½®ç±»ä¸­ä½¿ç”¨äº†LoginInterceptorï¼ˆç¼–è¯‘å™¨ä¹Ÿçˆ†çº¢äº†ï¼Œå› ä¸ºéœ€è¦LoginInterceptorä¼ å…¥å‚æ•°ï¼‰ï¼Œå› ä¸ºMvcConfigç±»æ ‡æ³¨äº†@Configurationï¼Œå› æ­¤è¯¥ç±»ç”±Springæ„å»ºï¼Œå› æ­¤åœ¨MvcConfigç±»åˆ©ç”¨@Resource&#x2F;@Autowiredæ³¨è§£æ¥è·å–stringRedisTemplateã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/******** MvcConfig ********/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// ç™»å½•æ‹¦æˆªå™¨</span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>())</span><br><span class="line">                .excludePathPatterns(</span><br><span class="line">                        <span class="string">&quot;/shop/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/voucher/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/shop-type/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/upload/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/blog/hot&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/user/code&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/user/login&quot;</span></span><br><span class="line">                ).order(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/******** LoginInterceptor ********/</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="comment">//é€šè¿‡æ„é€ å‡½æ•°åˆ›å»º</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate redisTemplate;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoginInterceptor</span><span class="params">(StringRedisTemplate redisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>

<h5 id="StringReidisTemplateç±»å‹éœ€è¦String-String"><a href="#StringReidisTemplateç±»å‹éœ€è¦String-String" class="headerlink" title="StringReidisTemplateç±»å‹éœ€è¦String,String"></a>StringReidisTemplateç±»å‹éœ€è¦String,String</h5><p>è‡ªå®šä¹‰Hutoolå·¥å…·ç±»ä¸­çš„BeanUtil.beanToMapæ–¹æ³•<br>é€šè¿‡è®¾ç½®å­—æ®µå€¼ä¿®æ”¹å™¨è§£å†³ç±»å‹è½¬æ¢å¼‚å¸¸</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.DTOè½¬ä¸ºMapï¼Œé€‚é…Redis Hashç»“æ„ï¼ˆå¤„ç†ç±»å‹è½¬æ¢ï¼Œå¿½ç•¥nullå€¼ï¼‰</span></span><br><span class="line">	<span class="comment">//1.1userå¯¹è±¡ä¸­å«æœ‰éStringç±»å‹çš„å±æ€§ï¼Œè€ŒstringRedisTemplateçš„Hashå­˜å‚¨éœ€è¦keyå’Œvalueéƒ½æ˜¯Stringç±»å‹</span></span><br><span class="line"><span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> BeanUtil.copyProperties(user,UserDTO.class);</span><br><span class="line">Map&lt;String,Object&gt; userMap = BeanUtil.beanToMap(userDTO,<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(),</span><br><span class="line">               CopyOptions.create()</span><br><span class="line">             .setIgnoreNullValue(<span class="literal">true</span>)<span class="comment">// 1.2å¿½ç•¥nullå€¼ï¼ŒèŠ‚çœç©ºé—´</span></span><br><span class="line">             .setFieldValueEditor((fieldName,fieldValue)-&gt;fieldValue.toString));<span class="comment">//1.3 æ‰€æœ‰å€¼è½¬ä¸ºå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">//2.å­˜å‚¨</span></span><br><span class="line"><span class="type">String</span> <span class="variable">tokenKey</span> <span class="operator">=</span> LOGIN_USER_KEY + token;</span><br><span class="line">	<span class="comment">//ç°åœ¨å°±ä¸ä¼šæŠ¥é”™äº†</span></span><br><span class="line">stringRedisTemplate.opsForHash().putAll(tokenKey,userMap);</span><br></pre></td></tr></table></figure>

<h4 id="ä»£ç å®æ“"><a href="#ä»£ç å®æ“" class="headerlink" title="ä»£ç å®æ“"></a>ä»£ç å®æ“</h4><h5 id="Serviece"><a href="#Serviece" class="headerlink" title="Serviece"></a>Serviece</h5><p>UserServiceImplç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">sendCode</span><span class="params">(String phone, HttpSession session)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.æ ¡éªŒæ‰‹æœºå·</span></span><br><span class="line">        <span class="keyword">if</span> (RegexUtils.isPhoneInvalid(phone)) &#123;</span><br><span class="line">            <span class="comment">// 2.å¦‚æœä¸ç¬¦åˆï¼Œè¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ‰‹æœºå·æ ¼å¼é”™è¯¯ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.ç¬¦åˆï¼Œç”ŸæˆéªŒè¯ç </span></span><br><span class="line">        <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> RandomUtil.randomNumbers(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4.ä¿å­˜éªŒè¯ç åˆ° redis</span></span><br><span class="line">        <span class="comment">//å¯ä»¥åŠ ä¸ªä¸šåŠ¡å‰ç¼€ï¼Œé˜²æ­¢å…¶ä»–ä¸šåŠ¡çš„éªŒè¯ç å†²çª</span></span><br><span class="line">        stringRedisTemplate.opsForValue().set(LOGIN_CODE_KEY+phone,code,LOGIN_CODE_TTL, TimeUnit.MINUTES);</span><br><span class="line">        <span class="comment">// 5.å‘é€éªŒè¯ç </span></span><br><span class="line">        log.debug(<span class="string">&quot;å‘é€çŸ­ä¿¡éªŒè¯ç æˆåŠŸï¼ŒéªŒè¯ç ï¼š&quot;</span>+code);</span><br><span class="line">        <span class="comment">// è¿”å›ok</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(LoginFormDTO loginForm, HttpSession session)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.æ ¡éªŒæ‰‹æœºå·</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> loginForm.getPhone();</span><br><span class="line">        <span class="keyword">if</span> (RegexUtils.isPhoneInvalid(phone)) &#123;</span><br><span class="line">            <span class="comment">// 2.å¦‚æœä¸ç¬¦åˆï¼Œè¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ‰‹æœºå·æ ¼å¼é”™è¯¯ï¼&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 3.ä»Redisè·å–éªŒè¯ç å¹¶æ ¡éªŒ</span></span><br><span class="line">        String cacheCode=stringRedisTemplate.opsForValue().get(LOGIN_CODE_KEY+phone);</span><br><span class="line">        String code=loginForm.getCode();</span><br><span class="line">        <span class="keyword">if</span>(cacheCode == <span class="literal">null</span> || !cacheCode.equals(code))&#123;</span><br><span class="line">            <span class="comment">//3.ä¸ä¸€è‡´ï¼ŒæŠ¥é”™</span></span><br><span class="line">            <span class="keyword">return</span> Result.fail(<span class="string">&quot;éªŒè¯ç é”™è¯¯&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 4.éªŒè¯ç ä¸€è‡´ï¼ŒæŸ¥è¯¢ç”¨æˆ· select * from tb_user where phone = ?</span></span><br><span class="line">        User user=query().eq(<span class="string">&quot;phone&quot;</span>,phone).one();</span><br><span class="line">        <span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">// 5.ç”¨æˆ·ä¸å­˜åœ¨ï¼Œåˆ›å»º</span></span><br><span class="line">            user =  createUserWithPhone(phone);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 6.ä¿æŠ¤ç”¨æˆ·ä¿¡æ¯åˆ°Redisä¸­</span></span><br><span class="line">        <span class="comment">// 6.1éšæœºç”Ÿæˆtokenï¼Œä½œä¸ºç™»å½•ä»¤ç‰Œ</span></span><br><span class="line">        String token= UUID.randomUUID().toString();</span><br><span class="line">        <span class="comment">// 6.2å°†Userå¯¹è±¡è½¬ä¸ºHashMapå­˜å‚¨</span></span><br><span class="line">        UserDTO userDTO=BeanUtil.copyProperties(user,UserDTO.class);</span><br><span class="line">        Map&lt;String,Object&gt; userMap=BeanUtil.beanToMap(userDTO,<span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(),</span><br><span class="line">                CopyOptions.create()</span><br><span class="line">                        .setIgnoreNullValue(<span class="literal">true</span>)</span><br><span class="line">                        .setFieldValueEditor((fieldName,fieldValue)-&gt;fieldValue.toString()));</span><br><span class="line">        <span class="comment">// 6.3Hashå­˜å‚¨ä¸­æ·»åŠ tokenå’ŒDTOå¯¹è±¡</span></span><br><span class="line">        String tokenKey=LOGIN_USER_KEY+token;</span><br><span class="line">        stringRedisTemplate.opsForHash().putAll(tokenKey,userMap);</span><br><span class="line">        <span class="comment">// 6.4è®¾ç½®tokençš„è¿‡æœŸæ—¶é—´</span></span><br><span class="line">        stringRedisTemplate.expire(LOGIN_USER_KEY+token,LOGIN_USER_TTL, TimeUnit.MINUTES);</span><br><span class="line">        <span class="comment">// 7.è¿”å›token</span></span><br><span class="line">        <span class="keyword">return</span> Result.ok(token);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="æ‹¦æˆªå™¨"><a href="#æ‹¦æˆªå™¨" class="headerlink" title="æ‹¦æˆªå™¨"></a>æ‹¦æˆªå™¨</h5><p><img src="/images/%E9%BB%91%E9%A9%AC%E7%82%B9%E8%AF%84/image-20250922162724186.png" alt="image-20250922162724186.png"></p>
<p><code>RefreshTokenInterceptor</code>ç±»  ï¼ˆå·¦è¾¹ğŸ‘ˆç¬¬ä¸€ä¸ªæ‹¦æˆªå™¨ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ‰‹åŠ¨newå‡ºæ¥çš„ç±»ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥æ³¨å…¥beanï¼Œéœ€è¦æ‰‹åŠ¨æ³¨å†Œåˆ°springå®¹å™¨ä¸­</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RefreshTokenInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">RefreshTokenInterceptor</span><span class="params">(StringRedisTemplate stringRedisTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.stringRedisTemplate = stringRedisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> &#123;</span><br><span class="line">        <span class="comment">// 1.è·å–è¯·æ±‚å¤´ä¸­çš„token    authorizationè¯·æ±‚å¤´</span></span><br><span class="line">        String token=request.getHeader(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line">        <span class="comment">//2.åŸºäºTokenè·å–Redisä¸­çš„ç”¨æˆ·</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span>LOGIN_USER_KEY+token;</span><br><span class="line">        Map&lt;Object,Object&gt; userMap=stringRedisTemplate.opsForHash().entries(key);</span><br><span class="line">        <span class="comment">//3.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span>(userMap.isEmpty()) &#123;</span><br><span class="line">            <span class="comment">//ä¸ºç©ºä¹Ÿç›´æ¥æ”¾è¡Œäº¤ç»™ä¸‹ä¸€ä¸ªæ‹¦æˆªå™¨å¤„ç†</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 5.å°†æŸ¥è¯¢åˆ°çš„Hashæ•°æ®è½¬ä¸ºUserDTOå¯¹è±¡</span></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span>BeanUtil.fillBeanWithMap(userMap, <span class="keyword">new</span> <span class="title class_">UserDTO</span>(), <span class="literal">false</span>);</span><br><span class="line">        <span class="comment">//6.å­˜åœ¨ï¼Œå°†UserDTOå¯¹è±¡å­˜å…¥ThreadLocalä¸­ */</span></span><br><span class="line">        UserHolder.saveUser(userDTO);</span><br><span class="line">        <span class="comment">// 7.åˆ·æ–°tokenæœ‰æ•ˆæœŸ</span></span><br><span class="line">        stringRedisTemplate.expire(key,LOGIN_USER_TTL, TimeUnit.MINUTES);</span><br><span class="line">        <span class="comment">//8.æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>LoginInterceptor</code>ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">       <span class="comment">//1.åˆ¤æ–­æ˜¯å¦éœ€è¦æ‹¦æˆªï¼ˆThreadLocalä¸­æ˜¯å¦æœ‰ç”¨æˆ·ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span>(UserHolder.getUser()==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//æ²¡æœ‰ï¼Œéœ€è¦æ‹¦æˆªï¼Œè®¾ç½®çŠ¶æ€</span></span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            <span class="comment">//æ‹¦æˆª</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æœ‰ç”¨æˆ·ï¼Œåˆ™æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>MvcConfigç±»</p>
<p>æ³¨å†Œå™¨ä¸­æœ‰æ§åˆ¶æ‹¦æˆªå™¨æ‰§è¡Œé¡ºåºçš„orderå­—æ®µï¼Œæˆ‘ä»¬å¸Œæœ›refreshæ‹¦æˆªå™¨å…ˆæ‰§è¡Œï¼Œå¯ä»¥é€šè¿‡è°ƒæ•´orderæ§åˆ¶æ‹¦æˆªå™¨æ‰§è¡Œé¡ºåºã€‚<br>orderå€¼è¶Šå¤§ï¼Œæ‰§è¡Œçš„ä¼˜å…ˆçº§è¶Šä½ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// ç™»å½•æ‹¦æˆªå™¨</span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>())</span><br><span class="line">                .excludePathPatterns(</span><br><span class="line">                        <span class="string">&quot;/shop/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/voucher/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/shop-type/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/upload/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/blog/hot&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/user/code&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/user/login&quot;</span></span><br><span class="line">                ).order(<span class="number">1</span>);</span><br><span class="line">     <span class="comment">/*  å†…å®¹ï¼šæ–°å¢åˆ·æ–°tokenæ‹¦æˆªå™¨ï¼Œé»˜è®¤å¯¹æ‰€æœ‰è¯·æ±‚éƒ½ç”Ÿæ•ˆ</span></span><br><span class="line"><span class="comment">         æ—¶é—´ï¼š 2025/9/22 17:01 */</span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">RefreshTokenInterceptor</span>(stringRedisTemplate)).addPathPatterns(<span class="string">&quot;/**&quot;</span>).order(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div>

    
    <section class="post-copyright">
      
      <p class="copyright-item">
        <span>ä½œè€…:</span>
        <span>è€æ±Ÿæ¹–</span>
      </p>
        
      <p class="copyright-item">
        <span>è®¸å¯è¯:</span>
        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
      </p>
       
      <p class="copyright-item">
        <span>å£å·:</span>
        <span><strong>ä»£ç æ˜¯å¼€æºçš„,æˆ‘ä»¬åªæ˜¯å®ƒçš„æ¬è¿å·¥ã€‚</strong></span>
      </p>
       
        <p class="copyright-item">
        <span>å¦‚æœè§‰å¾—æˆ‘çš„æ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œè¯·éšæ„è½¬è½½ï¼Œæ„Ÿè°¢æ”¯æŒï¼</span>
      </p>
      
             
        <p class="copyright-item">
        <span>å¦‚æœ‰ä¾µæƒè¯·å‘ŠçŸ¥åˆ é™¤ğŸ™</span>
      </p>
             
        <p class="copyright-item">
        <span>å¦‚æœä½ æœ‰å¾ˆå¥½çš„æƒ³æ³•ğŸ’¡ï¼Œè¯·åŠ¡å¿…è”ç³»æˆ‘ã€‚ </span>
        <br>
         <span>2292360909@qq.com</span>
      </p>
    </section>
    
    <section class="post-tags">
      <div>
        <span>æ ‡ç­¾:</span>
        <span class="tag">
          
        </span>
      </div>
      <div>
        <a href="javascript:window.history.back();">è¿”å›</a>
        <span>Â· </span>
        <a href="/">é¦–é¡µ</a>
      </div>
    </section>
    <section class="post-nav">
      
      <a class="prev" rel="prev" href="/2025/10/12/%E9%BB%91%E9%A9%AC%E7%82%B9%E8%AF%84/04-%E5%95%86%E6%88%B7%E6%9F%A5%E8%AF%A2%E7%BC%93%E5%AD%98/"
        >04-å•†æˆ·æŸ¥è¯¢ç¼“å­˜</a
      >
       
      <a class="next" rel="next" href="/2025/10/12/%E9%BB%91%E9%A9%AC%E7%82%B9%E8%AF%84/06-%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81/"
        >06-åˆ†å¸ƒå¼é”</a
      >
      
    </section>

    <!-- Giscus è¯„è®ºåŒºæŒ‚è½½ç‚¹ -->
<div id="giscus-container" style="margin-top: 2.5rem;"></div>

<!-- Giscus åŠ¨æ€åŠ è½½è„šæœ¬ï¼šåˆå§‹åŠ è½½ + æ˜æš—ä¸»é¢˜åˆ‡æ¢ -->
<script>
  function createGiscus(theme) {
    const giscusContainer = document.getElementById('giscus-container');
    if (!giscusContainer) return;

    // æ¸…é™¤æ—§çš„è¯„è®º iframe
    giscusContainer.innerHTML = '';

    const script = document.createElement('script');
    script.src = 'https://giscus.app/client.js';

    // æ›¿æ¢ä¸ºä½ çš„ GitHub ä»“åº“ä¿¡æ¯ï¼ˆæ ¼å¼ï¼šusername/repoï¼‰
    script.setAttribute('data-repo', 'meisijiya/meisijiya.github.io');

   // æ›¿æ¢ä¸ºä½ çš„ repo-id å’Œ category-idï¼ˆåœ¨ giscus.app é…ç½®é¡µé¢ç”Ÿæˆï¼‰
    script.setAttribute('data-repo-id', 'R_kgDOPwTrpQ');
    script.setAttribute('data-category', 'Announcements');
    script.setAttribute('data-category-id', 'DIC_kwDOPwTrpc4CviGR');

    // å…¶ä»–å¸¸è§„æ¨èè®¾ç½®
    script.setAttribute('data-mapping', 'pathname');           // ç”¨é¡µé¢è·¯å¾„åŒ¹é…è¯„è®ºå¸–
    script.setAttribute('data-strict', '0');                   // è‹¥æ— åŒ¹é…å¸–åˆ™åˆ›å»ºæ–°å¸–
    script.setAttribute('data-reactions-enabled', '1');        // å¯ç”¨è¡¨æƒ…ååº”
    script.setAttribute('data-emit-metadata', '0');            // ä¸è¾“å‡ºå…ƒæ•°æ®
    script.setAttribute('data-input-position', 'top');         // è¾“å…¥æ¡†åœ¨è¯„è®ºä¸Šæ–¹
    script.setAttribute('data-theme', theme);                
    script.setAttribute('data-lang', 'zh-CN');                 // ä¸­æ–‡ç•Œé¢
    script.setAttribute('crossorigin', 'anonymous');           // è·¨åŸŸèµ„æºå®‰å…¨
    script.async = true;                                       
     
    giscusContainer.appendChild(script);
  }

  function getCurrentTheme() {
    return document.body.classList.contains('dark-theme') ? 'dark' : 'light';
  }

  document.addEventListener('DOMContentLoaded', () => {
    // é¡µé¢é¦–æ¬¡åŠ è½½ï¼Œæ ¹æ®å½“å‰ä¸»é¢˜æŒ‚è½½è¯„è®º
    createGiscus(getCurrentTheme());

    // ç›‘å¬æŒ‰é’®ç‚¹å‡»åˆ‡æ¢ä¸»é¢˜ â†’ é‡è½½è¯„è®ºåŒº
    const buttons = [
      document.querySelector('.toggleBtn'),
      document.getElementById('mobile-toggle-theme')
    ];
    buttons.forEach(btn => {
      if (!btn) return;
      btn.addEventListener('click', () => {
        setTimeout(() => {
          createGiscus(getCurrentTheme());
        }, 400); // ç¨ä½œå»¶è¿Ÿï¼Œç¡®ä¿ class åˆ‡æ¢å®Œæ¯•
      });
    });

    // ç›‘å¬ body class æ”¹å˜ï¼ˆä¿é™©æ–¹æ¡ˆï¼‰
    const observer = new MutationObserver(() => {
      createGiscus(getCurrentTheme());
    });
    observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });
  });
</script>

  </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© è€æ±Ÿæ¹– | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>
<script src="/js/code-copy.js"></script>


    </div>
</body>
<!-- umami -->
<script defer src="https://cloud.umami.is/script.js" data-website-id="91b923f2-ff2d-43d0-ba5f-bc348d82426a"></script>
</html>