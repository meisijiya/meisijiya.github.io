<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
<meta name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="è€æ±Ÿæ¹–">


    <meta name="subtitle" content="è®°å½•è¿›å…¥æˆ¿é—´é—¨åçš„ç¾å¥½">


    <meta name="description" content="ä¸€å¹´å‰ï¼Œå­¤è‹¦ä¼¶ä»ƒçš„è€æ±Ÿæ¹–ï¼Œå¶ç„¶é—´å‘ç°ä¸€å¤„æˆ¿é—´é—¨ï¼Œæ¨é—¨è€Œå…¥ï¼Œä»æ­¤è¿›å…¥äº†å……æ»¡å¹¸ç¦çš„ä¸–ç•Œã€‚">


    <meta name="keywords" content="è€æ±Ÿæ¹–,è¿›,æˆ¿é—´é—¨">


<title>02-çŸ­ä¿¡ç™»å½•-åŸºäºsessionæ–¹æ¡ˆ | æ¬¢è¿æ¥åˆ°è€æ±Ÿæ¹–çš„åšå®¢</title>



    <link rel="icon" href="/images/%E9%87%91%E6%AF%9B.png?_t=1758006391547">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    
    <link rel="stylesheet" href="/css/search.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


<meta name="generator" content="Hexo 7.3.0"></head>

<body>
    <script>
        // this function is used to check current theme before page loaded.
        (() => {
            const pagebody = document.getElementsByTagName('body')[0]

            function setTheme(status) {

                if (status === 'dark') {
                    window.sessionStorage.theme = 'dark'
                    pagebody.classList.add('dark-theme');

                } else if (status === 'light') {
                    window.sessionStorage.theme = 'light'
                    pagebody.classList.remove('dark-theme');
                }
            };

            setTheme(window.sessionStorage.theme)
        })();
    </script>

    <div class="wrapper">
        <header>
  <nav class="navbar">
    <div class="container">
      <div class="navbar-header header-logo">
        <a href="/">è€æ±Ÿæ¹–çš„åšå®¢</a>
      </div>
      <div class="menu navbar-right">
        <!-- åœ¨ç”µè„‘ç«¯çš„å¯¼èˆªé“¾æ¥åŒºåŸŸæ·»åŠ æœç´¢åŠŸèƒ½ -->
        <div class="search-container">
          <a href="javascript:;" onclick="toggleSearchInput()">ğŸ”</a>
          <input
            type="text"
            id="nav-search-input-desktop"
            class="nav-search-input"
            placeholder="æƒ³çŸ¥é“æˆ‘ä»€ä¹ˆç§˜å¯†å‘¢ï¼Œæœæœçœ‹å§"
            oninput="navSearch(this)"
          />
          <div id="nav-search-result-desktop" class="nav-search-result"></div>
        </div>

        
        <a class="menu-item" href="/archives">æ–‡ç« </a>
        
        <a class="menu-item" href="/category">åˆ†ç±»</a>
        
        <a class="menu-item" href="/tag">æ ‡ç­¾</a>
        
        <a class="menu-item" href="/timeLine">æ—¶é—´çº¿</a>
        
        <a class="menu-item" href="/about">å…³äº</a>
        

        <input id="switch_default" type="checkbox" class="switch_default" />
        <label for="switch_default" class="toggleBtn"></label>
      </div>
    </div>
  </nav>

  
  <nav class="navbar-mobile" id="nav-mobile">
    <div class="container">
      <div class="navbar-header">
        <div>
          <a href="/">è€æ±Ÿæ¹–çš„åšå®¢</a
          ><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
        </div>

        <div class="menu-toggle" onclick="mobileBtn()">
          <svg
            class="menu-icon"
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
          >
            <path
              fill="currentColor"
              d="M4.5 17.27q-.213 0-.356-.145T4 16.768t.144-.356t.356-.143h15q.213 0 .356.144q.144.144.144.357t-.144.356t-.356.143zm0-4.77q-.213 0-.356-.144T4 11.999t.144-.356t.356-.143h15q.213 0 .356.144t.144.357t-.144.356t-.356.143zm0-4.77q-.213 0-.356-.143Q4 7.443 4 7.23t.144-.356t.356-.143h15q.213 0 .356.144T20 7.23t-.144.356t-.356.144z"
            />
          </svg>
          <svg
            class="close-icon"
            xmlns="http://www.w3.org/2000/svg"
            width="32"
            height="32"
            viewBox="0 0 24 24"
          >
            <!-- Icon from Material Symbols Light by Google - https://github.com/google/material-design-icons/blob/master/LICENSE -->
            <path
              fill="currentColor"
              d="m12 12.708l-5.246 5.246q-.14.14-.344.15t-.364-.15t-.16-.354t.16-.354L11.292 12L6.046 6.754q-.14-.14-.15-.344t.15-.364t.354-.16t.354.16L12 11.292l5.246-5.246q.14-.14.345-.15q.203-.01.363.15t.16.354t-.16.354L12.708 12l5.246 5.246q.14.14.15.345q.01.203-.15.363t-.354.16t-.354-.16z"
            />
          </svg>
        </div>
      </div>

      <div class="menu" id="mobile-menu">
        
        <a class="menu-item" href="/archives">æ–‡ç« </a>
        
        <a class="menu-item" href="/category">åˆ†ç±»</a>
        
        <a class="menu-item" href="/tag">æ ‡ç­¾</a>
        
        <a class="menu-item" href="/timeLine">æ—¶é—´çº¿</a>
        
        <a class="menu-item" href="/about">å…³äº</a>
        
        <!-- æ‰‹æœºæ¨¡å¼æœç´¢æ¡† -->
        <div class="search-container mobile-container">
          <a class="menu-item" href="javascript:;" onclick="toggleSearchInput()"
            >ğŸ”</a
          >
          <input
            type="text"
            id="nav-search-input-mobile"
            class="nav-search-input"
            placeholder="æƒ³çŸ¥é“æˆ‘ä»€ä¹ˆç§˜å¯†å‘¢ï¼Œæœæœçœ‹å§"
            oninput="navSearch(this)"
          />
          <div id="nav-search-result-mobile" class="nav-search-result"></div>
        </div>
      </div>
    </div>
  </nav>
</header>
<script>
  var mobileBtn = function f() {
    var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
    var mobileMenu = document.getElementById("mobile-menu");
    if (toggleMenu.classList.contains("active")) {
      toggleMenu.classList.remove("active");
      mobileMenu.classList.remove("active");
    } else {
      toggleMenu.classList.add("active");
      mobileMenu.classList.add("active");
    }
  };

  function toggleSearchInput() {
    const inputs = document.querySelectorAll(".nav-search-input");
    const results = document.querySelectorAll(".nav-search-result");
    inputs.forEach((input) => {
      input.classList.toggle("active");
      if (input.classList.contains("active")) input.focus();
    });
    results.forEach((r) => (r.style.display = "none"));
  }

  // ç‚¹å‡»å¤–éƒ¨åŒºåŸŸéšè—æœç´¢æ¡†å’Œç»“æœå®¹å™¨çš„å‡½æ•°
  function handleClickOutsideSearch(event) {
    const searchContainers = document.querySelectorAll(".search-container");
    searchContainers.forEach((container) => {
      const searchInput = container.querySelector(".nav-search-input");
      const searchIcon = container.querySelector("a");

      // å¦‚æœç‚¹å‡»çš„å…ƒç´ ä¸æ˜¯æœç´¢è¾“å…¥æ¡†æˆ–æœç´¢å›¾æ ‡ï¼Œåˆ™éšè—æœç´¢æ¡†å’Œç»“æœå®¹å™¨
      if (
        !searchInput.contains(event.target) &&
        !searchIcon.contains(event.target)
      ) {
        searchInput.classList.remove("active");
        searchInput.value = ""
        // æ ¹æ®è¾“å…¥æ¡†IDç¡®å®šå¯¹åº”çš„ç»“æœå®¹å™¨
        let resultContainer;
        if (searchInput.id === "nav-search-input-mobile") {
          // ç§»åŠ¨ç«¯ç»“æœå®¹å™¨
          resultContainer = document.querySelector(
            ".navbar-mobile .nav-search-result"
          );
        } else {
          // æ¡Œé¢ç«¯ç»“æœå®¹å™¨
          resultContainer = document.getElementById(
            "nav-search-result-desktop"
          );
        }

        if (resultContainer) {
          resultContainer.style.display = "none";
          resultContainer.innerHTML = ""; // æ¸…ç©ºç»“æœå®¹å™¨å†…å®¹
        }
      }
    });
  }

  // æ·»åŠ å…¨å±€ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
  document.addEventListener("click", function (event) {
    handleClickOutsideSearch(event);
  });

  // æ–°å¢ï¼šæœç´¢åŠŸèƒ½å®ç°
  let searchData = []; // å…¨å±€å˜é‡å­˜å‚¨æœç´¢æ•°æ®

  // é¡µé¢åŠ è½½å®Œæˆåè·å–æœç´¢æ•°æ®
  document.addEventListener("DOMContentLoaded", function () {
    fetch("/search.xml")
      .then((res) => res.text())
      .then((xmlText) => {
        const parser = new DOMParser();
        const xml = parser.parseFromString(xmlText, "text/xml");
        const entries = xml.getElementsByTagName("entry");
        for (let entry of entries) {
          searchData.push({
            title: entry.getElementsByTagName("title")[0]?.textContent || "",
            content:
              entry.getElementsByTagName("content")[0]?.textContent || "",
            url: entry.getElementsByTagName("url")[0]?.textContent || "",
          });
        }
      })
      .catch((err) => {
        console.error("Failed to load search data:", err);
      });
  });

  // æ–°å¢ï¼šå¯¼èˆªæœç´¢æ–¹æ³•
  function navSearch(inputElement) {
    const keyword = inputElement.value.trim().toLowerCase();
    // æŸ¥æ‰¾å¯¹åº”çš„æœç´¢ç»“æœå®¹å™¨
    let resultContainer;

    if (inputElement.id === "nav-search-input-desktop") {
      // æ¡Œé¢ç«¯
      resultContainer = document.getElementById("nav-search-result-desktop");
    } else if (inputElement.id === "nav-search-input-mobile") {
      // ç§»åŠ¨ç«¯
      resultContainer =
        inputElement.parentNode.querySelector(".nav-search-result");
    }

    if (!resultContainer) return;

    resultContainer.innerHTML = "";

    if (!keyword) {
      resultContainer.style.display = "none";
      return;
    }

    // æ˜¾ç¤ºç»“æœå®¹å™¨
    resultContainer.style.display = "block";

    // è¿‡æ»¤æœç´¢æ•°æ®
    const results = searchData.filter(
      (data) =>
        (data.title && data.title.toLowerCase().includes(keyword)) ||
        (data.content && data.content.toLowerCase().includes(keyword))
    );

    if (results.length === 0) {
      resultContainer.innerHTML =
        '<p class="no-result">æ²¡æœ‰ç»“æœå“Ÿï¼Œæ¢ä¸ªå…³é”®è¯è¯•è¯•å§</p>';
      return;
    }

    // é™åˆ¶æ˜¾ç¤ºç»“æœæ•°é‡
    const maxResults = 10;
    const limitedResults = results.slice(0, maxResults);

    // æ„å»ºç»“æœHTML
    const html = limitedResults
      .map((item) => {
        // æå–åŒ…å«å…³é”®å­—çš„å†…å®¹ç‰‡æ®µ
        let contentSnippet = "";
        if (item.content) {
          // æ‰¾åˆ°åŒ…å«å…³é”®å­—çš„å†…å®¹ç‰‡æ®µ
          const contentLower = item.content.toLowerCase();
          const keywordIndex = contentLower.indexOf(keyword);

          // æå–å…³é”®å­—å‰åçš„å†…å®¹
          const start = Math.max(0, keywordIndex - 3 * keyword.length);
          const end = Math.min(
            item.content.length,
            keywordIndex + 3 * keyword.length
          );
          contentSnippet = item.content.substring(start, end);
        // é«˜äº®å…³é”®å­—
      const keywordRegex = new RegExp(`(${keyword.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
      contentSnippet = contentSnippet.replace(
        keywordRegex,
        "<mark>$1</mark>"
      );
        }

        return `<div class="search-result-item">
  <a href="${item.url}">
    <div>æ ‡é¢˜ï¼š${item.title}</div>
    <div>å†…å®¹ï¼š${contentSnippet}</div>
  </a>
</div>`;
      })
      .join("");
    resultContainer.innerHTML = html;
  }
</script>
<style>
  /* æ‰‹æœºç«¯ä½¿ç”¨flexboxå¸ƒå±€æœç´¢å®¹å™¨ */
  .mobile-container {
    display: flex;
    align-items: center;
    flex-direction: row;
    margin-bottom: 10px;
    margin-left: 10px;
    flex-grow: 1;
    max-width: calc(100% - 40px);
  }


  .search-result-item {
  border: 1px solid #ddd; /* è¾¹æ¡† */
  margin: 4px 0; /* å¤–å±‚é—´è· */
  padding: 0; /* æ— å†…è¾¹è· */
  background: #fff; /* èƒŒæ™¯è‰² */
}

.search-result-item a {
  display: block;
  text-decoration: none;
  color: inherit;
}

.search-result-item div {
  padding: 3px 8px; /* ç´§å‡‘çš„å†…è¾¹è· */
  margin: 0; /* æ— å¤–è¾¹è· */
  line-height: 1.3; /* ç´§å‡‘çš„è¡Œé«˜ */
}

.search-result-item div:first-child {
  border-bottom: 1px solid #eee; /* æ ‡é¢˜å’Œå†…å®¹ä¹‹é—´çš„åˆ†éš”çº¿ */
}


</style>

            <div class="main">
                <div class="container">
    <div class="post-toc">
    <div class="tocbot-list">
    </div>
    <div class="tocbot-list-menu">
        <a class="tocbot-toc-expand" onclick="expand_toc()">å±•å¼€æ‰€æœ‰</a>
        <a onclick="go_top()">è¿”å›é¡¶éƒ¨</a>
        <a onclick="go_bottom()">è¿”å›åº•éƒ¨</a>
    </div>
</div>

<script>
    var tocbot_timer;
    var DEPTH_MAX = 6; // ä¸º 6 æ—¶å±•å¼€æ‰€æœ‰
    var tocbot_default_config = {
        tocSelector: '.tocbot-list',
        contentSelector: '.post-content',
        headingSelector: 'h1, h2, h3, h4, h5',
        orderedList: false,
        scrollSmooth: true,
        onClick: extend_click,
    };

    function extend_click() {
        clearTimeout(tocbot_timer);
        tocbot_timer = setTimeout(function() {
            tocbot.refresh(obj_merge(tocbot_default_config, {
                hasInnerContainers: true
            }));
        }, 420); // è¿™ä¸ªå€¼æ˜¯ç”± tocbot æºç é‡Œå®šä¹‰çš„ scrollSmoothDuration å¾—æ¥çš„
    }

    document.ready(function() {
        tocbot.init(obj_merge(tocbot_default_config, {
            collapseDepth: 1
        }));
    });

    function expand_toc() {
        var b = document.querySelector('.tocbot-toc-expand');
        var expanded = b.getAttribute('data-expanded');
        expanded ? b.removeAttribute('data-expanded') : b.setAttribute('data-expanded', true);
        tocbot.refresh(obj_merge(tocbot_default_config, {
            collapseDepth: expanded ? 1 : DEPTH_MAX
        }));
        b.innerText = expanded ? 'å±•å¼€æ‰€æœ‰' : 'æŠ˜å æ‰€æœ‰';
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

    function obj_merge(target, source) {
        for (var item in source) {
            if (source.hasOwnProperty(item)) {
                target[item] = source[item];
            }
        }
        return target;
    }
</script>  
  <article class="post-wrap">
    <header class="post-header">
      <h1 class="post-title">02-çŸ­ä¿¡ç™»å½•-åŸºäºsessionæ–¹æ¡ˆ</h1>
      
      <div class="post-meta">
         ä½œè€…:
        <a itemprop="author" rel="author" href="/">è€æ±Ÿæ¹–</a>
         
        <span class="post-time">
          <br />æ—¥æœŸ:
          <a href="#"
            >ä¹æœˆ 20, 2025&nbsp;&nbsp;21:17:42</a
          >
        </span>
         
        <span class="post-category"
          ><br />
          åˆ†ç±»: 
          <a href="/categories/%E9%BB%91%E9%A9%AC%E7%82%B9%E8%AF%84%E7%AC%94%E8%AE%B0/">é»‘é©¬ç‚¹è¯„ç¬”è®°</a>
          
        </span>
        
      </div>
      
    </header>

    <div class="post-content"><hr>
<h1 id="å‰ç½®ï¼šåŸºäºSessionå®ç°ç™»å½•"><a href="#å‰ç½®ï¼šåŸºäºSessionå®ç°ç™»å½•" class="headerlink" title="å‰ç½®ï¼šåŸºäºSessionå®ç°ç™»å½•"></a>å‰ç½®ï¼šåŸºäºSessionå®ç°ç™»å½•</h1><h2 id="HttpSession-å¯¹è±¡"><a href="#HttpSession-å¯¹è±¡" class="headerlink" title="HttpSession å¯¹è±¡"></a>HttpSession å¯¹è±¡</h2><p><a target="_blank" rel="noopener" href="https://baike.baidu.com/item/HttpSession/3159840?fr=aladdin">HttpSession_ç™¾åº¦ç™¾ç§‘</a> <a target="_blank" rel="noopener" href="https://www.runoob.com/servlet/servlet-session-tracking.html">Servlet Session è·Ÿè¸ª | èœé¸Ÿæ•™ç¨‹</a></p>
<p>Servletæä¾›äº†HttpSessionæ¥å£ï¼Œè¯¥æ¥å£ä¸­æä¾›äº†ä¸€ç§è·¨å¤šä¸ªé¡µé¢è¯·æ±‚æˆ–è®¿é—®ç½‘ç«™æ—¶è¯†åˆ«ç”¨æˆ·ä»¥åŠå­˜å‚¨æœ‰å…³ç”¨æˆ·ä¿¡æ¯çš„æ–¹å¼ã€‚<br>Servlet å®¹å™¨ä½¿ç”¨è¿™ä¸ªæ¥å£æ¥åˆ›å»ºä¸€ä¸ª HTTP å®¢æˆ·ç«¯å’Œ HTTP æœåŠ¡å™¨ä¹‹é—´çš„ session ä¼šè¯ã€‚ä¼šè¯æŒç»­ä¸€ä¸ªæŒ‡å®šçš„æ—¶é—´æ®µï¼Œè·¨å¤šä¸ªè¿æ¥æˆ–é¡µé¢è¯·æ±‚ã€‚</p>
<h2 id="RestController"><a href="#RestController" class="headerlink" title="@RestController"></a>@RestController</h2><p>ç»“åˆäº† <code>@Controller</code> å’Œ <code>@ResponseBody</code>ã€‚<br>è¢«è¢«æ ‡è®°çš„ç±»ä¸­ï¼Œæ¯ä¸ªæ–¹æ³•çš„è¿”å›å€¼éƒ½ä¼šä»¥JSONæˆ–XMLçš„å½¢å¼ç›´æ¥å†™å…¥HTTPå“åº”ä½“ä¸­ï¼ˆ@ResponseBodyï¼‰ã€‚<br>@Controllerå¤„ç†å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚ï¼Œå¹¶è´Ÿè´£è¿”å›é€‚å½“çš„è§†å›¾ï¼ˆViewï¼‰ä½œä¸ºå“åº”ï¼Œæ­é…ä¸Š@ResponseBodyï¼Œä½¿å¾—ä»¥æ–¹æ³•çš„è¿”å›å€¼ä½œä¸ºå“åº”çš„ä¸»é¢˜å†…å®¹ï¼Œè€Œä¸æ˜¯è§£æä¸ºè§†å›¾ã€‚</p>
<h2 id="Springä¸­å¤„ç†HTTPè¯·æ±‚æ˜ å°„çš„æ³¨è§£"><a href="#Springä¸­å¤„ç†HTTPè¯·æ±‚æ˜ å°„çš„æ³¨è§£" class="headerlink" title="Springä¸­å¤„ç†HTTPè¯·æ±‚æ˜ å°„çš„æ³¨è§£"></a>Springä¸­å¤„ç†HTTPè¯·æ±‚æ˜ å°„çš„æ³¨è§£</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span>&#123; <span class="meta">@PostMapping(&quot;/create&quot;)</span>/<span class="meta">@GetMapping(&quot;list&quot;)</span></span><br><span class="line"><span class="keyword">public</span> XXX  xxx&#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@<strong>RequestMapping</strong></p>
<p>å°†webè¯·æ±‚æ˜ å°„åˆ°å…·ä½“æ–¹æ³•ä¸Šï¼Œæ ‡æ³¨åœ¨æ–¹æ³•ä¸Šã€‚ä¹Ÿå¯æ ‡æ³¨åœ¨ç±»ä¸Šï¼Œæ ‡æ³¨åœ¨ç±»ä¸Šæ—¶ï¼Œè¡¨ç¤ºç±»ä¸­æ‰€æœ‰å“åº”è¯·æ±‚çš„æ–¹æ³•éƒ½æ˜¯ä»¥è¯¥è·¯å¾„ä¸ºçˆ¶è·¯å¾„ã€‚</p>
<p>@<strong>PostMapping</strong></p>
<p>ç»„åˆæ³¨è§£ã€‚<br>æ˜¯<code>@RequestMapping(method=RequestMethod.POST)</code>çš„ç¼©å†™ã€‚å®ƒç”¨äºå¤„ç†HTTP POSTè¯·æ±‚çš„æ–¹æ³•ï¼Œåªèƒ½æ ‡æ³¨åœ¨æ–¹æ³•ä¸Šã€‚ä½¿ç”¨<code>@PostMapping</code>æ³¨è§£çš„æ–¹æ³•å°†ä»…å“åº”POSTè¯·æ±‚ã€‚</p>
<p>@<strong>GetMapping</strong></p>
<p>ç»„åˆæ³¨è§£ã€‚<br>æ˜¯<code>@RequestMapping(method = RequestMethod.GET)</code>çš„ç¼©å†™ã€‚å®ƒç”¨äºå¤„ç†HTTP GETè¯·æ±‚çš„æ–¹æ³•ï¼Œä¹Ÿåªèƒ½æ ‡æ³¨åœ¨æ–¹æ³•ä¸Šã€‚ä½¿ç”¨<code>@GetMapping</code>æ³¨è§£çš„æ–¹æ³•å°†ä»…å“åº”GETè¯·æ±‚ã€‚</p>
<h2 id="SpringMVCæ¥æ”¶å‰ç«¯ä¼ é€’çš„å‚æ•°çš„æ³¨è§£"><a href="#SpringMVCæ¥æ”¶å‰ç«¯ä¼ é€’çš„å‚æ•°çš„æ³¨è§£" class="headerlink" title="SpringMVCæ¥æ”¶å‰ç«¯ä¼ é€’çš„å‚æ•°çš„æ³¨è§£"></a>SpringMVCæ¥æ”¶å‰ç«¯ä¼ é€’çš„å‚æ•°çš„æ³¨è§£</h2><p><code>@RequestParam</code> å’Œ <code>@RequestBody </code>éƒ½æ˜¯ä» <code>HttpServletRequest request</code> ä¸­å–å‚çš„ï¼Œè€Œ <code>@PathVariable</code> æ˜¯æ˜ å°„ URI è¯·æ±‚å‚æ•°ä¸­çš„å ä½ç¬¦åˆ°ç›®æ ‡æ–¹æ³•çš„å‚æ•°ä¸­çš„.</p>
<ol>
<li><p>@<strong>RequestParam</strong>  è¯·æ±‚æ ¼å¼ä¸ºï¼š<code>http://...?...=...&amp;...=...</code><br>æ¥æ”¶å‚æ•°å¦‚ä¸‹</p>
<ul>
<li>defaultValue å¦‚æœæœ¬æ¬¡è¯·æ±‚æ²¡æœ‰æºå¸¦è¿™ä¸ªå‚æ•°ï¼Œæˆ–è€…å‚æ•°ä¸ºç©ºï¼Œé‚£ä¹ˆå°±ä¼šå¯ç”¨é»˜è®¤å€¼</li>
<li>name ç»‘å®šæœ¬æ¬¡å‚æ•°çš„åç§°ï¼Œè¦è·ŸURLä¸Šé¢çš„ä¸€æ ·</li>
<li>required è¿™ä¸ªå‚æ•°ä¸æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœä¸º trueï¼Œä¸ä¼ å‚æ•°ä¼šæŠ¥é”™</li>
<li>value è·Ÿnameä¸€æ ·çš„ä½œç”¨ï¼Œæ˜¯nameå±æ€§çš„ä¸€ä¸ªåˆ«å</li>
</ul>
</li>
<li><p>@<strong>RequestBody</strong>  ä¸¤ç§æ¥æ”¶æ–¹å¼ï¼š ä¸€ç§æ˜¯å»ºç«‹ä¸ JSON æ•°æ®ä¸ä¹‹å¯¹åº”çš„å®ä½“ï¼ŒäºŒæ˜¯ç›´æ¥ä½¿ç”¨ Map&lt;String,Object&gt; å¯¹è±¡æ¥æ”¶ã€‚<br>ä½¿ç”¨éœ€è¦æ»¡è¶³å¦‚ä¸‹æ¡ä»¶ï¼š</p>
<ul>
<li>Content-Type ä¸º application&#x2F;jsonï¼Œç¡®ä¿ä¼ é€’æ˜¯ JSON æ•°æ®ï¼›</li>
<li>å‚æ•°è½¬åŒ–çš„é…ç½®å¿…é¡»ç»Ÿä¸€ï¼Œå¦åˆ™æ— æ³•æ¥æ”¶æ•°æ®ï¼Œæ¯”å¦‚ jsonã€request æ··ç”¨ç­‰</li>
</ul>
</li>
<li><p>@<strong>PathVariable</strong>     è¯·æ±‚æ ¼å¼ï¼š<code>.../&#123;&#125;/&#123;&#125;</code>åŒ<code>.../&#123;&#125;?...=...</code><br> æ¥æ”¶å‚æ•°å¦‚ä¸‹</p>
<ul>
<li>name ç»‘å®šå‚æ•°çš„åç§°ï¼Œ<strong>é»˜è®¤ä¸ä¼ é€’æ—¶ï¼Œç»‘å®šä¸ºåŒåçš„å½¢å‚ã€‚</strong> èµ‹å€¼ä½†åç§°ä¸ä¸€è‡´æ—¶åˆ™æŠ¥é”™</li>
<li>value è·Ÿnameä¸€æ ·çš„ä½œç”¨ï¼Œæ˜¯nameå±æ€§çš„ä¸€ä¸ªåˆ«å</li>
<li>required è¿™ä¸ªå‚æ•°ä¸æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœä¸º trueï¼Œä¸ä¼ å‚æ•°ä¼šæŠ¥é”™</li>
</ul>
<p>éœ€è¦æ³¨æ„ä¸¤ç‚¹ï¼š</p>
<ul>
<li>å‚æ•°æ¥æ”¶ç±»å‹ä½¿ç”¨<strong>åŸºæœ¬ç±»å‹</strong></li>
<li>å¦‚æœ@PathVariableæ ‡æ˜å‚æ•°åç§°ï¼Œåˆ™<strong>å‚æ•°åç§°å¿…é¡»å’ŒURLä¸­å‚æ•°åç§°ä¸€è‡´</strong></li>
</ul>
</li>
</ol>
<p>1ã€åœ¨ GET è¯·æ±‚ä¸­å¯ä»¥ä½¿ç”¨ <strong>@RequestParam</strong>ï¼Œä¸èƒ½ä½¿ç”¨ @RequestBodyï¼Œ@RequestBody æ˜¯ç”¨æ¥è·å–è¯·æ±‚ä½“ä¸­çš„å‚æ•°ï¼Œå› ä¸º GET è¯·æ±‚æ²¡æœ‰è¯·æ±‚ä½“ï¼Œæ‰€ä»¥ä¸èƒ½ä½¿ç”¨ã€‚</p>
<p>2.åœ¨postè¯·æ±‚ä¸­</p>
<ul>
<li>@RequestParam é€‚ç”¨äºè·å–<u><strong>é”®å€¼å¯¹</strong></u>å½¢å¼çš„è¯·æ±‚å‚æ•°ï¼Œæ¥æºåŒ…æ‹¬ URL æŸ¥è¯¢å­—ç¬¦ä¸²ã€application&#x2F;x-www-form-urlencoded æ ¼å¼çš„è¯·æ±‚ä½“ï¼ˆè¡¨å•é»˜è®¤æ ¼å¼ï¼‰ã€multipart&#x2F;form-data æ ¼å¼ä¸­çš„æ™®é€šå­—æ®µï¼ˆéæ–‡ä»¶ç±»å‹ï¼‰ã€‚</li>
<li>@RequestBody ç”¨äºæ¥æ”¶è¯·æ±‚ä½“ä¸­çš„å®Œæ•´æ•°æ®ï¼Œé€‚ç”¨äº<u><strong>éé”®å€¼</strong></u>å¯¹å½¢å¼çš„ç»“æ„åŒ–æ•°æ®ï¼ˆå¦‚ application&#x2F;jsonã€application&#x2F;xml ç­‰ï¼‰ï¼Œé€šè¿‡æ¶ˆæ¯è½¬æ¢å™¨å°†è¯·æ±‚ä½“å†…å®¹è§£æä¸ºç›®æ ‡ Java å¯¹è±¡ã€‚</li>
<li>ç‰¹æ®Šåœºæ™¯ï¼šmultipart&#x2F;form-data æ ¼å¼ä¸­çš„æ–‡ä»¶ä¸Šä¼ éœ€ç”¨ @RequestPartï¼›<br>application&#x2F;x-www-form-urlencoded æ ¼å¼ä¸ºé”®å€¼å¯¹ç»“æ„ï¼Œä¸é€‚åˆç”¨ @RequestBody æ¥æ”¶ï¼ˆä¼šå¾—åˆ°åŸå§‹å­—ç¬¦ä¸²ï¼Œéæ¨èç”¨æ³•ï¼‰ã€‚</li>
</ul>
<p>3ã€ä¸€ä¸ªæ–¹æ³•ä¸­ï¼Œå¯ä»¥åŒæ—¶ä½¿ç”¨<strong>å¤šä¸ª</strong> @RequestParam ï¼Œä½†æ˜¯åªèƒ½ä½¿ç”¨<strong>ä¸€ä¸ª</strong> @RequestBodyï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>
<p>4ã€@PathVariable èµ·åˆ°çš„ä½œç”¨å°±æ˜¯ URI è¯·æ±‚å‚æ•°ä¸­çš„<u>å ä½ç¬¦</u>åˆ°<u>ç›®æ ‡æ–¹æ³•å‚æ•°</u>çš„æ˜ å°„ã€‚</p>
<p>5ã€å‰ç«¯è¯·æ±‚çš„  Content-Type ï¼Œ<strong>é»˜è®¤å€¼</strong>ä¸º <code>application/x-www-form-urlencoded</code>ï¼Œåœ¨è¿™ç§æ ¼å¼ä¸‹ï¼Œåç«¯ç›´æ¥ä½¿ç”¨ @RequestParam å°±å¯ä»¥ç›´æ¥è·å–æŒ‡å®šçš„å‚æ•°ï¼Œä½†æ˜¯ä¸€æ—¦å‰ç«¯ä¼ é€’çš„æ˜¯ JSON æ•°æ®ï¼Œä¹Ÿå°±æ˜¯ Content-Type çš„å€¼ä¸º <code>application/json</code>ï¼Œé‚£ä¹ˆä½¿ç”¨ @RequestParam æ˜¯å–ä¸åˆ°å€¼çš„ï¼Œä¸ä½†å–ä¸åˆ°å€¼è¿˜æŠ¥é”™ã€‚</p>
<h2 id="Mybatis-plus"><a href="#Mybatis-plus" class="headerlink" title="Mybatis-plus"></a>Mybatis-plus</h2><p>ä¼˜ç§€çš„ ORM æ¡†æ¶ï¼Œè‡´åŠ›äºç®€åŒ–å’Œæé«˜ Java åº”ç”¨ç¨‹åºå¯¹æ•°æ®åº“è®¿é—®çš„æ•ˆç‡ã€‚</p>
<h3 id="Transactional"><a href="#Transactional" class="headerlink" title="@Transactional"></a>@Transactional</h3><p>åªèƒ½åº”ç”¨åˆ°æ¥å£æ–¹æ³•ã€ç±»ã€è¿˜æœ‰publicæ–¹æ³•ä¸Šã€‚<br>ä¸€èˆ¬åœ¨@serviceæ ‡è®°çš„ç±»ä¸Šæ·»åŠ ï¼Œå¯ä»¥å°†æ•´ä¸ªserviceç±»çº³å…¥Springäº‹åŠ¡ç®¡ç†ï¼Œé‡‡ç”¨ç»Ÿä¸€çš„äº‹åŠ¡ç®¡ç†æ–¹å¼ã€‚</p>
<p>å¸¸ç”¨å±æ€§æ€»ç»“ï¼š</p>
<ul>
<li><code>propagation</code>ï¼šæ§åˆ¶äº‹åŠ¡ä¼ æ’­è¡Œä¸ºï¼ˆå¦‚æ˜¯å¦å¤ç”¨çˆ¶äº‹åŠ¡ï¼‰ï¼Œé»˜è®¤<code>REQUIRED</code>ï¼›</li>
<li><code>isolation</code>ï¼šè®¾ç½®äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼ˆè§£å†³å¹¶å‘é—®é¢˜ï¼‰ï¼Œé»˜è®¤ç”¨æ•°æ®åº“é»˜è®¤å€¼ï¼›</li>
<li><code>rollbackFor</code>&#x2F;<code>noRollbackFor</code>ï¼šæŒ‡å®šéœ€è¦ &#x2F; ä¸éœ€è¦å›æ»šçš„å¼‚å¸¸ç±»å‹ï¼›</li>
<li><code>readOnly</code>ï¼šæ ‡è®°åªè¯»äº‹åŠ¡ï¼ˆä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½ï¼‰ï¼Œé»˜è®¤<code>false</code>ï¼›</li>
<li><code>timeout</code>ï¼šè®¾ç½®äº‹åŠ¡è¶…æ—¶æ—¶é—´ï¼ˆé˜²æ­¢é•¿äº‹åŠ¡ï¼Œå•ä½ç§’ï¼‰ï¼Œé»˜è®¤æ— é™åˆ¶ã€‚</li>
</ul>
<h3 id="BaseMapperã€IServiceå’ŒServiceImpl"><a href="#BaseMapperã€IServiceå’ŒServiceImpl" class="headerlink" title="BaseMapperã€IServiceå’ŒServiceImpl"></a>BaseMapperã€IServiceå’ŒServiceImpl</h3><p>åœ¨å…¸å‹çš„ä¸‰å±‚æ¶æ„ä¸­ï¼š</p>
<ul>
<li>Controller å±‚ï¼šæ¥æ”¶è¯·æ±‚ã€è¿”å›ç»“æœ</li>
<li>Service å±‚ï¼šä¸šåŠ¡é€»è¾‘ç¼–æ’</li>
<li>DAO å±‚ (Mapper)ï¼šç›´æ¥æ“ä½œæ•°æ®åº“</li>
</ul>
<p>MyBatis-Plus æä¾›äº† BaseMapper ç®€åŒ–äº† DAO å±‚çš„ CRUDï¼Œè€Œåœ¨ Service å±‚ï¼Œé€šå¸¸éœ€è¦ç¼–å†™ä¸€å †ç›¸ä¼¼çš„å¢åˆ æ”¹æŸ¥é€»è¾‘ã€‚ä¸ºæ­¤ï¼ŒMyBatis-Plus æä¾›äº† IService æ¥å£ + ServiceImpl å®ç°ç±»ï¼Œå°†é€šç”¨é€»è¾‘æŠ½è±¡å‡ºæ¥ã€‚</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">IService&lt;T&gt;   â†â€”â€”  é€šç”¨ Service æ¥å£ï¼ˆå®šä¹‰é€šç”¨æ–¹æ³•ï¼‰</span><br><span class="line">   â†‘</span><br><span class="line">ServiceImpl&lt;M extends BaseMapper&lt;T&gt;, T&gt;   â†â€”â€”  é€šç”¨ Service å®ç°ç±»</span><br><span class="line">   â†‘</span><br><span class="line">è‡ªå®šä¹‰ Service å®ç°ç±»ï¼ˆç»§æ‰¿ ServiceImplï¼‰</span><br></pre></td></tr></table></figure>

<h5 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h5><ol>
<li>å¿…é¡»ç»§æ‰¿ ServiceImpl å—ï¼Ÿ</li>
</ol>
<ul>
<li>ä¸æ˜¯å¿…é¡»ã€‚ä½ ä¹Ÿå¯ä»¥åªç”¨ BaseMapperï¼Œåœ¨ Controller é‡Œç›´æ¥è°ƒç”¨ã€‚ä½†è¿™æ ·ä¼šè®©ä¸šåŠ¡å±‚ç¼ºå¤±ï¼Œä»£ç è€¦åˆåº¦è¾ƒé«˜ï¼Œæ¨èé€šè¿‡ ServiceImpl æ¥éš”ç¦»ä¸šåŠ¡é€»è¾‘ä¸æŒä¹…åŒ–ã€‚</li>
</ul>
<ol start="2">
<li>å¦‚æœè¦å†™è‡ªå®šä¹‰æ–¹æ³•æ€ä¹ˆåŠï¼Ÿ</li>
</ol>
<ul>
<li>ç›´æ¥åœ¨ Service æ¥å£å’Œå®ç°ç±»ä¸­æ–°å¢å³å¯</li>
</ul>
<ol start="3">
<li>ä¸ Mapper çš„å…³ç³»ï¼Ÿ</li>
</ol>
<ul>
<li>Mapperï¼šæœ€è´´è¿‘æ•°æ®åº“ï¼Œè´Ÿè´£ SQL å±‚</li>
<li>ServiceImplï¼šå°è£… Mapperï¼Œå¹¶ä¸ºä¸šåŠ¡æä¾›ç»Ÿä¸€æ¥å£</li>
</ul>
<h5 id="æœ€ä½³å®è·µï¼š"><a href="#æœ€ä½³å®è·µï¼š" class="headerlink" title="æœ€ä½³å®è·µï¼š"></a>æœ€ä½³å®è·µï¼š</h5><ul>
<li>æ¥å£åˆ†ç¦»ï¼šå®šä¹‰ Service æ¥å£ï¼Œé¿å…ç›´æ¥åœ¨ Controller æ³¨å…¥ ServiceImpl</li>
<li>æ‰©å±•ä¸šåŠ¡é€»è¾‘ï¼šåœ¨ç»§æ‰¿çš„ ServiceImpl ä¸Šå¢åŠ è‡ªå·±çš„æ–¹æ³•ï¼Œä¸è¦éšæ„ä¿®æ”¹é€šç”¨æ–¹æ³•</li>
<li>æ‰¹é‡æ“ä½œï¼šä½¿ç”¨ saveBatchã€updateBatchById æå‡æ€§èƒ½</li>
<li>LambdaQueryWrapperï¼šç»“åˆ ServiceImpl çš„æŸ¥è¯¢æ–¹æ³•ï¼Œå†™æ³•æ›´ç®€æ´å®‰å…¨</li>
</ul>
<h4 id="BaseMapper"><a href="#BaseMapper" class="headerlink" title="BaseMapper"></a>BaseMapper</h4><p>ä¸»è¦ä½œç”¨æ˜¯å®šä¹‰ DAO å±‚çš„æ•°æ®åº“æ“ä½œæ–¹æ³•ï¼Œä¾‹å¦‚æ•°æ®çš„å¢åˆ æ”¹æŸ¥ç­‰ã€‚</p>
<p>é€šè¿‡æ™ºèƒ½çš„SQLç”Ÿæˆæœºåˆ¶ï¼Œåªè¦ç»§æ‰¿å¹¶æŒ‡å®šå¯¹åº”çš„å®ä½“ç±»ï¼Œå³å¯ç›´æ¥ä½¿ç”¨è¿™äº›é€šç”¨æ–¹æ³•ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™ SQL è¯­å¥ï¼Œä»è€Œå‡å°‘äº†ä»£ç é‡å’Œé‡å¤åŠ³åŠ¨ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªç»§æ‰¿ BaseMapper çš„è‡ªå®šä¹‰ Mapper æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">XXXMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;xxx&gt; &#123;</span><br><span class="line">    <span class="comment">// æ— éœ€æ‰‹å†™SQLï¼ŒMybatis-Plus æ ¹æ®å‘½åè§„èŒƒè‡ªåŠ¨ç”ŸæˆSQL</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="IService"><a href="#IService" class="headerlink" title="IService"></a>IService</h4><p>å°†å¸¸è§çš„ä¸šåŠ¡æ“ä½œæŠ½è±¡åŒ–ï¼ŒåŒ…æ‹¬ä¿å­˜ã€åˆ é™¤ã€æ›´æ–°ã€æŸ¥è¯¢ç­‰ã€‚é€šè¿‡ç»§æ‰¿ <code>IService</code> æ¥å£ï¼Œå¹¶æŒ‡å®šå¯¹åº”çš„å®ä½“ç±»ï¼Œå³å¯ç›´æ¥ä½¿ç”¨è¿™äº›é€šç”¨æ–¹æ³•ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™ä¸šåŠ¡é€»è¾‘ä»£ç ï¼Œä½¿å¾—ä»£ç æ›´åŠ ç®€æ´å’Œæ˜“äºç»´æŠ¤ã€‚</p>
<p>å°è£…çš„æ–¹æ³•åˆ†ä¸ºä¸ƒç±»ï¼šsaveã€removeã€updateã€getã€listã€countã€pageï¼ˆåˆ†é¡µæŸ¥è¯¢ï¼‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªç»§æ‰¿ IService çš„è‡ªå®šä¹‰ Service æ¥å£</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">XXXService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;xxx&gt; &#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰å¸¸ç”¨çš„ä¸šåŠ¡é€»è¾‘æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ServiceImpl"><a href="#ServiceImpl" class="headerlink" title="ServiceImpl"></a>ServiceImpl</h4><p>æ˜¯ <code>IService</code> æ¥å£çš„é»˜è®¤å®ç°ã€‚æ˜¯é’ˆå¯¹ä¸šåŠ¡é€»è¾‘å±‚çš„å®ç°ï¼Œå¹¶è°ƒç”¨ BaseMapper æ¥æ“ä½œæ•°æ®åº“ã€‚è¿˜é¢å¤–èµ‹äºˆäº†ä¸€äº›æ›´åŠ é«˜çº§çš„æŸ¥è¯¢æ“ä½œï¼Œå¦‚ <code>lambdaQuery</code>ã€<code>page</code> ç­‰</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æºç </span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceImpl</span>&lt;M <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;T&gt;, T&gt; <span class="keyword">implements</span> <span class="title class_">IService</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">protected</span> M baseMapper;    </span><br><span class="line">    <span class="comment">//...æ–¹æ³•</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å¸¸è§æ–¹æ³•å¦‚ä¸‹ï¼š</strong></p>
<ol>
<li>æ–°å¢</li>
</ol>
<ul>
<li>save(T entity)</li>
<li>saveBatch(Collection<T> entityList)</li>
<li>saveOrUpdate(T entity)</li>
</ul>
<ol start="2">
<li>åˆ é™¤</li>
</ol>
<ul>
<li>removeById(Serializable id)</li>
<li>removeByIds(Collection&lt;? extends Serializable&gt; idList)</li>
<li>remove(Wrapper<T> queryWrapper)</li>
</ul>
<ol start="3">
<li>ä¿®æ”¹</li>
</ol>
<ul>
<li>updateById(T entity)</li>
<li>update(T entity, Wrapper<T> updateWrapper)</li>
<li>updateBatchById(Collection<T> entityList)</li>
</ul>
<ol start="4">
<li>æŸ¥è¯¢</li>
</ol>
<ul>
<li>getById(Serializable id)</li>
<li>listByIds(Collection&lt;? extends Serializable&gt; idList)</li>
<li>list(Wrapper<T> queryWrapper)</li>
<li>page(Page<T> page, Wrapper<T> queryWrapper)</li>
<li>getOne(Wrapper<T> queryWrapper)</li>
</ul>
<ol start="5">
<li>ç»Ÿè®¡ä¸åˆ¤æ–­</li>
</ol>
<ul>
<li>count()</li>
<li>exists(Wrapper<T> queryWrapper)</li>
</ul>
<p><code>ServiceImpl</code> å¯¹äº‹åŠ¡ç®¡ç†æä¾›äº†æ”¯æŒã€‚é€šè¿‡ <code>@Transactional</code> æ³¨è§£ï¼Œèƒ½å¤Ÿè½»æ¾åœ°å®ç°äº‹åŠ¡çš„æ§åˆ¶ã€‚</p>
<p>å®è·µä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨ä¸šåŠ¡é€»è¾‘å®ç°ä¸­ç»§æ‰¿ ServiceImplï¼Œè½»æ¾æ„å»ºä¸šåŠ¡æ–¹æ³•</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XXXServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;M, T&gt; <span class="keyword">implements</span> <span class="title class_">XXXService</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¼ å…¥çš„å‚æ•°ä¸º M å’Œ Tï¼š</p>
<ul>
<li>Mï¼šMapper æ¥å£ç±»å‹</li>
<li>Tï¼šå¯¹åº”å®ä½“ç±»çš„ç±»å‹</li>
</ul>
<h3 id="Wrapper"><a href="#Wrapper" class="headerlink" title="Wrapper"></a>Wrapper</h3><ul>
<li>ä¸ç›´æ¥å…³è” Mapper æ¥å£ï¼Œéœ€æ‰‹åŠ¨ä¼ é€’ç»™ Mapper æ–¹æ³•æ‰§è¡ŒæŸ¥è¯¢ã€‚</li>
<li>éœ€è°ƒç”¨ Mapper æ–¹æ³•ï¼ˆå¦‚ <code>selectList(wrapper)</code>ï¼‰</li>
<li>åˆ†ä¸¤æ­¥ï¼šå…ˆæ„å»ºæ¡ä»¶ï¼Œå†è°ƒç”¨ Mapper</li>
<li>è¿ç”¨äºå¤æ‚é€»è¾‘ï¼ˆå¦‚æ¡ä»¶å¤ç”¨ã€åŠ¨æ€åˆ¤æ–­ï¼‰</li>
</ul>
<h4 id="QueryWrapper"><a href="#QueryWrapper" class="headerlink" title="QueryWrapper"></a>QueryWrapper</h4><p>æŸ¥è¯¢æ„é€ å™¨ï¼Œé€šè¿‡é“¾å¼è°ƒç”¨ï¼Œçµæ´»ç›´è§‚åœ°è¿›è¡Œå¤æ‚SQLæŸ¥è¯¢ï¼Œè€Œæ— éœ€æ‰‹åŠ¨ç¼–å†™SQLè¯­å¥ã€‚ä¸ç›´æ¥å…³è” Mapper æ¥å£ï¼Œéœ€æ‰‹åŠ¨ä¼ é€’ç»™ Mapper æ–¹æ³•æ‰§è¡ŒæŸ¥è¯¢ã€‚</p>
<p>æ“ä½œæµç¨‹ï¼š</p>
<ol>
<li>åˆ›å»ºQueryWrapperå®ä¾‹<br><code>QueryWrapper&lt;å®ä½“ç±»ï¼ˆä»£è¡¨æ•°æ®åº“ä¸­çš„ä¸€å¼ è¡¨ï¼‰&gt; wrapper = new QueryWrapper&lt;&gt;()</code></li>
<li>æ·»åŠ æŸ¥è¯¢æ¡ä»¶ï¼ˆæ–¹æ³•ï¼‰ï¼Œæ”¯æŒé“¾å¼è°ƒç”¨<ol>
<li><code>eq</code>ï¼šç­‰äº  <code>ne</code>ï¼šä¸ç­‰äº</li>
<li><code>gt</code>ï¼šå¤§äº  <code>ge</code>ï¼šå¤§äºç­‰äº</li>
<li><code>lt</code>ï¼šå°äº  <code>le</code>ï¼šå°äºç­‰äº</li>
<li><code>(not)like(left/right)</code>ï¼šæ¨¡ç³ŠåŒ¹é… <code>(not)between</code> åŒºé—´</li>
<li><code>(not)in</code>ï¼š(ä¸)åœ¨æŸä¸ªé›†åˆä¸­</li>
<li><code>and</code>   <code>or</code></li>
<li><code>nested</code> - åµŒå¥—æ¡ä»¶</li>
<li><code>orderby</code> æ’åº</li>
<li><code>select</code></li>
<li><code>last</code>åœ¨ SQL æœ«å°¾è¿½åŠ è‡ªå®šä¹‰ç‰‡æ®µ  <code>apply</code>æ·»åŠ åŠ¨æ€SQLç‰‡æ®µ</li>
</ol>
</li>
<li>æ‰§è¡ŒæŸ¥è¯¢<br>æ„é€ å¥½çš„QueryWrapperï¼Œé€šè¿‡ä¼ é€’ç»™Mybatis-Plusçš„Mapperæ¥å£æ–¹æ³•æ¥æ‰§è¡ŒæŸ¥è¯¢ã€‚<br><code>è¿”å›å€¼  x = xxxMapper.xxxæ–¹æ³•(wrapper)</code></li>
</ol>
<h5 id="QueryWrapperä¸å…¶ä»–Wrapperçš„åŒºåˆ«"><a href="#QueryWrapperä¸å…¶ä»–Wrapperçš„åŒºåˆ«" class="headerlink" title="QueryWrapperä¸å…¶ä»–Wrapperçš„åŒºåˆ«"></a>QueryWrapperä¸å…¶ä»–Wrapperçš„åŒºåˆ«</h5><ul>
<li><p>QueryWrapperï¼šä¸“æ³¨äºæ„å»º SELECT æŸ¥è¯¢çš„æ¡ä»¶ã€‚</p>
</li>
<li><p>UpdateWrapperï¼šç”¨äºæ„å»º UPDATE è¯­å¥ï¼Œæ”¯æŒæ¡ä»¶å’Œ SET å­å¥ã€‚ï¼ˆsetï¼‰</p>
</li>
<li><p>LambdaQueryWrapperï¼šQueryWrapper çš„ Lambda ç‰ˆæœ¬ï¼Œä½¿ç”¨ Lambda è¡¨è¾¾å¼æŒ‡å®šå­—æ®µã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ•ˆæœåŒQueryWrapperç¤ºä¾‹ï¼Œä½†ç”¨Lambdaå¼•ç”¨å­—æ®µ</span></span><br><span class="line">LambdaQueryWrapper&lt;User&gt; lambdaQuery = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;&gt;();</span><br><span class="line">lambdaQuery.gt(User::getAge, <span class="number">18</span>)  <span class="comment">// ç”¨Lambdaè¡¨è¾¾å¼å¼•ç”¨å­—æ®µï¼Œç¼–è¯‘æœŸæ£€æŸ¥</span></span><br><span class="line">           .like(User::getUsername, <span class="string">&quot;å¼ &quot;</span>);</span><br><span class="line">List&lt;User&gt; userList = userMapper.selectList(lambdaQuery);</span><br></pre></td></tr></table></figure>
</li>
<li><p>LambdaUpdateWrapperï¼šUpdateWrapper çš„ Lambda ç‰ˆæœ¬ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ•ˆæœåŒUpdateWrapperç¤ºä¾‹ï¼Œç”¨Lambdaå¼•ç”¨å­—æ®µ</span></span><br><span class="line">LambdaUpdateWrapper&lt;User&gt; lambdaUpdate = <span class="keyword">new</span> <span class="title class_">LambdaUpdateWrapper</span>&lt;&gt;();</span><br><span class="line">lambdaUpdate.set(User::getAge, <span class="number">20</span>)</span><br><span class="line">            .set(User::getStatus, <span class="number">1</span>)</span><br><span class="line">            .eq(User::getId, <span class="number">1</span>)</span><br><span class="line">            .eq(User::getUsername, <span class="string">&quot;å¼ ä¸‰&quot;</span>);</span><br><span class="line">userMapper.update(<span class="literal">null</span>, lambdaUpdate);</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="ChainWrapper"><a href="#ChainWrapper" class="headerlink" title="ChainWrapper"></a>ChainWrapper</h3><ul>
<li>å†…ç½® Mapperï¼Œåˆ›å»ºæ—¶ç»‘å®š</li>
<li>è‡ªå¸¦æ‰§è¡Œæ–¹æ³•ï¼ˆå¦‚ <code>list()</code>ã€<code>update()</code>ï¼‰</li>
<li>é“¾å¼è°ƒç”¨ï¼Œä¸€æ­¥å®Œæˆæ¡ä»¶ + æ‰§è¡Œ</li>
<li>ç®€å•æŸ¥è¯¢ &#x2F; æ›´æ–°ï¼Œè¿½æ±‚ä»£ç ç®€æ´</li>
</ul>
<h4 id="QueryChainWrapper"><a href="#QueryChainWrapper" class="headerlink" title="QueryChainWrapper"></a>QueryChainWrapper</h4><p><strong><code>query()</code> æ–¹æ³•</strong>æ˜¯ <code>BaseMapper</code> æ¥å£æä¾›çš„ä¸€ä¸ªé»˜è®¤æ–¹æ³•</p>
<ol>
<li>å¿«é€Ÿåˆ›å»º <code>QueryChainWrapper</code> å®ä¾‹ï¼ˆè‡ªåŠ¨ç»‘å®šå½“å‰ Mapperï¼‰ï¼›</li>
<li>æ”¯æŒç›´æ¥é“¾å¼è°ƒç”¨æŸ¥è¯¢æ¡ä»¶æ–¹æ³•ï¼ˆ<code>eq</code>ã€<code>like</code> ç­‰ï¼‰å’Œæ‰§è¡Œæ–¹æ³•ï¼ˆ<code>list</code>ã€<code>one</code> ç­‰ï¼‰ï¼›</li>
<li>è®©ä»£ç æ›´ç®€æ´ï¼Œå‡å°‘æ‰‹åŠ¨åˆ›å»ºåŒ…è£…å™¨çš„æ¨¡æ¿ä»£ç ã€‚</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç®€åŒ–æ–¹å¼ï¼šé€šè¿‡ mapper.query() è·å– QueryChainWrapper</span></span><br><span class="line">List&lt;User&gt; users = userMapper.query()  <span class="comment">// ç›´æ¥è·å–é“¾å¼æŸ¥è¯¢åŒ…è£…å™¨</span></span><br><span class="line">    .eq(<span class="string">&quot;status&quot;</span>, <span class="number">1</span>)</span><br><span class="line">    .list();</span><br></pre></td></tr></table></figure>

<p><strong>query() æ–¹æ³•ä¸ Service å±‚çš„ç»“åˆ</strong></p>
<p>åœ¨ Service å®ç°ç±»ä¸­ï¼ˆé€šå¸¸ç»§æ‰¿ <code>ServiceImpl&lt;M extends BaseMapper&lt;T&gt;, T&gt;</code>ï¼‰ï¼Œè°ƒç”¨ <code>BaseMapper</code> æä¾›çš„ <code>query()</code> æ–¹æ³•ï¼Œè·å– <code>QueryChainWrapper&lt;User&gt;</code> å®ä¾‹ï¼Œè¿›ä¸€æ­¥ç®€åŒ–ä»£ç ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">User user=query().eq(<span class="string">&quot;phone&quot;</span>,phone).one();</span><br></pre></td></tr></table></figure>

<p><strong>è‹¥ä¸ç”¨é“¾å¼æŸ¥è¯¢ï¼Œç­‰ä»·ä»£ç å¦‚ä¸‹</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">queryWrapper.eq(<span class="string">&quot;phone&quot;</span>, phone);</span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectOne(queryWrapper); <span class="comment">// æ‰‹åŠ¨è°ƒç”¨ Mapper æ–¹æ³•</span></span><br></pre></td></tr></table></figure>

<p><strong>QueryChainWrapperï¼š</strong></p>
<ul>
<li><p><strong>ä½œç”¨</strong>ï¼šç”¨äºæ„å»ºæŸ¥è¯¢æ¡ä»¶ï¼ˆ<code>WHERE</code>ã€<code>ORDER BY</code> ç­‰ï¼‰ï¼Œå¹¶ç›´æ¥æ‰§è¡ŒæŸ¥è¯¢æ“ä½œï¼ˆå¦‚æŸ¥è¯¢åˆ—è¡¨ã€å•æ¡æ•°æ®ã€æ•°é‡ç­‰ï¼‰ã€‚</p>
</li>
<li><p>æ ¸å¿ƒæ–¹æ³•ï¼š</p>
<ul>
<li>æ¡ä»¶æ–¹æ³•ï¼š<code>eq()</code>ï¼ˆç­‰äºï¼‰ã€<code>like()</code>ï¼ˆæ¨¡ç³ŠæŸ¥è¯¢ï¼‰ã€<code>orderBy()</code>ï¼ˆæ’åºï¼‰ç­‰ï¼ˆä¸ <code>QueryWrapper</code> ä¸€è‡´ï¼‰ã€‚</li>
<li>æ‰§è¡Œæ–¹æ³•ï¼š<code>list()</code>ï¼ˆæŸ¥è¯¢åˆ—è¡¨ï¼‰ã€<code>one()</code>ï¼ˆæŸ¥è¯¢å•æ¡ï¼‰ã€<code>count()</code>ï¼ˆæŸ¥è¯¢æ•°é‡ï¼‰ç­‰ã€‚</li>
</ul>
</li>
<li><pre><code class="java">// å¸¸è§„æ–¹æ³•ï¼Œé“¾å¼æŸ¥è¯¢ï¼šæŸ¥è¯¢nameä¸º&quot;å¼ ä¸‰&quot;ä¸”ageâ‰¥18çš„ç”¨æˆ·åˆ—è¡¨
List&lt;User&gt; users = new QueryChainWrapper&lt;&gt;(userMapper)
    .eq(&quot;name&quot;, &quot;å¼ ä¸‰&quot;)
    .ge(&quot;age&quot;, 18)
    .orderByDesc(&quot;create_time&quot;)
    .list(); // ç›´æ¥æ‰§è¡ŒæŸ¥è¯¢
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### UpdateChainWrapper</span><br><span class="line"></span><br><span class="line">- **ä½œç”¨**ï¼šç”¨äºæ„å»ºæ›´æ–°æ¡ä»¶ï¼ˆ`SET` å­—æ®µå€¼ + `WHERE` æ¡ä»¶ï¼‰ï¼Œå¹¶ç›´æ¥æ‰§è¡Œæ›´æ–°æ“ä½œã€‚</span><br><span class="line"></span><br><span class="line">- æ ¸å¿ƒæ–¹æ³•ï¼š</span><br><span class="line"></span><br><span class="line">  - å­—æ®µæ–¹æ³•ï¼š`set()`ï¼ˆè®¾ç½®æ›´æ–°å­—æ®µï¼‰ã€`setSql()`ï¼ˆç›´æ¥å†™ SQL ç‰‡æ®µï¼‰ç­‰ã€‚</span><br><span class="line">  - æ¡ä»¶æ–¹æ³•ï¼š`eq()`ã€`in()` ç­‰ï¼ˆä¸ `UpdateWrapper` ä¸€è‡´ï¼‰ã€‚</span><br><span class="line">  - æ‰§è¡Œæ–¹æ³•ï¼š`update()`ï¼ˆæ‰§è¡Œæ›´æ–°ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">- ```java</span><br><span class="line">  // é“¾å¼æ›´æ–°ï¼šå°†nameä¸º&quot;å¼ ä¸‰&quot;çš„ç”¨æˆ·ageæ”¹ä¸º20</span><br><span class="line">  boolean success = new UpdateChainWrapper&lt;&gt;(userMapper)</span><br><span class="line">      .set(&quot;age&quot;, 20)</span><br><span class="line">      .eq(&quot;name&quot;, &quot;å¼ ä¸‰&quot;)</span><br><span class="line">      .update(); // ç›´æ¥æ‰§è¡Œæ›´æ–°</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<h2 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h2><p>åœ¨ Tomcat å¤„ç† HTTP è¯·æ±‚çš„æµç¨‹ä¸­ï¼Œ<strong>æ¯ä¸ªç”¨æˆ·è¯·æ±‚éƒ½ä¼šç”± Tomcat çº¿ç¨‹æ± ä¸­çš„</strong>ã€Œç‹¬ç«‹çº¿ç¨‹ã€<strong>å¤„ç†</strong>ï¼ˆçº¿ç¨‹ä»æ± å†…å–å‡º â†’ å¤„ç†è¯·æ±‚ â†’ ç”¨å®Œå›æ”¶ï¼‰ã€‚ç”±äºä¸åŒç”¨æˆ·çš„è¯·æ±‚ç”±<strong>ä¸åŒçº¿ç¨‹</strong>æ‰§è¡Œï¼Œä¸”çº¿ç¨‹ä¼šç»è¿‡ <code>Controller</code>ã€<code>Service</code>ã€<code>DAO</code> ç­‰å¤šå±‚ç»„ä»¶è°ƒç”¨ï¼Œæ­¤æ—¶éœ€è¦ä¸€ç§æœºåˆ¶ï¼Œè®© <strong>â€œå½“å‰è¯·æ±‚çš„ä¸“å±æ•°æ®â€ èƒ½åœ¨çº¿ç¨‹å†…çš„å„ç»„ä»¶é—´å…±äº«ï¼ŒåŒæ—¶åˆä¸ä¸å…¶ä»–çº¿ç¨‹çš„è¯·æ±‚æ•°æ®å†²çª</strong> â€”â€” è¿™æ­£æ˜¯ <code>ThreadLocal</code> çš„æ ¸å¿ƒä»·å€¼ã€‚</p>
<p><u><strong>ThreadLocalçš„ä½œç”¨ä¸é€‚é…æ€§</strong>ï¼š</u></p>
<p><code>ThreadLocal</code> çš„åŸç†æ˜¯ <strong>ä¸ºæ¯ä¸ªçº¿ç¨‹ç»´æŠ¤ä¸€ä»½ã€Œç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ã€</strong>ï¼š</p>
<p>å½“ Tomcat çš„å·¥ä½œçº¿ç¨‹å¼€å§‹å¤„ç†è¯·æ±‚æ—¶ï¼Œä¼šæŠŠã€Œå½“å‰è¯·æ±‚çš„ä¸Šä¸‹æ–‡æ•°æ®ã€ï¼ˆæ¯”å¦‚ç”¨æˆ·èº«ä»½ä¿¡æ¯ã€äº‹åŠ¡ç®¡ç†å™¨ã€è‡ªå®šä¹‰çš„è¯·æ±‚ä½œç”¨åŸŸæ•°æ®ç­‰ï¼‰å­˜å…¥ <code>ThreadLocal</code>ï¼›</p>
<p>ä¹‹åï¼Œåœ¨è¯¥çº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ˆä» <code>Controller</code> æ¥æ”¶å‚æ•°ï¼Œåˆ° <code>Service</code> å¤„ç†ä¸šåŠ¡ï¼Œå†åˆ° <code>DAO</code> æ“ä½œæ•°æ®åº“ï¼‰ï¼Œæ‰€æœ‰ç»„ä»¶éƒ½èƒ½ä» <code>ThreadLocal</code> ä¸­è·å– <strong>â€œå½“å‰è¯·æ±‚ä¸“å±â€</strong> çš„æ•°æ®ï¼Œä¸”ä¸ä¼šä¸å…¶ä»–çº¿ç¨‹ï¼ˆå…¶ä»–ç”¨æˆ·çš„è¯·æ±‚ï¼‰çš„æ•°æ®äº§ç”Ÿå†²çªã€‚</p>
<p><u><strong>æ€»ç»“</strong>ï¼š</u></p>
<p>å› ä¸º â€œæ¯ä¸ªç”¨æˆ·è¯·æ±‚å¯¹åº”ç‹¬ç«‹çº¿ç¨‹â€ çš„ç‰¹æ€§ï¼Œ<code>ThreadLocal</code> èƒ½è®©<strong>æ¯ä¸ªçº¿ç¨‹åªæ“ä½œè‡ªå·±çš„é‚£ä»½æ•°æ®</strong>ï¼Œæ—¢ä¿è¯äº† â€œåŒä¸€è¯·æ±‚å†…å¤šç»„ä»¶å…±äº«æ•°æ®â€ï¼Œåˆå¤©ç„¶å®ç°äº† â€œçº¿ç¨‹éš”ç¦»â€ï¼Œå®Œç¾é€‚é… Web åº”ç”¨ä¸­ â€œè¯·æ±‚ - çº¿ç¨‹ - å¤šç»„ä»¶åä½œâ€ çš„åœºæ™¯ã€‚</p>
<h2 id="æ‹¦æˆªå™¨HandlerInterceptor"><a href="#æ‹¦æˆªå™¨HandlerInterceptor" class="headerlink" title="æ‹¦æˆªå™¨HandlerInterceptor"></a>æ‹¦æˆªå™¨HandlerInterceptor</h2><p>Spring MVC çš„ HandlerInterceptor æ˜¯è´¯å½» AOP æ€æƒ³ã€ç”¨äºæ‹¦æˆª Spring MVC è¯·æ±‚çš„æ ¸å¿ƒç»„ä»¶ï¼Œä»…ä½œç”¨äº Spring MVC å¤„ç†çš„è¯·æ±‚ï¼Œç”Ÿå‘½å‘¨æœŸç”± Spring ç®¡ç†ï¼Œå¯åœ¨<strong>è¯·æ±‚åˆ° Controller å‰ã€Controller æ‰§è¡Œåã€è§†å›¾æ¸²æŸ“å®Œæˆå</strong>ä¸‰ä¸ªé˜¶æ®µæ’å…¥è‡ªå®šä¹‰é€»è¾‘ï¼Œå®ç°æƒé™éªŒè¯ã€æ—¥å¿—è®°å½•ã€èµ„æºæ¸…ç†ç­‰æ¨ªåˆ‡éœ€æ±‚ã€‚</p>
<p>å…¶æ ¸å¿ƒæœ‰ 3 ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li><code>preHandle</code>ï¼ˆæ­£åºæ‰§è¡Œï¼‰ï¼šè¯·æ±‚å‰ç½®å¤„ç†ï¼Œè¿”å›<code>true</code>åˆ™ç»§ç»­è¯·æ±‚ï¼Œ<code>false</code>åˆ™ä¸­æ–­ï¼Œå¸¸ç”¨äºç™»å½•æ ¡éªŒï¼›</li>
<li><code>postHandle</code>ï¼ˆé€†åºæ‰§è¡Œï¼‰ï¼šController æ‰§è¡Œåã€è§†å›¾æ¸²æŸ“å‰å¤„ç†ï¼Œå¯ä¿®æ”¹<code>ModelAndView</code>ï¼Œå¦‚åŠ å…¨å±€æ•°æ®ï¼›</li>
<li><code>afterCompletion</code>ï¼ˆé€†åºæ‰§è¡Œï¼‰ï¼šè¯·æ±‚å…¨æµç¨‹ç»“æŸåæ‰§è¡Œï¼ˆæ— è®ºæˆè´¥ï¼‰ï¼Œç”¨äºèµ„æºæ¸…ç†ï¼Œå¦‚å…³è¿æ¥ã€æ¸…<code>ThreadLocal</code>ã€‚</li>
</ul>
<p>æ‹¦æˆªå™¨é€šè¿‡<code>HandlerExecutionChain</code>å°è£…æˆé“¾ï¼Œæ‰§è¡Œè§„åˆ™ä¸º â€œpreHandle æ­£åºã€åä¸¤ä¸ªæ–¹æ³•é€†åºâ€ï¼›ä¸ Servlet Filter ç›¸æ¯”ï¼Œå®ƒå¯¹ Spring MVC è¯·æ±‚æ§åˆ¶æ›´ç²¾ç»†ï¼Œé…ç½®ä¾èµ–<code>WebMvcConfigurer</code>ï¼Œè¿˜å¯é€šè¿‡<code>Ordered</code>&#x2F;<code>@Order</code>æ’åºã€<code>MappedInterceptor</code>åŠ¨æ€åŒ¹é…è·¯å¾„ï¼Œä¼˜åŒ–æ—¶éœ€é¿å…è€—æ—¶æ“ä½œã€æ§åˆ¶ä½œç”¨èŒƒå›´ã€‚</p>
<p>è¦ä½¿æ‹¦æˆªå™¨ç”Ÿæ•ˆï¼Œéœ€è¦é…ç½®æ‹¦æˆªå™¨<br>éœ€è¦åœ¨å®ç°äº†WebMvcConfigurerçš„é…ç½®ç±»ï¼ˆ@Configurationï¼‰ï¼Œç¼–å†™addInterceptors(InterceptroRegistry registry)æ–¹æ³•ï¼Œä½¿ç”¨æ³¨å†Œå™¨registryé€šè¿‡addInterceptoræ–¹æ³•æ¥é…ç½®æ‹¦æˆªè·¯å¾„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"><span class="comment">// æ‹¦æˆªå™¨é…ç½®ç±»ï¼ˆ@Configuration æ ‡è®°ä¸ºSpringé…ç½®ç±»ï¼‰</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcInterceptorConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ³¨å†Œæ‹¦æˆªå™¨ï¼Œå¹¶é…ç½®æ‹¦æˆª/æ’é™¤è·¯å¾„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// 1. æ³¨å†Œè‡ªå®šä¹‰çš„LoginInterceptor</span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>())</span><br><span class="line">                <span class="comment">// 2. é…ç½®ã€Œéœ€è¦æ‹¦æˆªã€çš„è·¯å¾„ï¼ˆAnté£æ ¼ï¼Œ/** è¡¨ç¤ºæ‰€æœ‰è¯·æ±‚ï¼‰</span></span><br><span class="line">                .addPathPatterns(<span class="string">&quot;/**&quot;</span>) </span><br><span class="line">                <span class="comment">// 3. é…ç½®ã€Œä¸éœ€è¦æ‹¦æˆªã€çš„è·¯å¾„ï¼ˆæ’é™¤ç™»å½•ã€é™æ€èµ„æºç­‰ï¼‰</span></span><br><span class="line">                .excludePathPatterns(</span><br><span class="line">                        <span class="string">&quot;/login&quot;</span>,          <span class="comment">// ç™»å½•æ¥å£ï¼ˆæœªç™»å½•æ—¶éœ€è®¿é—®ï¼Œä¸æ‹¦æˆªï¼‰</span></span><br><span class="line">                        <span class="string">&quot;/register&quot;</span>,       <span class="comment">// æ³¨å†Œæ¥å£ï¼ˆåŒç†ä¸æ‹¦æˆªï¼‰</span></span><br><span class="line">                        <span class="string">&quot;/static/**&quot;</span>,      <span class="comment">// é™æ€èµ„æºï¼ˆCSSã€JSã€å›¾ç‰‡ç­‰ï¼Œä¸æ‹¦æˆªï¼‰</span></span><br><span class="line">                        <span class="string">&quot;/error&quot;</span>           <span class="comment">// é”™è¯¯é¡µé¢ï¼ˆå¦‚404ã€500ï¼Œä¸æ‹¦æˆªï¼‰</span></span><br><span class="line">                );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è‹¥éœ€æ³¨å†Œå¤šä¸ªæ‹¦æˆªå™¨ï¼ˆå¦‚ â€œç™»å½•æ‹¦æˆªå™¨â€+â€œæ—¥å¿—æ‹¦æˆªå™¨â€ï¼‰ï¼Œå¯åœ¨ <code>addInterceptors</code> ä¸­å¤šæ¬¡è°ƒç”¨</p>
<h2 id="ä½¿ç”¨Hutoolå·¥å…·ç±»è¿›è¡Œå¯¹è±¡å±æ€§æ‹·è´"><a href="#ä½¿ç”¨Hutoolå·¥å…·ç±»è¿›è¡Œå¯¹è±¡å±æ€§æ‹·è´" class="headerlink" title="ä½¿ç”¨Hutoolå·¥å…·ç±»è¿›è¡Œå¯¹è±¡å±æ€§æ‹·è´"></a>ä½¿ç”¨Hutoolå·¥å…·ç±»è¿›è¡Œå¯¹è±¡å±æ€§æ‹·è´</h2><p>Hutool æä¾›äº† <code>BeanUtil</code> å’Œ <code>CollUtil</code> å·¥å…·ç±»ï¼Œå¯ç®€æ´å®ç°å®ä½“ç±»å¯¹è±¡åŠ List é›†åˆçš„å±æ€§æ‹·è´ï¼ˆç›¸åŒå±æ€§å€¼å¤åˆ¶ï¼‰ï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™ set&#x2F;get ä»£ç ã€‚</p>
<p>ä»¥ä¸‹æ˜¯å…·ä½“å®ç°æ–¹å¼ï¼š</p>
<ol>
<li><p>å®ä½“ç±»å¯¹è±¡æ‹·è´ï¼ˆå•ä¸ªå¯¹è±¡ï¼‰</p>
<p>ä½¿ç”¨ <code>BeanUtil.copyProperties</code> æ–¹æ³•ï¼Œè‡ªåŠ¨å¤åˆ¶ä¸¤ä¸ªå¯¹è±¡é—´åç§°å’Œç±»å‹ç›¸åŒçš„å±æ€§ã€‚</p>
</li>
<li><p>List é›†åˆæ‹·è´ï¼ˆæ‰¹é‡å¯¹è±¡ï¼‰</p>
<p>é€šè¿‡ <code>BeanUtil.copyProperties</code> ç»“åˆæµå¤„ç†ï¼Œæ‰¹é‡æ‹·è´é›†åˆä¸­æ‰€æœ‰å¯¹è±¡çš„å±æ€§ã€‚</p>
</li>
</ol>
<p>æ‹·è´è§„åˆ™ï¼š</p>
<ul>
<li>ä»…å¤åˆ¶<strong>åç§°å’Œç±»å‹å‡ç›¸åŒ</strong>çš„å±æ€§ï¼ˆç±»å‹éœ€å…¼å®¹ï¼Œå¦‚ <code>int</code> ä¸ <code>Integer</code> å¯äº’è½¬ï¼‰ã€‚</li>
<li>ç›®æ ‡å¯¹è±¡ä¸­ç‹¬æœ‰çš„å±æ€§ï¼ˆå¦‚ <code>UserDTO</code> çš„ <code>extra</code>ï¼‰ä¼šè¢«å¿½ç•¥ï¼Œæºå¯¹è±¡ä¸­ç‹¬æœ‰çš„å±æ€§ä¹Ÿä¸ä¼šå½±å“ç›®æ ‡å¯¹è±¡ã€‚</li>
</ul>
<p>æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>è‹¥å±æ€§åä¸åŒï¼Œå¯é€šè¿‡ <code>BeanUtil.copyProperties</code> çš„é‡è½½æ–¹æ³•è‡ªå®šä¹‰æ˜ å°„è§„åˆ™ï¼ˆå¦‚ <code>CopyOptions</code>ï¼‰ã€‚</li>
</ul>
<h2 id="éšè—ç”¨æˆ·ä¿¡æ¯"><a href="#éšè—ç”¨æˆ·ä¿¡æ¯" class="headerlink" title="éšè—ç”¨æˆ·ä¿¡æ¯"></a>éšè—ç”¨æˆ·ä¿¡æ¯</h2><p>å‰åç«¯æ•°æ®äº¤äº’çš„æ ‡å‡†æœ€ä½³å®è·µï¼š</p>
<p>é€šè¿‡DTOå¯¹è±¡ç±»è¿›è¡Œå‰åç«¯ä¼ é€’æ•°æ®ã€‚entityç±»è´Ÿè´£è·Ÿæ•°æ®åº“äº¤æ¢æ•°æ®ã€‚</p>
<ul>
<li>Entity ç±»ï¼ˆä¸æ•°æ®åº“äº¤äº’ï¼Œå«æ•æ„Ÿå­—æ®µï¼‰</li>
<li>DTO ç±»ï¼ˆå‰åç«¯ä¼ è¾“ï¼Œéšè—æ•æ„Ÿä¿¡æ¯ï¼‰</li>
</ul>
<h2 id="ä»£ç å®ç°"><a href="#ä»£ç å®ç°" class="headerlink" title="ä»£ç å®ç°"></a>ä»£ç å®ç°</h2><h3 id="å‘é€éªŒè¯ç "><a href="#å‘é€éªŒè¯ç " class="headerlink" title="å‘é€éªŒè¯ç "></a>å‘é€éªŒè¯ç </h3><p>IUserServiceå£°æ˜ï¼ŒUserServiceImplå®ç°</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Result <span class="title function_">sendCode</span><span class="params">(String phone, HttpSession session)</span> &#123;</span><br><span class="line">    <span class="comment">// 1.æ ¡éªŒæ‰‹æœºå·</span></span><br><span class="line">    <span class="keyword">if</span> (RegexUtils.isPhoneInvalid(phone)) &#123;</span><br><span class="line">        <span class="comment">// 2.å¦‚æœä¸ç¬¦åˆï¼Œè¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">        <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ‰‹æœºå·æ ¼å¼é”™è¯¯ï¼&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 3.ç¬¦åˆï¼Œç”ŸæˆéªŒè¯ç </span></span><br><span class="line">    <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> RandomUtil.randomNumbers(<span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.ä¿å­˜éªŒè¯ç åˆ° session</span></span><br><span class="line">    session.setAttribute(<span class="string">&quot;code&quot;</span>,code);</span><br><span class="line">    <span class="comment">// 5.å‘é€éªŒè¯ç </span></span><br><span class="line">    log.debug(<span class="string">&quot;å‘é€çŸ­ä¿¡éªŒè¯ç æˆåŠŸï¼ŒéªŒè¯ç ï¼š&#123;&#125;&quot;</span>, code);</span><br><span class="line">    <span class="comment">// è¿”å›ok</span></span><br><span class="line">    <span class="keyword">return</span> Result.ok();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> Result <span class="title function_">login</span><span class="params">(LoginFormDTO loginForm, HttpSession session)</span> &#123;</span><br><span class="line">       <span class="comment">// 1.æ ¡éªŒæ‰‹æœºå·</span></span><br><span class="line">       <span class="type">String</span> <span class="variable">phone</span> <span class="operator">=</span> loginForm.getPhone();</span><br><span class="line">       <span class="keyword">if</span> (RegexUtils.isPhoneInvalid(phone)) &#123;</span><br><span class="line">           <span class="comment">// 2.å¦‚æœä¸ç¬¦åˆï¼Œè¿”å›é”™è¯¯ä¿¡æ¯</span></span><br><span class="line">           <span class="keyword">return</span> Result.fail(<span class="string">&quot;æ‰‹æœºå·æ ¼å¼é”™è¯¯ï¼&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// 3.æ ¡éªŒéªŒè¯ç </span></span><br><span class="line">       <span class="type">Object</span> <span class="variable">cacheCode</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;code&quot;</span>);</span><br><span class="line">       <span class="type">String</span> <span class="variable">code</span> <span class="operator">=</span> loginForm.getCode();</span><br><span class="line">       <span class="keyword">if</span>(cacheCode == <span class="literal">null</span> || !cacheCode.toString().equals(code))&#123;</span><br><span class="line">           <span class="comment">//3.ä¸ä¸€è‡´ï¼ŒæŠ¥é”™</span></span><br><span class="line">           <span class="keyword">return</span> Result.fail(<span class="string">&quot;éªŒè¯ç é”™è¯¯&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// 4.éªŒè¯ç ä¸€è‡´ï¼ŒæŸ¥è¯¢ç”¨æˆ·</span></span><br><span class="line">       User user=query().eq(<span class="string">&quot;phone&quot;</span>,phone).one();</span><br><span class="line">       <span class="keyword">if</span>(user == <span class="literal">null</span>)&#123;</span><br><span class="line">           <span class="comment">// 5.ç”¨æˆ·ä¸å­˜åœ¨ï¼Œåˆ›å»º</span></span><br><span class="line">           user =  createUserWithPhone(phone);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">//6.ä¿æŠ¤ç”¨æˆ·ä¿¡æ¯åˆ°session</span></span><br><span class="line">       session.setAttribute(<span class="string">&quot;user&quot;</span>,user);</span><br><span class="line">       <span class="comment">//7.è¿”å›ok</span></span><br><span class="line">       <span class="keyword">return</span> Result.ok();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> User <span class="title function_">createUserWithPhone</span><span class="params">(String phone)</span> &#123;</span><br><span class="line">       <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">       user.setPhone(phone);</span><br><span class="line">       <span class="keyword">return</span> user;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ç™»å½•æ ¡éªŒæ‹¦æˆªå™¨"><a href="#ç™»å½•æ ¡éªŒæ‹¦æˆªå™¨" class="headerlink" title="ç™»å½•æ ¡éªŒæ‹¦æˆªå™¨"></a>ç™»å½•æ ¡éªŒæ‹¦æˆªå™¨</h3><p>æ‹¦æˆªå™¨ä»£ç ï¼Œåœ¨utilsåŒ…ä¸‹åˆ›å»º</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginInterceptor</span> <span class="keyword">implements</span> <span class="title class_">HandlerInterceptor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//1.è·å–session</span></span><br><span class="line">        <span class="type">HttpSession</span> <span class="variable">session</span> <span class="operator">=</span> request.getSession();</span><br><span class="line">        <span class="comment">//2.è·å–sessionä¸­çš„ç”¨æˆ·</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">user</span> <span class="operator">=</span> session.getAttribute(<span class="string">&quot;user&quot;</span>);</span><br><span class="line">        <span class="comment">//3.åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">        <span class="keyword">if</span>(user != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">//4.ä¸å­˜åœ¨å°±æ‹¦æˆªï¼Œè¿”å›401çŠ¶æ€ç </span></span><br><span class="line">            response.setStatus(<span class="number">401</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//5.å­˜åœ¨,ä¿å­˜ç”¨æˆ·ä¿¡æ¯åˆ°ThreadLocal</span></span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">userDTO</span> <span class="operator">=</span> BeanUtil.copyProperties(user, UserDTO.class);</span><br><span class="line">        UserHolder.saveUser(userDTO);</span><br><span class="line">        <span class="comment">//6.æ”¾è¡Œ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ·»åŠ æ‹¦æˆªå™¨ï¼Œé…ç½®ç±»</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MvcConfig</span> <span class="keyword">implements</span> <span class="title class_">WebMvcConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> StringRedisTemplate stringRedisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> &#123;</span><br><span class="line">        <span class="comment">// ç™»å½•æ‹¦æˆªå™¨</span></span><br><span class="line">        registry.addInterceptor(<span class="keyword">new</span> <span class="title class_">LoginInterceptor</span>())</span><br><span class="line">                .excludePathPatterns(</span><br><span class="line">                        <span class="string">&quot;/shop/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/voucher/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/shop-type/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/upload/**&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/blog/hot&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/user/code&quot;</span>,</span><br><span class="line">                        <span class="string">&quot;/user/login&quot;</span></span><br><span class="line">                ).order(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div>

    
    <section class="post-copyright">
      
      <p class="copyright-item">
        <span>ä½œè€…:</span>
        <span>è€æ±Ÿæ¹–</span>
      </p>
       
      <p class="copyright-item">
        <span>æ°¸ä¹…é“¾æ¥:</span>
        <span><a href="https://meisijiya.github.io/2025/09/20/%E9%BB%91%E9%A9%AC%E7%82%B9%E8%AF%84/02-%E7%9F%AD%E4%BF%A1%E7%99%BB%E5%BD%95-%E5%9F%BA%E4%BA%8Esession%E6%96%B9%E6%A1%88/">https://meisijiya.github.io/2025/09/20/%E9%BB%91%E9%A9%AC%E7%82%B9%E8%AF%84/02-%E7%9F%AD%E4%BF%A1%E7%99%BB%E5%BD%95-%E5%9F%BA%E4%BA%8Esession%E6%96%B9%E6%A1%88/</a></span>
      </p>
       
      <p class="copyright-item">
        <span>è®¸å¯è¯:</span>
        <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span>
      </p>
       
      <p class="copyright-item">
        <span>å£å·:</span>
        <span>Do you believe in <strong>DESTINY</strong>? <br> å¦‚æœ‰ä¾µæƒè¯·å‘ŠçŸ¥åˆ é™¤ğŸ™</span>
      </p>
      
    </section>
    
    <section class="post-tags">
      <div>
        <span>æ ‡ç­¾:</span>
        <span class="tag">
           
          <a href="/tags/session/"># session</a>
          
          <a href="/tags/Hutool%E5%B7%A5%E5%85%B7/"># Hutoolå·¥å…·</a>
          
          <a href="/tags/Mybatis-plus/"># Mybatis-plus</a>
          
          <a href="/tags/SpringMVC/"># SpringMVC</a>
           
        </span>
      </div>
      <div>
        <a href="javascript:window.history.back();">è¿”å›</a>
        <span>Â· </span>
        <a href="/">é¦–é¡µ</a>
      </div>
    </section>
    <section class="post-nav">
      
      <a class="prev" rel="prev" href="/2025/09/20/%E9%BB%91%E9%A9%AC%E7%82%B9%E8%AF%84/01-%E6%80%BB%E8%A7%88/"
        >01-æ€»è§ˆ</a
      >
       
      <a class="next" rel="next" href="/2025/09/17/%E6%96%B0%E5%A2%9E%E8%AF%84%E8%AE%BA%E5%8A%9F%E8%83%BD/"
        >æ–°å¢è¯„è®ºåŠŸèƒ½</a
      >
      
    </section>

    <!-- Giscus è¯„è®ºåŒºæŒ‚è½½ç‚¹ -->
<div id="giscus-container" style="margin-top: 2.5rem;"></div>

<!-- Giscus åŠ¨æ€åŠ è½½è„šæœ¬ï¼šåˆå§‹åŠ è½½ + æ˜æš—ä¸»é¢˜åˆ‡æ¢ -->
<script>
  function createGiscus(theme) {
    const giscusContainer = document.getElementById('giscus-container');
    if (!giscusContainer) return;

    // æ¸…é™¤æ—§çš„è¯„è®º iframe
    giscusContainer.innerHTML = '';

    const script = document.createElement('script');
    script.src = 'https://giscus.app/client.js';

    // æ›¿æ¢ä¸ºä½ çš„ GitHub ä»“åº“ä¿¡æ¯ï¼ˆæ ¼å¼ï¼šusername/repoï¼‰
    script.setAttribute('data-repo', 'meisijiya/meisijiya.github.io');

   // æ›¿æ¢ä¸ºä½ çš„ repo-id å’Œ category-idï¼ˆåœ¨ giscus.app é…ç½®é¡µé¢ç”Ÿæˆï¼‰
    script.setAttribute('data-repo-id', 'R_kgDOPwTrpQ');
    script.setAttribute('data-category', 'Announcements');
    script.setAttribute('data-category-id', 'DIC_kwDOPwTrpc4CviGR');

    // å…¶ä»–å¸¸è§„æ¨èè®¾ç½®
    script.setAttribute('data-mapping', 'pathname');           // ç”¨é¡µé¢è·¯å¾„åŒ¹é…è¯„è®ºå¸–
    script.setAttribute('data-strict', '0');                   // è‹¥æ— åŒ¹é…å¸–åˆ™åˆ›å»ºæ–°å¸–
    script.setAttribute('data-reactions-enabled', '1');        // å¯ç”¨è¡¨æƒ…ååº”
    script.setAttribute('data-emit-metadata', '0');            // ä¸è¾“å‡ºå…ƒæ•°æ®
    script.setAttribute('data-input-position', 'top');         // è¾“å…¥æ¡†åœ¨è¯„è®ºä¸Šæ–¹
    script.setAttribute('data-theme', theme);                
    script.setAttribute('data-lang', 'zh-CN');                 // ä¸­æ–‡ç•Œé¢
    script.setAttribute('crossorigin', 'anonymous');           // è·¨åŸŸèµ„æºå®‰å…¨
    script.async = true;                                       
     
    giscusContainer.appendChild(script);
  }

  function getCurrentTheme() {
    return document.body.classList.contains('dark-theme') ? 'dark' : 'light';
  }

  document.addEventListener('DOMContentLoaded', () => {
    // é¡µé¢é¦–æ¬¡åŠ è½½ï¼Œæ ¹æ®å½“å‰ä¸»é¢˜æŒ‚è½½è¯„è®º
    createGiscus(getCurrentTheme());

    // ç›‘å¬æŒ‰é’®ç‚¹å‡»åˆ‡æ¢ä¸»é¢˜ â†’ é‡è½½è¯„è®ºåŒº
    const buttons = [
      document.querySelector('.toggleBtn'),
      document.getElementById('mobile-toggle-theme')
    ];
    buttons.forEach(btn => {
      if (!btn) return;
      btn.addEventListener('click', () => {
        setTimeout(() => {
          createGiscus(getCurrentTheme());
        }, 400); // ç¨ä½œå»¶è¿Ÿï¼Œç¡®ä¿ class åˆ‡æ¢å®Œæ¯•
      });
    });

    // ç›‘å¬ body class æ”¹å˜ï¼ˆä¿é™©æ–¹æ¡ˆï¼‰
    const observer = new MutationObserver(() => {
      createGiscus(getCurrentTheme());
    });
    observer.observe(document.body, { attributes: true, attributeFilter: ['class'] });
  });
</script>

  </article>
</div>

            </div>
            <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© è€æ±Ÿæ¹– | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>

</html>